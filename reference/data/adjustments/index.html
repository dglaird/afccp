
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://dglaird.github.io/afccp/reference/data/adjustments/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../preferences/">
      
      
      <link rel="icon" href="../../../images/logos/afccp_logo_favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Adjustments - Air Force Cadet Career Problem</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#data.adjustments" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Air Force Cadet Career Problem" class="md-header__button md-logo" aria-label="Air Force Cadet Career Problem" data-md-component="logo">
      
  <img src="../../../images/logos/afccp_logo_and_text_light.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Air Force Cadet Career Problem
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Adjustments
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/dglaird/afccp/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  üè† Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../getting-started/getting-started/" class="md-tabs__link">
          
  
  
  üöÄ Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../user-guide/overview/" class="md-tabs__link">
          
  
  
  üìò User Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../developer-guide/" class="md-tabs__link">
        
  
  
    
  
  üß† Developer Guide

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../main/cadetcareerproblem_overview/" class="md-tabs__link">
          
  
  
  CadetCareerProblem

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
  üìä Data

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../solutions/" class="md-tabs__link">
          
  
  
  üìà Solutions

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../visualizations/" class="md-tabs__link">
          
  
  
  Visualizations

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../faq/" class="md-tabs__link">
        
  
  
    
  
  ‚ùì FAQs

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../help/" class="md-tabs__link">
        
  
  
    
  
  üÜò Help & Support

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Air Force Cadet Career Problem" class="md-nav__button md-logo" aria-label="Air Force Cadet Career Problem" data-md-component="logo">
      
  <img src="../../../images/logos/afccp_logo_and_text_light.png" alt="logo">

    </a>
    Air Force Cadet Career Problem
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dglaird/afccp/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    üè† Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    üöÄ Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            üöÄ Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    üìÑ Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    üõ†Ô∏è Install Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            üõ†Ô∏è Install Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation Instructions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/developer-checklist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developer Checklist
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    üìò User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            üìò User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/tutorial_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 1 (Introduction)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/tutorial_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 2 (Data Overview)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/tutorial_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 3 (Parameters)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/tutorial_4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 4 (Value Parameters)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/tutorial_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 5 (Data Methods)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/tutorial_6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 6 (Solutions Overview)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/tutorial_7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 7 (Algorithms)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/tutorial_8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 8 (Optimization)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/tutorial_9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 9 (Visualizations)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    üß† Developer Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    CadetCareerProblem
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            CadetCareerProblem
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_generated_data_corrections/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generated Data Corrections
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_main_data_corrections/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Main Data Corrections
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_other_adjustments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Other Adjustments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_value_parameter_specifications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Value Parameter Specifications
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_solution_generation_%26_algorithms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Solution Generation & Algorithms
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_optimization_models_%26_meta-heuristics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Optimization Models & Meta-Heuristics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_solution_handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Solution Handling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_export_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Export Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_data_visualizations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Visualizations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_results_visualizations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Results Visualizations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    üìä Data
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            üìä Data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Adjustments
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Adjustments
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#data.adjustments--data-adjustments-module-for-afccp" class="md-nav__link">
    <span class="md-ellipsis">
      Data Adjustments Module for AFCCP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Adjustments Module for AFCCP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data.adjustments--functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.adjustments.parameter_sanity_check" class="md-nav__link">
    <span class="md-ellipsis">
      parameter_sanity_check
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.adjustments.parameter_sets_additions" class="md-nav__link">
    <span class="md-ellipsis">
      parameter_sets_additions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.adjustments.more_parameter_additions" class="md-nav__link">
    <span class="md-ellipsis">
      more_parameter_additions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.adjustments.base_training_parameter_additions" class="md-nav__link">
    <span class="md-ellipsis">
      base_training_parameter_additions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.adjustments.set_ots_must_matches" class="md-nav__link">
    <span class="md-ellipsis">
      set_ots_must_matches
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.adjustments.gather_degree_tier_qual_matrix" class="md-nav__link">
    <span class="md-ellipsis">
      gather_degree_tier_qual_matrix
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.adjustments.convert_instance_to_from_scrubbed" class="md-nav__link">
    <span class="md-ellipsis">
      convert_instance_to_from_scrubbed
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../preferences/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Preferences
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../processing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Processing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../values/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Values
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Support
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../generation/basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generation- 'Basic'
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../generation/realistic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generation- 'Realistic'
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    üìà Solutions
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            üìà Solutions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../solutions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../solutions/algorithms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Algorithms
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../solutions/handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Handling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../solutions/optimization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Optimization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../solutions/sensitivity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sensitivity
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Visualizations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Visualizations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualizations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualizations/bubbles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bubbles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualizations/charts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Charts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualizations/slides/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Slides
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ‚ùì FAQs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../help/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    üÜò Help & Support
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<div class="doc doc-object doc-module">



<h1 id="data.adjustments" class="doc doc-heading">
            <code>data.adjustments</code>


<a href="#data.adjustments" class="headerlink" title="Permanent link">&para;</a></h1>

    <div class="doc doc-contents first">

        <h2 id="data.adjustments--data-adjustments-module-for-afccp">Data Adjustments Module for AFCCP<a class="headerlink" href="#data.adjustments--data-adjustments-module-for-afccp" title="Permanent link">&para;</a></h2>
<p>This module contains utility functions that perform critical adjustments, validations, and transformations
on the <code>parameters</code> and <code>vp_dict</code> dictionaries that define each problem instance in the AFCCP model.</p>
<p>The functions here serve as post-processing or pre-processing steps to ensure internal consistency,
prepare data for model input, or apply specific business rules (such as OTS must-matches or degree tier qualification logic).
They are commonly called after loading data or before solving a model.</p>
<h3 id="data.adjustments--functions">Functions:<a class="headerlink" href="#data.adjustments--functions" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><code>parameter_sanity_check(parameters)</code>
  Performs validation checks on parameters and value parameters to ensure modeling assumptions are satisfied.</p>
</li>
<li>
<p><code>parameter_sets_additions(parameters)</code>
  Updates derived parameter sets (like <code>I^OTS</code>, <code>I^USAF</code>, <code>J^Rated</code>) based on core problem inputs.</p>
</li>
<li>
<p><code>more_parameter_additions(parameters)</code>
  Adds further derived variables or flags used throughout the AFCCP model such as first-choice indicators.</p>
</li>
<li>
<p><code>base_training_parameter_additions(parameters)</code>
  Adds data structures needed to support Base Training assignments for cadets.</p>
</li>
<li>
<p><code>set_ots_must_matches(parameters)</code>
  Selects a subset of OTS cadets as "must-match" based on their merit and OTS accession targets.</p>
</li>
<li>
<p><code>gather_degree_tier_qual_matrix(cadets_df, parameters)</code>
  Determines the qualification matrix for AFSC eligibility based on degree tier requirements.</p>
</li>
<li>
<p><code>convert_instance_to_from_scrubbed(instance, new_letter=None, translation_dict=None, data_name='Unknown')</code>
  Converts instance AFSC names to "scrubbed" placeholders or restores them back to their original names for
  anonymized modeling and solution reproducibility.</p>
</li>
</ul>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="data.adjustments.parameter_sanity_check" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parameter_sanity_check</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span></code>

<a href="#data.adjustments.parameter_sanity_check" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Perform a Full Sanity Check on Problem Instance Parameters.</p>
<p>This function performs a comprehensive audit of the problem instance's input data and value parameters to verify that all
structures, matrices, and definitions are logically consistent and feasible. This includes checks on cadet eligibility,
AFSC quotas, objective constraints, preference list coherence, utility monotonicity, and tiered qualification logic.</p>
<p>The goal is to prevent downstream issues during optimization by catching data errors or logical mismatches in advance.
All checks are printed with contextual explanations and will highlight both errors and warnings when inconsistencies are found.</p>
<h4 id="data.adjustments.parameter_sanity_check--parameters">Parameters:<a class="headerlink" href="#data.adjustments.parameter_sanity_check--parameters" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>instance: <code>CadetCareerProblem</code> class instance
    An instantiated problem containing:</p>
<ul>
<li><code>parameters</code>: dictionaries and matrices representing cadets, AFSCs, preferences, and utility definitions.</li>
<li><code>value_parameters</code>: constraints, objective targets, and value function metadata.</li>
</ul>
</li>
</ul>
<h4 id="data.adjustments.parameter_sanity_check--returns">Returns:<a class="headerlink" href="#data.adjustments.parameter_sanity_check--returns" title="Permanent link">&para;</a></h4>
<ul>
<li>None: This function prints all identified issues to the console but does not return any values.
  It may raise a <code>ValueError</code> if <code>value_parameters</code> are not initialized.</li>
</ul>
<h4 id="data.adjustments.parameter_sanity_check--examples">Examples:<a class="headerlink" href="#data.adjustments.parameter_sanity_check--examples" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">afccp.data.adjustments</span> <span class="kn">import</span> <span class="n">parameter_sanity_check</span>
<span class="n">parameter_sanity_check</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
</code></pre></div>
<p>This prints a series of diagnostics like:</p>
<ul>
<li>"ISSUE: AFSC '15A' quota constraint invalid: 12 (min) &gt; 10 (eligible)"</li>
<li>"WARNING: Cadet 41 has no preferences and is therefore eligible for nothing."</li>
<li>"ISSUE: Value function breakpoints for AFSC '17X' objective 'Tier 2' are misaligned."</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>afccp/data/adjustments.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parameter_sanity_check</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform a Full Sanity Check on Problem Instance Parameters.</span>

<span class="sd">    This function performs a comprehensive audit of the problem instance&#39;s input data and value parameters to verify that all</span>
<span class="sd">    structures, matrices, and definitions are logically consistent and feasible. This includes checks on cadet eligibility,</span>
<span class="sd">    AFSC quotas, objective constraints, preference list coherence, utility monotonicity, and tiered qualification logic.</span>

<span class="sd">    The goal is to prevent downstream issues during optimization by catching data errors or logical mismatches in advance.</span>
<span class="sd">    All checks are printed with contextual explanations and will highlight both errors and warnings when inconsistencies are found.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    --------</span>
<span class="sd">    - instance: `CadetCareerProblem` class instance</span>
<span class="sd">        An instantiated problem containing:</span>

<span class="sd">        - `parameters`: dictionaries and matrices representing cadets, AFSCs, preferences, and utility definitions.</span>
<span class="sd">        - `value_parameters`: constraints, objective targets, and value function metadata.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    - None: This function prints all identified issues to the console but does not return any values.</span>
<span class="sd">      It may raise a `ValueError` if `value_parameters` are not initialized.</span>

<span class="sd">    Examples:</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from afccp.data.adjustments import parameter_sanity_check</span>
<span class="sd">    parameter_sanity_check(instance)</span>
<span class="sd">    ```</span>

<span class="sd">    This prints a series of diagnostics like:</span>

<span class="sd">    - &quot;ISSUE: AFSC &#39;15A&#39; quota constraint invalid: 12 (min) &gt; 10 (eligible)&quot;</span>
<span class="sd">    - &quot;WARNING: Cadet 41 has no preferences and is therefore eligible for nothing.&quot;</span>
<span class="sd">    - &quot;ISSUE: Value function breakpoints for AFSC &#39;17X&#39; objective &#39;Tier 2&#39; are misaligned.&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Shorthand</span>
    <span class="n">p</span><span class="p">,</span> <span class="n">vp</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">value_parameters</span>

    <span class="k">if</span> <span class="n">vp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot sanity check parameters without specifying which value_parameters to use.&quot;</span><span class="p">)</span>

    <span class="c1"># Initialization</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sanity checking the instance parameters...&quot;</span><span class="p">)</span>
    <span class="n">issue</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Check constraint type matrix (I discontinued &quot;3&quot;s and &quot;4&quot;s in favor of just doing &quot;1&quot;s and &quot;2&quot;s</span>
    <span class="k">if</span> <span class="mi">3</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;constraint_type&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">4</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;constraint_type&#39;</span><span class="p">]:</span>
        <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: &#39;constraint_type&#39; matrix contains 3s and/or 4s instead of 1s and 2s. I discontinued the&quot;</span>
                     <span class="s2">&quot;use of the former in favor of the latter so please adjust it.&quot;</span><span class="p">)</span>

    <span class="c1"># Loop through each AFSC to check various elements</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;afscs&quot;</span><span class="p">][:</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]]):</span>

        <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;num_eligible&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;quota_min&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
            <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: AFSC &#39;&quot;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span> <span class="s2">&quot;&#39; quota constraint invalid. &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;quota_min&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span>
                  <span class="s2">&quot; (min) &gt; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;num_eligible&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; (number of eligible cadets).&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;num_eligible&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;quota_min&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
            <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;WARNING: AFSC &#39;&quot;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span>
                  <span class="s2">&quot;&#39; has a lower quota that is the same as its number of eligible cadets (&quot;</span> <span class="o">+</span>
                  <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;quota_min&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;). All eligible cadets for this AFSC will be assigned to it.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;quota_min&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;quota_max&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
            <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: AFSC &#39;&quot;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span> <span class="s2">&quot;&#39; quota constraint invalid. &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;quota_min&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span>
                  <span class="s2">&quot; (min) &gt; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;quota_max&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; (max).&quot;</span><span class="p">)</span>

        <span class="n">quota_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s2">&quot;objectives&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Combined Quota&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;quota_d&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;objective_target&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">quota_k</span><span class="p">]:</span>
            <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: AFSC &#39;&quot;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span> <span class="s2">&quot;&#39; quota desired target of &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;quota_d&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span>
                  <span class="s2">&quot; from AFSCs Fixed does not match its objective target (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s2">&quot;objective_target&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">quota_k</span><span class="p">])</span> <span class="o">+</span>
                  <span class="s2">&quot;) in the value parameters.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;quota_d&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;quota_min&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="ow">or</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;quota_d&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;quota_max&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
            <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: AFSC &#39;&quot;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span> <span class="s2">&quot;&#39; quota desired target of &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;quota_d&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span>
                  <span class="s2">&quot; is outside the specified range on the number of cadets (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;quota_min&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span>
                  <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;quota_max&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;).&quot;</span><span class="p">)</span>

        <span class="c1"># If we have the AFSC preference lists, we validate certain features</span>
        <span class="k">if</span> <span class="s1">&#39;a_pref_matrix&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>

            <span class="n">cfm_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;a_pref_matrix&#39;</span><span class="p">][:,</span> <span class="n">j</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Cadets on the AFSC preference list</span>

            <span class="c1"># Cadets that are both on the CFM preference list and are eligible for the AFSC (qual matrix)</span>
            <span class="n">both_lists</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">cfm_list</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>  <span class="c1"># SHOULD contain the same cadets</span>
            <span class="n">num_cfm</span><span class="p">,</span> <span class="n">num_qual</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cfm_list</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>  <span class="c1"># SHOULD be the same number of cadets</span>

            <span class="c1"># If the numbers aren&#39;t equal</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">both_lists</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_qual</span><span class="p">:</span>
                <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">cfm_not_qual</span> <span class="o">=</span> <span class="p">[</span><span class="n">cadet</span> <span class="k">for</span> <span class="n">cadet</span> <span class="ow">in</span> <span class="n">cfm_list</span> <span class="k">if</span> <span class="n">cadet</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]]</span>
                <span class="n">qual_not_cfm</span> <span class="o">=</span> <span class="p">[</span><span class="n">cadet</span> <span class="k">for</span> <span class="n">cadet</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="k">if</span> <span class="n">cadet</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cfm_list</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: AFSC &#39;&quot;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span> <span class="s2">&quot;&#39; CFM preference list (&#39;a_pref_matrix&#39;) does not match the qual&quot;</span>
                                                      <span class="s2">&quot;matrix. </span><span class="se">\n</span><span class="s2">There are &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_cfm</span><span class="p">)</span> <span class="o">+</span>
                      <span class="s2">&quot; cadets that are on the preference list (non-zero ranks) but there are &quot;</span>
                      <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_qual</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &#39;eligible&#39; cadets (qual matrix). There are &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">both_lists</span><span class="p">))</span> <span class="o">+</span>
                      <span class="s2">&quot; cadets in both sets. </span><span class="se">\n</span><span class="s2">CFM list but not qual cadets:&quot;</span><span class="p">,</span> <span class="n">cfm_not_qual</span><span class="p">,</span>
                      <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Qual but not CFM list cadets:&quot;</span><span class="p">,</span> <span class="n">qual_not_cfm</span><span class="p">)</span>

            <span class="c1"># Make sure that all eligibility pairs line up</span>
            <span class="k">if</span> <span class="s1">&#39;c_pref_matrix&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cadet</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadets&#39;</span><span class="p">]):</span>

                    <span class="n">on_afsc_list</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;a_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
                    <span class="n">on_cadet_list</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>

                    <span class="k">if</span> <span class="n">on_cadet_list</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">on_afsc_list</span><span class="p">:</span>
                        <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: AFSC &#39;&quot;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span> <span class="s2">&quot;&#39; is on cadet &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cadet</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; (index=&quot;</span> <span class="o">+</span>
                              <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&#39;s preference list (c_pref_matrix) but the cadet is not on their preference &quot;</span>
                                       <span class="s2">&quot;list (a_pref_matrix).&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">on_afsc_list</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">on_cadet_list</span><span class="p">:</span>
                        <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: Cadet &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cadet</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; (index=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) is on AFSC &#39;&quot;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span>
                              <span class="s2">&quot;&#39;s preference list (a_pref_matrix) but the AFSC is not on their preference list (c_pref_matrix).&quot;</span><span class="p">)</span>

        <span class="c1"># Validate AFOCD tier objectives</span>
        <span class="k">for</span> <span class="n">objective</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Mandatory&quot;</span><span class="p">,</span> <span class="s2">&quot;Desired&quot;</span><span class="p">,</span> <span class="s2">&quot;Permitted&quot;</span><span class="p">,</span> <span class="s2">&quot;Tier 1&quot;</span><span class="p">,</span> <span class="s2">&quot;Tier 2&quot;</span><span class="p">,</span> <span class="s2">&quot;Tier 3&quot;</span><span class="p">,</span> <span class="s2">&quot;Tier 4&quot;</span><span class="p">]:</span>

            <span class="c1"># Make sure this is a valid objective for this problem instance</span>
            <span class="k">if</span> <span class="n">objective</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;objectives&quot;</span><span class="p">]:</span>
                <span class="k">continue</span>  <span class="c1"># goes to the next objective</span>

            <span class="c1"># Get index</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s2">&quot;objectives&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">objective</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Check if the AFSC is constraining this objective</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;K^C&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
                <span class="k">continue</span>

            <span class="c1"># Make sure there are cadets that are in this degree tier</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;I^D&quot;</span><span class="p">][</span><span class="n">objective</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="s2">&quot;Tier&quot;</span> <span class="ow">in</span> <span class="n">objective</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: AFSC &#39;&quot;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span> <span class="s2">&quot;&#39; objective &#39;&quot;</span> <span class="o">+</span> <span class="n">objective</span> <span class="o">+</span>
                          <span class="s2">&quot;&#39; is empty. No cadets have degrees that fit in this tier for this class year.&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: AFSC &#39;&quot;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span> <span class="s2">&quot;&#39; objective &#39;&quot;</span> <span class="o">+</span> <span class="n">objective</span> <span class="o">+</span>
                          <span class="s2">&quot;&#39;-Tier is empty. No cadets have degrees that fit in this tier for this class year.&quot;</span><span class="p">)</span>

            <span class="c1"># Make sure objective has valid target</span>
            <span class="k">if</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;objective_target&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: AFSC &#39;&quot;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span> <span class="s2">&quot;&#39; objective &#39;&quot;</span> <span class="o">+</span> <span class="n">objective</span> <span class="o">+</span>
                      <span class="s2">&quot;&#39;-Tier target cannot be 0 when it has a nonzero weight.&quot;</span><span class="p">)</span>

        <span class="c1"># Validate AFOCD Tier objectives</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">objective</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;Tier 1&quot;</span><span class="p">,</span> <span class="s2">&quot;Tier 2&quot;</span><span class="p">,</span> <span class="s2">&quot;Tier 3&quot;</span><span class="p">,</span> <span class="s2">&quot;Tier 4&quot;</span><span class="p">]):</span>

            <span class="c1"># Make sure this is a valid objective for this problem instance</span>
            <span class="k">if</span> <span class="n">objective</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;objectives&quot;</span><span class="p">]:</span>
                <span class="k">continue</span>  <span class="c1"># goes to the next objective</span>

            <span class="c1"># Get index</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s2">&quot;objectives&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">objective</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Make sure that this is a valid tier for this AFSC</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;K^A&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
                <span class="k">continue</span>  <span class="c1"># goes to the next objective</span>

            <span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;I&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">requirement_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;t_mandatory&#39;</span><span class="p">:</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;t_desired&#39;</span><span class="p">:</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;t_permitted&#39;</span><span class="p">:</span> <span class="s1">&#39;P&#39;</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">r_level</span> <span class="ow">in</span> <span class="n">requirement_dict</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="n">r_level</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">]:</span>
                    <span class="n">level</span> <span class="o">=</span> <span class="n">requirement_dict</span><span class="p">[</span><span class="n">r_level</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">levels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>

            <span class="c1"># Make sure this requirement/qualification level is present with the cadets</span>
            <span class="k">if</span> <span class="n">level</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;qual&#39;</span><span class="p">][:,</span> <span class="n">j</span><span class="p">]:</span>
                <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: AFSC &#39;&quot;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span> <span class="s2">&quot;&#39; objective &#39;&quot;</span> <span class="o">+</span> <span class="n">objective</span> <span class="o">+</span>
                      <span class="s2">&quot;&#39; expected cadet qualification level is &#39;&quot;</span> <span class="o">+</span> <span class="n">level</span> <span class="o">+</span> <span class="s2">&quot;&#39; but this is not in the qual matrix.&quot;</span><span class="p">)</span>

        <span class="n">unique_levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;qual&#39;</span><span class="p">][:,</span> <span class="n">j</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">unique_levels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">level</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">levels</span> <span class="ow">and</span> <span class="s1">&#39;E&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">level</span> <span class="ow">and</span> <span class="s1">&#39;I&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">level</span><span class="p">:</span>
                <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: AFSC &#39;&quot;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span> <span class="s2">&quot;&#39; qualification level &#39;&quot;</span> <span class="o">+</span> <span class="n">level</span> <span class="o">+</span>
                      <span class="s2">&quot;&#39; found within the cadet qual matrix but this is not defined within the value&quot;</span>
                      <span class="s2">&quot; parameters.&quot;</span> <span class="p">)</span>

        <span class="c1"># Make sure all constrained objectives have appropriate constraints</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;K^C&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
            <span class="n">objective</span> <span class="o">=</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;objectives&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>

            <span class="c1"># Check constraint type to see if something doesn&#39;t check out</span>
            <span class="k">if</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;constraint_type&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

                <span class="c1"># If the minimum is zero, we know this is an &quot;at MOST&quot; constraint (0 to 0.3, for example)</span>
                <span class="k">if</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;objective_min&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;WARNING: AFSC &#39;&quot;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span> <span class="s2">&quot;&#39; objective &#39;&quot;</span> <span class="o">+</span> <span class="n">objective</span> <span class="o">+</span>
                          <span class="s2">&quot;&#39; has an &#39;at most&#39; constraint of &#39;&quot;</span> <span class="o">+</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;objective_value_min&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">+</span>
                          <span class="s2">&quot;&#39;. The constraint_type is 1, indicating an approximate constraint but this is not recommended. &quot;</span>
                          <span class="s2">&quot;Instead, use the constraint_type &#39;2&#39; to indicate an exact constraint since this is the easiest&quot;</span>
                          <span class="s2">&quot; way to meet an &#39;at most&#39; constraint.&quot;</span><span class="p">)</span>

            <span class="c1"># Make sure constrained objectives have valid constraint types</span>
            <span class="k">if</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;constraint_type&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
                <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: AFSC &#39;&quot;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span> <span class="s2">&quot;&#39; objective &#39;&quot;</span> <span class="o">+</span> <span class="n">objective</span> <span class="o">+</span>
                      <span class="s2">&quot;&#39; is in set of constrained objectives: vp[&#39;K^C&#39;][j] but has a constraint_type of &#39;&quot;</span> <span class="o">+</span>
                      <span class="nb">str</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s1">&#39;constraint_type&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;&#39;. This is not a valid active constraint.&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;Please update the set of value parameters using &#39;instance.update_value_parameters()&#39;.&quot;</span><span class="p">)</span>

            <span class="c1"># Check valid &#39;objective_value_min&#39; constraint range</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">lb</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s2">&quot;objective_value_min&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">ub</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s2">&quot;objective_value_min&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">assert</span> <span class="n">lb</span> <span class="o">&lt;=</span> <span class="n">ub</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: AFSC &#39;&quot;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span> <span class="s2">&quot;&#39; objective &#39;&quot;</span> <span class="o">+</span> <span class="n">objective</span> <span class="o">+</span>
                      <span class="s2">&quot;&#39; constraint range (objective_value_min) &#39;&quot;</span> <span class="o">+</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;objective_value_min&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">+</span>
                      <span class="s2">&quot;&#39; is invalid. This constraint is currently activated.&quot;</span><span class="p">)</span>

        <span class="c1"># Make sure value functions are valid</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;K^A&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
            <span class="n">objective</span> <span class="o">=</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;objectives&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
            <span class="n">vf_string_start</span> <span class="o">=</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;value_functions&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># VF String validation</span>
            <span class="k">if</span> <span class="n">vf_string_start</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Min Increasing&quot;</span><span class="p">,</span> <span class="s2">&quot;Min Decreasing&quot;</span><span class="p">,</span> <span class="s2">&quot;Balance&quot;</span><span class="p">,</span> <span class="s2">&quot;Quota_Direct&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;Quota_Normal&quot;</span><span class="p">]:</span>
                <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: AFSC &#39;&quot;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span> <span class="s2">&quot;&#39; objective &#39;&quot;</span> <span class="o">+</span> <span class="n">objective</span> <span class="o">+</span> <span class="s2">&quot;&#39; value function string &#39;&quot;</span> <span class="o">+</span>
                      <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;value_functions&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39; is invalid.&quot;</span><span class="p">)</span>

            <span class="c1"># Validate number of breakpoints</span>
            <span class="k">if</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: AFSC &#39;&quot;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span> <span class="s2">&quot;&#39; objective &#39;&quot;</span> <span class="o">+</span> <span class="n">objective</span> <span class="o">+</span>
                      <span class="s2">&quot;&#39; does not have any value function breakpoints. &#39;a&#39;:&quot;</span><span class="p">,</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
                <span class="k">continue</span>

            <span class="c1"># Value function should have same number of x and y coordinates</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s2">&quot;f^hat&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]):</span>
                <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: AFSC &#39;&quot;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span> <span class="s2">&quot;&#39; objective &#39;&quot;</span> <span class="o">+</span> <span class="n">objective</span> <span class="o">+</span>
                      <span class="s2">&quot;&#39; value function breakpoint coordinates do not align. &#39;a&#39; has length of &quot;</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span>
                      <span class="s2">&quot; while &#39;f^hat&#39; has length of &quot;</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s2">&quot;f^hat&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Ensure that the breakpoint &quot;x&quot; coordinates are always getting bigger</span>
            <span class="n">current_x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">valid_x_bps</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;L&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">current_x</span><span class="p">:</span>
                    <span class="n">valid_x_bps</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">current_x</span> <span class="o">=</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_x_bps</span><span class="p">:</span>
                <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: AFSC &#39;&quot;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span> <span class="s2">&quot;&#39; objective &#39;&quot;</span> <span class="o">+</span> <span class="n">objective</span> <span class="o">+</span>
                      <span class="s2">&quot;&#39; value function x coordinates do not continuously increase along x-axis. &#39;a&#39;:&quot;</span><span class="p">,</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                      <span class="s2">&quot;&#39;vf_string&#39;:&quot;</span><span class="p">,</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;value_functions&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>

        <span class="c1"># Check all the objectives to see if the user missed something</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">objective</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s1">&#39;objectives&#39;</span><span class="p">]):</span>

            <span class="k">if</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;constraint_type&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;K^C&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;WARNING: AFSC &#39;&quot;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span> <span class="s2">&quot;&#39; objective &#39;&quot;</span> <span class="o">+</span> <span class="n">objective</span> <span class="o">+</span>
                      <span class="s2">&quot;&#39; has a constraint_type of &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s1">&#39;constraint_type&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span> <span class="o">+</span>
                      <span class="s2">&quot;&#39; but is not in set of constrained objectives: vp[&#39;K^C&#39;][j]. This is a mistake so&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;please update the set of value parameters using &#39;instance.update_value_parameters()&#39;.&quot;</span><span class="p">)</span>

    <span class="c1"># Loop through each cadet to check preferences and utility values</span>
    <span class="n">invalid_utility</span><span class="p">,</span> <span class="n">invalid_cadet_utility</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="n">invalid_utility_cadets</span><span class="p">,</span> <span class="n">invalid_cadet_utility_cadets</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="s1">&#39;c_preferences&#39;</span> <span class="ow">in</span> <span class="n">p</span> <span class="ow">and</span> <span class="s1">&#39;c_pref_matrix&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">choice</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]):</span>
                <span class="n">afsc</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">choice</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">]:</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">afsc</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="n">choice</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: Cadet&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadets&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="s2">&quot;has AFSC &#39;&quot;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span> <span class="s2">&quot;&#39; in position &#39;&quot;</span>
                              <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">choice</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; in the Cadets.csv file, but it is ranked &#39;&quot;</span> <span class="o">+</span>
                              <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;&#39; from the Cadets Preferences.csv file.&quot;</span><span class="p">)</span>
                        <span class="k">break</span>  <span class="c1"># Don&#39;t need to check the rest of the cadet&#39;s preferences</span>

            <span class="c1"># If this cadet does not have any preferences, we skip them (must be an OTS candidate)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;WARNING: Cadet </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> has no preferences and is therefore eligible for nothing.&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Make sure &quot;utility&quot; array is monotonically decreasing and the &quot;cadet_utility&quot; array is strictly decreasing</span>
            <span class="n">arr_1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span>
            <span class="n">arr_2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">arr_1</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">arr_1</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr_1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span>
                <span class="n">invalid_utility</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">invalid_utility_cadets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">arr_2</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">arr_2</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr_2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span>
                <span class="n">invalid_cadet_utility</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">invalid_cadet_utility_cadets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="c1"># Report issues with decreasing cadet utility values</span>
    <span class="k">if</span> <span class="n">invalid_utility</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: The cadet-reported utility matrix &#39;utility&#39;, located in &#39;Cadets Utility.csv&#39;</span><span class="se">\n</span><span class="s2">and in the &quot;</span>
                     <span class="s2">&quot;&#39;Util&#39; columns of &#39;Cadets.csv&#39;, does not incorporate monotonically</span><span class="se">\n</span><span class="s2">decreasing utility values for &quot;</span>
                     <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">invalid_utility</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; cadets. Please adjust.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">invalid_utility</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;These are the cadets at indices&#39;</span><span class="p">,</span> <span class="n">invalid_utility_cadets</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">invalid_cadet_utility</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s1">&#39;last_afsc&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>  <span class="c1"># There IS indifference with the new method of utilities</span>
        <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: The constructed cadet utility matrix &#39;cadet_utility&#39;, located in &#39;Cadets Utility (Final).&quot;</span>
                     <span class="s2">&quot;csv&#39;,</span><span class="se">\n</span><span class="s2">does not incorporate strictly decreasing utility values for &quot;</span>
                     <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">invalid_cadet_utility</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; cadets. Please adjust.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">invalid_cadet_utility</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;These are the cadets at indices&#39;</span><span class="p">,</span> <span class="n">invalid_cadet_utility_cadets</span><span class="p">)</span>

    <span class="c1"># Loop through each objective to see if there are any null values in the objective target array</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">objective</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s2">&quot;objectives&quot;</span><span class="p">]):</span>
        <span class="n">num_null</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s2">&quot;objective_target&quot;</span><span class="p">][:,</span> <span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">num_null</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: Objective &#39;&quot;</span> <span class="o">+</span> <span class="n">objective</span> <span class="o">+</span> <span class="s2">&quot;&#39; contains &quot;</span> <span class="o">+</span>
                  <span class="nb">str</span><span class="p">(</span><span class="n">num_null</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; null target values (&#39;objective_target&#39;).&quot;</span><span class="p">)</span>

    <span class="c1"># USSF OM Constraint rules</span>
    <span class="k">if</span> <span class="n">instance</span><span class="o">.</span><span class="n">mdl_p</span><span class="p">[</span><span class="s1">&#39;USSF OM&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="s2">&quot;USSF&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_acc_grp&#39;</span><span class="p">]:</span>
        <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: Space Force OM constraint specified in controls (USSF OM = True) but no USSF&quot;</span>
                     <span class="s2">&quot; AFSCS found in the instance.&quot;</span><span class="p">)</span>

    <span class="c1"># At least one rated preference for rated eligible</span>
    <span class="k">for</span> <span class="n">soc</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;SOCs&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">soc</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Rated Cadets&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Rated Cadets&#39;</span><span class="p">][</span><span class="n">soc</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;Rated Choices&#39;</span><span class="p">][</span><span class="n">soc</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span>
                          <span class="s2">&quot;ISSUE: Cadet &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadets&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;&#39; is on &quot;</span> <span class="o">+</span> <span class="n">soc</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span>
                          <span class="s2">&quot;&#39;s Rated list (&quot;</span> <span class="o">+</span> <span class="n">soc</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; Rated OM.csv) but is not eligible for any Rated AFSCs. &quot;</span>
                                                            <span class="s2">&quot;You need to remove their row from the csv.&quot;</span><span class="p">)</span>

    <span class="c1"># Make sure all cadets eligible for at least one rated AFSC are in their SOC&#39;s rated OM list</span>
    <span class="k">for</span> <span class="n">soc</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;SOCs&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="s1">&#39;J^Rated&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>  <span class="c1"># Make sure we have rated AFSCs</span>

            <span class="c1"># Loop through each cadet from this SOC</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="n">soc</span> <span class="o">+</span> <span class="s1">&#39;_cadets&#39;</span><span class="p">]:</span>

                <span class="c1"># Check if they&#39;re eligible for at least one rated AFSC</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;eligible&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]])</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>

                    <span class="c1"># If they&#39;re eligible for a Rated AFSC but aren&#39;t in the &quot;Rated OM.csv&quot; file, that&#39;s a problem</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Rated Cadets&#39;</span><span class="p">][</span><span class="n">soc</span><span class="p">]:</span>
                        <span class="n">rated_afscs_eligible</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^E&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])]</span>
                        <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: Cadet &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadets&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;&#39; is not on &quot;</span> <span class="o">+</span> <span class="n">soc</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span>
                              <span class="s2">&quot;&#39;s Rated list (&quot;</span> <span class="o">+</span> <span class="n">soc</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; Rated OM.csv), but is on the preference lists for&quot;</span><span class="p">,</span>
                              <span class="n">rated_afscs_eligible</span><span class="p">,</span> <span class="s2">&quot;Please add a row in &#39;Rated OM.csv&#39; for this cadet reflecting their &quot;</span>
                                                    <span class="s2">&quot;OM.&quot;</span><span class="p">)</span>

    <span class="c1"># Validate that the &quot;totals&quot; for minimums/maximums work</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;pgl&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]:</span>
        <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: Total sum of PGL targets is&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;pgl&#39;</span><span class="p">])),</span>
              <span class="s2">&quot; while &#39;N&#39; is &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;. This is infeasible since we don&#39;t have enough cadets.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;quota_min&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]:</span>
        <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: Total sum of minimum constrained capacities (quota_min) is&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;quota_min&#39;</span><span class="p">])),</span>
              <span class="s2">&quot; while &#39;N&#39; is &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;. This is infeasible since we don&#39;t have enough cadets.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;quota_max&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="s1">&#39;ots&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;SOCs&#39;</span><span class="p">]:</span>  <span class="c1"># OTS candidates can go unmatched</span>
        <span class="n">issue</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;ISSUE: Maximum constrained capacities (quota_max) is&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;quota_max&#39;</span><span class="p">])),</span>
              <span class="s2">&quot; while &#39;N&#39; is &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;. This is infeasible; we don&#39;t have enough positions for cadets to fill.&quot;</span><span class="p">)</span>

    <span class="c1"># Print statement</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done,&#39;</span><span class="p">,</span> <span class="n">issue</span><span class="p">,</span> <span class="s2">&quot;issues found.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.adjustments.parameter_sets_additions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parameter_sets_additions</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span></code>

<a href="#data.adjustments.parameter_sets_additions" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Add Indexed Sets and Subsets to the Problem Instance Parameters.</p>
<p>This function enhances the problem instance by creating indexed sets and subsets for both cadets and AFSCs,
demographic filters, eligibility matrices, preference-related metadata, and readiness for optimization.
It also validates eligibility constraints and appends additional calculated data fields.</p>
<h4 id="data.adjustments.parameter_sets_additions--parameters">Parameters<a class="headerlink" href="#data.adjustments.parameter_sets_additions--parameters" title="Permanent link">&para;</a></h4>
<p>parameters : dict
    The fixed model input parameters for a cadet-AFSC assignment instance, including eligibility matrices,
    cadet/AFSC attributes, utility matrices, and demographics.</p>
<h4 id="data.adjustments.parameter_sets_additions--returns">Returns<a class="headerlink" href="#data.adjustments.parameter_sets_additions--returns" title="Permanent link">&para;</a></h4>
<p>Updated parameter dictionary with:</p>
<ul>
<li>Indexed cadet and AFSC sets: <code>I</code>, <code>J</code>, <code>J^E</code>, <code>I^E</code></li>
<li>Eligibility and preference counts: <code>num_eligible</code>, <code>Choice Count</code></li>
<li>Demographic and qualification subsets: <code>I^D</code>, <code>I^USAFA</code>, <code>I^Male</code>, <code>I^Minority</code>, etc.</li>
<li>Assignment constraints: <code>J^Fixed</code>, <code>J^Reserved</code></li>
<li>Cadet and AFSC preference mappings</li>
<li>Updated utility matrix with unmatched column</li>
</ul>
<h4 id="data.adjustments.parameter_sets_additions--examples">Examples<a class="headerlink" href="#data.adjustments.parameter_sets_additions--examples" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">afccp.data.adjustments</span> <span class="kn">import</span> <span class="n">parameter_sets_additions</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">parameter_sets_additions</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</code></pre></div>
<h4 id="data.adjustments.parameter_sets_additions--notes">Notes<a class="headerlink" href="#data.adjustments.parameter_sets_additions--notes" title="Permanent link">&para;</a></h4>
<ul>
<li>Automatically detects and processes USAFA/ROTC cadet splits based on <code>usafa</code> and <code>soc</code> columns.</li>
<li>Adds extra handling for cadets that are fixed to AFSCs via preassignments in <code>assigned</code>.</li>
<li>Includes support for rated cadets, STEM AFSCs, race/ethnicity filters, and eligibility-based breakouts.</li>
</ul>
<h4 id="data.adjustments.parameter_sets_additions--see-also">See Also<a class="headerlink" href="#data.adjustments.parameter_sets_additions--see-also" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="../../../afccp/reference/data/adjustments/#data.adjustments.more_parameter_additions"><code>more_parameter_additions</code></a>:
  Adds enhanced logic for cadet/AFSC matching, preference flattening, and diversity tracking.</li>
<li><a href="../../../afccp/reference/data/adjustments/#data.adjustments.base_training_parameter_additions"><code>base_training_parameter_additions</code></a>:
  Adds base and training assignment structures to the parameters.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>afccp/data/adjustments.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parameter_sets_additions</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add Indexed Sets and Subsets to the Problem Instance Parameters.</span>

<span class="sd">    This function enhances the problem instance by creating indexed sets and subsets for both cadets and AFSCs,</span>
<span class="sd">    demographic filters, eligibility matrices, preference-related metadata, and readiness for optimization.</span>
<span class="sd">    It also validates eligibility constraints and appends additional calculated data fields.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameters : dict</span>
<span class="sd">        The fixed model input parameters for a cadet-AFSC assignment instance, including eligibility matrices,</span>
<span class="sd">        cadet/AFSC attributes, utility matrices, and demographics.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Updated parameter dictionary with:</span>

<span class="sd">    - Indexed cadet and AFSC sets: ``I``, ``J``, ``J^E``, ``I^E``</span>
<span class="sd">    - Eligibility and preference counts: ``num_eligible``, ``Choice Count``</span>
<span class="sd">    - Demographic and qualification subsets: ``I^D``, ``I^USAFA``, ``I^Male``, ``I^Minority``, etc.</span>
<span class="sd">    - Assignment constraints: ``J^Fixed``, ``J^Reserved``</span>
<span class="sd">    - Cadet and AFSC preference mappings</span>
<span class="sd">    - Updated utility matrix with unmatched column</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from afccp.data.adjustments import parameter_sets_additions</span>
<span class="sd">    params = parameter_sets_additions(params)</span>
<span class="sd">    ```</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Automatically detects and processes USAFA/ROTC cadet splits based on `usafa` and `soc` columns.</span>
<span class="sd">    - Adds extra handling for cadets that are fixed to AFSCs via preassignments in `assigned`.</span>
<span class="sd">    - Includes support for rated cadets, STEM AFSCs, race/ethnicity filters, and eligibility-based breakouts.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    - [`more_parameter_additions`](../../../afccp/reference/data/adjustments/#data.adjustments.more_parameter_additions):</span>
<span class="sd">      Adds enhanced logic for cadet/AFSC matching, preference flattening, and diversity tracking.</span>
<span class="sd">    - [`base_training_parameter_additions`](../../../afccp/reference/data/adjustments/#data.adjustments.base_training_parameter_additions):</span>
<span class="sd">      Adds base and training assignment structures to the parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Shorthand</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">parameters</span>

    <span class="c1"># Cadet Indexed Sets</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">])</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^E&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;eligible&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:])[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]]</span>  <span class="c1"># set of AFSCs that cadet i is eligible for</span>

    <span class="c1"># AFSC Indexed Sets</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;eligible&#39;</span><span class="p">][:,</span> <span class="n">j</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]]</span>  <span class="c1"># set of cadets that are eligible for AFSC j</span>

    <span class="c1"># Number of eligible cadets for each AFSC</span>
    <span class="n">p</span><span class="p">[</span><span class="s2">&quot;num_eligible&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]])</span>

    <span class="c1"># More cadet preference sets if we have the &quot;cadet preference columns&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;c_preferences&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;I^Choice&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">choice</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">p</span><span class="p">[</span><span class="s2">&quot;c_preferences&quot;</span><span class="p">][:,</span> <span class="n">choice</span><span class="p">]</span> <span class="o">==</span> <span class="n">afsc</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;afscs&quot;</span><span class="p">][:</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]]]</span> <span class="k">for</span> <span class="n">choice</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">])}</span>
        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Choice Count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">choice</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;I^Choice&quot;</span><span class="p">][</span><span class="n">choice</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;J&quot;</span><span class="p">]])</span> <span class="k">for</span> <span class="n">choice</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">])}</span>

    <span class="c1"># Add demographic sets if they&#39;re included</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="s1">&#39;usafa&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">usafa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;usafa&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># set of usafa cadets</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;usafa_proportion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;usafa&#39;</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^D&#39;</span><span class="p">][</span><span class="s1">&#39;USAFA Proportion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">usafa</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]]</span>
    <span class="k">if</span> <span class="s1">&#39;mandatory&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>  <span class="c1"># Qual Type = &quot;Old&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^D&#39;</span><span class="p">][</span><span class="s1">&#39;Mandatory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;mandatory&#39;</span><span class="p">][:,</span> <span class="n">j</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]]</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^D&#39;</span><span class="p">][</span><span class="s1">&#39;Desired&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;desired&#39;</span><span class="p">][:,</span> <span class="n">j</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]]</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^D&#39;</span><span class="p">][</span><span class="s1">&#39;Permitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;permitted&#39;</span><span class="p">][:,</span> <span class="n">j</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]]</span>
    <span class="k">if</span> <span class="s2">&quot;tier 1&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>  <span class="c1"># Qual Type = &quot;Tiers&quot;</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">]:</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^D&#39;</span><span class="p">][</span><span class="s1">&#39;Tier &#39;</span> <span class="o">+</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;tier &#39;</span> <span class="o">+</span> <span class="n">t</span><span class="p">][:,</span> <span class="n">j</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]]</span>

        <span class="c1"># Get arrays of unique degree tier values</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Deg Tier Values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">j</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;qual&#39;</span><span class="p">][:,</span> <span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]}</span>

    <span class="k">if</span> <span class="s1">&#39;male&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">male</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;male&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># set of male cadets</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;male_proportion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;male&#39;</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^D&#39;</span><span class="p">][</span><span class="s1">&#39;Male&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">male</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]]</span>
    <span class="k">if</span> <span class="s1">&#39;minority&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">minority</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;minority&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># set of minority cadets</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;minority_proportion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;minority&#39;</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^D&#39;</span><span class="p">][</span><span class="s1">&#39;Minority&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">minority</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]]</span>

    <span class="c1"># Add an extra column to the utility matrix for cadets who are unmatched (if it hasn&#39;t already been added)</span>
    <span class="n">zeros_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">])])</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;utility&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]):</span>
        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;utility&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;utility&quot;</span><span class="p">],</span> <span class="n">zeros_vector</span><span class="p">))</span>

    <span class="c1"># Merit</span>
    <span class="k">if</span> <span class="s1">&#39;merit&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;sum_merit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;merit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># should be close to N/2</span>

    <span class="c1"># USAFA/ROTC/OTS cadets</span>
    <span class="k">if</span> <span class="s1">&#39;SOCs&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>  <span class="c1"># If it&#39;s just a &quot;USAFA&quot; column, we assume it&#39;s only USAFA/ROTC</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rotc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;usafa&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;usafa_cadets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;usafa&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rotc_cadets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rotc&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;usafa_eligible_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;usafa_cadets&#39;</span><span class="p">]))</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]])</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rotc_eligible_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rotc_cadets&#39;</span><span class="p">]))</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]])</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;SOCs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;usafa&#39;</span><span class="p">,</span> <span class="s1">&#39;rotc&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">soc</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;SOCs&#39;</span><span class="p">]:</span>
            <span class="n">p</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;soc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">soc</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1</span>
            <span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">soc</span><span class="si">}</span><span class="s1">_cadets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">soc</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">soc</span><span class="si">}</span><span class="s1">_eligible_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">soc</span><span class="si">}</span><span class="s1">_cadets&#39;</span><span class="p">]))</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]])</span>

    <span class="c1"># Initialize empty dictionaries of matched/reserved cadets</span>
    <span class="n">p</span><span class="p">[</span><span class="s2">&quot;J^Fixed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">p</span><span class="p">[</span><span class="s2">&quot;J^Reserved&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># If we have the &quot;Assigned&quot; column in Cadets.csv, we can check to see if anyone is &quot;fixed&quot; in this solution</span>
    <span class="k">if</span> <span class="s2">&quot;assigned&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;assigned&quot;</span><span class="p">]):</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;afscs&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">afsc</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># AFSC index</span>

            <span class="c1"># Check if the cadet is actually assigned an AFSC already (it&#39;s not blank)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># Actual index</span>

                <span class="c1"># Check if the cadet is assigned to an AFSC they&#39;re not eligible for</span>
                <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;J^E&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">cadet</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadets&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cadet &quot;</span> <span class="o">+</span> <span class="n">cadet</span> <span class="o">+</span> <span class="s2">&quot; assigned to &#39;&quot;</span> <span class="o">+</span>
                                     <span class="n">afsc</span> <span class="o">+</span> <span class="s2">&quot;&#39; but is not eligible for it. Adjust the qualification matrix!&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="s2">&quot;J^Fixed&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>

    <span class="c1"># Cadet preference/rated cadet set additions</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">more_parameter_additions</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="c1"># Base/Training set additions</span>
    <span class="k">if</span> <span class="s2">&quot;bases&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">base_training_parameter_additions</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.adjustments.more_parameter_additions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">more_parameter_additions</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span></code>

<a href="#data.adjustments.more_parameter_additions" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Add Additional Subsets and Parameter Structures to the Problem Instance.</p>
<p>This function enhances the problem instance by appending numerous structured subsets and derived attributes
based on cadet preferences, eligibility, accession groupings, demographics, and more. It enriches the input
parameter dictionary in preparation for detailed analysis and optimization.</p>
<h4 id="data.adjustments.more_parameter_additions--parameters">Parameters<a class="headerlink" href="#data.adjustments.more_parameter_additions--parameters" title="Permanent link">&para;</a></h4>
<p>parameters : dict
    The initial problem instance dictionary, containing data on cadets, AFSCs, eligibility, utility matrices, etc.</p>
<h4 id="data.adjustments.more_parameter_additions--returns">Returns<a class="headerlink" href="#data.adjustments.more_parameter_additions--returns" title="Permanent link">&para;</a></h4>
<p>dict
The updated problem instance with additional fields, subsets, and derived variables including:</p>
<ul>
<li>Cadet and AFSC preferences</li>
<li>Accessions group (Rated, USSF, NRL) AFSC indices</li>
<li>Rated-specific cadet groupings and OM mapping</li>
<li>Simpson index for race/ethnicity</li>
<li>Groupings by SOC (e.g., ROTC, USAFA), gender, and STEM designation</li>
<li>Subsets like <code>I^Must_Match</code>, <code>J^Bottom 2 Choices</code>, etc.</li>
</ul>
<h4 id="data.adjustments.more_parameter_additions--examples">Examples<a class="headerlink" href="#data.adjustments.more_parameter_additions--examples" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">parameters</span> <span class="o">=</span> <span class="n">more_parameter_additions</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</code></pre></div>
<h4 id="data.adjustments.more_parameter_additions--notes">Notes<a class="headerlink" href="#data.adjustments.more_parameter_additions--notes" title="Permanent link">&para;</a></h4>
<p>The function performs a large number of conditional operations and appends dozens of new keys to <code>parameters</code>.
These are used downstream in optimization and statistical evaluation of AFSC assignment plans.</p>
<h4 id="data.adjustments.more_parameter_additions--see-also">See Also<a class="headerlink" href="#data.adjustments.more_parameter_additions--see-also" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="../../../afccp/reference/data/adjustments/#data.adjustments.parameter_sets_additions"><code>parameter_sets_additions</code></a>:
  Related utility that adds indexed parameter sets post-preference generation.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>afccp/data/adjustments.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">more_parameter_additions</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add Additional Subsets and Parameter Structures to the Problem Instance.</span>

<span class="sd">    This function enhances the problem instance by appending numerous structured subsets and derived attributes</span>
<span class="sd">    based on cadet preferences, eligibility, accession groupings, demographics, and more. It enriches the input</span>
<span class="sd">    parameter dictionary in preparation for detailed analysis and optimization.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameters : dict</span>
<span class="sd">        The initial problem instance dictionary, containing data on cadets, AFSCs, eligibility, utility matrices, etc.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">    The updated problem instance with additional fields, subsets, and derived variables including:</span>

<span class="sd">    - Cadet and AFSC preferences</span>
<span class="sd">    - Accessions group (Rated, USSF, NRL) AFSC indices</span>
<span class="sd">    - Rated-specific cadet groupings and OM mapping</span>
<span class="sd">    - Simpson index for race/ethnicity</span>
<span class="sd">    - Groupings by SOC (e.g., ROTC, USAFA), gender, and STEM designation</span>
<span class="sd">    - Subsets like `I^Must_Match`, `J^Bottom 2 Choices`, etc.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    parameters = more_parameter_additions(parameters)</span>
<span class="sd">    ```</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The function performs a large number of conditional operations and appends dozens of new keys to `parameters`.</span>
<span class="sd">    These are used downstream in optimization and statistical evaluation of AFSC assignment plans.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    - [`parameter_sets_additions`](../../../afccp/reference/data/adjustments/#data.adjustments.parameter_sets_additions):</span>
<span class="sd">      Related utility that adds indexed parameter sets post-preference generation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Shorthand</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">parameters</span>

    <span class="c1"># Create Cadet preferences</span>
    <span class="k">if</span> <span class="s1">&#39;c_pref_matrix&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;num_cadet_choices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]:</span>

            <span class="c1"># Sort the cadet preferences</span>
            <span class="n">cadet_sorted_preferences</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Loop through each AFSC in order of preference and add it to the cadet&#39;s list</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">cadet_sorted_preferences</span><span class="p">:</span>

                <span class="c1"># Only add AFSCs that the cadet is eligible for and expressed a preference for</span>
                <span class="k">if</span> <span class="s1">&#39;last_afsc&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^E&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

                <span class="c1"># Only add AFSCs that the cadet expressed a preference for</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>  <span class="c1"># Convert to numpy array</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;num_cadet_choices&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>

    <span class="c1"># Create AFSC preferences</span>
    <span class="k">if</span> <span class="s1">&#39;a_pref_matrix&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]:</span>

            <span class="c1"># Sort the AFSC preferences</span>
            <span class="n">afsc_sorted_preferences</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;a_pref_matrix&#39;</span><span class="p">][:,</span> <span class="n">j</span><span class="p">])</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Loop through each cadet in order of preference and add them to the AFSC&#39;s list</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">afsc_sorted_preferences</span><span class="p">:</span>

                <span class="c1"># Only add cadets that are eligible for this AFSC and expressed a preference for it</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;a_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>  <span class="c1"># Convert to numpy array</span>

    <span class="c1"># Determine AFSCs by Accessions Group</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_acc_grp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="s1">&#39;acc_grp&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">acc_grp</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Rated&#39;</span><span class="p">,</span> <span class="s1">&#39;USSF&#39;</span><span class="p">,</span> <span class="s1">&#39;NRL&#39;</span><span class="p">]:</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^&#39;</span> <span class="o">+</span> <span class="n">acc_grp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;acc_grp&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">acc_grp</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_acc_grp&#39;</span><span class="p">][</span><span class="n">acc_grp</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^&#39;</span> <span class="o">+</span> <span class="n">acc_grp</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Previously, we&#39;ve only assigned NRL cadets so we assume that&#39;s what we&#39;re dealing with here</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;acc_grp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;NRL&#39;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]])</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_acc_grp&#39;</span><span class="p">][</span><span class="s1">&#39;NRL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^NRL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]</span>

    <span class="c1"># If we have the &quot;Accessions Group&quot; column in Cadets.csv, we can check to see if anyone is fixed to a group here</span>
    <span class="k">if</span> <span class="s1">&#39;acc_grp_constraint&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>

        <span class="c1"># Loop through each Accession group and get the cadets that are constrained to be in this &quot;group&quot;</span>
        <span class="k">for</span> <span class="n">acc_grp</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_acc_grp&#39;</span><span class="p">]:</span>  <span class="c1"># This should really only ever apply to USSF, but we&#39;re generalizing it</span>

            <span class="c1"># Constrained cadets for each Accession group (don&#39;t confuse with I^*acc_grp* in the &quot;solutions&quot; dictionary!)</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">acc_grp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;acc_grp_constraint&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">acc_grp</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># PGL Totals per SOC for USSF</span>
    <span class="k">if</span> <span class="s1">&#39;USSF&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_acc_grp&#39;</span><span class="p">]:</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;ussf_usafa_pgl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;usafa_quota&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^USSF&#39;</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;ussf_rotc_pgl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rotc_quota&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^USSF&#39;</span><span class="p">])</span>

    <span class="c1"># We already have &quot;J^USSF&quot; defined above; now we want one for USAF (NRL + Rated)</span>
    <span class="k">if</span> <span class="s1">&#39;USSF&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_acc_grp&#39;</span><span class="p">]:</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^USAF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^USSF&#39;</span><span class="p">]])</span>

    <span class="c1"># Determine eligible Rated cadets for both SOCs (cadets that are considered by the board)</span>
    <span class="n">cadets_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">soc</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">soc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">r_om_cadets&#39;</span> <span class="k">for</span> <span class="n">soc</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;SOCs&#39;</span><span class="p">]}</span>
    <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Rated Cadets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Rated Cadet Index Dict&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Rated Choices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Dictionary of Rated cadet choices (only Rated AFSCs) by SOC</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Num Rated Choices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Number of Rated cadet choices by SOC</span>
    <span class="k">for</span> <span class="n">soc</span> <span class="ow">in</span> <span class="n">cadets_dict</span><span class="p">:</span>

        <span class="c1"># If we already have the array of cadets from the dataset</span>
        <span class="k">if</span> <span class="n">cadets_dict</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Rated Cadets&quot;</span><span class="p">][</span><span class="n">soc</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">cadets_dict</span><span class="p">[</span><span class="n">soc</span><span class="p">]]</span>
            <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Rated Cadet Index Dict&quot;</span><span class="p">][</span><span class="n">soc</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;Rated Cadets&quot;</span><span class="p">][</span><span class="n">soc</span><span class="p">])}</span>

        <span class="c1"># If we don&#39;t have this dataset, we check to see if we have Rated AFSCs</span>
        <span class="k">elif</span> <span class="s1">&#39;Rated&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_acc_grp&#39;</span><span class="p">]:</span>

            <span class="c1"># Add Rated cadets in order to each SOC list</span>
            <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Rated Cadets&quot;</span><span class="p">][</span><span class="n">soc</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="n">soc</span> <span class="o">+</span> <span class="s1">&#39;_cadets&#39;</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^E&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Rated Cadets&quot;</span><span class="p">][</span><span class="n">soc</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                        <span class="k">break</span>

            <span class="c1"># Convert to numpy array and get translation dictionary</span>
            <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Rated Cadets&quot;</span><span class="p">][</span><span class="n">soc</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;Rated Cadets&quot;</span><span class="p">][</span><span class="n">soc</span><span class="p">])</span>
            <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Rated Cadet Index Dict&quot;</span><span class="p">][</span><span class="n">soc</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;Rated Cadets&quot;</span><span class="p">][</span><span class="n">soc</span><span class="p">])}</span>

        <span class="c1"># Get Rated preferences (where we strip out all NRL/USSF choices</span>
        <span class="k">if</span> <span class="n">soc</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Rated Cadets&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;cadet_preferences&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Rated Choices&#39;</span><span class="p">][</span><span class="n">soc</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Num Rated Choices&#39;</span><span class="p">][</span><span class="n">soc</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Rated Cadets&quot;</span><span class="p">][</span><span class="n">soc</span><span class="p">]}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Rated Cadets&quot;</span><span class="p">][</span><span class="n">soc</span><span class="p">]:</span>
                <span class="n">rated_order</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]:</span>
                        <span class="n">rated_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Num Rated Choices&#39;</span><span class="p">][</span><span class="n">soc</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Rated Choices&#39;</span><span class="p">][</span><span class="n">soc</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rated_order</span><span class="p">)</span>

    <span class="c1"># If we haven&#39;t already created the &quot;cadet_utility&quot; matrix, we do that here (only one time)</span>
    <span class="k">if</span> <span class="s1">&#39;cadet_utility&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>

        <span class="c1"># Build out cadet_utility using cadet preferences</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_utility&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;utility&#39;</span><span class="p">]),</span> <span class="mi">4</span><span class="p">)</span>

    <span class="c1"># set of AFSCs that cadet i has placed a preference for and is also eligible for</span>
    <span class="n">non_zero_utils_j</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]]</span>
    <span class="n">p</span><span class="p">[</span><span class="s2">&quot;J^P&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^E&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">non_zero_utils_j</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]]</span>

    <span class="c1"># set of cadets that have placed a preference for AFSC j and are eligible for AFSC j</span>
    <span class="n">non_zero_utils_i</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_utility&#39;</span><span class="p">][:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]]</span>
    <span class="n">p</span><span class="p">[</span><span class="s2">&quot;I^P&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">non_zero_utils_i</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]]</span>

    <span class="c1"># Race categories</span>
    <span class="k">if</span> <span class="s1">&#39;race&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;race_categories&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;race&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">race</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;race_categories&#39;</span><span class="p">]:</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">race</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;race&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">race</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Calculate simpson index for overall class as a baseline</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;baseline_simpson_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([(</span><span class="nb">len</span><span class="p">(</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">race</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">race</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">race</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;race_categories&#39;</span><span class="p">]]),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Ethnicity categories</span>
    <span class="k">if</span> <span class="s1">&#39;ethnicity&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;ethnicity_categories&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;ethnicity&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">eth</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;ethnicity_categories&#39;</span><span class="p">]:</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">eth</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;ethnicity&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">eth</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Calculate simpson index for overall class as a baseline</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;baseline_simpson_index_eth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([(</span><span class="nb">len</span><span class="p">(</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">eth</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">eth</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">eth</span> <span class="ow">in</span>
                                                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;ethnicity_categories&#39;</span><span class="p">]]),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># SOC and Gender cadets standardized like above</span>
    <span class="k">if</span> <span class="s1">&#39;SOCs&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">soc</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;SOCs&#39;</span><span class="p">]:</span>
            <span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;I^</span><span class="si">{</span><span class="n">soc</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">soc</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;male&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Male&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;male&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Female&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;male&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># STEM cadets</span>
    <span class="k">if</span> <span class="s1">&#39;stem&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^STEM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;stem&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;afscs_stem&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^STEM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_stem&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Yes&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Not STEM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_stem&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;No&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Hybrid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_stem&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Hybrid&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Selected AFSCs</span>
    <span class="k">if</span> <span class="s1">&#39;c_selected_matrix&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Selected&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># The cadet selected the AFSC as a preference</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Selected-E&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># The cadet selected the AFSC as a preference and is eligible for it</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]:</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Selected&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_selected_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Selected-E&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^E&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Selected&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>

    <span class="c1"># Incorporate &quot;Must Match&quot; information for OTS</span>
    <span class="k">if</span> <span class="s1">&#39;must_match&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Must_Match&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;must_match&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Last/Second to Last AFSCs</span>
    <span class="k">if</span> <span class="s1">&#39;last_afsc&#39;</span> <span class="ow">in</span> <span class="n">p</span> <span class="ow">and</span> <span class="s1">&#39;second_to_last_afscs&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Bottom 2 Choices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Last Choice&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Loop through each cadet</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]:</span>

            <span class="c1"># Get a list of AFSC indices of the bottom 2 choices (but not last choice)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;second_to_last_afscs&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">afsc_list</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;second_to_last_afscs&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">afsc_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>

            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Bottom 2 Choices&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="n">afsc_list</span><span class="p">:</span>
                <span class="n">afsc</span> <span class="o">=</span> <span class="n">afsc</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">]:</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">afsc</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Bottom 2 Choices&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Bottom 2 Choices&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Bottom 2 Choices&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>

            <span class="c1"># Get the last AFSC choice index</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Last Choice&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]</span>  <span class="c1"># Unmatched AFSC (*)</span>
            <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;last_afsc&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">]:</span>
                <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Last Choice&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;last_afsc&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.adjustments.base_training_parameter_additions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">base_training_parameter_additions</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span></code>

<a href="#data.adjustments.base_training_parameter_additions" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Add Base and Training Parameters to the Problem Instance.</p>
<p>This function extends the parameter dictionary with the data structures required to support base assignments and
training course scheduling within the CASTLE Base/Training optimization model. Each cadet is categorized into
preference-based "states" depending on their AFSC priorities and base/course interest.</p>
<p>The function also calculates cadet-course availability, utility of wait times, and assignment eligibility across bases
and courses. This enables simultaneous modeling of AFSC matches, base assignments, and training timelines.</p>
<h4 id="data.adjustments.base_training_parameter_additions--parameters">Parameters<a class="headerlink" href="#data.adjustments.base_training_parameter_additions--parameters" title="Permanent link">&para;</a></h4>
<p>parameters : dict
    The problem instance parameters, including cadet preferences, AFSC eligibility, utility scores, training
    thresholds, and configuration flags for base/course logic.</p>
<h4 id="data.adjustments.base_training_parameter_additions--returns">Returns<a class="headerlink" href="#data.adjustments.base_training_parameter_additions--returns" title="Permanent link">&para;</a></h4>
<p>dict
Updated parameter dictionary with additional sets and matrices such as:</p>
<ul>
<li><code>D</code>, <code>Cadet Objectives</code>, <code>J^State</code>, <code>w^A</code>, <code>w^B</code>, <code>w^C</code>, <code>u^S</code>: cadet state structures.</li>
<li><code>B^A</code>, <code>B^E</code>, <code>B^State</code>: base assignment eligibility mappings.</li>
<li><code>C^E</code>, <code>I^A</code>, <code>course_days_cadet</code>, <code>course_utility</code>: training availability and utility values.</li>
<li><code>lo^B</code>, <code>hi^B</code>, <code>lo^C</code>, <code>hi^C</code>: quantity constraints on base/course assignments.</li>
</ul>
<h4 id="data.adjustments.base_training_parameter_additions--examples">Examples<a class="headerlink" href="#data.adjustments.base_training_parameter_additions--examples" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">afccp.data.adjustments</span> <span class="kn">import</span> <span class="n">base_training_parameter_additions</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="n">base_training_parameter_additions</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</code></pre></div>
<h4 id="data.adjustments.base_training_parameter_additions--notes">Notes<a class="headerlink" href="#data.adjustments.base_training_parameter_additions--notes" title="Permanent link">&para;</a></h4>
<ul>
<li>Cadet states are built using <code>base_threshold</code> and <code>training_threshold</code>, which split cadet preferences into
  AFSCs only, AFSC + base, and AFSC + base + course states.</li>
<li>Utility from training courses is based on cadet preferences (<code>Early</code>, <code>Late</code>, <code>None</code>) and normalized start dates.</li>
<li>Course utility is scaled from 0 to 1, with utility decreasing/increasing with wait time as appropriate.</li>
<li>This logic assumes all relevant arrays like <code>training_start</code>, <code>course_start</code>, <code>afsc_assign_base</code>, etc., exist and
  are preloaded in the parameter dictionary.</li>
</ul>
<h4 id="data.adjustments.base_training_parameter_additions--see-also">See Also<a class="headerlink" href="#data.adjustments.base_training_parameter_additions--see-also" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="../../../afccp/reference/data/adjustments/#data.adjustments.parameter_sets_additions"><code>parameter_sets_additions</code></a>:
  Adds foundational indexed sets and preference structures used prior to base/training expansion.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>afccp/data/adjustments.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">base_training_parameter_additions</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add Base and Training Parameters to the Problem Instance.</span>

<span class="sd">    This function extends the parameter dictionary with the data structures required to support base assignments and</span>
<span class="sd">    training course scheduling within the CASTLE Base/Training optimization model. Each cadet is categorized into</span>
<span class="sd">    preference-based &quot;states&quot; depending on their AFSC priorities and base/course interest.</span>

<span class="sd">    The function also calculates cadet-course availability, utility of wait times, and assignment eligibility across bases</span>
<span class="sd">    and courses. This enables simultaneous modeling of AFSC matches, base assignments, and training timelines.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameters : dict</span>
<span class="sd">        The problem instance parameters, including cadet preferences, AFSC eligibility, utility scores, training</span>
<span class="sd">        thresholds, and configuration flags for base/course logic.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">    Updated parameter dictionary with additional sets and matrices such as:</span>

<span class="sd">    - `D`, `Cadet Objectives`, `J^State`, `w^A`, `w^B`, `w^C`, `u^S`: cadet state structures.</span>
<span class="sd">    - `B^A`, `B^E`, `B^State`: base assignment eligibility mappings.</span>
<span class="sd">    - `C^E`, `I^A`, `course_days_cadet`, `course_utility`: training availability and utility values.</span>
<span class="sd">    - `lo^B`, `hi^B`, `lo^C`, `hi^C`: quantity constraints on base/course assignments.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from afccp.data.adjustments import base_training_parameter_additions</span>
<span class="sd">    parameters = base_training_parameter_additions(parameters)</span>
<span class="sd">    ```</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Cadet states are built using `base_threshold` and `training_threshold`, which split cadet preferences into</span>
<span class="sd">      AFSCs only, AFSC + base, and AFSC + base + course states.</span>
<span class="sd">    - Utility from training courses is based on cadet preferences (`Early`, `Late`, `None`) and normalized start dates.</span>
<span class="sd">    - Course utility is scaled from 0 to 1, with utility decreasing/increasing with wait time as appropriate.</span>
<span class="sd">    - This logic assumes all relevant arrays like `training_start`, `course_start`, `afsc_assign_base`, etc., exist and</span>
<span class="sd">      are preloaded in the parameter dictionary.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    - [`parameter_sets_additions`](../../../afccp/reference/data/adjustments/#data.adjustments.parameter_sets_additions):</span>
<span class="sd">      Adds foundational indexed sets and preference structures used prior to base/training expansion.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Helpful function to extract the datetime object from a specific string containing date information</span>
    <span class="k">def</span> <span class="nf">parse_date</span><span class="p">(</span><span class="n">date_str</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">fmt</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%y&#39;</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_str</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># Return None if no format matches</span>

    <span class="c1"># Shorthand</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">parameters</span>

    <span class="c1"># Sets of bases and courses</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">j</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]}</span>

    <span class="c1"># Set of AFSCs that assign cadets to bases</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_assign_base&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Set of bases that AFSC j may assign cadets to</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;B^A&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">j</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;base_max&#39;</span><span class="p">][:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]}</span>

    <span class="c1"># Set of bases that cadet i may be assigned to (based on the union of all eligible bases from AFSCs in J^E_i)</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;B^E&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">reduce</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">union1d</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;B^A&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^E&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^B&#39;</span><span class="p">])))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]}</span>

    <span class="c1"># Sets/Parameters for AFSC outcome states for each cadet</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Set of all AFSC outcome states that cadet i has designated</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Cadet Objectives&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Set of cadet objectives included for each cadet and each state</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^State&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Set of AFSCs that, if assigned, would put cadet i into state d</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^A&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># the weight that cadet i places on AFSCs in state d</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># the weight that cadet i places on bases in state d</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># the weight that cadet i places on courses in state d</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;u^S&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># the maximum utility that cadet i receives from state d (based on best AFSC)</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;B^State&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Set of bases that cadet i can be assigned to in state d (According to J^State_id)</span>

    <span class="c1"># Determine the &quot;states&quot; for each cadet based on the differences of AFSC outcomes</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]:</span>

        <span class="c1"># Base/Training Thresholds (Shorthand)</span>
        <span class="n">bt</span><span class="p">,</span> <span class="n">tt</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;base_threshold&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;training_threshold&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># Determine &quot;primary&quot; set of AFSCs and states based on thresholds</span>
        <span class="k">if</span> <span class="n">bt</span> <span class="o">&lt;</span> <span class="n">tt</span><span class="p">:</span>
            <span class="n">afscs</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="n">bt</span><span class="p">],</span>
                      <span class="mi">2</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">bt</span><span class="p">:</span> <span class="n">tt</span><span class="p">],</span>
                      <span class="mi">3</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">tt</span><span class="p">:]}</span>
            <span class="n">included</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;afsc&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;afsc&#39;</span><span class="p">,</span> <span class="s1">&#39;base&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;afsc&#39;</span><span class="p">,</span> <span class="s1">&#39;base&#39;</span><span class="p">,</span> <span class="s1">&#39;course&#39;</span><span class="p">]}</span>
        <span class="k">elif</span> <span class="n">tt</span> <span class="o">&lt;</span> <span class="n">bt</span><span class="p">:</span>
            <span class="n">afscs</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="n">tt</span><span class="p">],</span>
                      <span class="mi">2</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">tt</span><span class="p">:</span> <span class="n">bt</span><span class="p">],</span>
                      <span class="mi">3</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">bt</span><span class="p">:]}</span>
            <span class="n">included</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;afsc&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;afsc&#39;</span><span class="p">,</span> <span class="s1">&#39;course&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;afsc&#39;</span><span class="p">,</span> <span class="s1">&#39;base&#39;</span><span class="p">,</span> <span class="s1">&#39;course&#39;</span><span class="p">]}</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># They&#39;re equal!</span>
            <span class="n">afscs</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="n">bt</span><span class="p">],</span>
                      <span class="mi">2</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">bt</span><span class="p">:]}</span>
            <span class="n">included</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;afsc&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;afsc&#39;</span><span class="p">,</span> <span class="s1">&#39;base&#39;</span><span class="p">,</span> <span class="s1">&#39;course&#39;</span><span class="p">]}</span>

        <span class="c1"># Sets/Parameters for AFSC outcome states for each cadet</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Set of all AFSC outcome states that cadet i has designated</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Cadet Objectives&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Set of cadet objectives included for each cadet and each state</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^State&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Set of AFSCs that, if assigned, would put cadet i into state d</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^A&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># the weight that cadet i places on AFSCs in state d</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^B&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># the weight that cadet i places on bases in state d</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^C&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># the weight that cadet i places on courses in state d</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;u^S&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># the maximum utility that cadet i receives from state d (based on best AFSC)</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;B^State&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Set of bases that cadet i can be assigned to in state d (According to J^State_id)</span>

        <span class="c1"># Loop through each &quot;primary&quot; state to get &quot;final&quot; states (Split up states based on base assignment AFSCs)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">included</span><span class="p">:</span>

            <span class="c1"># Empty state!</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">afscs</span><span class="p">[</span><span class="n">state</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Split up the AFSCs into two groups if they assign cadets to bases or not</span>
            <span class="n">sets</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Assigned&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^B&#39;</span><span class="p">],</span> <span class="n">afscs</span><span class="p">[</span><span class="n">state</span><span class="p">]),</span>
                    <span class="s1">&#39;Not Assigned&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">afscs</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^B&#39;</span><span class="p">]])}</span>

            <span class="c1"># Loop through both sets and create a new state if the set contains AFSCs</span>
            <span class="k">for</span> <span class="n">set_name</span><span class="p">,</span> <span class="n">afscs_in_set</span> <span class="ow">in</span> <span class="n">sets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">afscs_in_set</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>

                    <span class="c1"># Add information to this state</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Cadet Objectives&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">included</span><span class="p">[</span><span class="n">state</span><span class="p">]</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^State&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">afscs_in_set</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;u^S&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">afscs</span><span class="p">[</span><span class="n">state</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># Utility of the top preferred AFSC</span>

                    <span class="c1"># Weights and set of bases are differentiated by if this is a set containing J^B AFSCs or not</span>
                    <span class="k">if</span> <span class="n">set_name</span> <span class="o">==</span> <span class="s2">&quot;Assigned&quot;</span><span class="p">:</span>

                        <span class="c1"># Re-scale weights based on the objectives included in this state</span>
                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^A&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;weight_afsc&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;weight_&#39;</span> <span class="o">+</span> <span class="n">obj</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">included</span><span class="p">[</span><span class="n">state</span><span class="p">])</span>
                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^C&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;weight_course&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;weight_&#39;</span> <span class="o">+</span> <span class="n">obj</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">included</span><span class="p">[</span><span class="n">state</span><span class="p">])</span> \
                                         <span class="o">*</span> <span class="p">(</span><span class="s1">&#39;course&#39;</span> <span class="ow">in</span> <span class="n">included</span><span class="p">[</span><span class="n">state</span><span class="p">])</span>
                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^B&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;weight_base&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;weight_&#39;</span> <span class="o">+</span> <span class="n">obj</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">included</span><span class="p">[</span><span class="n">state</span><span class="p">])</span> \
                                         <span class="o">*</span> <span class="p">(</span><span class="s1">&#39;base&#39;</span> <span class="ow">in</span> <span class="n">included</span><span class="p">[</span><span class="n">state</span><span class="p">])</span>

                        <span class="c1"># Union of bases that this cadet could be assigned to in this state according to J^State_id</span>
                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;B^State&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">union1d</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;B^A&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^State&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]))</span>

                    <span class="k">else</span><span class="p">:</span>

                        <span class="c1"># Re-scale weights based on the objectives included in this state</span>
                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^A&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;weight_afsc&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> \
                                         <span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;weight_&#39;</span> <span class="o">+</span> <span class="n">obj</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">included</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="k">if</span> <span class="n">obj</span> <span class="o">!=</span> <span class="s2">&quot;base&quot;</span><span class="p">)</span>
                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^C&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;course&#39;</span> <span class="ow">in</span> <span class="n">included</span><span class="p">[</span><span class="n">state</span><span class="p">])</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;weight_course&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> \
                                         <span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;weight_&#39;</span> <span class="o">+</span> <span class="n">obj</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">included</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="k">if</span> <span class="n">obj</span> <span class="o">!=</span> <span class="s2">&quot;base&quot;</span><span class="p">)</span>
                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^B&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;B^State&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>  <span class="c1"># Empty array (no bases)</span>

                    <span class="c1"># Next state</span>
                    <span class="n">d</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Print statement for specific cadet</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">10</span> <span class="ow">and</span> <span class="kc">False</span><span class="p">:</span>  <span class="c1"># Meant for debugging and sanity checking this logic!</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cadet&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Objectives&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Cadet Objectives&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;J^State&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^State&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;B^State&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;B^State&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;bases&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;B^State&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;B^State&#39;</span><span class="p">,</span> <span class="p">[])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Weight (AFSC)&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^A&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">],</span> <span class="mi">3</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Weight (Base)&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^B&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">],</span> <span class="mi">3</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Weight (Course)&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^C&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">],</span> <span class="mi">3</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Utility (State)&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;u^S&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">],</span> <span class="mi">3</span><span class="p">))</span>

    <span class="c1"># Adjust AFSC, base, course weights to give slight bump to ensure all are considered in each applicable state</span>
    <span class="n">max_afsc_weight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^A&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^A&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">max_afsc_weight</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">max_afsc_weight</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>

            <span class="c1"># Take some weight from AFSCs</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^A&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^A&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">*</span> <span class="n">max_afsc_weight</span>

            <span class="c1"># Redistribute the weight to Base/Courses depending on existence of J^B AFSCs</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;B^State&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^B&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^B&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">*</span> <span class="n">max_afsc_weight</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">max_afsc_weight</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^C&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^C&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">*</span> <span class="n">max_afsc_weight</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">max_afsc_weight</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^C&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^C&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">*</span> <span class="n">max_afsc_weight</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">max_afsc_weight</span><span class="p">)</span>

    <span class="c1"># Sets pertaining to courses for each AFSC</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;C^E&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Set of courses that cadet i is available to take with AFSC j</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^A&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Set of cadets that are available to take course c with AFSC j</span>

    <span class="c1"># Calculate course utility for each cadet, AFSC, course tuple</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;course_days_cadet&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;course_utility&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]:</span>

        <span class="c1"># Initialize information for this cadet</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;course_days_cadet&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;course_utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;C^E&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Loop through each AFSC and course to determine days between cadet start and course start</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^E&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;course_days_cadet&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>

                <span class="c1"># Convert str format to datetime format if necessary</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;course_start&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">c</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="n">course_start</span> <span class="o">=</span> <span class="n">parse_date</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;course_start&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">c</span><span class="p">])</span>
                    <span class="n">cadet_start</span> <span class="o">=</span> <span class="n">parse_date</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;training_start&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">course_start</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;course_start&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">c</span><span class="p">]</span>
                    <span class="n">cadet_start</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;training_start&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

                <span class="c1"># Calculate days between</span>
                <span class="n">days_between</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_start</span> <span class="o">-</span> <span class="n">cadet_start</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
                <span class="k">if</span> <span class="n">days_between</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># If the cadet is available to take the course before it starts</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;course_days_cadet&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">days_between</span>

            <span class="c1"># Get subset of courses that this cadet can take for this AFSC</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;C^E&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;course_days_cadet&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]])</span>

        <span class="c1"># Get course wait times and determine min and max</span>
        <span class="n">course_waits</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;course_days_cadet&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^E&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;C^E&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]]</span>
        <span class="n">max_wait</span><span class="p">,</span> <span class="n">min_wait</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">course_waits</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">course_waits</span><span class="p">)</span>

        <span class="c1"># Loop through each AFSC and course again to calculate utility (normalize the wait times)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^E&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;course_utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;C^E&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;training_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Early&#39;</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;course_utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;course_days_cadet&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">-</span> <span class="n">min_wait</span><span class="p">)</span> <span class="o">/</span> \
                                                   <span class="p">(</span><span class="n">max_wait</span> <span class="o">-</span> <span class="n">min_wait</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;training_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Late&#39;</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;course_utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;course_days_cadet&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">-</span> <span class="n">min_wait</span><span class="p">)</span> <span class="o">/</span> \
                                                   <span class="p">(</span><span class="n">max_wait</span> <span class="o">-</span> <span class="n">min_wait</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># No preference</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;course_utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="kc">False</span><span class="p">:</span>  <span class="c1"># Meant for debugging and sanity checking this logic!</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="s2">&quot;Dates&quot;</span><span class="p">,</span> <span class="n">course_start</span><span class="p">,</span> <span class="n">cadet_start</span><span class="p">,</span> <span class="s2">&quot;DAYS&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;course_days_cadet&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">c</span><span class="p">],</span>
                          <span class="s2">&quot;Utility&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;course_utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">c</span><span class="p">])</span>

    <span class="c1"># Determine set of cadets that are available to take course c with AFSC j</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]:</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^A&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^A&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;C^E&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]])</span>

    <span class="c1"># Get minimum and maximum quantities for bases</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;lo^B&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;hi^B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^B&#39;</span><span class="p">]:</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;lo^B&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;hi^B&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;B^A&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;lo^B&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">b</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;hi^B&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;base_min&#39;</span><span class="p">][</span><span class="n">b</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;base_max&#39;</span><span class="p">][</span><span class="n">b</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>

    <span class="c1"># Get minimum and maximum quantities for courses</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;lo^C&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;hi^C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;course_min&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;course_max&#39;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.adjustments.set_ots_must_matches" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_ots_must_matches</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span></code>

<a href="#data.adjustments.set_ots_must_matches" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Identify OTS Candidates Who Must Be Matched in the Assignment.</p>
<p>This function determines which Officer Training School (OTS) cadets must be assigned (i.e., matched) by
identifying the top candidates based on their Order of Merit (OM) scores. It updates the <code>must_match</code>
array to indicate mandatory match requirements, and adds a new set <code>I^Must_Match</code> containing the indices
of cadets who must be assigned a slot.</p>
<p>If OTS is not a participating source of commissioning (SOC) in the instance, the function exits early
with no modifications.</p>
<h4 id="data.adjustments.set_ots_must_matches--parameters">Parameters:<a class="headerlink" href="#data.adjustments.set_ots_must_matches--parameters" title="Permanent link">&para;</a></h4>
<ul>
<li>parameters (dict): Dictionary of model parameters, including cadet index sets (<code>I</code>, <code>I^OTS</code>), merit scores,
  and SOC definitions.</li>
</ul>
<h4 id="data.adjustments.set_ots_must_matches--returns">Returns:<a class="headerlink" href="#data.adjustments.set_ots_must_matches--returns" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>dict: The updated parameters dictionary with the following changes:</p>
<ul>
<li><code>must_match</code>: N-length array with <code>1</code> for must-match cadets, <code>0</code> for others, and <code>NaN</code> for non-OTS cadets.</li>
<li><code>I^Must_Match</code>: Set of cadet indices in <code>I^OTS</code> who are in the top ~99.5% of the OM distribution.</li>
</ul>
</li>
</ul>
<h4 id="data.adjustments.set_ots_must_matches--examples">Examples:<a class="headerlink" href="#data.adjustments.set_ots_must_matches--examples" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">parameters</span> <span class="o">=</span> <span class="n">set_ots_must_matches</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>afccp/data/adjustments.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_ots_must_matches</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Identify OTS Candidates Who Must Be Matched in the Assignment.</span>

<span class="sd">    This function determines which Officer Training School (OTS) cadets must be assigned (i.e., matched) by</span>
<span class="sd">    identifying the top candidates based on their Order of Merit (OM) scores. It updates the `must_match`</span>
<span class="sd">    array to indicate mandatory match requirements, and adds a new set `I^Must_Match` containing the indices</span>
<span class="sd">    of cadets who must be assigned a slot.</span>

<span class="sd">    If OTS is not a participating source of commissioning (SOC) in the instance, the function exits early</span>
<span class="sd">    with no modifications.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    --------</span>
<span class="sd">    - parameters (dict): Dictionary of model parameters, including cadet index sets (`I`, `I^OTS`), merit scores,</span>
<span class="sd">      and SOC definitions.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    - dict: The updated parameters dictionary with the following changes:</span>

<span class="sd">        - `must_match`: N-length array with `1` for must-match cadets, `0` for others, and `NaN` for non-OTS cadets.</span>
<span class="sd">        - `I^Must_Match`: Set of cadet indices in `I^OTS` who are in the top ~99.5% of the OM distribution.</span>

<span class="sd">    Examples:</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    parameters = set_ots_must_matches(parameters)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Shorthand</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">parameters</span>

    <span class="c1"># Clear &quot;must matches&quot;</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;must_match&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]])</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;must_match&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^OTS&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># No OTS adjustments to be made</span>
    <span class="k">if</span> <span class="s1">&#39;ots&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;SOCs&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;OTS not included in this instance!! Nothing to do here.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p</span>

    <span class="c1"># Sort OTS candidates by OM and take the top {ots_accessions} people</span>
    <span class="n">sorted_by_merit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;merit&#39;</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ots_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sorted_by_merit</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^OTS&#39;</span><span class="p">]])</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Must_Match&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ots_sorted</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;ots_accessions&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.995</span><span class="p">)]</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;must_match&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Must_Match&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.adjustments.gather_degree_tier_qual_matrix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">gather_degree_tier_qual_matrix</span><span class="p">(</span><span class="n">cadets_df</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span></code>

<a href="#data.adjustments.gather_degree_tier_qual_matrix" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Construct or Validate Degree Tier Qualification Matrix for Cadets.</p>
<p>This function analyzes the provided <code>cadets_df</code> and <code>parameters</code> to determine if a valid degree
qualification matrix (<code>qual</code>) exists. If not, or if the format differs from the expected
"Tiers" structure, a new one is generated using CIP codes. It then computes a series of derived
binary matrices (e.g., <code>eligible</code>, <code>mandatory</code>, <code>tier 1</code>, etc.) that describe cadet eligibility
for each AFSC based on degree requirements.</p>
<p>The degree tier qualification matrix is a critical part of the AFSC assignment model, influencing
eligibility filtering, tier-based objective constraints, and value function evaluations.</p>
<h4 id="data.adjustments.gather_degree_tier_qual_matrix--parameters">Parameters:<a class="headerlink" href="#data.adjustments.gather_degree_tier_qual_matrix--parameters" title="Permanent link">&para;</a></h4>
<ul>
<li>cadets_df (pd.DataFrame): The dataframe containing cadet qualification data. Must contain
  columns like <code>qual_AFSC</code> or CIP fields if generating the qualification matrix.</li>
<li>parameters (dict): Instance parameter dictionary (<code>p</code>) that includes AFSCs, CIP codes,
  qualification type, and degree tier expectations. This dictionary will be modified in place.</li>
</ul>
<h4 id="data.adjustments.gather_degree_tier_qual_matrix--returns">Returns:<a class="headerlink" href="#data.adjustments.gather_degree_tier_qual_matrix--returns" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>dict: Updated <code>parameters</code> dictionary with the following keys (if applicable):</p>
<ul>
<li><code>"qual"</code>: The constructed or validated NxM string matrix of qualification levels.</li>
<li><code>"eligible"</code> / <code>"ineligible"</code>: Binary matrices indicating AFSC eligibility.</li>
<li><code>"mandatory"</code> / <code>"desired"</code> / <code>"permitted"</code>: Binary matrices based on tier requirements.</li>
<li><code>"tier 1"</code> to <code>"tier 4"</code>: Tier-specific binary matrices.</li>
<li><code>"exception"</code>: Binary matrix marking cadets eligible through exception rules.</li>
<li><code>"t_count"</code>: Array of number of degree tiers per AFSC.</li>
<li><code>"t_proportion"</code>: Matrix with expected proportions for each tier per AFSC.</li>
<li><code>"t_eq"</code> / <code>"t_geq"</code> / <code>"t_leq"</code>: Binary matrices specifying how tier requirements should be interpreted.</li>
</ul>
</li>
</ul>
<h4 id="data.adjustments.gather_degree_tier_qual_matrix--examples">Examples:<a class="headerlink" href="#data.adjustments.gather_degree_tier_qual_matrix--examples" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">p</span> <span class="o">=</span> <span class="n">gather_degree_tier_qual_matrix</span><span class="p">(</span><span class="n">cadets_df</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</code></pre></div>
<h4 id="data.adjustments.gather_degree_tier_qual_matrix--see-also">See Also:<a class="headerlink" href="#data.adjustments.gather_degree_tier_qual_matrix--see-also" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="../../../afccp/reference/data/support/#data.support.cip_to_qual_tiers"><code>cip_to_qual_tiers</code></a>:
  Generates tier-based qualification matrix from CIP codes.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>afccp/data/adjustments.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">gather_degree_tier_qual_matrix</span><span class="p">(</span><span class="n">cadets_df</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Construct or Validate Degree Tier Qualification Matrix for Cadets.</span>

<span class="sd">    This function analyzes the provided `cadets_df` and `parameters` to determine if a valid degree</span>
<span class="sd">    qualification matrix (`qual`) exists. If not, or if the format differs from the expected</span>
<span class="sd">    &quot;Tiers&quot; structure, a new one is generated using CIP codes. It then computes a series of derived</span>
<span class="sd">    binary matrices (e.g., `eligible`, `mandatory`, `tier 1`, etc.) that describe cadet eligibility</span>
<span class="sd">    for each AFSC based on degree requirements.</span>

<span class="sd">    The degree tier qualification matrix is a critical part of the AFSC assignment model, influencing</span>
<span class="sd">    eligibility filtering, tier-based objective constraints, and value function evaluations.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    --------</span>
<span class="sd">    - cadets_df (pd.DataFrame): The dataframe containing cadet qualification data. Must contain</span>
<span class="sd">      columns like `qual_AFSC` or CIP fields if generating the qualification matrix.</span>
<span class="sd">    - parameters (dict): Instance parameter dictionary (`p`) that includes AFSCs, CIP codes,</span>
<span class="sd">      qualification type, and degree tier expectations. This dictionary will be modified in place.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    - dict: Updated `parameters` dictionary with the following keys (if applicable):</span>

<span class="sd">        - `&quot;qual&quot;`: The constructed or validated NxM string matrix of qualification levels.</span>
<span class="sd">        - `&quot;eligible&quot;` / `&quot;ineligible&quot;`: Binary matrices indicating AFSC eligibility.</span>
<span class="sd">        - `&quot;mandatory&quot;` / `&quot;desired&quot;` / `&quot;permitted&quot;`: Binary matrices based on tier requirements.</span>
<span class="sd">        - `&quot;tier 1&quot;` to `&quot;tier 4&quot;`: Tier-specific binary matrices.</span>
<span class="sd">        - `&quot;exception&quot;`: Binary matrix marking cadets eligible through exception rules.</span>
<span class="sd">        - `&quot;t_count&quot;`: Array of number of degree tiers per AFSC.</span>
<span class="sd">        - `&quot;t_proportion&quot;`: Matrix with expected proportions for each tier per AFSC.</span>
<span class="sd">        - `&quot;t_eq&quot;` / `&quot;t_geq&quot;` / `&quot;t_leq&quot;`: Binary matrices specifying how tier requirements should be interpreted.</span>

<span class="sd">    Examples:</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    p = gather_degree_tier_qual_matrix(cadets_df, p)</span>
<span class="sd">    ```</span>

<span class="sd">    See Also:</span>
<span class="sd">    --------</span>
<span class="sd">    - [`cip_to_qual_tiers`](../../../afccp/reference/data/support/#data.support.cip_to_qual_tiers):</span>
<span class="sd">      Generates tier-based qualification matrix from CIP codes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Shorthand</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">parameters</span>

    <span class="c1"># Determine if there is already a qualification matrix in the Cadets dataframe, and what &quot;type&quot; it is</span>
    <span class="n">afsc_1</span><span class="p">,</span> <span class="n">afsc_M</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;afscs&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;afscs&quot;</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">current_qual_type</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>  <span class="c1"># If there is no qualification matrix, we&#39;ll have to generate it</span>
    <span class="k">if</span> <span class="n">cadets_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;qual_&quot;</span> <span class="o">+</span> <span class="n">afsc_1</span> <span class="ow">in</span> <span class="n">cadets_df</span><span class="p">:</span>
            <span class="n">qual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cadets_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;qual_&quot;</span> <span class="o">+</span> <span class="n">afsc_1</span><span class="p">:</span> <span class="s2">&quot;qual_&quot;</span> <span class="o">+</span> <span class="n">afsc_M</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
            <span class="n">test_qual</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">qual</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># Variable to determine if we need to alter the qualification matrix</span>

            <span class="c1"># Determine the type of qual matrix we *currently* have</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_qual</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">test_qual</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">]:</span>
                    <span class="n">current_qual_type</span> <span class="o">=</span> <span class="s2">&quot;Binary&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">current_qual_type</span> <span class="o">=</span> <span class="s2">&quot;Relaxed&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">current_qual_type</span> <span class="o">=</span> <span class="s2">&quot;Tiers&quot;</span>

    <span class="c1"># If the current qualification matrix matches the one we want, then we don&#39;t need to do anything</span>
    <span class="n">generate_qual_matrix</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Qual Type&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">current_qual_type</span><span class="p">:</span>

        <span class="c1"># We don&#39;t have a qual matrix at all (We will generate the &quot;Tiers&quot; qual matrix!)</span>
        <span class="k">if</span> <span class="n">current_qual_type</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="n">generate_qual_matrix</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># We have a qual matrix and have specified that we want to keep it the way it is (Don&#39;t need to generate it)</span>
        <span class="k">elif</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Qual Type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Consistent&quot;</span><span class="p">:</span>
            <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Qual Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_qual_type</span>

        <span class="c1"># We have a qual matrix, but want to generate the &quot;Tiers&quot; qual matrix</span>
        <span class="k">elif</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Qual Type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Tiers&quot;</span><span class="p">:</span>
            <span class="n">generate_qual_matrix</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">generate_qual_matrix</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING. The degree_qual_type parameter &#39;&quot;</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Qual Type&quot;</span><span class="p">]</span> <span class="o">+</span>
                  <span class="s2">&quot; specified but current qual matrix is of type &#39;&quot;</span> <span class="o">+</span> <span class="n">current_qual_type</span> <span class="o">+</span>
                  <span class="s2">&quot;&#39;. We no longer generate that kind of qual matrix. We will generate a &#39;Tiers&#39; qual matrix.&quot;</span><span class="p">)</span>

    <span class="c1"># If we&#39;re going to generate a qual matrix, it&#39;ll be a &quot;Tiers&quot; matrix</span>
    <span class="k">if</span> <span class="n">generate_qual_matrix</span><span class="p">:</span>
        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Qual Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Tiers&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;cip1&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;cip2&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                <span class="n">qual</span> <span class="o">=</span> <span class="n">afccp</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">support</span><span class="o">.</span><span class="n">cip_to_qual_tiers</span><span class="p">(</span>
                    <span class="n">p</span><span class="p">[</span><span class="s2">&quot;afscs&quot;</span><span class="p">][:</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cip1&#39;</span><span class="p">],</span> <span class="n">cip2</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cip2&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qual</span> <span class="o">=</span> <span class="n">afccp</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">support</span><span class="o">.</span><span class="n">cip_to_qual_tiers</span><span class="p">(</span>
                    <span class="n">p</span><span class="p">[</span><span class="s2">&quot;afscs&quot;</span><span class="p">][:</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cip1&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error. Need to update the degree tier qualification matrix to include tiers &quot;</span>
                             <span class="s2">&quot;(&#39;M1&#39; instead of &#39;M&#39; for example) but don&#39;t have CIP codes. Please incorporate this.&quot;</span><span class="p">)</span>

    <span class="c1"># Determine the binary matrices for cadets based on their degree tiers and/or eligibility</span>
    <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Qual Type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Tiers&quot;</span><span class="p">:</span>

        <span class="c1"># NxM matrices with various features</span>
        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;ineligible&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">defchararray</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">qual</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;eligible&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;ineligible&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]:</span>
            <span class="n">p</span><span class="p">[</span><span class="s2">&quot;tier &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">defchararray</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">qual</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;mandatory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">defchararray</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">qual</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;desired&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">defchararray</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">qual</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;permitted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">defchararray</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">qual</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>

        <span class="c1"># NEW: Exception to degree qualification based on CFM ranks</span>
        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;exception&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">defchararray</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">qual</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>

        <span class="c1"># Error Handling</span>
        <span class="k">if</span> <span class="s2">&quot;Deg Tiers&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error. Degree qualification matrix is &#39;Tiers&#39; category (&#39;M1&#39; instead of &#39;M&#39; for example)&quot;</span>
                             <span class="s2">&quot; and &#39;Deg Tier X&#39; columns not found in &#39;AFSCs&#39; dataframe. Please correct this issue.&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Qual Type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Relaxed&quot;</span><span class="p">:</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;ineligible&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">qual</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;eligible&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;ineligible&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mandatory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">qual</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;desired&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">qual</span> <span class="o">==</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;permitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">qual</span> <span class="o">==</span> <span class="s1">&#39;P&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>

        <span class="c1"># NEW: Exception to degree qualification based on CFM ranks</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;exception&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">qual</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># &#39;Binary&#39;</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;ineligible&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">qual</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;eligible&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qual</span>

    <span class="c1"># Force string type!</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Deg Tiers&#39;</span><span class="p">][</span><span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;Deg Tiers&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Deg Tiers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Deg Tiers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="c1"># Load in Degree Tier information for each AFSC</span>
    <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Qual Type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Tiers&quot;</span><span class="p">:</span>

        <span class="c1"># Initialize information for AFSC degree tiers</span>
        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;t_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;t_proportion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;t_leq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">defchararray</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;Deg Tiers&quot;</span><span class="p">],</span> <span class="s2">&quot;&lt;&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;t_geq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">defchararray</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;Deg Tiers&quot;</span><span class="p">],</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;t_eq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">defchararray</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;Deg Tiers&quot;</span><span class="p">],</span> <span class="s2">&quot;=&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;t_mandatory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">defchararray</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;Deg Tiers&quot;</span><span class="p">],</span> <span class="s2">&quot;M&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;t_desired&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">defchararray</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;Deg Tiers&quot;</span><span class="p">],</span> <span class="s2">&quot;D&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;t_permitted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">defchararray</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;Deg Tiers&quot;</span><span class="p">],</span> <span class="s2">&quot;P&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>

        <span class="c1"># Loop through each AFSC</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;afscs&quot;</span><span class="p">][:</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]]):</span>

            <span class="c1"># Loop through each potential degree tier</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Deg Tiers&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span>

                <span class="c1"># Empty degree tier</span>
                <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;nan&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                    <span class="n">t</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="k">break</span>

                <span class="c1"># Degree Tier Proportion</span>
                <span class="n">p</span><span class="p">[</span><span class="s2">&quot;t_proportion&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>

            <span class="c1"># Num tiers</span>
            <span class="n">p</span><span class="p">[</span><span class="s2">&quot;t_count&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># Save qual matrix and return the instance p</span>
    <span class="n">p</span><span class="p">[</span><span class="s2">&quot;qual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qual</span>
    <span class="k">return</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.adjustments.convert_instance_to_from_scrubbed" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_instance_to_from_scrubbed</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">new_letter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">translation_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_name</span><span class="o">=</span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span></code>

<a href="#data.adjustments.convert_instance_to_from_scrubbed" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Convert Between Original and Scrubbed AFSC Names Based on PGL Sorting.</p>
<p>This function transforms a problem instance by reordering or restoring AFSC names based on their PGL targets.
It is used to anonymize (scrub) AFSCs for publication or experimentation by replacing real AFSC identifiers
with generic labels (e.g., "X1", "X2", ...) while preserving order. If a translation dictionary is provided,
it performs the inverse operation‚Äîrestoring original AFSC names from their scrubbed versions.</p>
<p>The function updates all relevant AFSC-indexed matrices, arrays, and value parameters in the instance.
It also modifies the solution dictionary (<code>instance.solutions</code>) and preference matrices to maintain consistency.</p>
<h4 id="data.adjustments.convert_instance_to_from_scrubbed--parameters">Parameters:<a class="headerlink" href="#data.adjustments.convert_instance_to_from_scrubbed--parameters" title="Permanent link">&para;</a></h4>
<ul>
<li>instance (<code>CadetCareerProblem</code>): The full problem instance containing parameter and solution data.</li>
<li>new_letter (str, optional): A single letter (e.g., <code>"X"</code>) to use as the prefix for scrubbed AFSC names.
  If provided, performs a <em>forward</em> conversion (real ‚Üí scrubbed).</li>
<li>translation_dict (dict, optional): A mapping from real to scrubbed AFSC names. If provided and
  <code>new_letter</code> is None, performs a <em>reverse</em> conversion (scrubbed ‚Üí real).</li>
<li>data_name (str, optional): A custom label to attach to the instance's <code>data_name</code> attribute.</li>
</ul>
<h4 id="data.adjustments.convert_instance_to_from_scrubbed--returns">Returns:<a class="headerlink" href="#data.adjustments.convert_instance_to_from_scrubbed--returns" title="Permanent link">&para;</a></h4>
<ul>
<li>tuple:<ul>
<li><code>instance</code> (<code>CadetCareerProblem</code>): The updated instance with renamed AFSCs and adjusted internal data.</li>
<li><code>translation_dict</code> (dict): The mapping used for conversion (real ‚Üí scrubbed).</li>
</ul>
</li>
</ul>
<h4 id="data.adjustments.convert_instance_to_from_scrubbed--examples">Examples:<a class="headerlink" href="#data.adjustments.convert_instance_to_from_scrubbed--examples" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Forward conversion (scrubbing AFSC names)</span>
<span class="n">new_instance</span><span class="p">,</span> <span class="n">afsc_mapping</span> <span class="o">=</span> <span class="n">convert_instance_to_from_scrubbed</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">new_letter</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">)</span>

<span class="c1"># Reverse conversion (restoring AFSC names)</span>
<span class="n">original_instance</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">convert_instance_to_from_scrubbed</span><span class="p">(</span><span class="n">new_instance</span><span class="p">,</span> <span class="n">translation_dict</span><span class="o">=</span><span class="n">afsc_mapping</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>afccp/data/adjustments.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_instance_to_from_scrubbed</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">new_letter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">translation_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_name</span><span class="o">=</span><span class="s1">&#39;Unknown&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert Between Original and Scrubbed AFSC Names Based on PGL Sorting.</span>

<span class="sd">    This function transforms a problem instance by reordering or restoring AFSC names based on their PGL targets.</span>
<span class="sd">    It is used to anonymize (scrub) AFSCs for publication or experimentation by replacing real AFSC identifiers</span>
<span class="sd">    with generic labels (e.g., &quot;X1&quot;, &quot;X2&quot;, ...) while preserving order. If a translation dictionary is provided,</span>
<span class="sd">    it performs the inverse operation‚Äîrestoring original AFSC names from their scrubbed versions.</span>

<span class="sd">    The function updates all relevant AFSC-indexed matrices, arrays, and value parameters in the instance.</span>
<span class="sd">    It also modifies the solution dictionary (`instance.solutions`) and preference matrices to maintain consistency.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    --------</span>
<span class="sd">    - instance (`CadetCareerProblem`): The full problem instance containing parameter and solution data.</span>
<span class="sd">    - new_letter (str, optional): A single letter (e.g., `&quot;X&quot;`) to use as the prefix for scrubbed AFSC names.</span>
<span class="sd">      If provided, performs a *forward* conversion (real ‚Üí scrubbed).</span>
<span class="sd">    - translation_dict (dict, optional): A mapping from real to scrubbed AFSC names. If provided and</span>
<span class="sd">      `new_letter` is None, performs a *reverse* conversion (scrubbed ‚Üí real).</span>
<span class="sd">    - data_name (str, optional): A custom label to attach to the instance&#39;s `data_name` attribute.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    - tuple:</span>
<span class="sd">        - `instance` (`CadetCareerProblem`): The updated instance with renamed AFSCs and adjusted internal data.</span>
<span class="sd">        - `translation_dict` (dict): The mapping used for conversion (real ‚Üí scrubbed).</span>

<span class="sd">    Examples:</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    # Forward conversion (scrubbing AFSC names)</span>
<span class="sd">    new_instance, afsc_mapping = convert_instance_to_from_scrubbed(instance, new_letter=&quot;X&quot;)</span>

<span class="sd">    # Reverse conversion (restoring AFSC names)</span>
<span class="sd">    original_instance, _ = convert_instance_to_from_scrubbed(new_instance, translation_dict=afsc_mapping)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Load parameters</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

    <span class="c1"># Initialize AFSC information</span>
    <span class="n">current_afscs_unsorted</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;afscs&quot;</span><span class="p">][:</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]]</span>
    <span class="n">new_p</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="c1"># We&#39;re going from original to scrubbed</span>
    <span class="k">if</span> <span class="n">new_letter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data_name</span> <span class="o">=</span> <span class="n">new_letter</span>

        <span class="c1"># Sort current list of AFSCs by PGL</span>
        <span class="n">t_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;pgl&quot;</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Indices that word sort the list -&gt; used a lot below!</span>
        <span class="n">current_afscs</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">current_afscs_unsorted</span><span class="p">[</span><span class="n">t_indices</span><span class="p">])</span>

        <span class="c1"># Construct new list of AFSCS</span>
        <span class="n">new_p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">10</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]])</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">current_afscs</span><span class="p">):</span>
            <span class="n">new_p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_letter</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Adjust new AFSC by adding &quot;_U&quot; or &quot;_R&quot; extension if necessary</span>
            <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;_R&quot;</span><span class="p">,</span> <span class="s2">&quot;_U&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">afsc</span><span class="p">:</span>
                    <span class="n">new_p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">ext</span>
                    <span class="k">break</span>

        <span class="c1"># Translate AFSCs to the new list</span>
        <span class="n">translation_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="n">current_afscs_unsorted</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">current_afscs</span> <span class="o">==</span> <span class="n">afsc</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">translation_dict</span><span class="p">[</span><span class="n">afsc</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>  <span class="c1"># Save this AFSC to the translation dictionary</span>
        <span class="n">new_p</span><span class="p">[</span><span class="s2">&quot;afscs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">new_p</span><span class="p">[</span><span class="s2">&quot;afscs&quot;</span><span class="p">],</span> <span class="s2">&quot;*&quot;</span><span class="p">))</span>  <span class="c1"># Add &quot;unmatched&quot; AFSC</span>

    <span class="c1"># We&#39;re going from scrubbed to original</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="c1"># Translate AFSCs (Really weird sorting going on...sorry)</span>
        <span class="n">new_p</span><span class="p">[</span><span class="s2">&quot;afscs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">translation_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">new_p</span><span class="p">[</span><span class="s2">&quot;afscs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">new_p</span><span class="p">[</span><span class="s2">&quot;afscs&quot;</span><span class="p">],</span> <span class="s2">&quot;*&quot;</span><span class="p">))</span>  <span class="c1"># Add &quot;unmatched&quot; AFSC</span>
        <span class="n">flipped_translation_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">translation_dict</span><span class="p">[</span><span class="n">afsc</span><span class="p">]:</span> <span class="n">afsc</span> <span class="k">for</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="n">translation_dict</span><span class="p">}</span>
        <span class="n">real_order_scrubbed_afscs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">flipped_translation_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">scrubbed_order_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">real_order_scrubbed_afscs</span><span class="o">==</span><span class="n">afsc</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="n">current_afscs_unsorted</span><span class="p">])</span>
        <span class="n">scrubbed_order_real_afscs</span> <span class="o">=</span> <span class="n">new_p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">][</span><span class="n">scrubbed_order_indices</span><span class="p">]</span>
        <span class="n">current_afscs</span> <span class="o">=</span> <span class="n">real_order_scrubbed_afscs</span>

        <span class="c1"># Get sorted indices</span>
        <span class="n">t_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">scrubbed_order_real_afscs</span><span class="o">==</span><span class="n">afsc</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="n">new_p</span><span class="p">[</span><span class="s2">&quot;afscs&quot;</span><span class="p">][:</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]]])</span>

    <span class="c1"># Loop through each key in the parameter dictionary to translate it</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>

        <span class="c1"># If it&#39;s a one dimensional array of length M, we translate it accordingly</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">],</span> <span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;^&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>  <span class="c1"># Sets/Subsets will be adjusted later</span>
            <span class="n">new_p</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">t_indices</span><span class="p">]</span>

        <span class="c1"># If it&#39;s a two-dimensional array of shape Mx4, we translate it accordingly</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">],</span> <span class="mi">4</span><span class="p">):</span>
            <span class="n">new_p</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">t_indices</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c1"># If it&#39;s a two-dimensional array of shape (NxM), we translate it accordingly</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">])</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;c_preferences&#39;</span><span class="p">,</span> <span class="s1">&#39;c_utilities&#39;</span><span class="p">]:</span>
            <span class="n">new_p</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">key</span><span class="p">][:,</span> <span class="n">t_indices</span><span class="p">]</span>

        <span class="c1"># If it&#39;s a two-dimensional array of shape (NxM+1), we translate it accordingly (leave unmatched AFSC alone)</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">new_p</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="n">new_p</span><span class="p">[</span><span class="n">key</span><span class="p">][:,</span> <span class="p">:</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">key</span><span class="p">][:,</span> <span class="n">t_indices</span><span class="p">]</span>

    <span class="c1"># Get assigned AFSC vector</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">real_afsc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;assigned&quot;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">real_afsc</span> <span class="ow">in</span> <span class="n">current_afscs</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">current_afscs</span> <span class="o">==</span> <span class="n">real_afsc</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">new_p</span><span class="p">[</span><span class="s2">&quot;assigned&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_p</span><span class="p">[</span><span class="s2">&quot;afscs&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>

    <span class="c1"># Set additions, and add to the instance</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameter_sets_additions</span><span class="p">(</span><span class="n">new_p</span><span class="p">)</span>

    <span class="c1"># Translate value parameters</span>
    <span class="k">if</span> <span class="n">instance</span><span class="o">.</span><span class="n">vp_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">new_vp_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">vp_name</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">vp_dict</span><span class="p">:</span>
            <span class="n">vp</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">vp_dict</span><span class="p">[</span><span class="n">vp_name</span><span class="p">])</span>
            <span class="n">new_vp</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">vp</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">:</span>

                <span class="c1"># If it&#39;s a one dimensional array of length M, we translate it accordingly</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">],):</span>
                    <span class="n">new_vp</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">vp</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">t_indices</span><span class="p">]</span>

                <span class="c1"># If it&#39;s a two-dimensional array of shape (NxM), we translate it accordingly</span>
                <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]):</span>
                    <span class="n">new_vp</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">vp</span><span class="p">[</span><span class="n">key</span><span class="p">][:,</span> <span class="n">t_indices</span><span class="p">]</span>

                <span class="c1"># If it&#39;s a two-dimensional array of shape (MxO), we translate it accordingly</span>
                <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">],</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;O&quot;</span><span class="p">])</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;f^hat&quot;</span><span class="p">]:</span>
                    <span class="n">new_vp</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">vp</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">t_indices</span><span class="p">,</span> <span class="p">:]</span>

            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">old_j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t_indices</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;K&quot;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;f^hat&quot;</span><span class="p">]:</span>
                        <span class="n">new_vp</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">vp</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">old_j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>

            <span class="c1"># Set value parameters to dict</span>
            <span class="n">new_vp_dict</span><span class="p">[</span><span class="n">vp_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_vp</span>

        <span class="c1"># Set it to the instance</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">vp_dict</span> <span class="o">=</span> <span class="n">new_vp_dict</span>

        <span class="c1"># Loop through each set of value parameters again</span>
        <span class="k">for</span> <span class="n">vp_name</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">vp_dict</span><span class="p">:</span>

            <span class="c1"># Set additions</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">vp_dict</span><span class="p">[</span><span class="n">vp_name</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">afccp</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">value_parameters_sets_additions</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">vp_dict</span><span class="p">[</span><span class="n">vp_name</span><span class="p">])</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">vp_dict</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Translate solutions</span>
    <span class="k">if</span> <span class="n">instance</span><span class="o">.</span><span class="n">solutions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">new_solutions_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Loop through each solution</span>
        <span class="k">for</span> <span class="n">solution_name</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">solutions</span><span class="p">:</span>
            <span class="n">real_solution</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">solutions</span><span class="p">[</span><span class="n">solution_name</span><span class="p">])</span>
            <span class="n">new_solutions_dict</span><span class="p">[</span><span class="n">solution_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">real_solution</span><span class="p">)</span>

            <span class="c1"># Loop through each assigned AFSC for the cadets</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">real_solution</span><span class="p">[</span><span class="s1">&#39;j_array&#39;</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]:</span>
                    <span class="n">real_afsc</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;afscs&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">current_afscs</span> <span class="o">==</span> <span class="n">real_afsc</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">new_solutions_dict</span><span class="p">[</span><span class="n">solution_name</span><span class="p">][</span><span class="s1">&#39;j_array&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>

        <span class="c1"># Save solutions dictionary</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">solutions</span> <span class="o">=</span> <span class="n">new_solutions_dict</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">solutions</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Convert &quot;c_preferences&quot; array</span>
    <span class="k">if</span> <span class="s2">&quot;c_preferences&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">pref</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">]):</span>
                <span class="n">real_afsc</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;c_preferences&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">pref</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">real_afsc</span> <span class="ow">in</span> <span class="n">current_afscs</span><span class="p">:</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">current_afscs</span> <span class="o">==</span> <span class="n">real_afsc</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">new_p</span><span class="p">[</span><span class="s2">&quot;c_preferences&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">pref</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_p</span><span class="p">[</span><span class="s2">&quot;afscs&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>

    <span class="c1"># Instance Attributes</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">data_name</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">data_version</span> <span class="o">=</span> <span class="n">data_name</span><span class="p">,</span> <span class="s2">&quot;Default&quot;</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">import_paths</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">export_paths</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">instance</span><span class="p">,</span> <span class="n">translation_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://gitlab.com/path-to-your-repo" target="_blank" rel="noopener" title="gitlab.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/input/tex/extensions/bm.js"></script>
      
    
  </body>
</html>