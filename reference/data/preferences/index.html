
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://dglaird.github.io/afccp/reference/data/preferences/">
      
      
        <link rel="prev" href="../adjustments/">
      
      
        <link rel="next" href="../processing/">
      
      
      <link rel="icon" href="../../../images/logos/afccp_logo_favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Preferences - Air Force Cadet Career Problem</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#data.preferences" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Air Force Cadet Career Problem" class="md-header__button md-logo" aria-label="Air Force Cadet Career Problem" data-md-component="logo">
      
  <img src="../../../images/logos/afccp_logo_and_text_light.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Air Force Cadet Career Problem
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Preferences
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/dglaird/afccp/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  üè† Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../getting-started/getting-started/" class="md-tabs__link">
          
  
  
  üöÄ Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../user-guide/overview/" class="md-tabs__link">
          
  
  
  üìò User Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../developer-guide/" class="md-tabs__link">
        
  
  
    
  
  üß† Developer Guide

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../main/cadetcareerproblem_overview/" class="md-tabs__link">
          
  
  
  CadetCareerProblem

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
  üìä Data

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../solutions/" class="md-tabs__link">
          
  
  
  üìà Solutions

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../visualizations/" class="md-tabs__link">
          
  
  
  Visualizations

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../faq/" class="md-tabs__link">
        
  
  
    
  
  ‚ùì FAQs

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../help/" class="md-tabs__link">
        
  
  
    
  
  üÜò Help & Support

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Air Force Cadet Career Problem" class="md-nav__button md-logo" aria-label="Air Force Cadet Career Problem" data-md-component="logo">
      
  <img src="../../../images/logos/afccp_logo_and_text_light.png" alt="logo">

    </a>
    Air Force Cadet Career Problem
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dglaird/afccp/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    üè† Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    üöÄ Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            üöÄ Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    üìÑ Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    üõ†Ô∏è Install Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            üõ†Ô∏è Install Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation Instructions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/developer-checklist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developer Checklist
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    üìò User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            üìò User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/tutorial_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 1 (Introduction)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/tutorial_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 2 (Data Overview)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/tutorial_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 3 (Parameters)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/tutorial_4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 4 (Value Parameters)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    üß† Developer Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    CadetCareerProblem
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            CadetCareerProblem
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_generated_data_corrections/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generated Data Corrections
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_main_data_corrections/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Main Data Corrections
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_other_adjustments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Other Adjustments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_value_parameter_specifications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Value Parameter Specifications
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_solution_generation_%26_algorithms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Solution Generation & Algorithms
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_optimization_models_%26_meta-heuristics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Optimization Models & Meta-Heuristics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_solution_handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Solution Handling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_export_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Export Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_data_visualizations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Visualizations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_results_visualizations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Results Visualizations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    üìä Data
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            üìä Data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adjustments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Adjustments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Preferences
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Preferences
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#data.preferences.convert_utility_matrices_preferences" class="md-nav__link">
    <span class="md-ellipsis">
      convert_utility_matrices_preferences
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.preferences.generate_fake_afsc_preferences" class="md-nav__link">
    <span class="md-ellipsis">
      generate_fake_afsc_preferences
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.preferences.generate_rated_data" class="md-nav__link">
    <span class="md-ellipsis">
      generate_rated_data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.preferences.construct_rated_preferences_from_om_by_soc" class="md-nav__link">
    <span class="md-ellipsis">
      construct_rated_preferences_from_om_by_soc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.preferences.fill_remaining_preferences" class="md-nav__link">
    <span class="md-ellipsis">
      fill_remaining_preferences
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.preferences.remove_ineligible_cadet_choices" class="md-nav__link">
    <span class="md-ellipsis">
      remove_ineligible_cadet_choices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.preferences.update_preference_matrices" class="md-nav__link">
    <span class="md-ellipsis">
      update_preference_matrices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.preferences.update_first_choice_cadet_utility_to_one" class="md-nav__link">
    <span class="md-ellipsis">
      update_first_choice_cadet_utility_to_one
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.preferences.convert_afsc_preferences_to_percentiles" class="md-nav__link">
    <span class="md-ellipsis">
      convert_afsc_preferences_to_percentiles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.preferences.update_cadet_columns_from_matrices" class="md-nav__link">
    <span class="md-ellipsis">
      update_cadet_columns_from_matrices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.preferences.update_cadet_utility_matrices" class="md-nav__link">
    <span class="md-ellipsis">
      update_cadet_utility_matrices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.preferences.modify_rated_cadet_lists_based_on_eligibility" class="md-nav__link">
    <span class="md-ellipsis">
      modify_rated_cadet_lists_based_on_eligibility
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.preferences.determine_soc_rated_afscs" class="md-nav__link">
    <span class="md-ellipsis">
      determine_soc_rated_afscs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.preferences.create_new_cadet_utility_matrix" class="md-nav__link">
    <span class="md-ellipsis">
      create_new_cadet_utility_matrix
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.preferences.create_final_cadet_utility_matrix_from_new_formula" class="md-nav__link">
    <span class="md-ellipsis">
      create_final_cadet_utility_matrix_from_new_formula
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../processing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Processing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../values/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Values
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Support
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../generation/basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generation- 'Basic'
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../generation/realistic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generation- 'Realistic'
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    üìà Solutions
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            üìà Solutions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../solutions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../solutions/algorithms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Algorithms
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../solutions/handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Handling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../solutions/optimization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Optimization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../solutions/sensitivity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sensitivity
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Visualizations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Visualizations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualizations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualizations/bubbles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bubbles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualizations/charts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Charts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualizations/slides/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Slides
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ‚ùì FAQs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../help/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    üÜò Help & Support
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<div class="doc doc-object doc-module">



<h1 id="data.preferences" class="doc doc-heading">
            <code>data.preferences</code>


<a href="#data.preferences" class="headerlink" title="Permanent link">&para;</a></h1>

    <div class="doc doc-contents first">

        <p>This module contains functions for constructing and modifying cadet and AFSC preference structures
within the Air Force Cadet Career Problem (AFCCP) model.</p>
<p>These utilities operate on the model's parameter dictionary to:
- Build preference matrices (<code>c_pref_matrix</code>, <code>a_pref_matrix</code>) from raw preference lists
- Convert preferences into normalized utilities and percentiles
- Apply eligibility filters to AFSC preferences
- Update final utility matrices for use in optimization</p>
<p>Functions in this module are essential for:
- Ensuring consistency between input data (Cadets.csv, AFSCs.csv) and the model structure
- Supporting preference-based evaluation and assignment logic
- Performing key preprocessing steps used during instance initialization or data generation</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="data.preferences.convert_utility_matrices_preferences" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_utility_matrices_preferences</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">cadets_as_well</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#data.preferences.convert_utility_matrices_preferences" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Converts utility matrices into ordinal preference matrices.</p>
<p>This function transforms the continuous utility values provided in the cadet and AFSC utility
matrices into discrete preference rankings (ordinal preferences). These rankings are stored in
<code>a_pref_matrix</code> and optionally <code>c_pref_matrix</code> within the <code>parameters</code> dictionary.</p>
<h4 id="data.preferences.convert_utility_matrices_preferences--parameters">Parameters<a class="headerlink" href="#data.preferences.convert_utility_matrices_preferences--parameters" title="Permanent link">&para;</a></h4>
<p>parameters : dict
    Dictionary of model parameters, including <code>afsc_utility</code> and optionally <code>cadet_utility</code>.</p>
<p>cadets_as_well : bool, optional
    If <code>True</code>, the cadet utility matrix (<code>cadet_utility</code>) is also converted into a cadet
    preference matrix (<code>c_pref_matrix</code>). Defaults to <code>False</code>.</p>
<h4 id="data.preferences.convert_utility_matrices_preferences--returns">Returns<a class="headerlink" href="#data.preferences.convert_utility_matrices_preferences--returns" title="Permanent link">&para;</a></h4>
<p>dict
    Updated <code>parameters</code> dictionary with added <code>a_pref_matrix</code> and optionally <code>c_pref_matrix</code>.</p>

            <details class="quote">
              <summary>Source code in <code>afccp/data/preferences.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_utility_matrices_preferences</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">cadets_as_well</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts utility matrices into ordinal preference matrices.</span>

<span class="sd">    This function transforms the continuous utility values provided in the cadet and AFSC utility</span>
<span class="sd">    matrices into discrete preference rankings (ordinal preferences). These rankings are stored in</span>
<span class="sd">    `a_pref_matrix` and optionally `c_pref_matrix` within the `parameters` dictionary.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameters : dict</span>
<span class="sd">        Dictionary of model parameters, including `afsc_utility` and optionally `cadet_utility`.</span>

<span class="sd">    cadets_as_well : bool, optional</span>
<span class="sd">        If `True`, the cadet utility matrix (`cadet_utility`) is also converted into a cadet</span>
<span class="sd">        preference matrix (`c_pref_matrix`). Defaults to `False`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        Updated `parameters` dictionary with added `a_pref_matrix` and optionally `c_pref_matrix`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">parameters</span>

    <span class="c1"># Loop through each AFSC to get their preferences</span>
    <span class="k">if</span> <span class="s1">&#39;afsc_utility&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;a_pref_matrix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;J&quot;</span><span class="p">]:</span>

            <span class="c1"># Sort the utilities to get the preference list</span>
            <span class="n">utilities</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;afsc_utility&quot;</span><span class="p">][:,</span> <span class="n">j</span><span class="p">]</span>
            <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">utilities</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">preferences</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">sorted_indices</span><span class="p">)</span>
            <span class="n">p</span><span class="p">[</span><span class="s2">&quot;a_pref_matrix&quot;</span><span class="p">][:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">preferences</span>

    <span class="c1"># Loop through each cadet to get their preferences</span>
    <span class="k">if</span> <span class="n">cadets_as_well</span><span class="p">:</span>
        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;c_pref_matrix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">]:</span>

            <span class="c1"># Sort the utilities to get the preference list</span>
            <span class="n">utilities</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;cadet_utility&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]]</span>
            <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">utilities</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">preferences</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span>
                <span class="n">sorted_indices</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Add 1 to change from python index (at 0) to rank (start at 1)</span>
            <span class="n">p</span><span class="p">[</span><span class="s2">&quot;c_pref_matrix&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">preferences</span>
    <span class="k">return</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.preferences.generate_fake_afsc_preferences" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_fake_afsc_preferences</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">value_parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fix_cadet_eligibility</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#data.preferences.generate_fake_afsc_preferences" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generate synthetic AFSC utility and preference matrices.</p>
<p>This function constructs artificial utility scores and corresponding preference rankings for Air Force Specialty
Codes (AFSCs) using merit, AFOCD tiers, and other known cadet attributes. It supports both weighted approaches
using a provided set of value parameters or a default fixed weighting strategy. Preferences are automatically
adjusted to ensure cadets and AFSCs only rank eligible options.</p>
<h4 id="data.preferences.generate_fake_afsc_preferences--parameters">Parameters<a class="headerlink" href="#data.preferences.generate_fake_afsc_preferences--parameters" title="Permanent link">&para;</a></h4>
<p>parameters : dict
    Dictionary containing fixed model parameters (cadet/AFSC eligibility, merit scores, utility matrices, etc.).</p>
<p>value_parameters : dict, optional
    Value parameter dictionary containing weights and objectives to guide AFSC utility generation. If None,
    a default set of weights is used.</p>
<p>fix_cadet_eligibility : bool, default=False
    If True, overrides cadet preferences to match eligibility criteria and recomputes rankings.</p>
<h4 id="data.preferences.generate_fake_afsc_preferences--returns">Returns<a class="headerlink" href="#data.preferences.generate_fake_afsc_preferences--returns" title="Permanent link">&para;</a></h4>
<p>parameters : dict
    Updated parameter dictionary containing generated utility matrices and preference rankings:</p>
<div class="highlight"><pre><span></span><code>- `afsc_utility`: N x M matrix of cadet utility scores for each AFSC.
- `a_pref_matrix`: AFSCs&#39; preference rankings of cadets.
- `c_pref_matrix`: Cadets&#39; preference rankings of AFSCs.
- `afsc_preferences`: Dict mapping each AFSC to its sorted list of cadet indices.
- `cadet_preferences`: Dict mapping each cadet to their sorted list of AFSC indices.
</code></pre></div>
<h4 id="data.preferences.generate_fake_afsc_preferences--examples">Examples<a class="headerlink" href="#data.preferences.generate_fake_afsc_preferences--examples" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">parameters</span> <span class="o">=</span> <span class="n">generate_fake_afsc_preferences</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="n">generate_fake_afsc_preferences</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">value_parameters</span><span class="o">=</span><span class="n">vp</span><span class="p">,</span> <span class="n">fix_cadet_eligibility</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>afccp/data/preferences.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_fake_afsc_preferences</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">value_parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fix_cadet_eligibility</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate synthetic AFSC utility and preference matrices.</span>

<span class="sd">    This function constructs artificial utility scores and corresponding preference rankings for Air Force Specialty</span>
<span class="sd">    Codes (AFSCs) using merit, AFOCD tiers, and other known cadet attributes. It supports both weighted approaches</span>
<span class="sd">    using a provided set of value parameters or a default fixed weighting strategy. Preferences are automatically</span>
<span class="sd">    adjusted to ensure cadets and AFSCs only rank eligible options.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameters : dict</span>
<span class="sd">        Dictionary containing fixed model parameters (cadet/AFSC eligibility, merit scores, utility matrices, etc.).</span>

<span class="sd">    value_parameters : dict, optional</span>
<span class="sd">        Value parameter dictionary containing weights and objectives to guide AFSC utility generation. If None,</span>
<span class="sd">        a default set of weights is used.</span>

<span class="sd">    fix_cadet_eligibility : bool, default=False</span>
<span class="sd">        If True, overrides cadet preferences to match eligibility criteria and recomputes rankings.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    parameters : dict</span>
<span class="sd">        Updated parameter dictionary containing generated utility matrices and preference rankings:</span>

<span class="sd">        - `afsc_utility`: N x M matrix of cadet utility scores for each AFSC.</span>
<span class="sd">        - `a_pref_matrix`: AFSCs&#39; preference rankings of cadets.</span>
<span class="sd">        - `c_pref_matrix`: Cadets&#39; preference rankings of AFSCs.</span>
<span class="sd">        - `afsc_preferences`: Dict mapping each AFSC to its sorted list of cadet indices.</span>
<span class="sd">        - `cadet_preferences`: Dict mapping each cadet to their sorted list of AFSC indices.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    parameters = generate_fake_afsc_preferences(parameters)</span>
<span class="sd">    parameters = generate_fake_afsc_preferences(parameters, value_parameters=vp, fix_cadet_eligibility=True)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Shorthand</span>
    <span class="n">p</span><span class="p">,</span> <span class="n">vp</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">value_parameters</span>

    <span class="c1"># Create AFSC Utility Matrix</span>
    <span class="n">p</span><span class="p">[</span><span class="s2">&quot;afsc_utility&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">vp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

        <span class="c1"># If we don&#39;t have a set of value_parameters, we just make some assumptions</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Merit&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="s2">&quot;Tier 1&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;Tier 2&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;Tier 3&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s2">&quot;Tier 4&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Utility&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">objective</span> <span class="ow">in</span> <span class="n">weights</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">objective</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s2">&quot;Merit&quot;</span><span class="p">:</span>
                    <span class="n">merit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;merit&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
                    <span class="n">p</span><span class="p">[</span><span class="s2">&quot;afsc_utility&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">merit</span> <span class="o">*</span> <span class="n">weights</span><span class="p">[</span><span class="n">objective</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="s2">&quot;afsc_utility&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">p</span><span class="p">[</span><span class="n">objective</span><span class="o">.</span><span class="n">lower</span><span class="p">()][:,</span> <span class="p">:</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]]</span> <span class="o">*</span> <span class="n">weights</span><span class="p">[</span><span class="n">objective</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="c1"># If we do have a set of value_parameters, we incorporate them</span>
        <span class="k">for</span> <span class="n">objective</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Merit&#39;</span><span class="p">,</span> <span class="s1">&#39;Tier 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Tier 2&#39;</span><span class="p">,</span> <span class="s1">&#39;Tier 3&#39;</span><span class="p">,</span> <span class="s1">&#39;Tier 4&#39;</span><span class="p">,</span> <span class="s1">&#39;Utility&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">objective</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;objectives&#39;</span><span class="p">]:</span>

                <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s1">&#39;objectives&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">objective</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s2">&quot;Merit&quot;</span><span class="p">:</span>
                    <span class="n">merit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;merit&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
                    <span class="n">p</span><span class="p">[</span><span class="s2">&quot;afsc_utility&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">merit</span> <span class="o">*</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;objective_weight&#39;</span><span class="p">][:,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="s2">&quot;afsc_utility&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">p</span><span class="p">[</span><span class="n">objective</span><span class="o">.</span><span class="n">lower</span><span class="p">()][:,</span> <span class="p">:</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]]</span> <span class="o">*</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;objective_weight&#39;</span><span class="p">][:,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
    <span class="n">p</span><span class="p">[</span><span class="s2">&quot;afsc_utility&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;eligible&quot;</span><span class="p">]</span>  <span class="c1"># They have to be eligible!</span>

    <span class="k">if</span> <span class="n">fix_cadet_eligibility</span><span class="p">:</span>  <span class="c1"># We just start over from scratch with cadet preferences</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Add a column to the eligible matrix for the unmatched AFSC (just to get the below multiplication to work)</span>
        <span class="n">eligible</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;eligible&#39;</span><span class="p">])</span>
        <span class="n">eligible</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">eligible</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">])])))</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_utility&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">eligible</span>  <span class="c1"># They have to be eligible!</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">]:</span>

            <span class="c1"># Sort the utilities to get the preference list</span>
            <span class="n">utilities</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;cadet_utility&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]]</span>
            <span class="n">ineligible_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">eligible</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">utilities</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">ineligible_indices</span><span class="p">)]</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sorted_indices</span>

            <span class="c1"># Since &#39;cadet_preferences&#39; is an array of AFSC indices, we can do this</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Create AFSC Preferences</span>
    <span class="n">p</span><span class="p">[</span><span class="s2">&quot;a_pref_matrix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;J&quot;</span><span class="p">]:</span>

        <span class="c1"># Loop through each cadet one more time to fix them on the AFSC list</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Sort the utilities to get the preference list</span>
        <span class="n">utilities</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;afsc_utility&quot;</span><span class="p">][:,</span> <span class="n">j</span><span class="p">]</span>
        <span class="n">ineligible_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">utilities</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">utilities</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">ineligible_indices</span><span class="p">)]</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">sorted_indices</span>

        <span class="c1"># Since &#39;afsc_preferences&#39; is an array of AFSC indices, we can do this</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;a_pref_matrix&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.preferences.generate_rated_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_rated_data</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span></code>

<a href="#data.preferences.generate_rated_data" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generate Simulated Rated Interest and Order of Merit (OM) Data.</p>
<p>This function generates ROTC-rated interest levels and USAFA/ROTC-rated Order of Merit (OM) scores for cadets
eligible for rated AFSCs (e.g., Pilot, CSO, ABM, RPA). These scores are essential for modeling preferences and
eligibility in rated board algorithms.</p>
<h4 id="data.preferences.generate_rated_data--parameters">Parameters<a class="headerlink" href="#data.preferences.generate_rated_data--parameters" title="Permanent link">&para;</a></h4>
<p>parameters : dict
    The main parameter dictionary for the cadet-AFSC assignment problem. It must contain:</p>
<div class="highlight"><pre><span></span><code>- `Rated Cadets`: Dictionary of rated cadets by commissioning source (`usafa`, `rotc`)
- `afscs_acc_grp`: AFSCs categorized into assignment groups (must include &#39;Rated&#39;)
- `SOCs`: List of commissioning source identifiers (e.g., `(&#39;usafa&#39;, &#39;Rated&#39;)`)
- `afsc_preferences`: AFSCs‚Äô ranked preferences over cadets
- `I^E`: Cadet eligibility sets
- `afscs`: Full list of AFSCs
- `Rated Cadet Index Dict`: Lookup dict to convert cadet ID to matrix row index for each SOC
</code></pre></div>
<h4 id="data.preferences.generate_rated_data--returns">Returns<a class="headerlink" href="#data.preferences.generate_rated_data--returns" title="Permanent link">&para;</a></h4>
<p>dict
Updated parameter dictionary including:</p>
<ul>
<li><code>rr_interest_matrix</code>: ROTC cadets' self-assessed interest in rated AFSCs</li>
<li><code>xr_om_matrix</code>, <code>ur_om_matrix</code>, etc.: Rated OM matrices for each SOC (generated if missing)</li>
</ul>
<h4 id="data.preferences.generate_rated_data--examples">Examples<a class="headerlink" href="#data.preferences.generate_rated_data--examples" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">parameters</span> <span class="o">=</span> <span class="n">generate_rated_data</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</code></pre></div>
<p>This generates the following additions:</p>
<ul>
<li><code>parameters['rr_interest_matrix']</code> ‚Üí random values like ['High', 'Med', 'Low', 'None']</li>
<li><code>parameters['ur_om_matrix']</code> ‚Üí OM percentiles for USAFA-rated cadets and AFSCs</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>afccp/data/preferences.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_rated_data</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate Simulated Rated Interest and Order of Merit (OM) Data.</span>

<span class="sd">    This function generates ROTC-rated interest levels and USAFA/ROTC-rated Order of Merit (OM) scores for cadets</span>
<span class="sd">    eligible for rated AFSCs (e.g., Pilot, CSO, ABM, RPA). These scores are essential for modeling preferences and</span>
<span class="sd">    eligibility in rated board algorithms.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameters : dict</span>
<span class="sd">        The main parameter dictionary for the cadet-AFSC assignment problem. It must contain:</span>

<span class="sd">        - `Rated Cadets`: Dictionary of rated cadets by commissioning source (`usafa`, `rotc`)</span>
<span class="sd">        - `afscs_acc_grp`: AFSCs categorized into assignment groups (must include &#39;Rated&#39;)</span>
<span class="sd">        - `SOCs`: List of commissioning source identifiers (e.g., `(&#39;usafa&#39;, &#39;Rated&#39;)`)</span>
<span class="sd">        - `afsc_preferences`: AFSCs‚Äô ranked preferences over cadets</span>
<span class="sd">        - `I^E`: Cadet eligibility sets</span>
<span class="sd">        - `afscs`: Full list of AFSCs</span>
<span class="sd">        - `Rated Cadet Index Dict`: Lookup dict to convert cadet ID to matrix row index for each SOC</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">    Updated parameter dictionary including:</span>

<span class="sd">    - `rr_interest_matrix`: ROTC cadets&#39; self-assessed interest in rated AFSCs</span>
<span class="sd">    - `xr_om_matrix`, `ur_om_matrix`, etc.: Rated OM matrices for each SOC (generated if missing)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    parameters = generate_rated_data(parameters)</span>
<span class="sd">    ```</span>

<span class="sd">    This generates the following additions:</span>

<span class="sd">    - `parameters[&#39;rr_interest_matrix&#39;]` ‚Üí random values like [&#39;High&#39;, &#39;Med&#39;, &#39;Low&#39;, &#39;None&#39;]</span>
<span class="sd">    - `parameters[&#39;ur_om_matrix&#39;]` ‚Üí OM percentiles for USAFA-rated cadets and AFSCs</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Shorthand</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">parameters</span>
    <span class="k">if</span> <span class="s1">&#39;usafa&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Rated Cadets&#39;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">p</span>  <span class="c1"># No Rated AFSCs to add</span>

    <span class="c1"># ROTC Rated Interest Matrix (Only generate random data if we don&#39;t already have it)</span>
    <span class="k">if</span> <span class="s1">&#39;rr_interest_matrix&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_interest_matrix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;High&#39;</span><span class="p">,</span> <span class="s1">&#39;Med&#39;</span><span class="p">,</span> <span class="s1">&#39;Low&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span>
              <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_acc_grp&#39;</span><span class="p">][</span><span class="s1">&#39;Rated&#39;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;Rated Cadets&#39;</span><span class="p">][</span><span class="s1">&#39;rotc&#39;</span><span class="p">]))])</span>

    <span class="c1"># Loop through each SOC to generate OM data (based on AFSC preferences) if we don&#39;t already have it</span>
    <span class="n">dataset_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">soc</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">soc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">r_om_matrix&#39;</span> <span class="k">for</span> <span class="n">soc</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;SOCs&#39;</span><span class="p">]}</span>
    <span class="k">for</span> <span class="n">soc</span> <span class="ow">in</span> <span class="n">dataset_dict</span><span class="p">:</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset_dict</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span>  <span class="c1"># SOC specific dataset name for Rated OM data</span>

        <span class="c1"># Collect useful information on the Rated cadets (for this SOC) and the Rated AFSCs</span>
        <span class="n">rated_cadets</span><span class="p">,</span> <span class="n">rated_afscs</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Rated Cadets&#39;</span><span class="p">][</span><span class="n">soc</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_acc_grp&#39;</span><span class="p">][</span><span class="s1">&#39;Rated&#39;</span><span class="p">]</span>
        <span class="n">num_rated_cadets</span><span class="p">,</span> <span class="n">num_rated_afscs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rated_cadets</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">rated_afscs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dataset</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>  <span class="c1"># Only generate data if we don&#39;t already have it</span>

            <span class="c1"># Loop through each Rated AFSC to construct their OM data</span>
            <span class="n">p</span><span class="p">[</span><span class="n">dataset</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">num_rated_cadets</span><span class="p">,</span> <span class="n">num_rated_afscs</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">afsc_index</span><span class="p">,</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_acc_grp&#39;</span><span class="p">][</span><span class="s1">&#39;Rated&#39;</span><span class="p">]):</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">afsc</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

                <span class="c1"># Percentiles sorted from top (1) to bottom (0)</span>
                <span class="n">rated_afsc_eligible_cadets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">rated_cadets</span><span class="p">)</span>
                <span class="n">percentiles</span> <span class="o">=</span> \
                    <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rated_afsc_eligible_cadets</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rated_afsc_eligible_cadets</span><span class="p">)))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="c1"># Loop through each cadet in order of preference and give them the highest percentile based on SOC</span>
                <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rated_afsc_eligible_cadets</span><span class="p">:</span>
                        <span class="n">cadet_index</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Rated Cadet Index Dict&#39;</span><span class="p">][</span><span class="n">soc</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">p</span><span class="p">[</span><span class="n">dataset</span><span class="p">][</span><span class="n">cadet_index</span><span class="p">,</span> <span class="n">afsc_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">percentiles</span><span class="p">[</span><span class="n">count</span><span class="p">]</span>
                        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.preferences.construct_rated_preferences_from_om_by_soc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">construct_rated_preferences_from_om_by_soc</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span></code>

<a href="#data.preferences.construct_rated_preferences_from_om_by_soc" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Construct AFSC Preferences for Rated Candidates Using OM Matrices.</p>
<p>This function consolidates the Ordered Merit (OM) matrices from multiple Sources of Commissioning (SOCs)
(e.g., USAFA and ROTC) and creates a unified AFSC preference list for Rated AFSCs. It normalizes OM rankings
across SOCs, combines them into a single composite preference score, and updates both the <code>afsc_preferences</code>
list and the <code>a_pref_matrix</code> for use in assignment modeling.</p>
<h4 id="data.preferences.construct_rated_preferences_from_om_by_soc--parameters">Parameters:<a class="headerlink" href="#data.preferences.construct_rated_preferences_from_om_by_soc--parameters" title="Permanent link">&para;</a></h4>
<p>parameters (dict): Dictionary containing the model instance parameters, including:</p>
<ul>
<li><code>rr_om_matrix</code>, <code>ur_om_matrix</code>: Ordered merit matrices from ROTC and USAFA.</li>
<li><code>or_om_matrix</code>: <strong>Potentially</strong> Ordered merit matrices from OTS.</li>
<li><code>afsc_preferences</code>: Dictionary to update with new AFSC ‚Üí cadet preference lists.</li>
<li><code>a_pref_matrix</code>: Matrix representing cadet rankings from the AFSCs' perspective.</li>
<li><code>SOCs</code>, <code>afscs_acc_grp</code>, and cadet lists for each SOC.</li>
</ul>
<h4 id="data.preferences.construct_rated_preferences_from_om_by_soc--returns">Returns:<a class="headerlink" href="#data.preferences.construct_rated_preferences_from_om_by_soc--returns" title="Permanent link">&para;</a></h4>
<p>dict: Updated <code>parameters</code> dictionary with modified <code>afsc_preferences</code> and <code>a_pref_matrix</code> reflecting
normalized OM-based preference rankings for Rated AFSCs.</p>
<h4 id="data.preferences.construct_rated_preferences_from_om_by_soc--example">Example:<a class="headerlink" href="#data.preferences.construct_rated_preferences_from_om_by_soc--example" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">parameters</span> <span class="o">=</span> <span class="n">construct_rated_preferences_from_om_by_soc</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</code></pre></div>
<h4 id="data.preferences.construct_rated_preferences_from_om_by_soc--see-also">See Also:<a class="headerlink" href="#data.preferences.construct_rated_preferences_from_om_by_soc--see-also" title="Permanent link">&para;</a></h4>
<p><a href="../../../afccp/reference/data/preferences/#data.preferences.determine_soc_rated_afscs"><code>determine_soc_rated_afscs</code></a>:
    Identifies which AFSCs are rated within a given SOC.</p>

            <details class="quote">
              <summary>Source code in <code>afccp/data/preferences.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">construct_rated_preferences_from_om_by_soc</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Construct AFSC Preferences for Rated Candidates Using OM Matrices.</span>

<span class="sd">    This function consolidates the Ordered Merit (OM) matrices from multiple Sources of Commissioning (SOCs)</span>
<span class="sd">    (e.g., USAFA and ROTC) and creates a unified AFSC preference list for Rated AFSCs. It normalizes OM rankings</span>
<span class="sd">    across SOCs, combines them into a single composite preference score, and updates both the `afsc_preferences`</span>
<span class="sd">    list and the `a_pref_matrix` for use in assignment modeling.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    --------</span>
<span class="sd">    parameters (dict): Dictionary containing the model instance parameters, including:</span>

<span class="sd">    - `rr_om_matrix`, `ur_om_matrix`: Ordered merit matrices from ROTC and USAFA.</span>
<span class="sd">    - `or_om_matrix`: **Potentially** Ordered merit matrices from OTS.</span>
<span class="sd">    - `afsc_preferences`: Dictionary to update with new AFSC ‚Üí cadet preference lists.</span>
<span class="sd">    - `a_pref_matrix`: Matrix representing cadet rankings from the AFSCs&#39; perspective.</span>
<span class="sd">    - `SOCs`, `afscs_acc_grp`, and cadet lists for each SOC.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    dict: Updated `parameters` dictionary with modified `afsc_preferences` and `a_pref_matrix` reflecting</span>
<span class="sd">    normalized OM-based preference rankings for Rated AFSCs.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    parameters = construct_rated_preferences_from_om_by_soc(parameters)</span>
<span class="sd">    ```</span>

<span class="sd">    See Also:</span>
<span class="sd">    --------</span>
<span class="sd">    [`determine_soc_rated_afscs`](../../../afccp/reference/data/preferences/#data.preferences.determine_soc_rated_afscs):</span>
<span class="sd">        Identifies which AFSCs are rated within a given SOC.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Shorthand</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">parameters</span>

    <span class="c1"># Loop through all the parameters we need and make sure we have everything</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;rr_om_matrix&#39;</span><span class="p">,</span> <span class="s1">&#39;ur_om_matrix&#39;</span><span class="p">,</span> <span class="s1">&#39;afsc_preferences&#39;</span><span class="p">,</span> <span class="s1">&#39;a_pref_matrix&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error. Parameter &#39;&quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;&#39; not in the parameter dictionary. Please make sure you have&quot;</span>
                                                          <span class="s2">&quot;AFSC preferences and Rated preferences from both sources &quot;</span>
                                                          <span class="s2">&quot;of commissioning.&quot;</span><span class="p">)</span>

    <span class="c1"># Need to construct a &quot;combined Rated OM&quot; matrix with ALL cadets which also contains 0 if the cadet is ineligible</span>
    <span class="n">all_rated_afscs</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_acc_grp&#39;</span><span class="p">][</span><span class="s2">&quot;Rated&quot;</span><span class="p">]</span>
    <span class="n">dataset_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">soc</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">soc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">r_om_matrix&#39;</span> <span class="k">for</span> <span class="n">soc</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;SOCs&#39;</span><span class="p">]}</span>
    <span class="n">cadets_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">soc</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">soc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">r_om_cadets&#39;</span> <span class="k">for</span> <span class="n">soc</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;SOCs&#39;</span><span class="p">]}</span>
    <span class="n">combined_rated_om</span> <span class="o">=</span> <span class="p">{</span><span class="n">afsc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="n">all_rated_afscs</span><span class="p">}</span>

    <span class="c1"># Loop through all sources of commissioning</span>
    <span class="n">rated_cadets</span><span class="p">,</span> <span class="n">rated_cadet_index_dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">soc</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;SOCs&#39;</span><span class="p">]:</span>

        <span class="c1"># Rated AFSCs for this SOC</span>
        <span class="n">rated_afscs</span> <span class="o">=</span> <span class="n">determine_soc_rated_afscs</span><span class="p">(</span><span class="n">soc</span><span class="p">,</span> <span class="n">all_rated_afscs</span><span class="p">)</span>

        <span class="c1"># Rated cadets for this SOC</span>
        <span class="n">rated_cadets</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">cadets_dict</span><span class="p">[</span><span class="n">soc</span><span class="p">]]</span>

        <span class="c1"># Loop through SOC-specific rated AFSCs</span>
        <span class="k">for</span> <span class="n">afsc_index</span><span class="p">,</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rated_afscs</span><span class="p">):</span>

            <span class="c1"># Need to re-normalize OM to make it fair across SOCs</span>
            <span class="n">nonzero_indices_in_soc_dataset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">dataset_dict</span><span class="p">[</span><span class="n">soc</span><span class="p">]][:,</span> <span class="n">afsc_index</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">num_eligible</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nonzero_indices_in_soc_dataset</span><span class="p">)</span>
            <span class="n">sorted_eligible_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">dataset_dict</span><span class="p">[</span><span class="n">soc</span><span class="p">]][:,</span> <span class="n">afsc_index</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="n">num_eligible</span><span class="p">]</span>
            <span class="n">ordered_cadets</span> <span class="o">=</span> <span class="n">rated_cadets</span><span class="p">[</span><span class="n">soc</span><span class="p">][</span><span class="n">sorted_eligible_indices</span><span class="p">]</span>
            <span class="n">combined_rated_om</span><span class="p">[</span><span class="n">afsc</span><span class="p">][</span><span class="n">ordered_cadets</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_eligible</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">num_eligible</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Sort the OM to convert it into a 1-N</span>
    <span class="k">for</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="n">all_rated_afscs</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">afsc</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Get AFSC preferences (list of cadet indices in order)</span>
        <span class="n">ineligibles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">combined_rated_om</span><span class="p">[</span><span class="n">afsc</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">num_ineligible</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ineligibles</span><span class="p">)</span>  <span class="c1"># Ineligibles are going to be at the bottom of the list (and we remove them)</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">combined_rated_om</span><span class="p">[</span><span class="n">afsc</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">num_ineligible</span><span class="p">]</span>

        <span class="c1"># Reset this AFSC&#39;s &quot;preference matrix&quot; column</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;a_pref_matrix&#39;</span><span class="p">][:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span>

        <span class="c1"># Since &#39;afsc_preferences&#39; is an array of cadet indices, we can do this</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;a_pref_matrix&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">p</span>  <span class="c1"># Return updated parameters</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.preferences.fill_remaining_preferences" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fill_remaining_preferences</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span></code>

<a href="#data.preferences.fill_remaining_preferences" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Fill in Remaining Cadet Preferences to Complete the Preference Matrix.</p>
<p>This function ensures that each cadet has a complete preference list across all AFSCs. It fills in any
unranked AFSCs (excluding bottom 2 and last choice) with incrementing ranks, followed by bottom 2 preferences,
and finally the explicitly marked last choice if applicable.</p>
<h4 id="data.preferences.fill_remaining_preferences--parameters">Parameters:<a class="headerlink" href="#data.preferences.fill_remaining_preferences--parameters" title="Permanent link">&para;</a></h4>
<p>parameters (dict): The problem instance parameters, containing:
    - <code>cadet_preferences</code>: Dictionary of AFSC preference orderings per cadet.
    - <code>c_pref_matrix</code>: Matrix of cadet preferences over AFSCs.
    - <code>J^Bottom 2 Choices</code>: Dictionary of each cadet's bottom two AFSCs.
    - <code>J^Last Choice</code>: Dictionary of each cadet's last AFSC choice.
    - <code>I</code>, <code>J</code>, <code>M</code>: Indexed sets of cadets, AFSCs, and unmatched AFSC index.</p>
<h4 id="data.preferences.fill_remaining_preferences--returns">Returns:<a class="headerlink" href="#data.preferences.fill_remaining_preferences--returns" title="Permanent link">&para;</a></h4>
<p>dict: Updated parameters dictionary with a fully filled <code>c_pref_matrix</code>.</p>
<h4 id="data.preferences.fill_remaining_preferences--example">Example:<a class="headerlink" href="#data.preferences.fill_remaining_preferences--example" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">parameters</span> <span class="o">=</span> <span class="n">fill_remaining_preferences</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>afccp/data/preferences.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fill_remaining_preferences</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fill in Remaining Cadet Preferences to Complete the Preference Matrix.</span>

<span class="sd">    This function ensures that each cadet has a complete preference list across all AFSCs. It fills in any</span>
<span class="sd">    unranked AFSCs (excluding bottom 2 and last choice) with incrementing ranks, followed by bottom 2 preferences,</span>
<span class="sd">    and finally the explicitly marked last choice if applicable.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    --------</span>
<span class="sd">    parameters (dict): The problem instance parameters, containing:</span>
<span class="sd">        - `cadet_preferences`: Dictionary of AFSC preference orderings per cadet.</span>
<span class="sd">        - `c_pref_matrix`: Matrix of cadet preferences over AFSCs.</span>
<span class="sd">        - `J^Bottom 2 Choices`: Dictionary of each cadet&#39;s bottom two AFSCs.</span>
<span class="sd">        - `J^Last Choice`: Dictionary of each cadet&#39;s last AFSC choice.</span>
<span class="sd">        - `I`, `J`, `M`: Indexed sets of cadets, AFSCs, and unmatched AFSC index.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    dict: Updated parameters dictionary with a fully filled `c_pref_matrix`.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    parameters = fill_remaining_preferences(parameters)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Shorthand</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">parameters</span>

    <span class="c1"># Loop through all cadets</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]:</span>

        <span class="c1"># Loop through all &quot;indifferent&quot; AFSCs that they are eligible for</span>
        <span class="n">pref_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]:</span>

            <span class="c1"># The AFSC is not in the cadet&#39;s preferences and it&#39;s not in the bottom choices</span>
            <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> \
                    <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Bottom 2 Choices&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Last Choice&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">pref_num</span>
                <span class="n">pref_num</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Loop through bottom 2 choices</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Bottom 2 Choices&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">pref_num</span>
            <span class="n">pref_num</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Set last choice preference if applicable</span>
        <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Last Choice&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]:</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Last Choice&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">pref_num</span>

    <span class="k">return</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.preferences.remove_ineligible_cadet_choices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_ineligible_cadet_choices</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">printing</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#data.preferences.remove_ineligible_cadet_choices" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Clean Ineligible Cadet-AFSC Preference Pairings.</p>
<p>This function audits and cleans the cadet-AFSC preference matrices by removing any inconsistent or ineligible pairings
based on the qualification matrix. It ensures that both <code>c_pref_matrix</code> (cadet preferences) and <code>a_pref_matrix</code>
(AFSC preferences) reflect only valid, eligible pairings. It also updates the qualification matrix to reflect enforced
ineligibility for problematic pairs.</p>
<h4 id="data.preferences.remove_ineligible_cadet_choices--parameters">Parameters:<a class="headerlink" href="#data.preferences.remove_ineligible_cadet_choices--parameters" title="Permanent link">&para;</a></h4>
<p>parameters (dict): Dictionary of the problem instance parameters.</p>
<p>printing (bool, optional): If True, logs every change made. Default is False.</p>
<h4 id="data.preferences.remove_ineligible_cadet_choices--returns">Returns:<a class="headerlink" href="#data.preferences.remove_ineligible_cadet_choices--returns" title="Permanent link">&para;</a></h4>
<p>dict: Updated parameters dictionary with cleaned preference matrices and enforced eligibility alignment.</p>
<h4 id="data.preferences.remove_ineligible_cadet_choices--example">Example:<a class="headerlink" href="#data.preferences.remove_ineligible_cadet_choices--example" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">parameters</span> <span class="o">=</span> <span class="n">remove_ineligible_cadet_choices</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">printing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<h4 id="data.preferences.remove_ineligible_cadet_choices--see-also">See Also:<a class="headerlink" href="#data.preferences.remove_ineligible_cadet_choices--see-also" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="../../../afccp/reference/data/preferences/#data.preferences.fill_remaining_preferences"><code>fill_remaining_preferences</code></a>:
  Fills in arbitrary preferences for cadets, excluding bottom-ranked AFSCs.</li>
<li><a href="../../../afccp/reference/data/adjustments/#data.adjustments.parameter_sets_additions"><code>parameter_sets_additions</code></a>:
  Rebuilds indexed sets after modifying eligibility or preference matrices.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>afccp/data/preferences.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_ineligible_cadet_choices</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">printing</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clean Ineligible Cadet-AFSC Preference Pairings.</span>

<span class="sd">    This function audits and cleans the cadet-AFSC preference matrices by removing any inconsistent or ineligible pairings</span>
<span class="sd">    based on the qualification matrix. It ensures that both `c_pref_matrix` (cadet preferences) and `a_pref_matrix`</span>
<span class="sd">    (AFSC preferences) reflect only valid, eligible pairings. It also updates the qualification matrix to reflect enforced</span>
<span class="sd">    ineligibility for problematic pairs.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    --------</span>
<span class="sd">    parameters (dict): Dictionary of the problem instance parameters.</span>

<span class="sd">    printing (bool, optional): If True, logs every change made. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    dict: Updated parameters dictionary with cleaned preference matrices and enforced eligibility alignment.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    parameters = remove_ineligible_cadet_choices(parameters, printing=True)</span>
<span class="sd">    ```</span>

<span class="sd">    See Also:</span>
<span class="sd">    --------</span>
<span class="sd">    - [`fill_remaining_preferences`](../../../afccp/reference/data/preferences/#data.preferences.fill_remaining_preferences):</span>
<span class="sd">      Fills in arbitrary preferences for cadets, excluding bottom-ranked AFSCs.</span>
<span class="sd">    - [`parameter_sets_additions`](../../../afccp/reference/data/adjustments/#data.adjustments.parameter_sets_additions):</span>
<span class="sd">      Rebuilds indexed sets after modifying eligibility or preference matrices.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Shorthand</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">parameters</span>

    <span class="c1"># This is my final correction for preferences to make it all match up</span>
    <span class="n">num_removals</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]:</span>
            <span class="n">afsc</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>  <span class="c1"># AFSC name</span>

            <span class="c1"># Cadet not eligible based on degree qualification matrix</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>

                <span class="c1"># AFSC is currently in the cadet&#39;s preference list</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">num_removals</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Edit &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_removals</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: Cadet &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; not eligible for &#39;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span>
                                 <span class="s1">&#39; based on degree qualification matrix but the AFSC was in the cadet preference list. &#39;</span>
                                 <span class="s1">&#39;c_pref_matrix position (&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;) set to 0.&#39;</span><span class="p">)</span>

                <span class="c1"># Cadet is currently in the AFSC&#39;s preference list</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;a_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;a_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">num_removals</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Edit &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_removals</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: Cadet &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; not eligible for &#39;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span>
                                 <span class="s1">&#39; based on degree qualification matrix but the cadet was in the AFSC preference list. &#39;</span>
                                 <span class="s1">&#39;a_pref_matrix position (&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;) set to 0.&#39;</span><span class="p">)</span>

            <span class="c1"># Cadet is currently eligible based on degree qualification matrix</span>
            <span class="k">else</span><span class="p">:</span>

                <span class="c1"># If there&#39;s already an ineligible tier in this AFSC, we use it in case we need to adjust qual matrix</span>
                <span class="k">if</span> <span class="s2">&quot;I = 0&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Deg Tiers&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="s2">&quot;I&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;t_count&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="s2">&quot;I&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;t_count&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1"># The cadet is not in the AFSC&#39;s preference list</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;a_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

                    <span class="c1"># The AFSC is in the cadet&#39;s preference list</span>
                    <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">num_removals</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Edit &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_removals</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: Cadet &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; eligible for &#39;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span>
                                     <span class="s1">&#39; based on degree qualification matrix but the cadet was not in the AFSC preference list. &#39;</span>
                                     <span class="s1">&#39;c_pref_matrix position (&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span>
                                     <span class="s1">&#39;) set to 0 and qual position adjusted to &#39;</span> <span class="o">+</span> <span class="n">val</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>

                    <span class="c1"># The AFSC is not in the cadet&#39;s preference list</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">num_removals</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Edit &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_removals</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: Cadet &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; eligible for &#39;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span>
                                     <span class="s1">&#39; based on degree qualification matrix but the cadet/afsc pairing was in neither &#39;</span>
                                     <span class="s1">&#39;matrix (a_pref_matrix or c_pref_matrix). Both a_pref_matrix and c_pref_matrix &#39;</span>
                                     <span class="s1">&#39;position (&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;) were already 0 so only qual position was &#39;</span>
                                                                             <span class="s1">&#39;adjusted to &#39;</span> <span class="o">+</span> <span class="n">val</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>

                    <span class="c1"># Force ineligibility in the qual matrix as well</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;qual&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;eligible&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;ineligible&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="c1"># The AFSC is not in the cadet&#39;s preference list</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

                    <span class="c1"># The cadet is in the AFSC&#39;s preference list</span>
                    <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;a_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;a_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">num_removals</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Edit &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_removals</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: Cadet &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; eligible for &#39;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span>
                                     <span class="s1">&#39; based on degree qualification matrix but the AFSC was not in the cadet preference list. &#39;</span>
                                     <span class="s1">&#39;a_pref_matrix position (&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span>
                                     <span class="s1">&#39;) set to 0 and qual position adjusted to &#39;</span> <span class="o">+</span> <span class="n">val</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>

                    <span class="c1"># The cadet is not in the AFSC&#39;s preference list</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">num_removals</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Edit &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_removals</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: Cadet &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; eligible for &#39;</span> <span class="o">+</span> <span class="n">afsc</span> <span class="o">+</span>
                                     <span class="s1">&#39; based on degree qualification matrix but the cadet/afsc pairing was in neither &#39;</span>
                                     <span class="s1">&#39;matrix (a_pref_matrix or c_pref_matrix). Both a_pref_matrix and c_pref_matrix &#39;</span>
                                     <span class="s1">&#39;position (&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                         <span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;) were already 0 so only qual position was &#39;</span>
                                              <span class="s1">&#39;adjusted to &#39;</span> <span class="o">+</span> <span class="n">val</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>

                    <span class="c1"># Force ineligibility in the qual matrix as well</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;qual&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;eligible&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;ineligible&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Print statement</span>
    <span class="k">if</span> <span class="n">printing</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">num_removals</span><span class="p">,</span> <span class="s2">&quot;total adjustments.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p</span>  <span class="c1"># Return parameters</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.preferences.update_preference_matrices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_preference_matrices</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span></code>

<a href="#data.preferences.update_preference_matrices" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Reconstructs cadet and AFSC preference matrices based on index-based preference lists.</p>
<p>This function updates the <code>c_pref_matrix</code> (cadet preference matrix) and <code>a_pref_matrix</code>
(AFSC preference matrix) using the indexed preference lists provided in
<code>cadet_preferences</code> and <code>afsc_preferences</code>, respectively. Cadets and AFSCs with empty
preferences are skipped.</p>
<h4 id="data.preferences.update_preference_matrices--parameters">Parameters<a class="headerlink" href="#data.preferences.update_preference_matrices--parameters" title="Permanent link">&para;</a></h4>
<p>parameters : dict
A parameter dictionary containing:</p>
<ul>
<li><code>N</code> : int, total number of cadets</li>
<li><code>M</code> : int, total number of AFSCs</li>
<li><code>I</code> : list of cadet indices</li>
<li><code>J</code> : list of AFSC indices</li>
<li><code>cadet_preferences</code> : dictionary of lists; each list contains AFSC indices ranked by each cadet</li>
<li><code>afsc_preferences</code> : dictionary of lists; each list contains cadet indices ranked by each AFSC</li>
</ul>
<h4 id="data.preferences.update_preference_matrices--returns">Returns<a class="headerlink" href="#data.preferences.update_preference_matrices--returns" title="Permanent link">&para;</a></h4>
<p>dict
Updated parameter dictionary with:</p>
<ul>
<li><code>c_pref_matrix</code> : ndarray, shape (N, M)
    Preference matrix where entry (i, j) indicates cadet i's rank of AFSC j (0 if not ranked)</li>
<li><code>a_pref_matrix</code> : ndarray, shape (N, M)
    Preference matrix where entry (i, j) indicates AFSC j's rank of cadet i (0 if not ranked)</li>
</ul>
<h4 id="data.preferences.update_preference_matrices--examples">Examples<a class="headerlink" href="#data.preferences.update_preference_matrices--examples" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">afccp.data.preferences</span> <span class="kn">import</span> <span class="n">update_preference_matrices</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="n">update_preference_matrices</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>afccp/data/preferences.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_preference_matrices</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reconstructs cadet and AFSC preference matrices based on index-based preference lists.</span>

<span class="sd">    This function updates the `c_pref_matrix` (cadet preference matrix) and `a_pref_matrix`</span>
<span class="sd">    (AFSC preference matrix) using the indexed preference lists provided in</span>
<span class="sd">    `cadet_preferences` and `afsc_preferences`, respectively. Cadets and AFSCs with empty</span>
<span class="sd">    preferences are skipped.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameters : dict</span>
<span class="sd">    A parameter dictionary containing:</span>

<span class="sd">    - `N` : int, total number of cadets</span>
<span class="sd">    - `M` : int, total number of AFSCs</span>
<span class="sd">    - `I` : list of cadet indices</span>
<span class="sd">    - `J` : list of AFSC indices</span>
<span class="sd">    - `cadet_preferences` : dictionary of lists; each list contains AFSC indices ranked by each cadet</span>
<span class="sd">    - `afsc_preferences` : dictionary of lists; each list contains cadet indices ranked by each AFSC</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">    Updated parameter dictionary with:</span>

<span class="sd">    - `c_pref_matrix` : ndarray, shape (N, M)</span>
<span class="sd">        Preference matrix where entry (i, j) indicates cadet i&#39;s rank of AFSC j (0 if not ranked)</span>
<span class="sd">    - `a_pref_matrix` : ndarray, shape (N, M)</span>
<span class="sd">        Preference matrix where entry (i, j) indicates AFSC j&#39;s rank of cadet i (0 if not ranked)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    from afccp.data.preferences import update_preference_matrices</span>
<span class="sd">    parameters = update_preference_matrices(parameters)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Shorthand</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">parameters</span>

    <span class="c1"># Update the cadet preference matrix (c_pref_matrix)</span>
    <span class="k">if</span> <span class="s1">&#39;cadet_preferences&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>

        <span class="c1"># Since &#39;cadet_preferences&#39; is an array of AFSC indices, we can do this</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]:</span>

            <span class="c1"># If this cadet does not have any preferences, we skip them (must be an OTS candidate)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Update the AFSC preference matrix (a_pref_matrix)</span>
    <span class="k">if</span> <span class="s1">&#39;afsc_preferences&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>

        <span class="c1"># Since &#39;afsc_preferences&#39; is an array of cadet indices, we can do this</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;a_pref_matrix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]:</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;a_pref_matrix&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.preferences.update_first_choice_cadet_utility_to_one" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_first_choice_cadet_utility_to_one</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">printing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#data.preferences.update_first_choice_cadet_utility_to_one" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Fix First-Choice Cadet Utility to One.</p>
<p>Updates the utility matrix so that each cadet's top-ranked AFSC is assigned a utility value of 1.0,
indicating maximum preference. This only applies to cadets who have valid preference lists.</p>
<h4 id="data.preferences.update_first_choice_cadet_utility_to_one--parameters">Parameters<a class="headerlink" href="#data.preferences.update_first_choice_cadet_utility_to_one--parameters" title="Permanent link">&para;</a></h4>
<p>parameters : dict
A parameter dictionary containing:</p>
<ul>
<li><code>I</code> : list of int
  Cadet indices.</li>
<li><code>cadet_preferences</code> : dict of lists
  Each cadet's list of AFSC indices in ranked order of preference.</li>
<li><code>utility</code> : ndarray of shape (N, M)
  Matrix of cadet utility values where entry (i, j) is cadet i's utility for AFSC j.</li>
</ul>
<p>printing : bool, optional
If True, prints the number of cadets updated and their indices. Default is True.</p>
<h4 id="data.preferences.update_first_choice_cadet_utility_to_one--returns">Returns<a class="headerlink" href="#data.preferences.update_first_choice_cadet_utility_to_one--returns" title="Permanent link">&para;</a></h4>
<p>ndarray:
Updated utility matrix with each cadet's first choice AFSC set to a utility of 1.</p>
<h4 id="data.preferences.update_first_choice_cadet_utility_to_one--examples">Examples<a class="headerlink" href="#data.preferences.update_first_choice_cadet_utility_to_one--examples" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">updated_utility</span> <span class="o">=</span> <span class="n">update_first_choice_cadet_utility_to_one</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>afccp/data/preferences.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_first_choice_cadet_utility_to_one</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">printing</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fix First-Choice Cadet Utility to One.</span>

<span class="sd">    Updates the utility matrix so that each cadet&#39;s top-ranked AFSC is assigned a utility value of 1.0,</span>
<span class="sd">    indicating maximum preference. This only applies to cadets who have valid preference lists.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameters : dict</span>
<span class="sd">    A parameter dictionary containing:</span>

<span class="sd">    - `I` : list of int</span>
<span class="sd">      Cadet indices.</span>
<span class="sd">    - `cadet_preferences` : dict of lists</span>
<span class="sd">      Each cadet&#39;s list of AFSC indices in ranked order of preference.</span>
<span class="sd">    - `utility` : ndarray of shape (N, M)</span>
<span class="sd">      Matrix of cadet utility values where entry (i, j) is cadet i&#39;s utility for AFSC j.</span>

<span class="sd">    printing : bool, optional</span>
<span class="sd">    If True, prints the number of cadets updated and their indices. Default is True.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ndarray:</span>
<span class="sd">    Updated utility matrix with each cadet&#39;s first choice AFSC set to a utility of 1.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    updated_utility = update_first_choice_cadet_utility_to_one(parameters)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Shorthand</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">parameters</span>

    <span class="c1"># Loop through each cadet and make their first choice AFSC have a utility of 1</span>
    <span class="n">fixed_cadets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]:</span>

        <span class="c1"># If this cadet does not have any preferences, we skip them (must be an OTS candidate)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># Fix the first choice</span>
        <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">fixed_cadets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">printing</span><span class="p">:</span>
        <span class="n">print_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Fixed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">fixed_cadets</span><span class="p">)</span><span class="si">}</span><span class="s1"> first choice cadet utility values to 100%.</span><span class="se">\n</span><span class="s1">Cadets: </span><span class="si">{</span><span class="n">fixed_cadets</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">print_str</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;utility&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.preferences.convert_afsc_preferences_to_percentiles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_afsc_preferences_to_percentiles</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span></code>

<a href="#data.preferences.convert_afsc_preferences_to_percentiles" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Convert AFSC Preferences to Percentile-Based Utilities.</p>
<p>This method transforms each AFSC's preference list into a normalized percentile utility score
for each cadet. Higher-ranked cadets receive higher percentile scores (closer to 1), while lower-ranked
cadets receive lower scores (closer to 0). These scores are stored in a new matrix called <code>afsc_utility</code>.</p>
<h4 id="data.preferences.convert_afsc_preferences_to_percentiles--parameters">Parameters<a class="headerlink" href="#data.preferences.convert_afsc_preferences_to_percentiles--parameters" title="Permanent link">&para;</a></h4>
<p>parameters: dict
A parameter dictionary containing:</p>
<ul>
<li><code>N</code> : int
  Total number of cadets</li>
<li><code>M</code> : int
  Total number of AFSCs</li>
<li><code>J</code> : list of AFSC indices</li>
<li><code>afsc_preferences</code> : dict
  Dictionary where each key is an AFSC index and each value is a list of cadet indices ranked by that AFSC</li>
</ul>
<h4 id="data.preferences.convert_afsc_preferences_to_percentiles--returns">Returns<a class="headerlink" href="#data.preferences.convert_afsc_preferences_to_percentiles--returns" title="Permanent link">&para;</a></h4>
<p>parameters : dict
Updated parameter dictionary with:</p>
<ul>
<li><code>afsc_utility</code>: ndarray of shape (N, M)
  Matrix of normalized percentile utility values for each cadet-AFSC pair. A value of 1.0 indicates
  top preference, and values decrease with lower preference.</li>
</ul>
<h4 id="data.preferences.convert_afsc_preferences_to_percentiles--examples">Examples<a class="headerlink" href="#data.preferences.convert_afsc_preferences_to_percentiles--examples" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Define AFSC preferences</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;J&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="s1">&#39;afsc_preferences&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Convert preferences to percentiles</span>
<span class="n">updated</span> <span class="o">=</span> <span class="n">convert_afsc_preferences_to_percentiles</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

<span class="c1"># View result</span>
<span class="nb">print</span><span class="p">(</span><span class="n">updated</span><span class="p">[</span><span class="s1">&#39;afsc_utility&#39;</span><span class="p">])</span>
<span class="c1"># Output:</span>
<span class="c1"># array([[0.333, 0.5],</span>
<span class="c1">#        [0.666, 1.0],</span>
<span class="c1">#        [1.0,   0.0]])</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>afccp/data/preferences.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_afsc_preferences_to_percentiles</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert AFSC Preferences to Percentile-Based Utilities.</span>

<span class="sd">    This method transforms each AFSC&#39;s preference list into a normalized percentile utility score</span>
<span class="sd">    for each cadet. Higher-ranked cadets receive higher percentile scores (closer to 1), while lower-ranked</span>
<span class="sd">    cadets receive lower scores (closer to 0). These scores are stored in a new matrix called `afsc_utility`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameters: dict</span>
<span class="sd">    A parameter dictionary containing:</span>

<span class="sd">    - `N` : int</span>
<span class="sd">      Total number of cadets</span>
<span class="sd">    - `M` : int</span>
<span class="sd">      Total number of AFSCs</span>
<span class="sd">    - `J` : list of AFSC indices</span>
<span class="sd">    - `afsc_preferences` : dict</span>
<span class="sd">      Dictionary where each key is an AFSC index and each value is a list of cadet indices ranked by that AFSC</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    parameters : dict</span>
<span class="sd">    Updated parameter dictionary with:</span>

<span class="sd">    - `afsc_utility`: ndarray of shape (N, M)</span>
<span class="sd">      Matrix of normalized percentile utility values for each cadet-AFSC pair. A value of 1.0 indicates</span>
<span class="sd">      top preference, and values decrease with lower preference.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    # Define AFSC preferences</span>
<span class="sd">    parameters = {</span>
<span class="sd">        &#39;N&#39;: 3,</span>
<span class="sd">        &#39;M&#39;: 2,</span>
<span class="sd">        &#39;J&#39;: [0, 1],</span>
<span class="sd">        &#39;afsc_preferences&#39;: {</span>
<span class="sd">            0: [2, 1, 0],</span>
<span class="sd">            1: [1, 0]</span>
<span class="sd">        }</span>
<span class="sd">    }</span>

<span class="sd">    # Convert preferences to percentiles</span>
<span class="sd">    updated = convert_afsc_preferences_to_percentiles(parameters)</span>

<span class="sd">    # View result</span>
<span class="sd">    print(updated[&#39;afsc_utility&#39;])</span>
<span class="sd">    # Output:</span>
<span class="sd">    # array([[0.333, 0.5],</span>
<span class="sd">    #        [0.666, 1.0],</span>
<span class="sd">    #        [1.0,   0.0]])</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Shorthand</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">parameters</span>

    <span class="c1"># Get normalized percentiles (Average of 0.5)</span>
    <span class="n">p</span><span class="p">[</span><span class="s2">&quot;afsc_utility&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]])</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]:</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_utility&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.preferences.update_cadet_columns_from_matrices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_cadet_columns_from_matrices</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span></code>

<a href="#data.preferences.update_cadet_columns_from_matrices" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Convert cadet preference matrix to preference columns of AFSC names and calculate utility columns.</p>
<p>This function takes the cadet preference matrix (NxM) where cadet "ranks" are specified and converts it to
preference columns (NxP) of AFSC names, where P is the number of AFSC preferences for each cadet. It uses
this preference information alongside the utility dataframe (NxP) to extract the utility columns (NxP) as well.</p>
<p>Args:
parameters (dict): A dictionary containing the following elements:</p>
<ul>
<li>"c_pref_matrix" (numpy.ndarray): Cadet preference matrix (NxM) with cadet ranks.</li>
<li>"P" (int): Number of AFSC preferences for each cadet.</li>
<li>"N" (int): Total number of cadets.</li>
<li>"I" (list): List of cadet indices.</li>
<li>"M" (int): Total number of AFSCs.</li>
<li>"afscs" (numpy.ndarray): Array of AFSC names.</li>
<li>"num_util" (int): Number of utility values to extract.</li>
<li>"utility" (numpy.ndarray): Utility dataframe (NxM) containing utility values for cadets and AFSCs.</li>
</ul>
<p>Returns:
tuple: A tuple containing two elements:</p>
<ul>
<li>preferences (numpy.ndarray): Cadet preference columns (NxP) with AFSC names.</li>
<li>utilities_array (numpy.ndarray): Utility columns (NxP) for each cadet and AFSC preference.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>afccp/data/preferences.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_cadet_columns_from_matrices</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert cadet preference matrix to preference columns of AFSC names and calculate utility columns.</span>

<span class="sd">    This function takes the cadet preference matrix (NxM) where cadet &quot;ranks&quot; are specified and converts it to</span>
<span class="sd">    preference columns (NxP) of AFSC names, where P is the number of AFSC preferences for each cadet. It uses</span>
<span class="sd">    this preference information alongside the utility dataframe (NxP) to extract the utility columns (NxP) as well.</span>

<span class="sd">    Args:</span>
<span class="sd">    parameters (dict): A dictionary containing the following elements:</span>

<span class="sd">    - &quot;c_pref_matrix&quot; (numpy.ndarray): Cadet preference matrix (NxM) with cadet ranks.</span>
<span class="sd">    - &quot;P&quot; (int): Number of AFSC preferences for each cadet.</span>
<span class="sd">    - &quot;N&quot; (int): Total number of cadets.</span>
<span class="sd">    - &quot;I&quot; (list): List of cadet indices.</span>
<span class="sd">    - &quot;M&quot; (int): Total number of AFSCs.</span>
<span class="sd">    - &quot;afscs&quot; (numpy.ndarray): Array of AFSC names.</span>
<span class="sd">    - &quot;num_util&quot; (int): Number of utility values to extract.</span>
<span class="sd">    - &quot;utility&quot; (numpy.ndarray): Utility dataframe (NxM) containing utility values for cadets and AFSCs.</span>

<span class="sd">    Returns:</span>
<span class="sd">    tuple: A tuple containing two elements:</span>

<span class="sd">    - preferences (numpy.ndarray): Cadet preference columns (NxP) with AFSC names.</span>
<span class="sd">    - utilities_array (numpy.ndarray): Utility columns (NxP) for each cadet and AFSC preference.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Shorthand</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">parameters</span>

    <span class="c1"># Initialize data</span>
    <span class="n">preference_matrix</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;c_pref_matrix&quot;</span><span class="p">])</span>
    <span class="n">preferences</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">10</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">])]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])])</span>
    <span class="n">utilities_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]:</span>

        <span class="c1"># Eliminate AFSCs that weren&#39;t in the cadet&#39;s preference list (Change the choice to a large #)</span>
        <span class="n">zero_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">preference_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">preference_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">zero_indices</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>

        <span class="c1"># Get the ordered list of AFSCs</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">preference_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>  <span class="c1"># [::-1]  #.nonzero()[0]</span>
        <span class="n">ordered_afscs</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;afscs&quot;</span><span class="p">][</span><span class="n">indices</span><span class="p">][:</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">zero_indices</span><span class="p">)][:</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">]]</span>
        <span class="n">ordered_utilities</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;utility&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">indices</span><span class="p">][:</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">zero_indices</span><span class="p">)][:</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;num_util&quot;</span><span class="p">]]</span>

        <span class="c1"># Put the utilities and preferences in the correct spots</span>
        <span class="n">np</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">utilities_array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ordered_utilities</span><span class="p">)),</span> <span class="n">ordered_utilities</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">preferences</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ordered_afscs</span><span class="p">)),</span> <span class="n">ordered_afscs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">preferences</span><span class="p">,</span> <span class="n">utilities_array</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.preferences.update_cadet_utility_matrices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_cadet_utility_matrices</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span></code>

<a href="#data.preferences.update_cadet_utility_matrices" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Update Cadet Utility Matrices from Reported Utilities.</p>
<p>This method reads each cadet's self-reported utility values (from <code>c_utilities</code>) and updates the <code>utility</code> matrix accordingly.
It also creates the normalized <code>cadet_utility</code> matrix based on ordinal preferences or a utility-based formula,
depending on whether <code>last_afsc</code> is present in the parameters.</p>
<h4 id="data.preferences.update_cadet_utility_matrices--parameters">Parameters<a class="headerlink" href="#data.preferences.update_cadet_utility_matrices--parameters" title="Permanent link">&para;</a></h4>
<p>parameters : dict
A parameter dictionary containing:</p>
<ul>
<li><code>N</code> : int, total number of cadets</li>
<li><code>M</code> : int, total number of AFSCs</li>
<li><code>I</code> : list of cadet indices</li>
<li><code>cadet_preferences</code> : dict of lists; each list contains AFSC indices ranked by cadet</li>
<li><code>c_utilities</code> : ndarray, shape (N, P); cadet-reported utilities aligned with their preferences</li>
<li><code>num_util</code> : int; number of utility values reported per cadet</li>
<li><code>last_afsc</code> (optional) : str; used to determine which utility processing function to apply</li>
</ul>
<h4 id="data.preferences.update_cadet_utility_matrices--returns">Returns<a class="headerlink" href="#data.preferences.update_cadet_utility_matrices--returns" title="Permanent link">&para;</a></h4>
<p>parameters : dict
Updated parameter dictionary with:</p>
<ul>
<li><code>utility</code> : ndarray, shape (N, M+1)
    Utility matrix with cadet-reported values; last column represents unmatched utility</li>
<li><code>cadet_utility</code> : ndarray
    Normalized utility matrix calculated from rankings or weighted formula</li>
</ul>
<h4 id="data.preferences.update_cadet_utility_matrices--raises">Raises<a class="headerlink" href="#data.preferences.update_cadet_utility_matrices--raises" title="Permanent link">&para;</a></h4>
<p>ValueError
    If required fields (<code>cadet_preferences</code>, <code>c_utilities</code>) are missing from the parameter dictionary.</p>
<h4 id="data.preferences.update_cadet_utility_matrices--examples">Examples<a class="headerlink" href="#data.preferences.update_cadet_utility_matrices--examples" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">parameters</span> <span class="o">=</span> <span class="n">update_cadet_utility_matrices</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</code></pre></div>
<h4 id="data.preferences.update_cadet_utility_matrices--see-also">See Also<a class="headerlink" href="#data.preferences.update_cadet_utility_matrices--see-also" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="../../../../afccp/reference/data/preferences/#data.preferences.create_final_cadet_utility_matrix_from_new_formula"><code>create_final_cadet_utility_matrix_from_new_formula</code></a></li>
<li><a href="../../../../afccp/reference/data/preferences/#data.preferences.create_new_cadet_utility_matrix"><code>create_new_cadet_utility_matrix</code></a></li>
</ul>

            <details class="quote">
              <summary>Source code in <code>afccp/data/preferences.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_cadet_utility_matrices</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update Cadet Utility Matrices from Reported Utilities.</span>

<span class="sd">    This method reads each cadet&#39;s self-reported utility values (from `c_utilities`) and updates the `utility` matrix accordingly.</span>
<span class="sd">    It also creates the normalized `cadet_utility` matrix based on ordinal preferences or a utility-based formula,</span>
<span class="sd">    depending on whether `last_afsc` is present in the parameters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameters : dict</span>
<span class="sd">    A parameter dictionary containing:</span>

<span class="sd">    - `N` : int, total number of cadets</span>
<span class="sd">    - `M` : int, total number of AFSCs</span>
<span class="sd">    - `I` : list of cadet indices</span>
<span class="sd">    - `cadet_preferences` : dict of lists; each list contains AFSC indices ranked by cadet</span>
<span class="sd">    - `c_utilities` : ndarray, shape (N, P); cadet-reported utilities aligned with their preferences</span>
<span class="sd">    - `num_util` : int; number of utility values reported per cadet</span>
<span class="sd">    - `last_afsc` (optional) : str; used to determine which utility processing function to apply</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    parameters : dict</span>
<span class="sd">    Updated parameter dictionary with:</span>

<span class="sd">    - `utility` : ndarray, shape (N, M+1)</span>
<span class="sd">        Utility matrix with cadet-reported values; last column represents unmatched utility</span>
<span class="sd">    - `cadet_utility` : ndarray</span>
<span class="sd">        Normalized utility matrix calculated from rankings or weighted formula</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If required fields (`cadet_preferences`, `c_utilities`) are missing from the parameter dictionary.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    parameters = update_cadet_utility_matrices(parameters)</span>
<span class="sd">    ```</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    - [`create_final_cadet_utility_matrix_from_new_formula`](../../../../afccp/reference/data/preferences/#data.preferences.create_final_cadet_utility_matrix_from_new_formula)</span>
<span class="sd">    - [`create_new_cadet_utility_matrix`](../../../../afccp/reference/data/preferences/#data.preferences.create_new_cadet_utility_matrix)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Shorthand</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">parameters</span>

    <span class="c1"># Simple error checking</span>
    <span class="n">required_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">,</span> <span class="s1">&#39;c_utilities&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">required_parameters</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error. Parameter &#39;&quot;</span> <span class="o">+</span> <span class="n">param</span> <span class="o">+</span> <span class="s2">&quot;&#39; not in instance parameters. It is required.&quot;</span><span class="p">)</span>

    <span class="c1"># Initialize matrix (reported cadet utility)</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;utility&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># Additional column for unmatched cadets</span>

    <span class="c1"># Loop through each cadet</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]:</span>

        <span class="c1"># If this cadet does not have any preferences, we skip them (must be an OTS candidate)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># List of ordered AFSC indices (by cadet preference) up to the number of utilities</span>
        <span class="n">afsc_indices</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;num_util&#39;</span><span class="p">]]</span>

        <span class="c1"># Fill in the reported utilities</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">afsc_indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_utilities&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">afsc_indices</span><span class="p">)]</span>

    <span class="c1"># Create the &quot;cadet_utility&quot; matrix by re-calculating utility based on ordinal rankings</span>
    <span class="k">if</span> <span class="s1">&#39;last_afsc&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">create_final_cadet_utility_matrix_from_new_formula</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">create_new_cadet_utility_matrix</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.preferences.modify_rated_cadet_lists_based_on_eligibility" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">modify_rated_cadet_lists_based_on_eligibility</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">printing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#data.preferences.modify_rated_cadet_lists_based_on_eligibility" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Remove Ineligible Rated Cadets from Rated Lists and Matrices.</p>
<p>This method ensures that cadets in each Source of Commissioning (SOC)'s rated list are only included if they have at least
one rated AFSC preference. Cadets without any rated preferences are removed from the rated cadet list for that SOC as well as
the corresponding rated order-of-merit matrix (e.g., 'rr_om_matrix' for ROTC).</p>
<h4 id="data.preferences.modify_rated_cadet_lists_based_on_eligibility--parameters">Parameters<a class="headerlink" href="#data.preferences.modify_rated_cadet_lists_based_on_eligibility--parameters" title="Permanent link">&para;</a></h4>
<p>parameters : dict
A dictionary of model parameters including:</p>
<ul>
<li><code>SOCs</code> : list of str
    List of Source of Commissioning identifiers (e.g., ['ROTC', 'USAFA', 'OTS'])</li>
<li><code>Rated Cadets</code> : dict
    Dictionary mapping SOC names to arrays of rated cadet indices</li>
<li><code>Rated Choices</code> : dict
    Dictionary mapping SOC names to dicts of cadet-rated-AFSC preferences</li>
<li><code>rr_om_matrix</code>, <code>ur_om_matrix</code>, etc. : ndarray
    Matrices used in rated order-of-merit calculations by SOC</li>
</ul>
<p>printing : bool, optional
    If True (default), prints a summary of the cadets removed and the matrices updated.</p>
<h4 id="data.preferences.modify_rated_cadet_lists_based_on_eligibility--returns">Returns<a class="headerlink" href="#data.preferences.modify_rated_cadet_lists_based_on_eligibility--returns" title="Permanent link">&para;</a></h4>
<p>dict
The updated parameter dictionary with:</p>
<ul>
<li>Rated cadet lists pruned of cadets lacking rated preferences</li>
<li>Rated order-of-merit matrices updated to exclude removed cadets</li>
</ul>
<h4 id="data.preferences.modify_rated_cadet_lists_based_on_eligibility--examples">Examples<a class="headerlink" href="#data.preferences.modify_rated_cadet_lists_based_on_eligibility--examples" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">parameters</span> <span class="o">=</span> <span class="n">modify_rated_cadet_lists_based_on_eligibility</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">printing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>afccp/data/preferences.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">modify_rated_cadet_lists_based_on_eligibility</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">printing</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove Ineligible Rated Cadets from Rated Lists and Matrices.</span>

<span class="sd">    This method ensures that cadets in each Source of Commissioning (SOC)&#39;s rated list are only included if they have at least</span>
<span class="sd">    one rated AFSC preference. Cadets without any rated preferences are removed from the rated cadet list for that SOC as well as</span>
<span class="sd">    the corresponding rated order-of-merit matrix (e.g., &#39;rr_om_matrix&#39; for ROTC).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameters : dict</span>
<span class="sd">    A dictionary of model parameters including:</span>

<span class="sd">    - `SOCs` : list of str</span>
<span class="sd">        List of Source of Commissioning identifiers (e.g., [&#39;ROTC&#39;, &#39;USAFA&#39;, &#39;OTS&#39;])</span>
<span class="sd">    - `Rated Cadets` : dict</span>
<span class="sd">        Dictionary mapping SOC names to arrays of rated cadet indices</span>
<span class="sd">    - `Rated Choices` : dict</span>
<span class="sd">        Dictionary mapping SOC names to dicts of cadet-rated-AFSC preferences</span>
<span class="sd">    - `rr_om_matrix`, `ur_om_matrix`, etc. : ndarray</span>
<span class="sd">        Matrices used in rated order-of-merit calculations by SOC</span>

<span class="sd">    printing : bool, optional</span>
<span class="sd">        If True (default), prints a summary of the cadets removed and the matrices updated.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">    The updated parameter dictionary with:</span>

<span class="sd">    - Rated cadet lists pruned of cadets lacking rated preferences</span>
<span class="sd">    - Rated order-of-merit matrices updated to exclude removed cadets</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    parameters = modify_rated_cadet_lists_based_on_eligibility(parameters, printing=True)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Shorthand</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">parameters</span>

    <span class="c1"># At least one rated preference for rated eligible</span>
    <span class="k">for</span> <span class="n">soc</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;SOCs&#39;</span><span class="p">]:</span>
        <span class="n">cadets_to_remove</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cadet_indices_in_matrix</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">soc</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Rated Cadets&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;Rated Cadets&#39;</span><span class="p">][</span><span class="n">soc</span><span class="p">]):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;Rated Choices&#39;</span><span class="p">][</span><span class="n">soc</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">cadets_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">cadet_indices_in_matrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

        <span class="c1"># Remove cadets from set of rated cadets for this SOC</span>
        <span class="n">cadets_to_remove</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cadets_to_remove</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Rated Cadets&#39;</span><span class="p">][</span><span class="n">soc</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Rated Cadets&#39;</span><span class="p">][</span><span class="n">soc</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;Rated Cadets&#39;</span><span class="p">][</span><span class="n">soc</span><span class="p">],</span> <span class="n">cadets_to_remove</span><span class="p">)]</span>

        <span class="c1"># Remove the cadet rows by position in the matrix</span>
        <span class="n">cadet_indices_in_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cadet_indices_in_matrix</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cadet_indices_in_matrix</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">parameter</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">soc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">r_om_matrix&#39;</span>
            <span class="n">p</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">parameter</span><span class="p">],</span> <span class="n">cadet_indices_in_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Print results</span>
            <span class="k">if</span> <span class="n">printing</span><span class="p">:</span>
                <span class="n">print_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;We removed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cadets_to_remove</span><span class="p">)</span><span class="si">}</span><span class="s2"> cadets from </span><span class="si">{</span><span class="n">soc</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39;s rated cadet list.</span><span class="se">\n</span><span class="s2">&quot;</span> \
                            <span class="sa">f</span><span class="s2">&quot;These were cadets </span><span class="si">{</span><span class="n">cadets_to_remove</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">We removed them from </span><span class="si">{</span><span class="n">parameter</span><span class="si">}</span><span class="s2"> as well.&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">print_str</span><span class="p">)</span>

    <span class="c1"># Return modified parameters</span>
    <span class="k">return</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.preferences.determine_soc_rated_afscs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">determine_soc_rated_afscs</span><span class="p">(</span><span class="n">soc</span><span class="p">,</span> <span class="n">all_rated_afscs</span><span class="p">)</span></code>

<a href="#data.preferences.determine_soc_rated_afscs" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Filter Rated AFSCs Based on Source of Commissioning (SOC).</p>
<p>This function selects only the AFSCs relevant to the given SOC (e.g., USAFA, ROTC, OTS)
by excluding AFSCs that are tagged for other SOCs using suffixes like <code>_U</code>, <code>_R</code>, or <code>_O</code>.</p>
<h4 id="data.preferences.determine_soc_rated_afscs--parameters">Parameters:<a class="headerlink" href="#data.preferences.determine_soc_rated_afscs--parameters" title="Permanent link">&para;</a></h4>
<p>soc (str): The name of the source of commissioning (e.g., "usafa", "rotc").
all_rated_afscs (List[str]): A list of all rated AFSC strings.</p>
<h4 id="data.preferences.determine_soc_rated_afscs--returns">Returns:<a class="headerlink" href="#data.preferences.determine_soc_rated_afscs--returns" title="Permanent link">&para;</a></h4>
<p>List[str]: Filtered list of AFSCs associated with the provided SOC.</p>
<h4 id="data.preferences.determine_soc_rated_afscs--example">Example:<a class="headerlink" href="#data.preferences.determine_soc_rated_afscs--example" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">determine_soc_rated_afscs</span><span class="p">(</span><span class="s2">&quot;usafa&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;11XX_U&quot;</span><span class="p">,</span> <span class="s2">&quot;11XX_R&quot;</span><span class="p">,</span> <span class="s2">&quot;11XX_O&quot;</span><span class="p">,</span> <span class="s2">&quot;12XX&quot;</span><span class="p">,</span> <span class="s2">&quot;13B&quot;</span><span class="p">,</span> <span class="s2">&quot;18X&quot;</span><span class="p">])</span>
<span class="c1"># Returns: [&quot;11XX_U&quot;, &quot;12XX&quot;, &quot;13B&quot;, &quot;18X&quot;]</span>
</code></pre></div>
<h4 id="data.preferences.determine_soc_rated_afscs--notes">Notes:<a class="headerlink" href="#data.preferences.determine_soc_rated_afscs--notes" title="Permanent link">&para;</a></h4>
<p>The filtering logic assumes that the AFSC string may contain a SOC-specific suffix.
- <code>_U</code> for USAFA
- <code>_R</code> for ROTC
- <code>_O</code> for OTS</p>

            <details class="quote">
              <summary>Source code in <code>afccp/data/preferences.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">determine_soc_rated_afscs</span><span class="p">(</span><span class="n">soc</span><span class="p">,</span> <span class="n">all_rated_afscs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filter Rated AFSCs Based on Source of Commissioning (SOC).</span>

<span class="sd">    This function selects only the AFSCs relevant to the given SOC (e.g., USAFA, ROTC, OTS)</span>
<span class="sd">    by excluding AFSCs that are tagged for other SOCs using suffixes like `_U`, `_R`, or `_O`.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    --------</span>
<span class="sd">    soc (str): The name of the source of commissioning (e.g., &quot;usafa&quot;, &quot;rotc&quot;).</span>
<span class="sd">    all_rated_afscs (List[str]): A list of all rated AFSC strings.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    List[str]: Filtered list of AFSCs associated with the provided SOC.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    determine_soc_rated_afscs(&quot;usafa&quot;, [&quot;11XX_U&quot;, &quot;11XX_R&quot;, &quot;11XX_O&quot;, &quot;12XX&quot;, &quot;13B&quot;, &quot;18X&quot;])</span>
<span class="sd">    # Returns: [&quot;11XX_U&quot;, &quot;12XX&quot;, &quot;13B&quot;, &quot;18X&quot;]</span>
<span class="sd">    ```</span>

<span class="sd">    Notes:</span>
<span class="sd">    --------</span>
<span class="sd">    The filtering logic assumes that the AFSC string may contain a SOC-specific suffix.</span>
<span class="sd">    - `_U` for USAFA</span>
<span class="sd">    - `_R` for ROTC</span>
<span class="sd">    - `_O` for OTS</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Rated AFSCs for this SOC</span>
    <span class="n">other_letters</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;_U&#39;</span><span class="p">,</span> <span class="s1">&#39;_R&#39;</span><span class="p">,</span> <span class="s1">&#39;_O&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">l</span> <span class="o">!=</span> <span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">soc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
    <span class="n">rated_afscs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="n">all_rated_afscs</span><span class="p">:</span>
        <span class="n">include</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">other_letters</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">afsc</span><span class="p">:</span>
                <span class="n">include</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">include</span><span class="p">:</span>
            <span class="n">rated_afscs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">afsc</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">rated_afscs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.preferences.create_new_cadet_utility_matrix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_new_cadet_utility_matrix</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span></code>

<a href="#data.preferences.create_new_cadet_utility_matrix" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create New Cadet Utility Matrix from Rankings and Original Utilities.</p>
<p>This function constructs a new "cadet_utility" matrix by blending each cadet's ordinal preferences
(normalized rankings) with their original reported utility scores. The result is a weighted composite
utility score for each cadet‚ÄìAFSC pair.</p>
<p>The final matrix is stored in <code>cadet_utility</code> and is used in the optimization models.</p>
<h4 id="data.preferences.create_new_cadet_utility_matrix--parameters">Parameters<a class="headerlink" href="#data.preferences.create_new_cadet_utility_matrix--parameters" title="Permanent link">&para;</a></h4>
<p>parameters : dict
Parameter dictionary containing:</p>
<ul>
<li><code>N</code> : int, number of cadets</li>
<li><code>M</code> : int, number of AFSCs</li>
<li><code>I</code> : list of cadet indices</li>
<li><code>utility</code> : ndarray, cadet-reported utility matrix</li>
<li><code>cadet_preferences</code> : dict, cadet-to-AFSC preference lists</li>
<li><code>num_cadet_choices</code> : dict, number of ranked AFSCs per cadet</li>
</ul>
<h4 id="data.preferences.create_new_cadet_utility_matrix--returns">Returns<a class="headerlink" href="#data.preferences.create_new_cadet_utility_matrix--returns" title="Permanent link">&para;</a></h4>
<p>dict :
Updated parameter dictionary with:</p>
<ul>
<li><code>cadet_utility</code> : ndarray, shape (N, M+1)
    Blended utility matrix using normalized rankings and reported utilities.
    Last column is reserved for unmatched cadets.</li>
</ul>
<h4 id="data.preferences.create_new_cadet_utility_matrix--examples">Examples<a class="headerlink" href="#data.preferences.create_new_cadet_utility_matrix--examples" title="Permanent link">&para;</a></h4>
<p><div class="highlight"><pre><span></span><code><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="s1">&#39;utility&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]),</span>
    <span class="s1">&#39;cadet_preferences&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]},</span>
    <span class="s1">&#39;num_cadet_choices&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="p">}</span>
<span class="n">updated</span> <span class="o">=</span> <span class="n">create_new_cadet_utility_matrix</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
<span class="n">updated</span><span class="p">[</span><span class="s1">&#39;cadet_utility&#39;</span><span class="p">]</span>
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code>array([[1.  , 0.8 , 0.6 , 0.  ],
       [1.  , 0.75, 0.  , 0.  ]])
</code></pre></div></p>
<h4 id="data.preferences.create_new_cadet_utility_matrix--see-also">See Also<a class="headerlink" href="#data.preferences.create_new_cadet_utility_matrix--see-also" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="../../../afccp/reference/data/preferences/#data.preferences.update_cadet_utility_matrices"><code>update_cadet_utility_matrices</code></a></li>
</ul>

            <details class="quote">
              <summary>Source code in <code>afccp/data/preferences.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_new_cadet_utility_matrix</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create New Cadet Utility Matrix from Rankings and Original Utilities.</span>

<span class="sd">    This function constructs a new &quot;cadet_utility&quot; matrix by blending each cadet&#39;s ordinal preferences</span>
<span class="sd">    (normalized rankings) with their original reported utility scores. The result is a weighted composite</span>
<span class="sd">    utility score for each cadet‚ÄìAFSC pair.</span>

<span class="sd">    The final matrix is stored in `cadet_utility` and is used in the optimization models.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameters : dict</span>
<span class="sd">    Parameter dictionary containing:</span>

<span class="sd">    - `N` : int, number of cadets</span>
<span class="sd">    - `M` : int, number of AFSCs</span>
<span class="sd">    - `I` : list of cadet indices</span>
<span class="sd">    - `utility` : ndarray, cadet-reported utility matrix</span>
<span class="sd">    - `cadet_preferences` : dict, cadet-to-AFSC preference lists</span>
<span class="sd">    - `num_cadet_choices` : dict, number of ranked AFSCs per cadet</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict :</span>
<span class="sd">    Updated parameter dictionary with:</span>

<span class="sd">    - `cadet_utility` : ndarray, shape (N, M+1)</span>
<span class="sd">        Blended utility matrix using normalized rankings and reported utilities.</span>
<span class="sd">        Last column is reserved for unmatched cadets.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    parameters = {</span>
<span class="sd">        &#39;N&#39;: 2,</span>
<span class="sd">        &#39;M&#39;: 3,</span>
<span class="sd">        &#39;I&#39;: [0, 1],</span>
<span class="sd">        &#39;utility&#39;: np.array([[1.0, 0.8, 0.6, 0.0], [0.5, 1.0, 0.0, 0.0]]),</span>
<span class="sd">        &#39;cadet_preferences&#39;: {0: [0, 1, 2], 1: [1, 0]},</span>
<span class="sd">        &#39;num_cadet_choices&#39;: {0: 3, 1: 2}</span>
<span class="sd">    }</span>
<span class="sd">    updated = create_new_cadet_utility_matrix(parameters)</span>
<span class="sd">    updated[&#39;cadet_utility&#39;]</span>
<span class="sd">    ```</span>
<span class="sd">    Output:</span>
<span class="sd">    ```</span>
<span class="sd">    array([[1.  , 0.8 , 0.6 , 0.  ],</span>
<span class="sd">           [1.  , 0.75, 0.  , 0.  ]])</span>
<span class="sd">    ```</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    - [`update_cadet_utility_matrices`](../../../afccp/reference/data/preferences/#data.preferences.update_cadet_utility_matrices)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Shorthand</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">parameters</span>

    <span class="c1"># Initialize matrix</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_utility&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># Additional column for unmatched cadets</span>

    <span class="c1"># Loop through each cadet</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]:</span>

        <span class="c1"># 1, 2, 3, 4, ..., N  (Pure rankings)</span>
        <span class="n">rankings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;num_cadet_choices&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># 1, 0.8, 0.6, 0.4, ..., 1 / N  (Scale rankings to range from 1 to 0)</span>
        <span class="n">normalized_rankings</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">rankings</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">rankings</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">rankings</span><span class="p">))</span>

        <span class="c1"># 1, 0.75, 0, 0, etc. (From utility matrix)</span>
        <span class="n">original_utilities</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span>

        <span class="c1"># &quot;New&quot; Utilities based on a weighted sum of normalized rankings and original utilities</span>
        <span class="n">new_utilities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">normalized_rankings</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">original_utilities</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

        <span class="c1"># Put these new utilities back into the utility matrix in the appropriate spots</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">new_utilities</span>

    <span class="c1"># Return parameters</span>
    <span class="k">return</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.preferences.create_final_cadet_utility_matrix_from_new_formula" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_final_cadet_utility_matrix_from_new_formula</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span></code>

<a href="#data.preferences.create_final_cadet_utility_matrix_from_new_formula" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create Final Cadet Utility Matrix Using Eligibility-Aware Scoring Formula.</p>
<p>This function constructs a final <code>cadet_utility</code> matrix by integrating ordinal rankings, cadet-reported utilities,
and least desired AFSC criteria. It uses a custom scoring formula that reflects cadet preferences, their
eligibility, and how the AFSC ranks among their choices.</p>
<p>The output matrix is used in the optimization models.</p>
<h4 id="data.preferences.create_final_cadet_utility_matrix_from_new_formula--parameters">Parameters<a class="headerlink" href="#data.preferences.create_final_cadet_utility_matrix_from_new_formula--parameters" title="Permanent link">&para;</a></h4>
<p>parameters : dict
A dictionary containing cadet‚ÄìAFSC preference and eligibility information:</p>
<ul>
<li><code>N</code> : int, number of cadets</li>
<li><code>M</code> : int, number of AFSCs</li>
<li><code>I</code> : list of cadet indices</li>
<li><code>cadet_preferences</code> : dict, AFSC preference list per cadet</li>
<li><code>utility</code> : ndarray, shape (N, M+1), cadet-reported utility values</li>
<li><code>J^Selected</code> : dict, selected AFSCs for each cadet</li>
<li><code>J^Bottom 2 Choices</code> : dict, bottom two AFSC preferences per cadet</li>
<li><code>J^Last Choice</code> : dict, last-choice AFSC for each cadet</li>
</ul>
<h4 id="data.preferences.create_final_cadet_utility_matrix_from_new_formula--returns">Returns<a class="headerlink" href="#data.preferences.create_final_cadet_utility_matrix_from_new_formula--returns" title="Permanent link">&para;</a></h4>
<p>parameters : dict
Updated parameter dictionary with:</p>
<ul>
<li><code>cadet_utility</code> : ndarray, shape (N, M+1)
    Weighted utility matrix accounting for ordinal preferences, eligibility, and cadet-reported utilities.</li>
</ul>
<h4 id="data.preferences.create_final_cadet_utility_matrix_from_new_formula--examples">Examples<a class="headerlink" href="#data.preferences.create_final_cadet_utility_matrix_from_new_formula--examples" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">p</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="s1">&#39;utility&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]),</span>
    <span class="s1">&#39;cadet_preferences&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]},</span>
    <span class="s1">&#39;J^Selected&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
    <span class="s1">&#39;J^Bottom 2 Choices&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
    <span class="s1">&#39;J^Last Choice&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="p">}</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">create_final_cadet_utility_matrix_from_new_formula</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_utility&#39;</span><span class="p">])</span>
</code></pre></div>
<h4 id="data.preferences.create_final_cadet_utility_matrix_from_new_formula--see-also">See Also<a class="headerlink" href="#data.preferences.create_final_cadet_utility_matrix_from_new_formula--see-also" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="../../../afccp/reference/data/preferences/#data.preferences.create_new_cadet_utility_matrix"><code>create_new_cadet_utility_matrix</code></a></li>
</ul>

            <details class="quote">
              <summary>Source code in <code>afccp/data/preferences.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_final_cadet_utility_matrix_from_new_formula</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create Final Cadet Utility Matrix Using Eligibility-Aware Scoring Formula.</span>

<span class="sd">    This function constructs a final `cadet_utility` matrix by integrating ordinal rankings, cadet-reported utilities,</span>
<span class="sd">    and least desired AFSC criteria. It uses a custom scoring formula that reflects cadet preferences, their</span>
<span class="sd">    eligibility, and how the AFSC ranks among their choices.</span>

<span class="sd">    The output matrix is used in the optimization models.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameters : dict</span>
<span class="sd">    A dictionary containing cadet‚ÄìAFSC preference and eligibility information:</span>

<span class="sd">    - `N` : int, number of cadets</span>
<span class="sd">    - `M` : int, number of AFSCs</span>
<span class="sd">    - `I` : list of cadet indices</span>
<span class="sd">    - `cadet_preferences` : dict, AFSC preference list per cadet</span>
<span class="sd">    - `utility` : ndarray, shape (N, M+1), cadet-reported utility values</span>
<span class="sd">    - `J^Selected` : dict, selected AFSCs for each cadet</span>
<span class="sd">    - `J^Bottom 2 Choices` : dict, bottom two AFSC preferences per cadet</span>
<span class="sd">    - `J^Last Choice` : dict, last-choice AFSC for each cadet</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    parameters : dict</span>
<span class="sd">    Updated parameter dictionary with:</span>

<span class="sd">    - `cadet_utility` : ndarray, shape (N, M+1)</span>
<span class="sd">        Weighted utility matrix accounting for ordinal preferences, eligibility, and cadet-reported utilities.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    p = {</span>
<span class="sd">        &#39;N&#39;: 2,</span>
<span class="sd">        &#39;M&#39;: 3,</span>
<span class="sd">        &#39;I&#39;: [0, 1],</span>
<span class="sd">        &#39;utility&#39;: np.array([[0.8, 1.0, 0.6, 0.0], [0.5, 0.0, 0.9, 0.0]]),</span>
<span class="sd">        &#39;cadet_preferences&#39;: {0: [0, 1, 2], 1: [2, 0]},</span>
<span class="sd">        &#39;J^Selected&#39;: {0: [0, 1], 1: [0, 2]},</span>
<span class="sd">        &#39;J^Bottom 2 Choices&#39;: {0: [1, 2], 1: [0, 2]},</span>
<span class="sd">        &#39;J^Last Choice&#39;: {0: 2, 1: 2}</span>
<span class="sd">    }</span>
<span class="sd">    p = create_final_cadet_utility_matrix_from_new_formula(p)</span>
<span class="sd">    print(p[&#39;cadet_utility&#39;])</span>
<span class="sd">    ```</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    - [`create_new_cadet_utility_matrix`](../../../afccp/reference/data/preferences/#data.preferences.create_new_cadet_utility_matrix)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Shorthand</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">parameters</span>

    <span class="c1"># Initialize matrix (0.1 for everyone by default as indifference)</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_utility&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.1</span>  <span class="c1"># Additional column for unmatched cadets</span>

    <span class="c1"># Loop through each cadet</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]:</span>

        <span class="c1"># AFSCs the cadet is eligible for and selected (ordered appropriately)</span>
        <span class="n">intersection</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Selected&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="n">intersection</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">intersection</span><span class="p">])</span>
        <span class="n">num_selected</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">intersection</span><span class="p">)</span>

        <span class="c1"># Skip this cadet if they don&#39;t have any eligible choices</span>
        <span class="k">if</span> <span class="n">num_selected</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># 1, 2, 3, 4, ..., N  (Pure rankings)</span>
        <span class="n">rankings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_selected</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># 1, 0.8, 0.6, 0.4, ..., 1 / N  (Scale rankings to range from 1 to 0)</span>
        <span class="n">normalized_rankings</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">rankings</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">rankings</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">rankings</span><span class="p">))</span>

        <span class="c1"># Create dictionary of normalized ordinal rankings</span>
        <span class="n">norm_ord_rankings_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">j</span><span class="p">:</span> <span class="n">normalized_rankings</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">intersection</span><span class="p">)}</span>

        <span class="c1"># Loop through all AFSCs that the cadet is eligible for</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>

            <span class="c1"># A: AFSC is NOT the LAST choice</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">!=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Last Choice&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span>

            <span class="c1"># B: AFSC is NOT in the bottom 3 choices</span>
            <span class="n">b</span> <span class="o">=</span> <span class="p">((</span><span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Bottom 2 Choices&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">j</span> <span class="o">!=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Last Choice&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">1</span>

            <span class="c1"># C: AFSC was selected as a preference</span>
            <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Selected&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span>

            <span class="c1"># D: AFSC was selected as a preference and has a utility assigned</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>

            <span class="c1"># X: Normalized ordinal ranking of the AFSC</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">norm_ord_rankings_dict</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">norm_ord_rankings_dict</span> <span class="k">else</span> <span class="mi">0</span>

            <span class="c1"># Y: Utility value the cadet assigned to the AFSC</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>

            <span class="c1"># Execute the formula and load it into the cadet utility matrix</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">a</span> <span class="o">+</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">b</span> <span class="o">+</span> <span class="mf">0.9</span><span class="o">*</span><span class="p">(</span><span class="mf">0.3</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.7</span><span class="o">*</span><span class="n">d</span><span class="o">*</span><span class="n">y</span><span class="p">)</span>

    <span class="c1"># Return parameters</span>
    <span class="k">return</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://gitlab.com/path-to-your-repo" target="_blank" rel="noopener" title="gitlab.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/input/tex/extensions/bm.js"></script>
      
    
  </body>
</html>