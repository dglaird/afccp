
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://dglaird.github.io/afccp/reference/data/generation/realistic/">
      
      
        <link rel="prev" href="../basic/">
      
      
        <link rel="next" href="../../../solutions/">
      
      
      <link rel="icon" href="../../../../images/logos/afccp_logo_favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Generation- 'Realistic' - Air Force Cadet Career Problem</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#data.generation.realistic" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Air Force Cadet Career Problem" class="md-header__button md-logo" aria-label="Air Force Cadet Career Problem" data-md-component="logo">
      
  <img src="../../../../images/logos/afccp_logo_and_text_light.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Air Force Cadet Career Problem
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Generation- 'Realistic'
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/dglaird/afccp/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  üè† Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../getting-started/getting-started/" class="md-tabs__link">
          
  
  
  üöÄ Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../user-guide/overview/" class="md-tabs__link">
          
  
  
  üìò User Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../developer-guide/" class="md-tabs__link">
        
  
  
    
  
  üß† Developer Guide

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../main/cadetcareerproblem_overview/" class="md-tabs__link">
          
  
  
  CadetCareerProblem

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
  üìä Data

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../solutions/" class="md-tabs__link">
          
  
  
  üìà Solutions

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../visualizations/" class="md-tabs__link">
          
  
  
  Visualizations

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../faq/" class="md-tabs__link">
        
  
  
    
  
  ‚ùì FAQs

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../help/" class="md-tabs__link">
        
  
  
    
  
  üÜò Help & Support

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Air Force Cadet Career Problem" class="md-nav__button md-logo" aria-label="Air Force Cadet Career Problem" data-md-component="logo">
      
  <img src="../../../../images/logos/afccp_logo_and_text_light.png" alt="logo">

    </a>
    Air Force Cadet Career Problem
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dglaird/afccp/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    üè† Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    üöÄ Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            üöÄ Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../getting-started/getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    üìÑ Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    üõ†Ô∏è Install Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            üõ†Ô∏è Install Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation Instructions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../getting-started/developer-checklist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developer Checklist
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    üìò User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            üìò User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user-guide/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user-guide/tutorial_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 1 (Introduction)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user-guide/tutorial_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 2 (Data Overview)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user-guide/tutorial_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 3 (Parameters)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user-guide/tutorial_4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 4 (Value Parameters)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user-guide/tutorial_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 5 (Data Methods)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user-guide/tutorial_6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 6 (Solutions Overview)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user-guide/tutorial_7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 7 (Algorithms)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user-guide/tutorial_8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 8 (Optimization)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user-guide/tutorial_9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 9 (Visualizations)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../developer-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    üß† Developer Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    CadetCareerProblem
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            CadetCareerProblem
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../main/cadetcareerproblem_overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../main/cadetcareerproblem_generated_data_corrections/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generated Data Corrections
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../main/cadetcareerproblem_main_data_corrections/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Main Data Corrections
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../main/cadetcareerproblem_other_adjustments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Other Adjustments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../main/cadetcareerproblem_value_parameter_specifications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Value Parameter Specifications
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../main/cadetcareerproblem_solution_generation_%26_algorithms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Solution Generation & Algorithms
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../main/cadetcareerproblem_optimization_models_%26_meta-heuristics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Optimization Models & Meta-Heuristics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../main/cadetcareerproblem_solution_handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Solution Handling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../main/cadetcareerproblem_export_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Export Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../main/cadetcareerproblem_data_visualizations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Visualizations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../main/cadetcareerproblem_results_visualizations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Results Visualizations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    üìä Data
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            üìä Data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../adjustments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Adjustments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../preferences/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Preferences
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Processing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../values/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Values
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Support
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generation- 'Basic'
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Generation- 'Realistic'
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Generation- 'Realistic'
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#data.generation.realistic--afccpdatagenerationrealistic" class="md-nav__link">
    <span class="md-ellipsis">
      afccp.data.generation.realistic
    </span>
  </a>
  
    <nav class="md-nav" aria-label="afccp.data.generation.realistic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data.generation.realistic--what-this-module-does" class="md-nav__link">
    <span class="md-ellipsis">
      What this module does
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data.generation.realistic--key-outputs-file-layout" class="md-nav__link">
    <span class="md-ellipsis">
      Key outputs &amp; file layout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data.generation.realistic--important-details-conventions" class="md-nav__link">
    <span class="md-ellipsis">
      Important details &amp; conventions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data.generation.realistic--minimal-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Minimal examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data.generation.realistic--dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Dependencies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data.generation.realistic--see-also" class="md-nav__link">
    <span class="md-ellipsis">
      See also
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.generation.realistic.train_ctgan" class="md-nav__link">
    <span class="md-ellipsis">
      train_ctgan
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.generation.realistic.generate_ctgan_instance" class="md-nav__link">
    <span class="md-ellipsis">
      generate_ctgan_instance
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.generation.realistic.augment_2026_data_with_ots" class="md-nav__link">
    <span class="md-ellipsis">
      augment_2026_data_with_ots
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.generation.realistic.generate_data_with_degree_preference_fixes" class="md-nav__link">
    <span class="md-ellipsis">
      generate_data_with_degree_preference_fixes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.generation.realistic.extract_afsc_cip_sampling_information" class="md-nav__link">
    <span class="md-ellipsis">
      extract_afsc_cip_sampling_information
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.generation.realistic.safe_round" class="md-nav__link">
    <span class="md-ellipsis">
      safe_round
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data.generation.realistic.sample_cadets_for_degree_conditions" class="md-nav__link">
    <span class="md-ellipsis">
      sample_cadets_for_degree_conditions
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    üìà Solutions
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            üìà Solutions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../solutions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../solutions/algorithms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Algorithms
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../solutions/handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Handling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../solutions/optimization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Optimization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../solutions/sensitivity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sensitivity
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Visualizations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Visualizations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualizations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualizations/bubbles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bubbles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualizations/charts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Charts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualizations/slides/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Slides
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ‚ùì FAQs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../help/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    üÜò Help & Support
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<div class="doc doc-object doc-module">



<h1 id="data.generation.realistic" class="doc doc-heading">
            <code>data.generation.realistic</code>


<a href="#data.generation.realistic" class="headerlink" title="Permanent link">&para;</a></h1>

    <div class="doc doc-contents first">

        <h2 id="data.generation.realistic--afccpdatagenerationrealistic"><code>afccp.data.generation.realistic</code><a class="headerlink" href="#data.generation.realistic--afccpdatagenerationrealistic" title="Permanent link">&para;</a></h2>
<p>Generates <strong>realistic</strong> AFCCP problem instances by learning from historical data and sampling
with a conditional tabular GAN (CTGAN). This module prepares training datasets from past
instances, trains/loads CTGAN models, samples synthetic cadets and AFSC utilities, and can
augment an existing instance (e.g., 2026) with <strong>OTS</strong> candidates. It also rebuilds the
derived AFCCP parameter structures needed by optimization models (preferences, utilities,
eligibility/qual matrices, quotas, and rated OM datasets).</p>
<h3 id="data.generation.realistic--what-this-module-does">What this module does<a class="headerlink" href="#data.generation.realistic--what-this-module-does" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>AFSC facts &amp; proportions (for policy generation)</strong></li>
<li>
<p><code>process_instances_into_afscs_data</code>: Builds an <code>afscs_data.csv</code> with AFSC list, accession groups,
    ‚Äúall-eligible‚Äù flags, USAFA/ROTC proportions, overall PGL proportions, and degree-tier strings.</p>
</li>
<li>
<p><strong>CTGAN training data assembly</strong></p>
</li>
<li>
<p><code>process_instances_into_ctgan_data</code>: Merges selected years (e.g., 2024/2025) into a single table of
    features (SOC, CIP1/2, Merit, least‚Äëdesired AFSCs) plus per‚ÄëAFSC cadet/AFSC utilities.</p>
</li>
<li>
<p>Handles 2024 column harmonization (e.g., <code>13S1S ‚Üí USSF_{R/U}</code>, <code>11U ‚Üí 18X</code>) and merges SOC‚Äësegmented
    AFSCs into generic columns via <code>fix_soc_afscs_to_generic</code>.</p>
</li>
<li>
<p><strong>Model training</strong></p>
</li>
<li>
<p><code>train_ctgan</code>: Detects metadata with SDV, enforces [0,1] constraints on Merit and all utility columns,
    trains the CTGAN, and saves to <code>&lt;support&gt;/CTGAN_*.pkl</code>.</p>
</li>
<li>
<p><strong>Sampling realistic instances</strong></p>
</li>
<li>
<p><code>generate_ctgan_instance</code>: Loads a trained CTGAN and samples <strong>N</strong> cadets; optionally conditions on
    pilot first‚Äëchoice composition (USAFA/ROTC) and sets degree qualification style (<code>degree_qual_type</code>).</p>
</li>
<li>
<p>Re‚Äëscales OM percentiles within SOC, builds cadet preference lists/matrices, AFSC utilities, and
    rated OM datasets (USAFA/ROTC) consistent with AFCCP expectations.</p>
</li>
<li>
<p><strong>OTS augmentation pipeline</strong></p>
</li>
<li>
<p><code>augment_2026_data_with_ots</code>: Adds a large OTS cohort to an existing instance (e.g., <code>2026_0</code>) by
    sampling with CTGAN and stitching the new cadets into all required CSVs (Cadets, Preferences, Utility,
    Selected, AFSCs Preferences, Rated OM, etc.).</p>
</li>
<li>
<p>Degree‚Äëscarce AFSCs are boosted with targeted sampling:
    <code>generate_data_with_degree_preference_fixes</code> ‚Üí <code>extract_afsc_cip_sampling_information</code> ‚Üí
    <code>sample_cadets_for_degree_conditions</code> (+ KDE‚Äëbased utility samplers).</p>
</li>
<li>
<p>Recomputes OM and AFSC rankings for OTS (<code>re_calculate_ots_om_and_afsc_rankings</code>), aligns volunteer flags
    and degrees (<code>align_ots_preferences_and_degrees_somewhat</code>), rebuilds qual matrices and utilities
    with eligibility rules (<code>construct_parameter_dictionary_and_augment_data</code>), and emits fully formed
    dataframes via <code>construct_full_afsc_preferences_data</code>, <code>construct_full_cadets_data</code>, and <code>compile_new_dataframes</code>.</p>
</li>
</ul>
<h3 id="data.generation.realistic--key-outputs-file-layout">Key outputs &amp; file layout<a class="headerlink" href="#data.generation.realistic--key-outputs-file-layout" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Writes training/derived data under <code>&lt;support&gt;/data/</code>:</p>
</li>
<li>
<p><code>afscs_data.csv</code> (AFSC facts/proportions)</p>
</li>
<li>
<p><code>ctgan_data.csv</code> (CTGAN training table)</p>
</li>
<li>
<p>Writes a trained model under <code>&lt;support&gt;/CTGAN_*.pkl</code>.</p>
</li>
<li>
<p>For instance augmentation, writes CSVs under <code>instances/&lt;export_name&gt;/4. Model Input/</code>.</p>
</li>
</ul>
<h3 id="data.generation.realistic--important-details-conventions">Important details &amp; conventions<a class="headerlink" href="#data.generation.realistic--important-details-conventions" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>SOC merging</strong>: <code>fix_soc_afscs_to_generic</code> consolidates <code>11XX_{R/U}</code> ‚Üí <code>11XX</code> and <code>USSF_{R/U}</code> ‚Üí <code>USSF</code>
  for training and downstream sampling while preserving least‚Äëdesired columns.</li>
<li><strong>Bounds</strong>: Merit and all utility columns are constrained to <code>[0,1]</code> during CTGAN training.</li>
<li><strong>OM re-scaling</strong>: Within‚ÄëSOC percentile normalization ensures comparable distributions for USAFA/ROTC.</li>
<li><strong>Eligibility coupling</strong>: AFSC utilities are zeroed for ineligible/ non‚Äëvolunteer cases; missing but
  eligible entries may be backfilled with OM (rated/USSF and NRL logic differs accordingly).</li>
<li><strong>Quotas</strong>: PGL and SOC quotas are sampled from empirical proportions stored in <code>afscs_data.csv</code>,
  then propagated to <code>quota_*</code> parameters.</li>
</ul>
<h3 id="data.generation.realistic--minimal-examples">Minimal examples<a class="headerlink" href="#data.generation.realistic--minimal-examples" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Train a model:
    &gt;&gt;&gt; process_instances_into_ctgan_data(['2024','2025'])
    &gt;&gt;&gt; train_ctgan(epochs=1000, name='CTGAN_Full')</p>
</li>
<li>
<p>Sample a synthetic instance:
    &gt;&gt;&gt; p = generate_ctgan_instance(N=1600, name='CTGAN_Full', pilot_condition=True, degree_qual_type='Consistent')</p>
</li>
<li>
<p>Augment 2026 with OTS:
    &gt;&gt;&gt; augment_2026_data_with_ots(N=3000, import_name='2026_0', export_name='2026O')</p>
</li>
</ul>
<h3 id="data.generation.realistic--dependencies">Dependencies<a class="headerlink" href="#data.generation.realistic--dependencies" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>SDV</strong> (<code>sdv</code>): <code>CTGANSynthesizer</code>, <code>SingleTableMetadata</code>, <code>Condition</code></li>
<li><strong>NumPy</strong>, <strong>Pandas</strong>, <strong>SciPy</strong> (<code>gaussian_kde</code>) for sampling and table ops</li>
<li>AFCCP submodules: <code>globals</code>, <code>data.adjustments</code>, <code>data.preferences</code>, <code>data.values</code>, <code>data.support</code></li>
</ul>
<h3 id="data.generation.realistic--see-also">See also<a class="headerlink" href="#data.generation.realistic--see-also" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="../../../../../afccp/reference/data/preferences/#data.preferences"><code>data.preferences</code></a></li>
<li><a href="../../../../../afccp/reference/data/adjustments/#data.adjustments"><code>data.adjustments</code></a></li>
<li><a href="../../../../../afccp/reference/data/values/#data.values"><code>data.values</code></a></li>
<li><a href="../../../../../afccp/reference/data/support/#data.support"><code>data.support</code></a></li>
</ul>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="data.generation.realistic.train_ctgan" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_ctgan</span><span class="p">(</span><span class="n">epochs</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">printing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;CTGAN_Full&#39;</span><span class="p">)</span></code>

<a href="#data.generation.realistic.train_ctgan" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Train CTGAN to produce realistic data based on the current "ctgan_data" file in the support sub-folder. This
function then saves the ".pkl" file back to the support sub-folder</p>

            <details class="quote">
              <summary>Source code in <code>afccp/data/generation/realistic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train_ctgan</span><span class="p">(</span><span class="n">epochs</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">printing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;CTGAN_Full&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Train CTGAN to produce realistic data based on the current &quot;ctgan_data&quot; file in the support sub-folder. This</span>
<span class="sd">    function then saves the &quot;.pkl&quot; file back to the support sub-folder</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Import data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">afccp</span><span class="o">.</span><span class="n">globals</span><span class="o">.</span><span class="n">import_csv_data</span><span class="p">(</span><span class="n">afccp</span><span class="o">.</span><span class="n">globals</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="s1">&#39;support&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;data/ctgan_data.csv&#39;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;YEAR&#39;</span><span class="p">]]]</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="n">SingleTableMetadata</span><span class="p">()</span>  <span class="c1"># SDV requires this now</span>
    <span class="n">metadata</span><span class="o">.</span><span class="n">detect_from_dataframe</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># get the metadata from dataframe</span>

    <span class="c1"># Create the synthesizer model</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">CTGANSynthesizer</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># List of constraints for CTGAN</span>
    <span class="n">constraints</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Get list of columns that must be between 0 and 1</span>
    <span class="n">zero_to_one_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Merit&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;_Cadet&quot;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">or</span> <span class="s2">&quot;_AFSC&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
            <span class="n">zero_to_one_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

    <span class="c1"># Create the &quot;zero to one&quot; constraints and add them to our list of constraints</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">zero_to_one_columns</span><span class="p">:</span>
        <span class="n">zero_to_one_constraint</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;constraint_class&quot;</span><span class="p">:</span> <span class="s2">&quot;ScalarRange&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;constraint_parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
                                      <span class="s1">&#39;column_name&#39;</span><span class="p">:</span> <span class="n">col</span><span class="p">,</span>
                                      <span class="s1">&#39;low_value&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                      <span class="s1">&#39;high_value&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                      <span class="s1">&#39;strict_boundaries&#39;</span><span class="p">:</span> <span class="kc">False</span>
                                  <span class="p">}}</span>
        <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zero_to_one_constraint</span><span class="p">)</span>

    <span class="c1"># Add the constraints to the model</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add_constraints</span><span class="p">(</span><span class="n">constraints</span><span class="p">)</span>

    <span class="c1"># Train the model</span>
    <span class="k">if</span> <span class="n">printing</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training the model...&quot;</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># Save the model</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">afccp</span><span class="o">.</span><span class="n">globals</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="s2">&quot;support&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.pkl&#39;</span>
    <span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">printing</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model saved to&quot;</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.generation.realistic.generate_ctgan_instance" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_ctgan_instance</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">1600</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;CTGAN_Full&#39;</span><span class="p">,</span> <span class="n">pilot_condition</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">degree_qual_type</span><span class="o">=</span><span class="s1">&#39;Consistent&#39;</span><span class="p">)</span></code>

<a href="#data.generation.realistic.generate_ctgan_instance" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>This procedure takes in the specified number of cadets and then generates a representative problem
instance using CTGAN that has been trained from a real class year of cadets</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>pilot_condition</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If we want to sample cadets according to pilot preferences (make this more representative)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>name</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the CTGAN model to import</p>
              </div>
            </td>
            <td>
                  <code>&#39;CTGAN_Full&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>N</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of cadets</p>
              </div>
            </td>
            <td>
                  <code>1600</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model fixed parameters</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>afccp/data/generation/realistic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_ctgan_instance</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">1600</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;CTGAN_Full&#39;</span><span class="p">,</span> <span class="n">pilot_condition</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">degree_qual_type</span><span class="o">=</span><span class="s1">&#39;Consistent&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This procedure takes in the specified number of cadets and then generates a representative problem</span>
<span class="sd">    instance using CTGAN that has been trained from a real class year of cadets</span>
<span class="sd">    :param pilot_condition: If we want to sample cadets according to pilot preferences</span>
<span class="sd">    (make this more representative)</span>
<span class="sd">    :param name: Name of the CTGAN model to import</span>
<span class="sd">    :param N: number of cadets</span>
<span class="sd">    :return: model fixed parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Load in the model</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">afccp</span><span class="o">.</span><span class="n">globals</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="s2">&quot;support&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.pkl&#39;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">CTGANSynthesizer</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

    <span class="c1"># Split up the number of ROTC/USAFA cadets</span>
    <span class="n">N_usafa</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">triangular</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span> <span class="o">*</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">N_rotc</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">N_usafa</span>

    <span class="c1"># Pilot is by far the #1 desired career field, let&#39;s make sure this is represented here</span>
    <span class="n">N_usafa_pilots</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">triangular</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.43</span><span class="p">)</span> <span class="o">*</span> <span class="n">N_usafa</span><span class="p">)</span>
    <span class="n">N_usafa_generic</span> <span class="o">=</span> <span class="n">N_usafa</span> <span class="o">-</span> <span class="n">N_usafa_pilots</span>
    <span class="n">N_rotc_pilots</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">triangular</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">)</span> <span class="o">*</span> <span class="n">N_rotc</span><span class="p">)</span>
    <span class="n">N_rotc_generic</span> <span class="o">=</span> <span class="n">N_rotc</span> <span class="o">-</span> <span class="n">N_rotc_pilots</span>

    <span class="c1"># Condition the data generated to produce the right composition of pilot first choice preferences</span>
    <span class="n">usafa_pilot_first_choice</span> <span class="o">=</span> <span class="n">Condition</span><span class="p">(</span><span class="n">num_rows</span> <span class="o">=</span> <span class="n">N_usafa_pilots</span><span class="p">,</span> <span class="n">column_values</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;SOC&#39;</span><span class="p">:</span> <span class="s1">&#39;USAFA&#39;</span><span class="p">,</span> <span class="s1">&#39;11XX_Cadet&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
    <span class="n">usafa_generic_cadets</span> <span class="o">=</span> <span class="n">Condition</span><span class="p">(</span><span class="n">num_rows</span><span class="o">=</span><span class="n">N_usafa_generic</span><span class="p">,</span> <span class="n">column_values</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;SOC&#39;</span><span class="p">:</span> <span class="s1">&#39;USAFA&#39;</span><span class="p">})</span>
    <span class="n">rotc_pilot_first_choice</span> <span class="o">=</span> <span class="n">Condition</span><span class="p">(</span><span class="n">num_rows</span><span class="o">=</span><span class="n">N_rotc_pilots</span><span class="p">,</span> <span class="n">column_values</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;SOC&#39;</span><span class="p">:</span> <span class="s1">&#39;ROTC&#39;</span><span class="p">,</span> <span class="s1">&#39;11XX_Cadet&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
    <span class="n">rotc_generic_cadets</span> <span class="o">=</span> <span class="n">Condition</span><span class="p">(</span><span class="n">num_rows</span><span class="o">=</span><span class="n">N_rotc_generic</span><span class="p">,</span> <span class="n">column_values</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;SOC&#39;</span><span class="p">:</span> <span class="s1">&#39;ROTC&#39;</span><span class="p">})</span>

    <span class="c1"># Sample data  (Sampling from conditions may take too long!)</span>
    <span class="k">if</span> <span class="n">pilot_condition</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample_from_conditions</span><span class="p">(</span><span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">usafa_pilot_first_choice</span><span class="p">,</span> <span class="n">usafa_generic_cadets</span><span class="p">,</span>
                                                        <span class="n">rotc_pilot_first_choice</span><span class="p">,</span> <span class="n">rotc_generic_cadets</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

    <span class="c1"># Load in AFSCs data</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">afccp</span><span class="o">.</span><span class="n">globals</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="s2">&quot;support&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;data/afscs_data.csv&#39;</span>
    <span class="n">afscs_data</span> <span class="o">=</span> <span class="n">afccp</span><span class="o">.</span><span class="n">globals</span><span class="o">.</span><span class="n">import_csv_data</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

    <span class="c1"># Get list of AFSCs</span>
    <span class="n">afscs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">afscs_data</span><span class="p">[</span><span class="s1">&#39;AFSC&#39;</span><span class="p">])</span>

    <span class="c1"># Initialize parameter dictionary</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;afscs&#39;</span><span class="p">:</span> <span class="n">afscs</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="n">N</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">afscs</span><span class="p">),</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">afscs</span><span class="p">),</span> <span class="s1">&#39;merit&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Merit&#39;</span><span class="p">]),</span>
         <span class="s1">&#39;cadets&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="s1">&#39;usafa&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;SOC&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;USAFA&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span><span class="p">,</span>
         <span class="s1">&#39;cip1&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CIP1&#39;</span><span class="p">]),</span> <span class="s1">&#39;cip2&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CIP2&#39;</span><span class="p">]),</span> <span class="s1">&#39;num_util&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>  <span class="c1"># 10 utilities taken</span>
         <span class="s1">&#39;rotc&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;SOC&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ROTC&#39;</span><span class="p">),</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="s1">&#39;J&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">afscs</span><span class="p">))}</span>

    <span class="c1"># Clean up degree columns (remove the leading &quot;c&quot; I put there if it&#39;s there)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cip1&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cip1&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cip1&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cip2&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cip2&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cip2&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>

    <span class="c1"># Create &quot;SOC&quot; variable</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;soc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;USAFA&#39;</span> <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;usafa&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;ROTC&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]])</span>

    <span class="c1"># Fix percentiles for USAFA and ROTC</span>
    <span class="n">re_scaled_om</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;merit&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">soc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;usafa&#39;</span><span class="p">,</span> <span class="s1">&#39;rotc&#39;</span><span class="p">]:</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">soc</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Indices of these SOC-specific cadets</span>
        <span class="n">percentiles</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;merit&#39;</span><span class="p">][</span><span class="n">indices</span><span class="p">]</span>  <span class="c1"># The percentiles of these cadets</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">percentiles</span><span class="p">)</span>  <span class="c1"># Number of cadets from this SOC</span>
        <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">percentiles</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Sort these percentiles (descending)</span>
        <span class="n">new_percentiles</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># New percentiles we want to replace these with</span>
        <span class="n">magic_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">sorted_indices</span><span class="p">)</span>  <span class="c1"># Indices that let us put the new percentiles in right place</span>
        <span class="n">new_percentiles</span> <span class="o">=</span> <span class="n">new_percentiles</span><span class="p">[</span><span class="n">magic_indices</span><span class="p">]</span>  <span class="c1"># Put the new percentiles back in the right place</span>
        <span class="n">np</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">re_scaled_om</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">new_percentiles</span><span class="p">)</span>  <span class="c1"># Put these new percentiles in combined SOC OM spot</span>

    <span class="c1"># Replace merit</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;merit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">re_scaled_om</span>

    <span class="c1"># Add AFSC features to parameters</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;acc_grp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">afscs_data</span><span class="p">[</span><span class="s1">&#39;Accessions Group&#39;</span><span class="p">])</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Deg Tiers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">afscs_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Deg Tier 1&#39;</span><span class="p">:</span> <span class="s1">&#39;Deg Tier 4&#39;</span><span class="p">])</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Deg Tiers&#39;</span><span class="p">][</span><span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;Deg Tiers&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># TODO</span>

    <span class="c1"># Determine AFSCs by Accessions Group</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_acc_grp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="s1">&#39;acc_grp&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">acc_grp</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Rated&#39;</span><span class="p">,</span> <span class="s1">&#39;USSF&#39;</span><span class="p">,</span> <span class="s1">&#39;NRL&#39;</span><span class="p">]:</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^&#39;</span> <span class="o">+</span> <span class="n">acc_grp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;acc_grp&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">acc_grp</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_acc_grp&#39;</span><span class="p">][</span><span class="n">acc_grp</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^&#39;</span> <span class="o">+</span> <span class="n">acc_grp</span><span class="p">]]</span>

    <span class="c1"># Useful data elements to help us generate PGL targets</span>
    <span class="n">usafa_prop</span><span class="p">,</span> <span class="n">rotc_prop</span><span class="p">,</span> <span class="n">pgl_prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">afscs_data</span><span class="p">[</span><span class="s1">&#39;USAFA Proportion&#39;</span><span class="p">]),</span> \
                                      <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">afscs_data</span><span class="p">[</span><span class="s1">&#39;ROTC Proportion&#39;</span><span class="p">]),</span> \
                                      <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">afscs_data</span><span class="p">[</span><span class="s1">&#39;PGL Proportion&#39;</span><span class="p">])</span>

    <span class="c1"># Total targets needed to distribute</span>
    <span class="n">total_targets</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">0.93</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">)))</span>

    <span class="c1"># PGL targets</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;pgl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;usafa_quota&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rotc_quota&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]:</span>

        <span class="c1"># Create the PGL target by sampling from the PGL proportion triangular distribution</span>
        <span class="n">p_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.8</span> <span class="o">*</span> <span class="n">pgl_prop</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="n">p_max</span> <span class="o">=</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="n">pgl_prop</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">triangular</span><span class="p">(</span><span class="n">p_min</span><span class="p">,</span> <span class="n">pgl_prop</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">p_max</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;pgl&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">prop</span> <span class="o">*</span> <span class="n">total_targets</span><span class="p">))</span>

        <span class="c1"># Get the ROTC proportion of this PGL target to allocate</span>
        <span class="k">if</span> <span class="n">rotc_prop</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">rotc_prop</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rotc_p_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.8</span> <span class="o">*</span> <span class="n">rotc_prop</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="n">rotc_p_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="n">rotc_prop</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">triangular</span><span class="p">(</span><span class="n">rotc_p_min</span><span class="p">,</span> <span class="n">rotc_prop</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">rotc_p_max</span><span class="p">)</span>

        <span class="c1"># Create the SOC-specific targets</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rotc_quota&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">prop</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;pgl&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;usafa_quota&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;pgl&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rotc_quota&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>

    <span class="c1"># Initialize the other pieces of information here</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;quota_e&#39;</span><span class="p">,</span> <span class="s1">&#39;quota_d&#39;</span><span class="p">,</span> <span class="s1">&#39;quota_min&#39;</span><span class="p">,</span> <span class="s1">&#39;quota_max&#39;</span><span class="p">]:</span>
        <span class="n">p</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;pgl&#39;</span><span class="p">]</span>

    <span class="c1"># Break up USSF and 11XX AFSC by SOC</span>
    <span class="k">for</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;USSF&#39;</span><span class="p">,</span> <span class="s1">&#39;11XX&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Cadet&#39;</span><span class="p">,</span> <span class="s1">&#39;AFSC&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">soc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;USAFA&#39;</span><span class="p">,</span> <span class="s1">&#39;ROTC&#39;</span><span class="p">]:</span>
                <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">afsc</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">soc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;SOC&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">soc</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">afsc</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">soc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;SOC&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">soc</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">afsc</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>

    <span class="n">c_pref_cols</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">afsc</span><span class="si">}</span><span class="s1">_Cadet&#39;</span> <span class="k">for</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="n">afscs</span><span class="p">]</span>
    <span class="n">util_original</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">c_pref_cols</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Initialize cadet preference information</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_utilities&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_preferences&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">6</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">])]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])])</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;utility&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]))</span>

    <span class="c1"># Loop through each cadet to tweak their preferences</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadets&#39;</span><span class="p">]:</span>

        <span class="c1"># Manually fix 62EXE preferencing from eligible cadets</span>
        <span class="n">ee_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">afscs</span> <span class="o">==</span> <span class="s1">&#39;62EXE&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;1410&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;CIP1&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;1447&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;CIP1&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.6</span><span class="p">:</span>
                <span class="n">util_original</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">ee_j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">util_original</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">ee_j</span><span class="p">],</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">))),</span>
                                                   <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Fix rated/USSF volunteer situation</span>
        <span class="k">for</span> <span class="n">acc_grp</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Rated&#39;</span><span class="p">,</span> <span class="s1">&#39;USSF&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">acc_grp</span><span class="si">}</span><span class="s1"> Vol&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">util_original</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;J^</span><span class="si">{</span><span class="n">acc_grp</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]])</span> <span class="o">&lt;</span> <span class="mf">0.6</span><span class="p">:</span>
                    <span class="n">util_original</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;J^</span><span class="si">{</span><span class="n">acc_grp</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">acc_grp</span><span class="si">}</span><span class="s1"> Vol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Not a volunteer</span>

                <span class="c1"># We have a higher preference for these kinds of AFSCs</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">util_original</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;J^</span><span class="si">{</span><span class="n">acc_grp</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]])</span> <span class="o">&gt;=</span> <span class="mf">0.6</span><span class="p">:</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">acc_grp</span><span class="si">}</span><span class="s1"> Vol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Make them a volunteer now</span>

        <span class="c1"># Was this the last choice AFSC? Remove from our lists</span>
        <span class="n">ordered_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">util_original</span><span class="p">[</span><span class="n">i</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">last_choice</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;Last Choice&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">last_choice</span> <span class="ow">in</span> <span class="n">afscs</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">afscs</span> <span class="o">==</span> <span class="n">last_choice</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ordered_list</span> <span class="o">=</span> <span class="n">ordered_list</span><span class="p">[</span><span class="n">ordered_list</span> <span class="o">!=</span> <span class="n">j</span><span class="p">]</span>

        <span class="c1"># Add the &quot;2nd least desired AFSC&quot; to list</span>
        <span class="n">second_last_choice</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;2nd-Last Choice&#39;</span><span class="p">]</span>
        <span class="n">bottom</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">second_last_choice</span> <span class="ow">in</span> <span class="n">afscs</span> <span class="ow">and</span> <span class="n">afsc</span> <span class="o">!=</span> <span class="n">last_choice</span><span class="p">:</span>  <span class="c1"># Check if valid and not in bottom choices</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">afscs</span> <span class="o">==</span> <span class="n">second_last_choice</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Get index of AFSC</span>
            <span class="n">ordered_list</span> <span class="o">=</span> <span class="n">ordered_list</span><span class="p">[</span><span class="n">ordered_list</span> <span class="o">!=</span> <span class="n">j</span><span class="p">]</span>  <span class="c1"># Remove index from preferences</span>
            <span class="n">bottom</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">second_last_choice</span><span class="p">)</span>  <span class="c1"># Add it to the list of bottom choices</span>

        <span class="c1"># If it&#39;s a valid AFSC that isn&#39;t already in the bottom choices</span>
        <span class="n">third_last_choice</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;3rd-Last Choice&#39;</span><span class="p">]</span>  <span class="c1"># Add the &quot;3rd least desired AFSC&quot; to list</span>
        <span class="k">if</span> <span class="n">third_last_choice</span> <span class="ow">in</span> <span class="n">afscs</span> <span class="ow">and</span> <span class="n">afsc</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">last_choice</span><span class="p">,</span> <span class="n">second_last_choice</span><span class="p">]:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">afscs</span> <span class="o">==</span> <span class="n">third_last_choice</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Get index of AFSC</span>
            <span class="n">ordered_list</span> <span class="o">=</span> <span class="n">ordered_list</span><span class="p">[</span>
                <span class="n">ordered_list</span> <span class="o">!=</span> <span class="n">j</span><span class="p">]</span>  <span class="c1"># Reordered_list = np.argsort(util_original[i])[::-1]move index from preferences</span>
            <span class="n">bottom</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">third_last_choice</span><span class="p">)</span>  <span class="c1"># Add it to the list of bottom choices</span>

        <span class="c1"># If we have an AFSC in the bottom choices, but NOT the LAST choice, move one to the last choice</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bottom</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">last_choice</span><span class="p">):</span>
            <span class="n">afsc</span> <span class="o">=</span> <span class="n">bottom</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;Last Choice&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">afsc</span>
        <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;Second Least Desired AFSCs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bottom</span><span class="p">)</span>  <span class="c1"># Put it in the dataframe</span>

        <span class="c1"># Save cadet preference information</span>
        <span class="n">num_pref</span> <span class="o">=</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.1</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">triangular</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">26</span><span class="p">))</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_utilities&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">util_original</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">ordered_list</span><span class="p">[:</span><span class="mi">10</span><span class="p">]]</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ordered_list</span><span class="p">[:</span><span class="n">num_pref</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="n">num_pref</span><span class="p">]</span> <span class="o">=</span> <span class="n">afscs</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="mi">10</span><span class="p">]]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_utilities&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

    <span class="c1"># Get qual matrix information</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Qual Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">degree_qual_type</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">afccp</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">adjustments</span><span class="o">.</span><span class="n">gather_degree_tier_qual_matrix</span><span class="p">(</span><span class="n">cadets_df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>

    <span class="c1"># Get the qual matrix to know what people are eligible for</span>
    <span class="n">ineligible</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">defchararray</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;qual&#39;</span><span class="p">],</span> <span class="s2">&quot;I&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>
    <span class="n">eligible</span> <span class="o">=</span> <span class="p">(</span><span class="n">ineligible</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>
    <span class="n">I_E</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">eligible</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]]</span>  <span class="c1"># set of cadets that are eligible for AFSC j</span>

    <span class="c1"># Modify AFSC utilities based on eligibility</span>
    <span class="n">a_pref_cols</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">afsc</span><span class="si">}</span><span class="s1">_AFSC&#39;</span> <span class="k">for</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="n">afscs</span><span class="p">]</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_utility&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">a_pref_cols</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">acc_grp</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Rated&#39;</span><span class="p">,</span> <span class="s1">&#39;USSF&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^&#39;</span> <span class="o">+</span> <span class="n">acc_grp</span><span class="p">]:</span>
            <span class="n">volunteer_col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Rated Vol&#39;</span><span class="p">])</span>
            <span class="n">volunteers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">volunteer_col</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">not_volunteers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">volunteer_col</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ranked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_utility&#39;</span><span class="p">][:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">unranked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_utility&#39;</span><span class="p">][:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Fill in utility values with OM for rated folks who don&#39;t have an AFSC score</span>
            <span class="n">volunteer_unranked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">volunteers</span><span class="p">,</span> <span class="n">unranked</span><span class="p">)</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_utility&#39;</span><span class="p">][</span><span class="n">volunteer_unranked</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;merit&#39;</span><span class="p">][</span><span class="n">volunteer_unranked</span><span class="p">]</span>

            <span class="c1"># If the cadet didn&#39;t actually volunteer, they should have utility of 0</span>
            <span class="n">non_volunteer_ranked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">not_volunteers</span><span class="p">,</span> <span class="n">ranked</span><span class="p">)</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_utility&#39;</span><span class="p">][</span><span class="n">non_volunteer_ranked</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Remove cadets from this AFSC&#39;s preferences if the cadet is not eligible</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^NRL&#39;</span><span class="p">]:</span>

        <span class="c1"># Get appropriate sets of cadets</span>
        <span class="n">eligible_cadets</span> <span class="o">=</span> <span class="n">I_E</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">ineligible_cadets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ineligible</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ranked_cadets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_utility&#39;</span><span class="p">][:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">unranked_cadets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_utility&#39;</span><span class="p">][:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Fill in utility values with OM for eligible folks who don&#39;t have an AFSC score</span>
        <span class="n">eligible_unranked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">eligible_cadets</span><span class="p">,</span> <span class="n">unranked_cadets</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_utility&#39;</span><span class="p">][</span><span class="n">eligible_unranked</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;merit&#39;</span><span class="p">][</span><span class="n">eligible_unranked</span><span class="p">]</span>

        <span class="c1"># If the cadet isn&#39;t actually eligible, they should have utility of 0</span>
        <span class="n">ineligible_ranked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">ineligible_cadets</span><span class="p">,</span> <span class="n">ranked_cadets</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_utility&#39;</span><span class="p">][</span><span class="n">ineligible_ranked</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Collect AFSC preference information</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;a_pref_matrix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]:</span>

        <span class="c1"># Sort the utilities to get the preference list</span>
        <span class="n">utilities</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;afsc_utility&quot;</span><span class="p">][:,</span> <span class="n">j</span><span class="p">]</span>
        <span class="n">ineligible_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">utilities</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">utilities</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">ineligible_indices</span><span class="p">)]</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">sorted_indices</span>

        <span class="c1"># Since &#39;afsc_preferences&#39; is an array of AFSC indices, we can do this</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;a_pref_matrix&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Needed information for rated OM matrices</span>
    <span class="n">dataset_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rotc&#39;</span><span class="p">:</span> <span class="s1">&#39;rr_om_matrix&#39;</span><span class="p">,</span> <span class="s1">&#39;usafa&#39;</span><span class="p">:</span> <span class="s1">&#39;ur_om_matrix&#39;</span><span class="p">}</span>
    <span class="n">cadets_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rotc&#39;</span><span class="p">:</span> <span class="s1">&#39;rr_om_cadets&#39;</span><span class="p">,</span> <span class="s1">&#39;usafa&#39;</span><span class="p">:</span> <span class="s1">&#39;ur_om_cadets&#39;</span><span class="p">}</span>
    <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Rated Cadets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Create rated OM matrices for each SOC</span>
    <span class="k">for</span> <span class="n">soc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;usafa&#39;</span><span class="p">,</span> <span class="s1">&#39;rotc&#39;</span><span class="p">]:</span>

        <span class="c1"># Rated AFSCs for this SOC</span>
        <span class="k">if</span> <span class="n">soc</span> <span class="o">==</span> <span class="s1">&#39;rotc&#39;</span><span class="p">:</span>
            <span class="n">rated_J_soc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;_U&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># usafa</span>
            <span class="n">rated_J_soc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;_R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]])</span>

        <span class="c1"># Cadets from this SOC</span>
        <span class="n">soc_cadets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">soc</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Determine which cadets are eligible for at least one rated AFSC</span>
        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Rated Cadets&quot;</span><span class="p">][</span><span class="n">soc</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">soc_cadets</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">rated_J_soc</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="n">cadets_dict</span><span class="p">[</span><span class="n">soc</span><span class="p">]]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Rated Cadets&quot;</span><span class="p">][</span><span class="n">soc</span><span class="p">]</span>

        <span class="c1"># Initialize OM dataset</span>
        <span class="n">p</span><span class="p">[</span><span class="n">dataset_dict</span><span class="p">[</span><span class="n">soc</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;Rated Cadets&quot;</span><span class="p">][</span><span class="n">soc</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">rated_J_soc</span><span class="p">)])</span>

        <span class="c1"># Create OM dataset</span>
        <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rated_J_soc</span><span class="p">):</span>

            <span class="c1"># Get the maximum rank someone had</span>
            <span class="n">max_rank</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;a_pref_matrix&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;Rated Cadets&quot;</span><span class="p">][</span><span class="n">soc</span><span class="p">],</span> <span class="n">j</span><span class="p">])</span>

            <span class="c1"># Loop through each cadet to convert rank to percentile</span>
            <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;Rated Cadets&quot;</span><span class="p">][</span><span class="n">soc</span><span class="p">]):</span>
                <span class="n">rank</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;a_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="n">dataset_dict</span><span class="p">[</span><span class="n">soc</span><span class="p">]][</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="n">dataset_dict</span><span class="p">[</span><span class="n">soc</span><span class="p">]][</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_rank</span> <span class="o">-</span> <span class="n">rank</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">max_rank</span>

    <span class="c1"># Return parameters</span>
    <span class="k">return</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.generation.realistic.augment_2026_data_with_ots" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">augment_2026_data_with_ots</span><span class="p">(</span><span class="n">N</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span> <span class="n">import_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;2026_0&#39;</span><span class="p">,</span> <span class="n">export_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;2026O&#39;</span><span class="p">)</span></code>

<a href="#data.generation.realistic.augment_2026_data_with_ots" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Augment a base instance with a synthetic OTS cohort and export a new, fully wired instance.</p>
<p>This pipeline loads the trained CTGAN model and historical CTGAN training table, samples <strong>N</strong>
realistic cadets (with extra emphasis on degree‚Äëscarce AFSCs), converts them to OTS,
re-computes OM and AFSC utilities under AFCCP rules (eligibility &amp; volunteer logic), and
stitches the new cohort into all downstream CSVs (Cadets, Preferences, Utilities, AFSC
Preferences, CASTLE input, etc.). The result is written to
<code>instances/{export_name}/4. Model Input/</code>.</p>
<h4 id="data.generation.realistic.augment_2026_data_with_ots--parameters">Parameters<a class="headerlink" href="#data.generation.realistic.augment_2026_data_with_ots--parameters" title="Permanent link">&para;</a></h4>
<p>N : int, optional
    Number of OTS cadets to generate (default 3000).
import_name : str, optional
    Name of the <em>source</em> instance to copy/extend (e.g., <code>'2026_0'</code>).
    Reads input CSVs from <code>instances/{import_name}/4. Model Input/</code>.
export_name : str, optional
    Name of the <em>destination</em> instance to create (e.g., <code>'2026O'</code>).
    Writes outputs to <code>instances/{export_name}/4. Model Input/</code>.</p>
<h4 id="data.generation.realistic.augment_2026_data_with_ots--workflow">Workflow<a class="headerlink" href="#data.generation.realistic.augment_2026_data_with_ots--workflow" title="Permanent link">&para;</a></h4>
<p>1) Load CTGAN training data (<code>&lt;support&gt;/data/ctgan_data.csv</code>) and AFSCs for the source instance.
2) Load CTGAN model (<code>&lt;support&gt;/CTGAN_Full.pkl</code>).
3) Targeted sampling for degree‚Äëscarce AFSCs via
   <code>generate_data_with_degree_preference_fixes</code> (with KDE utility bootstrapping), then
   sample the remainder from the CTGAN.
4) Force SOC to <code>OTS</code>, re‚Äëscale OM and blend AFSC utilities with OM / cadet utility using
   <code>re_calculate_ots_om_and_afsc_rankings</code>.
5) Align volunteers and degree fields for OTS with <code>align_ots_preferences_and_degrees_somewhat</code>
   (USSF turned off for OTS).
6) Build AFCCP parameter dict and eligibility‚Äëaware AFSC utilities with
   <code>construct_parameter_dictionary_and_augment_data</code> (zero for ineligible/non‚Äëvolunteer;
   OM backfill where appropriate).
7) Rebuild AFSC preference rankings and matrices with
   <code>construct_full_afsc_preferences_data</code>, and cadet‚Äëside preferences/utilities with
   <code>construct_full_cadets_data</code>.
8) Merge everything with existing source CSVs via <code>compile_new_dataframes</code> and export.</p>
<h4 id="data.generation.realistic.augment_2026_data_with_ots--files-read">Files Read<a class="headerlink" href="#data.generation.realistic.augment_2026_data_with_ots--files-read" title="Permanent link">&para;</a></h4>
<ul>
<li><code>&lt;support&gt;/data/ctgan_data.csv</code></li>
<li><code>&lt;support&gt;/CTGAN_Full.pkl</code></li>
<li><code>instances/{import_name}/4. Model Input/{import_name} AFSCs.csv</code></li>
<li><code>instances/{import_name}/4. Model Input/{import_name} AFSCs Preferences.csv</code></li>
<li><code>instances/{import_name}/4. Model Input/{import_name} Cadets.csv</code></li>
<li><code>instances/{import_name}/4. Model Input/{import_name} Castle Input.csv</code></li>
</ul>
<h4 id="data.generation.realistic.augment_2026_data_with_ots--files-written-to-instancesexport_name4-model-input">Files Written (to <code>instances/{export_name}/4. Model Input/</code>)<a class="headerlink" href="#data.generation.realistic.augment_2026_data_with_ots--files-written-to-instancesexport_name4-model-input" title="Permanent link">&para;</a></h4>
<ul>
<li><code>{export_name} Cadets.csv</code></li>
<li><code>{export_name} AFSCs Preferences.csv</code></li>
<li><code>{export_name} AFSCs.csv</code> (copied base AFSCs, unchanged schema)</li>
<li><code>{export_name} Raw Data.csv</code> (the assembled OTS sampling table)</li>
<li><code>{export_name} Castle Input.csv</code></li>
<li>Plus augmented matrices produced by <code>compile_new_dataframes</code>
  (e.g., Cadets Preferences, Cadets Utility, Cadets Selected, AFSCs Buckets, OTS Rated OM).</li>
</ul>
<h4 id="data.generation.realistic.augment_2026_data_with_ots--returns">Returns<a class="headerlink" href="#data.generation.realistic.augment_2026_data_with_ots--returns" title="Permanent link">&para;</a></h4>
<p>None
    Side‚Äëeffects only. Progress is printed to stdout; artifacts are saved to disk.</p>
<h4 id="data.generation.realistic.augment_2026_data_with_ots--notes">Notes<a class="headerlink" href="#data.generation.realistic.augment_2026_data_with_ots--notes" title="Permanent link">&para;</a></h4>
<ul>
<li>Assumes the CTGAN model is saved as <code>&lt;support&gt;/CTGAN_Full.pkl</code>.</li>
<li>Assumes the source instance (<code>import_name</code>) contains the standard AFCCP CSVs under
  <code>4. Model Input/</code> with 2026‚Äëstyle schemas.</li>
<li>OTS candidates are excluded from USSF by construction (<code>USSF Vol = False</code>, utilities set to 0).</li>
<li>Rated OM for OTS is derived from OM where needed, filtered by eligibility.</li>
</ul>
<h4 id="data.generation.realistic.augment_2026_data_with_ots--examples">Examples<a class="headerlink" href="#data.generation.realistic.augment_2026_data_with_ots--examples" title="Permanent link">&para;</a></h4>
<blockquote>
<blockquote>
<blockquote>
<p>augment_2026_data_with_ots(N=3000, import_name='2026_0', export_name='2026O')</p>
</blockquote>
</blockquote>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>afccp/data/generation/realistic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">augment_2026_data_with_ots</span><span class="p">(</span><span class="n">N</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span> <span class="n">import_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;2026_0&#39;</span><span class="p">,</span> <span class="n">export_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;2026O&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Augment a base instance with a synthetic OTS cohort and export a new, fully wired instance.</span>

<span class="sd">    This pipeline loads the trained CTGAN model and historical CTGAN training table, samples **N**</span>
<span class="sd">    realistic cadets (with extra emphasis on degree‚Äëscarce AFSCs), converts them to OTS,</span>
<span class="sd">    re-computes OM and AFSC utilities under AFCCP rules (eligibility &amp; volunteer logic), and</span>
<span class="sd">    stitches the new cohort into all downstream CSVs (Cadets, Preferences, Utilities, AFSC</span>
<span class="sd">    Preferences, CASTLE input, etc.). The result is written to</span>
<span class="sd">    `instances/{export_name}/4. Model Input/`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    N : int, optional</span>
<span class="sd">        Number of OTS cadets to generate (default 3000).</span>
<span class="sd">    import_name : str, optional</span>
<span class="sd">        Name of the *source* instance to copy/extend (e.g., `&#39;2026_0&#39;`).</span>
<span class="sd">        Reads input CSVs from `instances/{import_name}/4. Model Input/`.</span>
<span class="sd">    export_name : str, optional</span>
<span class="sd">        Name of the *destination* instance to create (e.g., `&#39;2026O&#39;`).</span>
<span class="sd">        Writes outputs to `instances/{export_name}/4. Model Input/`.</span>

<span class="sd">    Workflow</span>
<span class="sd">    --------</span>
<span class="sd">    1) Load CTGAN training data (`&lt;support&gt;/data/ctgan_data.csv`) and AFSCs for the source instance.</span>
<span class="sd">    2) Load CTGAN model (`&lt;support&gt;/CTGAN_Full.pkl`).</span>
<span class="sd">    3) Targeted sampling for degree‚Äëscarce AFSCs via</span>
<span class="sd">       `generate_data_with_degree_preference_fixes` (with KDE utility bootstrapping), then</span>
<span class="sd">       sample the remainder from the CTGAN.</span>
<span class="sd">    4) Force SOC to `OTS`, re‚Äëscale OM and blend AFSC utilities with OM / cadet utility using</span>
<span class="sd">       `re_calculate_ots_om_and_afsc_rankings`.</span>
<span class="sd">    5) Align volunteers and degree fields for OTS with `align_ots_preferences_and_degrees_somewhat`</span>
<span class="sd">       (USSF turned off for OTS).</span>
<span class="sd">    6) Build AFCCP parameter dict and eligibility‚Äëaware AFSC utilities with</span>
<span class="sd">       `construct_parameter_dictionary_and_augment_data` (zero for ineligible/non‚Äëvolunteer;</span>
<span class="sd">       OM backfill where appropriate).</span>
<span class="sd">    7) Rebuild AFSC preference rankings and matrices with</span>
<span class="sd">       `construct_full_afsc_preferences_data`, and cadet‚Äëside preferences/utilities with</span>
<span class="sd">       `construct_full_cadets_data`.</span>
<span class="sd">    8) Merge everything with existing source CSVs via `compile_new_dataframes` and export.</span>

<span class="sd">    Files Read</span>
<span class="sd">    ----------</span>
<span class="sd">    - `&lt;support&gt;/data/ctgan_data.csv`</span>
<span class="sd">    - `&lt;support&gt;/CTGAN_Full.pkl`</span>
<span class="sd">    - `instances/{import_name}/4. Model Input/{import_name} AFSCs.csv`</span>
<span class="sd">    - `instances/{import_name}/4. Model Input/{import_name} AFSCs Preferences.csv`</span>
<span class="sd">    - `instances/{import_name}/4. Model Input/{import_name} Cadets.csv`</span>
<span class="sd">    - `instances/{import_name}/4. Model Input/{import_name} Castle Input.csv`</span>

<span class="sd">    Files Written (to `instances/{export_name}/4. Model Input/`)</span>
<span class="sd">    ------------------------------------------------------------</span>
<span class="sd">    - `{export_name} Cadets.csv`</span>
<span class="sd">    - `{export_name} AFSCs Preferences.csv`</span>
<span class="sd">    - `{export_name} AFSCs.csv` (copied base AFSCs, unchanged schema)</span>
<span class="sd">    - `{export_name} Raw Data.csv` (the assembled OTS sampling table)</span>
<span class="sd">    - `{export_name} Castle Input.csv`</span>
<span class="sd">    - Plus augmented matrices produced by `compile_new_dataframes`</span>
<span class="sd">      (e.g., Cadets Preferences, Cadets Utility, Cadets Selected, AFSCs Buckets, OTS Rated OM).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        Side‚Äëeffects only. Progress is printed to stdout; artifacts are saved to disk.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Assumes the CTGAN model is saved as `&lt;support&gt;/CTGAN_Full.pkl`.</span>
<span class="sd">    - Assumes the source instance (`import_name`) contains the standard AFCCP CSVs under</span>
<span class="sd">      `4. Model Input/` with 2026‚Äëstyle schemas.</span>
<span class="sd">    - OTS candidates are excluded from USSF by construction (`USSF Vol = False`, utilities set to 0).</span>
<span class="sd">    - Rated OM for OTS is derived from OM where needed, filtered by eligibility.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; augment_2026_data_with_ots(N=3000, import_name=&#39;2026_0&#39;, export_name=&#39;2026O&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Load in original data</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading in data...&#39;</span><span class="p">)</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">afccp</span><span class="o">.</span><span class="n">globals</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="s2">&quot;support&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;data/ctgan_data.csv&#39;</span>
    <span class="n">full_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="n">cadet_cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">full_data</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;_Cadet&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">])</span>

    <span class="c1"># Import &#39;AFSCs&#39; data</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;instances/</span><span class="si">{</span><span class="n">import_name</span><span class="si">}</span><span class="s1">/4. Model Input/</span><span class="si">{</span><span class="n">import_name</span><span class="si">}</span><span class="s1"> AFSCs.csv&#39;</span>
    <span class="n">afscs_df</span> <span class="o">=</span> <span class="n">afccp</span><span class="o">.</span><span class="n">globals</span><span class="o">.</span><span class="n">import_csv_data</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="n">afscs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">col</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cadet_cols</span><span class="p">])</span>

    <span class="c1"># Load in the model</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading in model...&#39;</span><span class="p">)</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">afccp</span><span class="o">.</span><span class="n">globals</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="s2">&quot;support&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;CTGAN_Full.pkl&#39;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">CTGANSynthesizer</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

    <span class="c1"># Sample the data</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sampling data...&#39;</span><span class="p">)</span>
    <span class="n">data_degrees</span> <span class="o">=</span> <span class="n">generate_data_with_degree_preference_fixes</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">full_data</span><span class="p">,</span> <span class="n">afscs_df</span><span class="p">)</span>
    <span class="n">data_all_else</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_degrees</span><span class="p">))</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">data_degrees</span><span class="p">,</span> <span class="n">data_all_else</span><span class="p">),</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># These are all OTS candidates now!</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;SOC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;OTS&#39;</span>

    <span class="c1"># Determine AFSCs by accessions group</span>
    <span class="n">rated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cadet_cols</span> <span class="o">==</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">afsc</span><span class="si">}</span><span class="s1">_Cadet&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;11XX&#39;</span><span class="p">,</span> <span class="s1">&#39;12XX&#39;</span><span class="p">,</span> <span class="s1">&#39;13B&#39;</span><span class="p">,</span> <span class="s1">&#39;18X&#39;</span><span class="p">]])</span>
    <span class="n">afscs_acc_grp</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Rated&#39;</span><span class="p">:</span> <span class="n">rated</span><span class="p">,</span> <span class="s1">&#39;USSF&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])}</span>

    <span class="c1"># Re-calculate OM/AFSC Rankings for OTS</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Modifying data...&#39;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">re_calculate_ots_om_and_afsc_rankings</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># OTS isn&#39;t going to USSF</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;USSF Vol&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;USSF_Cadet&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;USSF_AFSC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">align_ots_preferences_and_degrees_somewhat</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">afscs_acc_grp</span><span class="p">)</span>

    <span class="c1"># Non-rated AFSC indices</span>
    <span class="n">nrl_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">afscs</span> <span class="o">==</span> <span class="n">afsc</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="n">afscs</span> <span class="k">if</span> <span class="n">afsc</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;USSF&#39;</span><span class="p">,</span> <span class="s1">&#39;11XX&#39;</span><span class="p">,</span> <span class="s1">&#39;12XX&#39;</span><span class="p">,</span> <span class="s1">&#39;13B&#39;</span><span class="p">,</span> <span class="s1">&#39;18X&#39;</span><span class="p">]])</span>

    <span class="c1"># Construct the parameter dictionary and adjust AFSC utilities</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">construct_parameter_dictionary_and_augment_data</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">afscs</span><span class="p">,</span> <span class="n">afscs_df</span><span class="p">,</span> <span class="n">afscs_acc_grp</span><span class="p">,</span> <span class="n">nrl_indices</span><span class="o">=</span><span class="n">nrl_indices</span><span class="p">)</span>

    <span class="c1"># Import AFSCs Preferences data</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;instances/</span><span class="si">{</span><span class="n">import_name</span><span class="si">}</span><span class="s1">/4. Model Input/</span><span class="si">{</span><span class="n">import_name</span><span class="si">}</span><span class="s1"> AFSCs Preferences.csv&#39;</span>
    <span class="n">a_pref_df</span> <span class="o">=</span> <span class="n">afccp</span><span class="o">.</span><span class="n">globals</span><span class="o">.</span><span class="n">import_csv_data</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

    <span class="c1"># Construct the full AFSC preference data</span>
    <span class="n">full_a_pref_df</span> <span class="o">=</span> <span class="n">construct_full_afsc_preferences_data</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">a_pref_df</span><span class="p">,</span> <span class="n">afscs</span><span class="p">,</span> <span class="n">nrl_indices</span><span class="p">)</span>

    <span class="c1"># Import &#39;Cadets&#39; dataframe</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;instances/</span><span class="si">{</span><span class="n">import_name</span><span class="si">}</span><span class="s1">/4. Model Input/</span><span class="si">{</span><span class="n">import_name</span><span class="si">}</span><span class="s1"> Cadets.csv&#39;</span>
    <span class="n">cadets_df</span> <span class="o">=</span> <span class="n">afccp</span><span class="o">.</span><span class="n">globals</span><span class="o">.</span><span class="n">import_csv_data</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

    <span class="c1"># Construct the cadets data</span>
    <span class="n">full_cadets_df</span> <span class="o">=</span> <span class="n">construct_full_cadets_data</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">cadets_df</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">afscs</span><span class="p">)</span>

    <span class="c1"># Import CASTLE data</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;instances/</span><span class="si">{</span><span class="n">import_name</span><span class="si">}</span><span class="s1">/4. Model Input/</span><span class="si">{</span><span class="n">import_name</span><span class="si">}</span><span class="s1"> Castle Input.csv&#39;</span>
    <span class="n">castle_df</span> <span class="o">=</span> <span class="n">afccp</span><span class="o">.</span><span class="n">globals</span><span class="o">.</span><span class="n">import_csv_data</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

    <span class="c1"># Dictionary of dataframes to export with new OTS 2026 instance</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Compiling current 2026 data...&#39;</span><span class="p">)</span>
    <span class="n">new_dfs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Cadets&#39;</span><span class="p">:</span> <span class="n">full_cadets_df</span><span class="p">,</span> <span class="s1">&#39;AFSCs Preferences&#39;</span><span class="p">:</span> <span class="n">full_a_pref_df</span><span class="p">,</span> <span class="s1">&#39;AFSCs&#39;</span><span class="p">:</span> <span class="n">afscs_df</span><span class="p">,</span> <span class="s1">&#39;Raw Data&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
               <span class="s1">&#39;Castle Input&#39;</span><span class="p">:</span> <span class="n">castle_df</span><span class="p">}</span>
    <span class="n">new_dfs</span> <span class="o">=</span> <span class="n">compile_new_dataframes</span><span class="p">(</span><span class="n">new_dfs</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cadets_df</span><span class="p">,</span> <span class="n">afscs</span><span class="p">,</span> <span class="n">rated</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">import_name</span><span class="p">)</span>

    <span class="c1"># Export new dataframes for new instance</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Export new data instance...&#39;</span><span class="p">)</span>
    <span class="n">folder_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;instances/</span><span class="si">{</span><span class="n">export_name</span><span class="si">}</span><span class="s1">/4. Model Input/&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">df_name</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">new_dfs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Data: &quot;</span><span class="si">{</span><span class="n">df_name</span><span class="si">}</span><span class="s1">&quot;, Shape: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_path</span><span class="si">}{</span><span class="n">export_name</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">df_name</span><span class="si">}</span><span class="s1">.csv&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.generation.realistic.generate_data_with_degree_preference_fixes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_data_with_degree_preference_fixes</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">full_data</span><span class="p">,</span> <span class="n">afscs_df</span><span class="p">)</span></code>

<a href="#data.generation.realistic.generate_data_with_degree_preference_fixes" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generate synthetic cadet data for rare AFSCs, preserving degree distribution
preferences and realistic cadet/AFSC utilities.</p>
<p>This function focuses on AFSCs that are difficult to fill ("rare" AFSCs),
generating synthetic cadets in a way that matches observed degree patterns
(CIP1) from historical data. It uses
<a href="../../../reference/data/generation/#data.generation.extract_afsc_cip_sampling_information"><code>extract_afsc_cip_sampling_information</code></a>
to determine sampling quotas and conditions, and
<a href="../../../reference/data/generation/#data.generation.sample_cadets_for_degree_conditions"><code>sample_cadets_for_degree_conditions</code></a>
to produce matching synthetic records. Cadet and AFSC utility values are
then resampled for realism.</p>
<h4 id="data.generation.realistic.generate_data_with_degree_preference_fixes--parameters">Parameters<a class="headerlink" href="#data.generation.realistic.generate_data_with_degree_preference_fixes--parameters" title="Permanent link">&para;</a></h4>
<p>model : object
    A generative model instance (e.g., CTGAN) implementing
    <code>sample_from_conditions(conditions)</code> to produce synthetic cadets.
full_data : pandas.DataFrame
    Full dataset containing historical cadet and AFSC information.
afscs_df : pandas.DataFrame
    DataFrame containing AFSC metadata, including 'OTS Target' values.</p>
<h4 id="data.generation.realistic.generate_data_with_degree_preference_fixes--returns">Returns<a class="headerlink" href="#data.generation.realistic.generate_data_with_degree_preference_fixes--returns" title="Permanent link">&para;</a></h4>
<p>pandas.DataFrame
    Synthetic dataset containing cadets for rare AFSCs with realistic
    degree distributions and utility values.</p>
<h4 id="data.generation.realistic.generate_data_with_degree_preference_fixes--notes">Notes<a class="headerlink" href="#data.generation.realistic.generate_data_with_degree_preference_fixes--notes" title="Permanent link">&para;</a></h4>
<ul>
<li>Rare AFSC eligibility is hardcoded as a list of AFSC strings in this
  function.</li>
<li>Degree sampling is biased toward more common CIPs by cubic weighting
  (proportions ‚àù frequency¬≥).</li>
<li>Cadet and AFSC utilities are drawn from kernel density estimators
  (KDEs) fitted on historical data.</li>
</ul>
<h4 id="data.generation.realistic.generate_data_with_degree_preference_fixes--see-also">See Also<a class="headerlink" href="#data.generation.realistic.generate_data_with_degree_preference_fixes--see-also" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="../../../afccp/reference/data/generation/#data.generation.extract_afsc_cip_sampling_information"><code>extract_afsc_cip_sampling_information</code></a></li>
<li><a href="../../../afccp/reference/data/generation/#data.generation.sample_cadets_for_degree_conditions"><code>sample_cadets_for_degree_conditions</code></a></li>
</ul>

            <details class="quote">
              <summary>Source code in <code>afccp/data/generation/realistic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_data_with_degree_preference_fixes</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">full_data</span><span class="p">,</span> <span class="n">afscs_df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate synthetic cadet data for rare AFSCs, preserving degree distribution</span>
<span class="sd">    preferences and realistic cadet/AFSC utilities.</span>

<span class="sd">    This function focuses on AFSCs that are difficult to fill (&quot;rare&quot; AFSCs),</span>
<span class="sd">    generating synthetic cadets in a way that matches observed degree patterns</span>
<span class="sd">    (CIP1) from historical data. It uses</span>
<span class="sd">    [`extract_afsc_cip_sampling_information`](../../../reference/data/generation/#data.generation.extract_afsc_cip_sampling_information)</span>
<span class="sd">    to determine sampling quotas and conditions, and</span>
<span class="sd">    [`sample_cadets_for_degree_conditions`](../../../reference/data/generation/#data.generation.sample_cadets_for_degree_conditions)</span>
<span class="sd">    to produce matching synthetic records. Cadet and AFSC utility values are</span>
<span class="sd">    then resampled for realism.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    model : object</span>
<span class="sd">        A generative model instance (e.g., CTGAN) implementing</span>
<span class="sd">        `sample_from_conditions(conditions)` to produce synthetic cadets.</span>
<span class="sd">    full_data : pandas.DataFrame</span>
<span class="sd">        Full dataset containing historical cadet and AFSC information.</span>
<span class="sd">    afscs_df : pandas.DataFrame</span>
<span class="sd">        DataFrame containing AFSC metadata, including &#39;OTS Target&#39; values.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        Synthetic dataset containing cadets for rare AFSCs with realistic</span>
<span class="sd">        degree distributions and utility values.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Rare AFSC eligibility is hardcoded as a list of AFSC strings in this</span>
<span class="sd">      function.</span>
<span class="sd">    - Degree sampling is biased toward more common CIPs by cubic weighting</span>
<span class="sd">      (proportions ‚àù frequency¬≥).</span>
<span class="sd">    - Cadet and AFSC utilities are drawn from kernel density estimators</span>
<span class="sd">      (KDEs) fitted on historical data.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    - [`extract_afsc_cip_sampling_information`](../../../afccp/reference/data/generation/#data.generation.extract_afsc_cip_sampling_information)</span>
<span class="sd">    - [`sample_cadets_for_degree_conditions`](../../../afccp/reference/data/generation/#data.generation.sample_cadets_for_degree_conditions)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Filter dataframe to rare AFSCs (degree-wise)</span>
    <span class="n">afscs_rare_eligible</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;13H&#39;</span><span class="p">,</span> <span class="s1">&#39;32EXA&#39;</span><span class="p">,</span> <span class="s1">&#39;32EXC&#39;</span><span class="p">,</span> <span class="s1">&#39;32EXE&#39;</span><span class="p">,</span> <span class="s1">&#39;32EXF&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;32EXJ&#39;</span><span class="p">,</span> <span class="s1">&#39;61C&#39;</span><span class="p">,</span> <span class="s1">&#39;61D&#39;</span><span class="p">,</span> <span class="s1">&#39;62EXC&#39;</span><span class="p">,</span> <span class="s1">&#39;62EXE&#39;</span><span class="p">,</span> <span class="s1">&#39;62EXH&#39;</span><span class="p">,</span> <span class="s1">&#39;62EXI&#39;</span><span class="p">]</span>
    <span class="n">afscs_rare_df</span> <span class="o">=</span> <span class="n">afscs_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;AFSC&#39;</span><span class="p">)[</span><span class="s1">&#39;OTS Target&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">afscs_rare_eligible</span><span class="p">]</span>

    <span class="c1"># Extract data generating parameters</span>
    <span class="n">total_gen</span><span class="p">,</span> <span class="n">afsc_cip_data</span><span class="p">,</span> <span class="n">afsc_cip_conditions</span><span class="p">,</span> <span class="n">afsc_util_samplers</span><span class="p">,</span> <span class="n">cadet_util_samplers</span> <span class="o">=</span> \
        <span class="n">extract_afsc_cip_sampling_information</span><span class="p">(</span><span class="n">full_data</span><span class="p">,</span> <span class="n">afscs_rare_eligible</span><span class="p">,</span> <span class="n">afscs_rare_df</span><span class="p">)</span>

    <span class="c1"># Generate the data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">sample_cadets_for_degree_conditions</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">total_gen</span><span class="p">,</span> <span class="n">afscs_rare_eligible</span><span class="p">,</span> <span class="n">afsc_cip_data</span><span class="p">,</span>
                                               <span class="n">afsc_cip_conditions</span><span class="p">)</span>

    <span class="c1"># Modify the utilities for the cadet/AFSC pairs</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="n">afscs_rare_eligible</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">cip</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">afsc_cip_data</span><span class="p">[</span><span class="n">afsc</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">afsc</span><span class="si">}</span><span class="s1">_Cadet&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cadet_util_samplers</span><span class="p">[</span><span class="n">afsc</span><span class="p">](</span><span class="n">count</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">afsc</span><span class="si">}</span><span class="s1">_AFSC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">afsc_util_samplers</span><span class="p">[</span><span class="n">afsc</span><span class="p">](</span><span class="n">count</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="n">count</span>

    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.generation.realistic.extract_afsc_cip_sampling_information" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_afsc_cip_sampling_information</span><span class="p">(</span><span class="n">full_data</span><span class="p">,</span> <span class="n">afscs_rare_eligible</span><span class="p">,</span> <span class="n">afscs_rare_df</span><span class="p">)</span></code>

<a href="#data.generation.realistic.extract_afsc_cip_sampling_information" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Extract degree distribution and utility sampling information for rare AFSCs.</p>
<p>This function identifies cadets who have strong mutual preference with specific
rare AFSCs (both the AFSC ranks the cadet highly and the cadet ranks the AFSC
highly), determines the distribution of primary degrees (CIP1) for those cadets,
and constructs constraints to ensure proportional representation in generated
synthetic data. It also fits kernel density estimators (KDEs) to model cadet and
AFSC utility scores for each AFSC-degree combination.</p>
<h4 id="data.generation.realistic.extract_afsc_cip_sampling_information--parameters">Parameters<a class="headerlink" href="#data.generation.realistic.extract_afsc_cip_sampling_information--parameters" title="Permanent link">&para;</a></h4>
<p>full_data : pandas.DataFrame
    Full dataset containing cadet records with columns for degree codes (<code>CIP1</code>),
    AFSC utilities (<code>&lt;AFSC&gt;_AFSC</code>), and cadet preferences (<code>&lt;AFSC&gt;_Cadet</code>).
afscs_rare_eligible : list of str
    List of AFSC codes considered rare and eligible for targeted sampling.
afscs_rare_df : pandas.DataFrame or pandas.Series
    Data structure mapping each AFSC to the number of cadets needed to meet
    quotas for that AFSC.</p>
<h4 id="data.generation.realistic.extract_afsc_cip_sampling_information--returns">Returns<a class="headerlink" href="#data.generation.realistic.extract_afsc_cip_sampling_information--returns" title="Permanent link">&para;</a></h4>
<p>total_gen : int
    Total number of synthetic cadets to generate across all rare AFSCs.
afsc_cip_data : dict
    Mapping of <code>{afsc: pandas.Series}</code> where the Series index is degree codes
    (CIP1) and values are the number of cadets to generate for each degree.
afsc_cip_conditions : dict
    Mapping <code>{afsc: {cip: Condition}}</code> specifying generation constraints for each
    AFSC-degree combination.
afsc_util_samplers : dict
    Mapping <code>{afsc: callable}</code> returning AFSC utility samples for a given AFSC.
cadet_util_samplers : dict
    Mapping <code>{afsc: callable}</code> returning cadet utility samples for a given AFSC.</p>
<h4 id="data.generation.realistic.extract_afsc_cip_sampling_information--notes">Notes<a class="headerlink" href="#data.generation.realistic.extract_afsc_cip_sampling_information--notes" title="Permanent link">&para;</a></h4>
<ul>
<li>Only cadets with mutual interest scores &gt; 0.6 for a given AFSC are considered.</li>
<li>Degree frequencies are cubed to overweight common degrees, then scaled to match
  target generation counts using <a href="../../../reference/data/processing/#data.processing.safe_round"><code>safe_round</code></a>.</li>
<li>For AFSC <code>62EXE</code>, target counts are halved due to quota filling difficulty.</li>
<li>Generation quotas are inflated by 40% or at least 3 extra cadets to ensure
  adequate representation.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>afccp/data/generation/realistic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_afsc_cip_sampling_information</span><span class="p">(</span><span class="n">full_data</span><span class="p">,</span> <span class="n">afscs_rare_eligible</span><span class="p">,</span> <span class="n">afscs_rare_df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract degree distribution and utility sampling information for rare AFSCs.</span>

<span class="sd">    This function identifies cadets who have strong mutual preference with specific</span>
<span class="sd">    rare AFSCs (both the AFSC ranks the cadet highly and the cadet ranks the AFSC</span>
<span class="sd">    highly), determines the distribution of primary degrees (CIP1) for those cadets,</span>
<span class="sd">    and constructs constraints to ensure proportional representation in generated</span>
<span class="sd">    synthetic data. It also fits kernel density estimators (KDEs) to model cadet and</span>
<span class="sd">    AFSC utility scores for each AFSC-degree combination.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    full_data : pandas.DataFrame</span>
<span class="sd">        Full dataset containing cadet records with columns for degree codes (`CIP1`),</span>
<span class="sd">        AFSC utilities (`&lt;AFSC&gt;_AFSC`), and cadet preferences (`&lt;AFSC&gt;_Cadet`).</span>
<span class="sd">    afscs_rare_eligible : list of str</span>
<span class="sd">        List of AFSC codes considered rare and eligible for targeted sampling.</span>
<span class="sd">    afscs_rare_df : pandas.DataFrame or pandas.Series</span>
<span class="sd">        Data structure mapping each AFSC to the number of cadets needed to meet</span>
<span class="sd">        quotas for that AFSC.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    total_gen : int</span>
<span class="sd">        Total number of synthetic cadets to generate across all rare AFSCs.</span>
<span class="sd">    afsc_cip_data : dict</span>
<span class="sd">        Mapping of `{afsc: pandas.Series}` where the Series index is degree codes</span>
<span class="sd">        (CIP1) and values are the number of cadets to generate for each degree.</span>
<span class="sd">    afsc_cip_conditions : dict</span>
<span class="sd">        Mapping `{afsc: {cip: Condition}}` specifying generation constraints for each</span>
<span class="sd">        AFSC-degree combination.</span>
<span class="sd">    afsc_util_samplers : dict</span>
<span class="sd">        Mapping `{afsc: callable}` returning AFSC utility samples for a given AFSC.</span>
<span class="sd">    cadet_util_samplers : dict</span>
<span class="sd">        Mapping `{afsc: callable}` returning cadet utility samples for a given AFSC.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Only cadets with mutual interest scores &gt; 0.6 for a given AFSC are considered.</span>
<span class="sd">    - Degree frequencies are cubed to overweight common degrees, then scaled to match</span>
<span class="sd">      target generation counts using [`safe_round`](../../../reference/data/processing/#data.processing.safe_round).</span>
<span class="sd">    - For AFSC `62EXE`, target counts are halved due to quota filling difficulty.</span>
<span class="sd">    - Generation quotas are inflated by 40% or at least 3 extra cadets to ensure</span>
<span class="sd">      adequate representation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">afsc_cip_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">afsc_util_samplers</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">cadet_util_samplers</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">afsc_cip_conditions</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">total_gen</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="n">afscs_rare_eligible</span><span class="p">:</span>

        <span class="c1"># Filter the real data on people who wanted this AFSC, and the AFSC wanted them</span>
        <span class="n">conditions</span> <span class="o">=</span> <span class="p">(</span><span class="n">full_data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">afsc</span><span class="si">}</span><span class="s1">_AFSC&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">full_data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">afsc</span><span class="si">}</span><span class="s1">_Cadet&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.6</span><span class="p">)</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;YEAR&#39;</span><span class="p">,</span> <span class="s1">&#39;CIP1&#39;</span><span class="p">,</span> <span class="s1">&#39;CIP2&#39;</span><span class="p">,</span> <span class="s1">&#39;Merit&#39;</span><span class="p">,</span> <span class="s1">&#39;SOC&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">afsc</span><span class="si">}</span><span class="s1">_Cadet&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">afsc</span><span class="si">}</span><span class="s1">_AFSC&#39;</span><span class="p">]</span>

        <span class="c1"># Get the degrees of these people</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">full_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">conditions</span><span class="p">][</span><span class="n">columns</span><span class="p">][</span><span class="s1">&#39;CIP1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
        <span class="n">degrees</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># Figure out how many degrees we have to ensure are present in this newly created dataset</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">afscs_rare_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">afsc</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">afsc</span> <span class="o">==</span> <span class="s1">&#39;62EXE&#39;</span><span class="p">:</span>  <span class="c1"># We struggle to fill this quota!!</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">val</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">num_gen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">val</span> <span class="o">*</span> <span class="mf">1.4</span><span class="p">,</span> <span class="n">val</span> <span class="o">+</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">proportions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># Tip the scales in favor of the more common CIP</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">safe_round</span><span class="p">(</span><span class="n">proportions</span> <span class="o">*</span> <span class="n">num_gen</span><span class="p">)</span>
        <span class="n">afsc_cip_data</span><span class="p">[</span><span class="n">afsc</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">degrees</span><span class="p">)</span>  <span class="c1"># Save the degree information for this AFSC</span>
        <span class="n">afsc_cip_data</span><span class="p">[</span><span class="n">afsc</span><span class="p">]</span> <span class="o">=</span> <span class="n">afsc_cip_data</span><span class="p">[</span><span class="n">afsc</span><span class="p">][</span><span class="n">afsc_cip_data</span><span class="p">[</span><span class="n">afsc</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Save functions to sample cadet/AFSC utilities for the ones with these degrees</span>
        <span class="n">afsc_util_samplers</span><span class="p">[</span><span class="n">afsc</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit_kde_sampler</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">full_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">conditions</span><span class="p">][</span><span class="n">columns</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">afsc</span><span class="si">}</span><span class="s1">_AFSC&#39;</span><span class="p">]))</span>
        <span class="n">cadet_util_samplers</span><span class="p">[</span><span class="n">afsc</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit_kde_sampler</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">full_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">conditions</span><span class="p">][</span><span class="n">columns</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">afsc</span><span class="si">}</span><span class="s1">_Cadet&#39;</span><span class="p">]))</span>

        <span class="n">afsc_cip_conditions</span><span class="p">[</span><span class="n">afsc</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">cip</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">afsc_cip_data</span><span class="p">[</span><span class="n">afsc</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">condition</span> <span class="o">=</span> <span class="n">Condition</span><span class="p">(</span><span class="n">num_rows</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">count</span><span class="p">),</span> <span class="n">column_values</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;CIP1&quot;</span><span class="p">:</span> <span class="n">cip</span><span class="p">})</span>
            <span class="n">afsc_cip_conditions</span><span class="p">[</span><span class="n">afsc</span><span class="p">][</span><span class="n">cip</span><span class="p">]</span> <span class="o">=</span> <span class="n">condition</span>
            <span class="n">total_gen</span> <span class="o">+=</span> <span class="n">count</span>

    <span class="k">return</span> <span class="n">total_gen</span><span class="p">,</span> <span class="n">afsc_cip_data</span><span class="p">,</span> <span class="n">afsc_cip_conditions</span><span class="p">,</span> <span class="n">afsc_util_samplers</span><span class="p">,</span> <span class="n">cadet_util_samplers</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.generation.realistic.safe_round" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">safe_round</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">decimals</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span></code>

<a href="#data.generation.realistic.safe_round" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Round values while preserving the sum along a given axis.</p>
<p>This function rounds <code>data</code> to <code>decimals</code> decimal places but adjusts a minimal
subset of elements so that the rounded values sum to the same (rounded) total
as the original, slice‚Äëby‚Äëslice along <code>axis</code>. It does this by distributing the
leftover rounding ‚Äúunits‚Äù to the entries whose fractional parts are most
favorable (largest magnitude residuals with the correct sign), using a stable
tie‚Äëbreak so results are deterministic.</p>
<h4 id="data.generation.realistic.safe_round--parameters">Parameters<a class="headerlink" href="#data.generation.realistic.safe_round--parameters" title="Permanent link">&para;</a></h4>
<p>data : numpy.ndarray
    Input array to round. Must be numeric. (Other array‚Äëlikes are coerced;
    behavior is only guaranteed for NumPy arrays.)
decimals : int, optional
    Number of decimal places to keep (default 0).
axis : int, optional
    Axis along which to preserve the slice sums (default -1). Each 1D slice
    along this axis will have its rounded sum equal to the original sum
    rounded to <code>decimals</code>.</p>
<h4 id="data.generation.realistic.safe_round--returns">Returns<a class="headerlink" href="#data.generation.realistic.safe_round--returns" title="Permanent link">&para;</a></h4>
<p>numpy.ndarray or same type as <code>data</code> when feasible
    Rounded array with the same shape as <code>data</code>. If <code>data</code> is a NumPy array,
    a NumPy array is returned. For some other types, the function attempts to
    reconstruct the input type after rounding.</p>
<h4 id="data.generation.realistic.safe_round--notes">Notes<a class="headerlink" href="#data.generation.realistic.safe_round--notes" title="Permanent link">&para;</a></h4>
<ul>
<li>Let <code>S = sum(data, axis)</code> and <code>S_r = round(S, decimals)</code>. The output <code>y</code>
  satisfies <code>sum(y, axis) == S_r</code> exactly (up to floating‚Äëpoint representation).</li>
<li>Within each slice, the adjustment is minimal in the sense that only the
  elements with the largest compatible residuals are modified by ¬± one unit
  in the scaled space (10**decimals).</li>
<li>Time complexity is <code>O(n log n)</code> per slice due to sorting; memory usage is
  linear in the slice size.</li>
<li>This procedure does not enforce monotonicity or ordering of values.</li>
</ul>
<h4 id="data.generation.realistic.safe_round--examples">Examples<a class="headerlink" href="#data.generation.realistic.safe_round--examples" title="Permanent link">&para;</a></h4>
<blockquote>
<blockquote>
<blockquote>
<p>import numpy as np
x = np.array([0.24, 0.24, 0.24, 0.24, 0.04])
x.sum(), round(x.sum(), 2)
(1.0, 1.0)
y = safe_round(x, decimals=1, axis=0)
y
array([0.2, 0.2, 0.2, 0.2, 0.2])
y.sum()
1.0</p>
<p>X = np.array([[0.333, 0.333, 0.334],
...               [0.125, 0.125, 0.750]])
Y = safe_round(X, decimals=2, axis=1)
Y
array([[0.33, 0.33, 0.34],
       [0.12, 0.13, 0.75]])
Y.sum(axis=1)
array([1.  , 1.  ])</p>
</blockquote>
</blockquote>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>afccp/data/generation/realistic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">safe_round</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">decimals</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Round values while preserving the sum along a given axis.</span>

<span class="sd">    This function rounds `data` to `decimals` decimal places but adjusts a minimal</span>
<span class="sd">    subset of elements so that the rounded values sum to the same (rounded) total</span>
<span class="sd">    as the original, slice‚Äëby‚Äëslice along `axis`. It does this by distributing the</span>
<span class="sd">    leftover rounding ‚Äúunits‚Äù to the entries whose fractional parts are most</span>
<span class="sd">    favorable (largest magnitude residuals with the correct sign), using a stable</span>
<span class="sd">    tie‚Äëbreak so results are deterministic.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : numpy.ndarray</span>
<span class="sd">        Input array to round. Must be numeric. (Other array‚Äëlikes are coerced;</span>
<span class="sd">        behavior is only guaranteed for NumPy arrays.)</span>
<span class="sd">    decimals : int, optional</span>
<span class="sd">        Number of decimal places to keep (default 0).</span>
<span class="sd">    axis : int, optional</span>
<span class="sd">        Axis along which to preserve the slice sums (default -1). Each 1D slice</span>
<span class="sd">        along this axis will have its rounded sum equal to the original sum</span>
<span class="sd">        rounded to `decimals`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy.ndarray or same type as `data` when feasible</span>
<span class="sd">        Rounded array with the same shape as `data`. If `data` is a NumPy array,</span>
<span class="sd">        a NumPy array is returned. For some other types, the function attempts to</span>
<span class="sd">        reconstruct the input type after rounding.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Let `S = sum(data, axis)` and `S_r = round(S, decimals)`. The output `y`</span>
<span class="sd">      satisfies `sum(y, axis) == S_r` exactly (up to floating‚Äëpoint representation).</span>
<span class="sd">    - Within each slice, the adjustment is minimal in the sense that only the</span>
<span class="sd">      elements with the largest compatible residuals are modified by ¬± one unit</span>
<span class="sd">      in the scaled space (10**decimals).</span>
<span class="sd">    - Time complexity is `O(n log n)` per slice due to sorting; memory usage is</span>
<span class="sd">      linear in the slice size.</span>
<span class="sd">    - This procedure does not enforce monotonicity or ordering of values.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; x = np.array([0.24, 0.24, 0.24, 0.24, 0.04])</span>
<span class="sd">    &gt;&gt;&gt; x.sum(), round(x.sum(), 2)</span>
<span class="sd">    (1.0, 1.0)</span>
<span class="sd">    &gt;&gt;&gt; y = safe_round(x, decimals=1, axis=0)</span>
<span class="sd">    &gt;&gt;&gt; y</span>
<span class="sd">    array([0.2, 0.2, 0.2, 0.2, 0.2])</span>
<span class="sd">    &gt;&gt;&gt; y.sum()</span>
<span class="sd">    1.0</span>

<span class="sd">    &gt;&gt;&gt; X = np.array([[0.333, 0.333, 0.334],</span>
<span class="sd">    ...               [0.125, 0.125, 0.750]])</span>
<span class="sd">    &gt;&gt;&gt; Y = safe_round(X, decimals=2, axis=1)</span>
<span class="sd">    &gt;&gt;&gt; Y</span>
<span class="sd">    array([[0.33, 0.33, 0.34],</span>
<span class="sd">           [0.12, 0.13, 0.75]])</span>
<span class="sd">    &gt;&gt;&gt; Y.sum(axis=1)</span>
<span class="sd">    array([1.  , 1.  ])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">constructor</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># 1) Scale by 10^decimals</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="n">decimals</span>
    <span class="n">scaled</span> <span class="o">=</span> <span class="n">data</span> <span class="o">*</span> <span class="n">scale</span>

    <span class="c1"># 2) Naively round each element to the nearest integer</span>
    <span class="n">rounded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="n">scaled</span><span class="p">)</span>

    <span class="c1"># 3) Compute how many integer &quot;units&quot; the sum *should* have in each slice</span>
    <span class="n">sum_rounded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rounded</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">sum_desired</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">scaled</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">difference</span> <span class="o">=</span> <span class="n">sum_desired</span> <span class="o">-</span> <span class="n">sum_rounded</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
    <span class="n">leftover_div</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor_divide</span><span class="p">(</span><span class="n">difference</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">leftover_mod</span> <span class="o">=</span> <span class="n">difference</span> <span class="o">-</span> <span class="n">leftover_div</span> <span class="o">*</span> <span class="n">n</span>
    <span class="n">rounded</span> <span class="o">+=</span> <span class="n">leftover_div</span>

    <span class="c1"># 5) Select elements to tweak</span>
    <span class="n">difference</span> <span class="o">=</span> <span class="n">scaled</span> <span class="o">-</span> <span class="n">rounded</span>
    <span class="n">leftover_sign</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">leftover_mod</span><span class="p">)</span>
    <span class="n">difference_sign</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">difference</span><span class="p">)</span>
    <span class="n">candidate_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">difference_sign</span> <span class="o">==</span> <span class="n">leftover_sign</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">difference_sign</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">sort_key</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">candidate_mask</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">difference</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
    <span class="n">sorted_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">sort_key</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;stable&#39;</span><span class="p">)</span>

    <span class="n">ranks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">sorted_idx</span><span class="p">)</span>
    <span class="n">shape_for_r</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span>
    <span class="n">shape_for_r</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
    <span class="n">r_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">sorted_idx</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape_for_r</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">put_along_axis</span><span class="p">(</span><span class="n">ranks</span><span class="p">,</span> <span class="n">sorted_idx</span><span class="p">,</span> <span class="n">r_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>

    <span class="n">leftover_mod_int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">leftover_mod</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">choose_mask</span> <span class="o">=</span> <span class="n">ranks</span> <span class="o">&lt;</span> <span class="n">leftover_mod_int</span>
    <span class="n">rounded</span> <span class="o">+=</span> <span class="n">leftover_sign</span> <span class="o">*</span> <span class="n">choose_mask</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">rounded</span> <span class="o">/</span> <span class="n">scale</span>

    <span class="k">if</span> <span class="n">data_type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">return</span> <span class="n">data_type</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="o">**</span><span class="n">constructor</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="data.generation.realistic.sample_cadets_for_degree_conditions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample_cadets_for_degree_conditions</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">total_gen</span><span class="p">,</span> <span class="n">afscs_rare_eligible</span><span class="p">,</span> <span class="n">afsc_cip_data</span><span class="p">,</span> <span class="n">afsc_cip_conditions</span><span class="p">)</span></code>

<a href="#data.generation.realistic.sample_cadets_for_degree_conditions" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generate synthetic cadets matching AFSC-degree sampling conditions.</p>
<p>Iterates over rare AFSCs and their associated degree quotas to generate
synthetic cadets using the provided generative model. For each AFSC-degree
combination, the function samples cadets that meet the degree condition
constraints, appending them to a cumulative dataset.</p>
<h4 id="data.generation.realistic.sample_cadets_for_degree_conditions--parameters">Parameters<a class="headerlink" href="#data.generation.realistic.sample_cadets_for_degree_conditions--parameters" title="Permanent link">&para;</a></h4>
<p>model : object
    A generative model instance (e.g., CTGAN) implementing
    <code>sample_from_conditions(conditions)</code> to produce synthetic cadets.
total_gen : int
    Total number of cadets to generate across all AFSC-degree combinations.
afscs_rare_eligible : list of str
    List of AFSC codes considered rare and eligible for targeted generation.
afsc_cip_data : dict
    Mapping <code>{afsc: pandas.Series}</code> where the Series index is degree codes (CIP1)
    and values are the number of cadets to generate for each degree.
afsc_cip_conditions : dict
    Mapping <code>{afsc: {cip: Condition}}</code> specifying generation constraints for each
    AFSC-degree combination.</p>
<h4 id="data.generation.realistic.sample_cadets_for_degree_conditions--returns">Returns<a class="headerlink" href="#data.generation.realistic.sample_cadets_for_degree_conditions--returns" title="Permanent link">&para;</a></h4>
<p>pandas.DataFrame
    A concatenated dataset of synthetic cadets meeting all AFSC-degree constraints.</p>
<h4 id="data.generation.realistic.sample_cadets_for_degree_conditions--notes">Notes<a class="headerlink" href="#data.generation.realistic.sample_cadets_for_degree_conditions--notes" title="Permanent link">&para;</a></h4>
<ul>
<li>This function logs progress to the console, showing both the number and
  percentage of cadets generated so far.</li>
<li>Sampling order is AFSC-major, iterating over all degrees within each AFSC
  before moving to the next AFSC.</li>
<li>The <code>count</code> values in <code>afsc_cip_data</code> are expected to be integers or
  convertible to integers.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>afccp/data/generation/realistic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sample_cadets_for_degree_conditions</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">total_gen</span><span class="p">,</span> <span class="n">afscs_rare_eligible</span><span class="p">,</span> <span class="n">afsc_cip_data</span><span class="p">,</span> <span class="n">afsc_cip_conditions</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate synthetic cadets matching AFSC-degree sampling conditions.</span>

<span class="sd">    Iterates over rare AFSCs and their associated degree quotas to generate</span>
<span class="sd">    synthetic cadets using the provided generative model. For each AFSC-degree</span>
<span class="sd">    combination, the function samples cadets that meet the degree condition</span>
<span class="sd">    constraints, appending them to a cumulative dataset.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    model : object</span>
<span class="sd">        A generative model instance (e.g., CTGAN) implementing</span>
<span class="sd">        `sample_from_conditions(conditions)` to produce synthetic cadets.</span>
<span class="sd">    total_gen : int</span>
<span class="sd">        Total number of cadets to generate across all AFSC-degree combinations.</span>
<span class="sd">    afscs_rare_eligible : list of str</span>
<span class="sd">        List of AFSC codes considered rare and eligible for targeted generation.</span>
<span class="sd">    afsc_cip_data : dict</span>
<span class="sd">        Mapping `{afsc: pandas.Series}` where the Series index is degree codes (CIP1)</span>
<span class="sd">        and values are the number of cadets to generate for each degree.</span>
<span class="sd">    afsc_cip_conditions : dict</span>
<span class="sd">        Mapping `{afsc: {cip: Condition}}` specifying generation constraints for each</span>
<span class="sd">        AFSC-degree combination.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        A concatenated dataset of synthetic cadets meeting all AFSC-degree constraints.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - This function logs progress to the console, showing both the number and</span>
<span class="sd">      percentage of cadets generated so far.</span>
<span class="sd">    - Sampling order is AFSC-major, iterating over all degrees within each AFSC</span>
<span class="sd">      before moving to the next AFSC.</span>
<span class="sd">    - The `count` values in `afsc_cip_data` are expected to be integers or</span>
<span class="sd">      convertible to integers.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Generate dataframe</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="n">afscs_rare_eligible</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">cip</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">afsc_cip_data</span><span class="p">[</span><span class="n">afsc</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">afsc</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">cip</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
            <span class="n">df_gen</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample_from_conditions</span><span class="p">([</span><span class="n">afsc_cip_conditions</span><span class="p">[</span><span class="n">afsc</span><span class="p">][</span><span class="n">cip</span><span class="p">]])</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">df_gen</span><span class="p">),</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="n">count</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">afsc</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">cip</span><span class="si">}</span><span class="s1">: (</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">total_gen</span><span class="p">)</span><span class="si">}</span><span class="s1">) </span><span class="si">{</span><span class="nb">round</span><span class="p">((</span><span class="n">i</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">total_gen</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">% complete.&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://gitlab.com/path-to-your-repo" target="_blank" rel="noopener" title="gitlab.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "content.code.copy"], "search": "../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="../../../../javascripts/mathjax.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/input/tex/extensions/bm.js"></script>
      
    
  </body>
</html>