
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://dglaird.github.io/afccp/reference/solutions/handling/">
      
      
        <link rel="prev" href="../algorithms/">
      
      
        <link rel="next" href="../optimization/">
      
      
      <link rel="icon" href="../../../images/logos/afccp_logo_favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Handling - Air Force Cadet Career Problem</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#solutions.handling" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Air Force Cadet Career Problem" class="md-header__button md-logo" aria-label="Air Force Cadet Career Problem" data-md-component="logo">
      
  <img src="../../../images/logos/afccp_logo_and_text_light.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Air Force Cadet Career Problem
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Handling
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/dglaird/afccp/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  üè† Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../getting-started/getting-started/" class="md-tabs__link">
          
  
  
  üöÄ Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../user-guide/overview/" class="md-tabs__link">
          
  
  
  üìò User Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../developer-guide/" class="md-tabs__link">
        
  
  
    
  
  üß† Developer Guide

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../main/cadetcareerproblem_overview/" class="md-tabs__link">
          
  
  
  CadetCareerProblem

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../data/" class="md-tabs__link">
          
  
  
  üìä Data

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
  üìà Solutions

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../visualizations/" class="md-tabs__link">
          
  
  
  Visualizations

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../faq/" class="md-tabs__link">
        
  
  
    
  
  ‚ùì FAQs

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../help/" class="md-tabs__link">
        
  
  
    
  
  üÜò Help & Support

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Air Force Cadet Career Problem" class="md-nav__button md-logo" aria-label="Air Force Cadet Career Problem" data-md-component="logo">
      
  <img src="../../../images/logos/afccp_logo_and_text_light.png" alt="logo">

    </a>
    Air Force Cadet Career Problem
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dglaird/afccp/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    üè† Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    üöÄ Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            üöÄ Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    üìÑ Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    üõ†Ô∏è Install Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            üõ†Ô∏è Install Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation Instructions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/developer-checklist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developer Checklist
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    üìò User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            üìò User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/tutorial_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 1 (Introduction)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/tutorial_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 2 (Data Overview)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/tutorial_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 3 (Parameters)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/tutorial_4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 4 (Value Parameters)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/tutorial_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 5 (Data Methods)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/tutorial_6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 6 (Solutions Overview)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/tutorial_7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 7 (Algorithms)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/tutorial_8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 8 (Optimization)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide/tutorial_9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial 9 (Visualizations)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    üß† Developer Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    CadetCareerProblem
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            CadetCareerProblem
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_generated_data_corrections/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generated Data Corrections
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_main_data_corrections/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Main Data Corrections
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_other_adjustments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Other Adjustments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_value_parameter_specifications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Value Parameter Specifications
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_solution_generation_%26_algorithms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Solution Generation & Algorithms
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_optimization_models_%26_meta-heuristics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Optimization Models & Meta-Heuristics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_solution_handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Solution Handling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_export_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Export Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_data_visualizations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Visualizations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/cadetcareerproblem_results_visualizations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Results Visualizations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    üìä Data
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            üìä Data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data/adjustments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Adjustments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data/preferences/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Preferences
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data/processing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Processing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data/values/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Values
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data/support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Support
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data/generation/basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generation- 'Basic'
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data/generation/realistic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generation- 'Realistic'
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    üìà Solutions
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            üìà Solutions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algorithms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Algorithms
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Handling
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Handling
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#solutions.handling--contents" class="md-nav__link">
    <span class="md-ellipsis">
      Contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solutions.handling--workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solutions.handling--see-also" class="md-nav__link">
    <span class="md-ellipsis">
      See Also
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solutions.handling.evaluate_solution" class="md-nav__link">
    <span class="md-ellipsis">
      evaluate_solution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solutions.handling.fitness_function" class="md-nav__link">
    <span class="md-ellipsis">
      fitness_function
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solutions.handling.calculate_blocking_pairs" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_blocking_pairs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solutions.handling.value_function" class="md-nav__link">
    <span class="md-ellipsis">
      value_function
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solutions.handling.value_function_points" class="md-nav__link">
    <span class="md-ellipsis">
      value_function_points
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solutions.handling.calculate_afsc_norm_score" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_afsc_norm_score
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solutions.handling.calculate_afsc_norm_score_general" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_afsc_norm_score_general
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solutions.handling.calculate_additional_useful_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_additional_useful_metrics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solutions.handling.calculate_base_training_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_base_training_metrics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solutions.handling.calculate_castle_solution_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_castle_solution_metrics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solutions.handling.calculate_objective_measure_chromosome" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_objective_measure_chromosome
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solutions.handling.calculate_objective_measure_matrix" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_objective_measure_matrix
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solutions.handling.calculate_failed_constraint_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_failed_constraint_metrics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solutions.handling.check_failed_constraint_chromosome" class="md-nav__link">
    <span class="md-ellipsis">
      check_failed_constraint_chromosome
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solutions.handling.compare_solutions" class="md-nav__link">
    <span class="md-ellipsis">
      compare_solutions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solutions.handling.similarity_coordinates" class="md-nav__link">
    <span class="md-ellipsis">
      similarity_coordinates
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solutions.handling.incorporate_rated_results_in_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      incorporate_rated_results_in_parameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solutions.handling.augment_rated_algorithm_results" class="md-nav__link">
    <span class="md-ellipsis">
      augment_rated_algorithm_results
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../optimization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Optimization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sensitivity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sensitivity
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Visualizations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Visualizations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualizations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualizations/bubbles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bubbles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualizations/charts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Charts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualizations/slides/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Slides
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ‚ùì FAQs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../help/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    üÜò Help & Support
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<div class="doc doc-object doc-module">



<h1 id="solutions.handling" class="doc doc-heading">
            <code>solutions.handling</code>


<a href="#solutions.handling" class="headerlink" title="Permanent link">&para;</a></h1>

    <div class="doc doc-contents first">

        <p>This module provides the core logic for <strong>evaluating, validating, and comparing solutions</strong>
within the <code>afccp</code> framework. It includes comprehensive tools for computing cadet and AFSC value
scores, applying VFT constraints, and generating solution diagnostics for use in optimization,
genetic algorithms, and post-hoc analysis.</p>
<h3 id="solutions.handling--contents">Contents<a class="headerlink" href="#solutions.handling--contents" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Solution Evaluation</strong><ul>
<li><code>evaluate_solution</code>: Evaluate a proposed solution (matrix/vector) against AFCCP objectives.</li>
<li><code>fitness_function</code>: Calculate the scalar fitness score for use in meta-heuristics.</li>
</ul>
</li>
<li><strong>Metrics and Constraint Evaluation</strong><ul>
<li><code>calculate_objective_measure_matrix</code>: Compute objective measures across cadets/AFSCs.</li>
<li><code>calculate_failed_constraint_metrics</code>: Annotate constraint violations for debugging.</li>
<li><code>value_function</code>, <code>value_function_points</code>: Calculate piecewise linear VFT scores.</li>
</ul>
</li>
<li><strong>Additional Metrics</strong><ul>
<li><code>calculate_additional_useful_metrics</code>: Compute fairness, choice rank, gender/race equity, utility scores.</li>
<li><code>calculate_base_training_metrics</code>: Integrate base/training preference satisfaction.</li>
<li><code>calculate_castle_solution_metrics</code>: Evaluate CASTLE-specific value curves and GUO tradeoffs.</li>
<li><code>calculate_ots_specific_metrics</code>: Add OTS-specific merit and preference analytics.</li>
</ul>
</li>
<li><strong>Stability and Comparison</strong><ul>
<li><code>calculate_blocking_pairs</code>: Identify cadet‚ÄìAFSC blocking pairs based on stable matching criteria.</li>
<li><code>compare_solutions</code>: Measure assignment similarity between two <code>j_array</code> vectors.</li>
<li><code>similarity_coordinates</code>: Use multidimensional scaling (MDS) to visualize solution clusters.</li>
</ul>
</li>
<li><strong>Rated SOC Integration</strong><ul>
<li><code>incorporate_rated_results_in_parameters</code>: Lock matched/reserved cadets from SOC rated algorithms.</li>
<li><code>augment_rated_algorithm_results</code>: Expand alternate lists and enforce USAFA/ROTC rated constraints.</li>
</ul>
</li>
</ul>
<h3 id="solutions.handling--workflow">Workflow<a class="headerlink" href="#solutions.handling--workflow" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Evaluation of a Solution</strong><ul>
<li>Construct <code>x</code>, <code>j_array</code>, and <code>afsc_array</code>.</li>
<li>Calculate AFSC/cadet utility values and objective scores.</li>
<li>Apply value functions and check for failed constraints.</li>
<li>Compute global metrics: <code>z</code>, <code>z^gu</code>, blocking pairs, Simpson diversity, and match quality.</li>
</ul>
</li>
<li><strong>Constraint Handling</strong><ul>
<li>Differentiate between hard and soft constraints (AFSC value floors, cadet preference thresholds).</li>
<li>Track failed constraints using <code>objective_constraint_fail</code> and <code>con_fail_dict</code>.</li>
</ul>
</li>
<li><strong>Post-Evaluation Analysis</strong><ul>
<li>Calculate Simpson indices (race/ethnicity), choice distributions, and demographic breakdowns.</li>
<li>Decompose metrics by SOC, gender, service branch (USSF/USAF), and AFSC.</li>
</ul>
</li>
<li><strong>Solution Comparison</strong><ul>
<li>Visualize solution similarity with MDS or compute <code>compare_solutions</code> overlap %.</li>
<li>Count and list blocking pairs to assess matching stability.</li>
</ul>
</li>
<li><strong>Integration with SOC-Rated Workflows</strong><ul>
<li>Lock rated matches/reserves and update alternate lists.</li>
<li>Define alternate eligibility (hard/soft), preference sets, and blocking pair-safe configurations.</li>
</ul>
</li>
</ol>
<h3 id="solutions.handling--see-also">See Also<a class="headerlink" href="#solutions.handling--see-also" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="../../../reference/solutions/algorithms/#solutions.algorithms"><code>afccp.solutions.algorithms</code></a>:
  Contains the matching and meta-heuristic algorithms whose outputs are evaluated here.</li>
<li><a href="../../../reference/data/preferences/#data.preferences"><code>afccp.data.preferences</code></a>:
  Helper functions to compute cadet and AFSC preferences, including rated eligibility sets.</li>
</ul>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="solutions.handling.evaluate_solution" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">evaluate_solution</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">value_parameters</span><span class="p">,</span> <span class="n">approximate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">re_calculate_x</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">printing</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#solutions.handling.evaluate_solution" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Evaluate a solution (either a vector or a matrix) by calculating various metrics.</p>
<p>Parameters:
    solution (numpy.ndarray): The solution to evaluate, represented as a vector or a matrix.
    parameters (dict): The fixed cadet/AFSC model parameters.
    value_parameters (dict): The weight/value parameters.
    approximate (bool, optional): Whether the solution is approximate or exact. Defaults to False.
    re_calculate_x (bool, optional): If we want to force re-calculation of x as integer matrix. Defaults to True.
    printing (bool, optional): Whether to print the evaluated metrics. Defaults to False.</p>
<p>Returns:
    solution (dict): A dictionary containing the solution core elements and evaluated metrics.</p>
<p>Note:
    This function evaluates a solution by calculating various metrics, including objective measures, objective values,
    AFSC values, cadet values, constraint failures, overall values, and additional useful metrics.</p>

            <details class="quote">
              <summary>Source code in <code>afccp/solutions/handling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">evaluate_solution</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">value_parameters</span><span class="p">,</span> <span class="n">approximate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">re_calculate_x</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">printing</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate a solution (either a vector or a matrix) by calculating various metrics.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        solution (numpy.ndarray): The solution to evaluate, represented as a vector or a matrix.</span>
<span class="sd">        parameters (dict): The fixed cadet/AFSC model parameters.</span>
<span class="sd">        value_parameters (dict): The weight/value parameters.</span>
<span class="sd">        approximate (bool, optional): Whether the solution is approximate or exact. Defaults to False.</span>
<span class="sd">        re_calculate_x (bool, optional): If we want to force re-calculation of x as integer matrix. Defaults to True.</span>
<span class="sd">        printing (bool, optional): Whether to print the evaluated metrics. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        solution (dict): A dictionary containing the solution core elements and evaluated metrics.</span>

<span class="sd">    Note:</span>
<span class="sd">        This function evaluates a solution by calculating various metrics, including objective measures, objective values,</span>
<span class="sd">        AFSC values, cadet values, constraint failures, overall values, and additional useful metrics.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Shorthand</span>
    <span class="n">p</span><span class="p">,</span> <span class="n">vp</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">value_parameters</span>

    <span class="c1"># Get X matrix</span>
    <span class="k">if</span> <span class="s1">&#39;x&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">solution</span> <span class="ow">or</span> <span class="n">re_calculate_x</span><span class="p">:</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;j_array&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]])</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>

    <span class="c1"># Initialize solution metrics to be added to solution dictionary</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;objective_measure&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">],</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]]),</span>  <span class="c1"># AFSC objective &quot;raw&quot; measure</span>
               <span class="s1">&#39;objective_value&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">],</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]]),</span>  <span class="c1"># AFSC objective value determined through value function</span>
               <span class="s1">&#39;afsc_value&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]),</span> <span class="s1">&#39;cadet_value&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]),</span>  <span class="c1"># AFSC/Cadet Individual values</span>
               <span class="s1">&#39;cadet_constraint_fail&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]),</span>  <span class="c1"># 1-N binary array indicating cadet constraint failures</span>
               <span class="s1">&#39;afsc_constraint_fail&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]),</span>  <span class="c1"># 1-M binary array indicating AFSC constraint failures</span>
               <span class="s1">&#39;objective_score&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]),</span>  <span class="c1"># &quot;Flipped&quot; score for the AFSC objective</span>

               <span class="c1"># Constraint data metrics</span>
               <span class="s1">&#39;total_failed_constraints&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;failed_constraints&quot;</span><span class="p">:</span> <span class="p">[],</span>
               <span class="s1">&#39;objective_constraint_fail&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">30</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">])]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">])]),</span>
               <span class="s1">&#39;con_fail_dict&#39;</span><span class="p">:</span> <span class="p">{}</span>  <span class="c1"># Dictionary containing the new minimum/maximum value we need to adhere to</span>
               <span class="p">}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>
        <span class="n">solution</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="c1"># Loop through all AFSCs to assign their &quot;individual&quot; values</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]:</span>
        <span class="n">afsc</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;afscs&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>

        <span class="c1"># Loop through all AFSC objectives</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">objective</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s2">&quot;objectives&quot;</span><span class="p">]):</span>

            <span class="c1"># Calculate AFSC objective measure</span>
            <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;objective_measure&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">calculate_objective_measure_matrix</span><span class="p">(</span>
                <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">j</span><span class="p">,</span> <span class="n">objective</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">approximate</span><span class="o">=</span><span class="n">approximate</span><span class="p">)</span>

            <span class="c1"># Calculate AFSC objective value</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;K^A&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;objective_value&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_function</span><span class="p">(</span>
                    <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;f^hat&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;objective_measure&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>

            <span class="c1"># Update metrics dictionary with failed AFSC objective constraint information</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;K^C&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">solution</span> <span class="o">=</span> <span class="n">calculate_failed_constraint_metrics</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">solution</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">vp</span><span class="p">)</span>

        <span class="c1"># AFSC individual value</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_value&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s1">&#39;objective_weight&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;objective_value&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="p">:])</span>
        <span class="k">if</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_value&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;afsc_value_min&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
            <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_constraint_fail&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;total_failed_constraints&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">solution</span><span class="p">[</span><span class="s2">&quot;failed_constraints&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">afsc</span> <span class="o">+</span> <span class="s2">&quot; Value&quot;</span><span class="p">)</span>

    <span class="c1"># Set of cadets that have been matched to AFSCs</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^Match&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;j_array&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;Num Matched&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^Match&#39;</span><span class="p">])</span>

    <span class="c1"># Loop through all cadets to assign their values</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]:</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_value&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^E&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_value&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;cadet_value_min&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_constraint_fail&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;total_failed_constraints&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">solution</span><span class="p">[</span><span class="s2">&quot;failed_constraints&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Cadet &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadets&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; Value&quot;</span><span class="p">)</span>

    <span class="c1"># Variables used to help verify that cadets are receiving the AFSCs they need to if specified</span>
    <span class="n">num_fixed_correctly</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">num_reserved_correctly</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Get the AFSC solution (Modified to support &quot;unmatched&quot; cadets)</span>
    <span class="n">solution</span><span class="p">[</span><span class="s2">&quot;num_unmatched&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_array&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">10</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">solution</span><span class="p">[</span><span class="s2">&quot;num_unmatched&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]</span>  <span class="c1"># Last index (*)</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_array&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>

        <span class="c1"># Check if this AFSC was &quot;fixed&quot; for this cadet</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Fixed&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Fixed&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">num_fixed_correctly</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Check if this AFSC was reserved for this cadet</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Reserved&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Reserved&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">num_reserved_correctly</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Alternate list situation</span>
    <span class="k">if</span> <span class="s1">&#39;J^Preferred [usafa]&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;num_alternates_allowed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Number of cadets on alternate lists</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;num_successful_alternates&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Number of cadets on alternate lists that don&#39;t form blocking pairs</span>

        <span class="c1"># Loop through each SOC and rated AFSC</span>
        <span class="k">for</span> <span class="n">soc</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;SOCs&#39;</span><span class="p">]:</span>

            <span class="c1"># Did we not run the algorithm for this specific SOC?</span>
            <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;J^Preferred [</span><span class="si">{</span><span class="n">soc</span><span class="si">}</span><span class="s1">]&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Loop through each rated AFSC</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]:</span>

                <span class="c1"># Loop through each cadet on this SOC&#39;s rated AFSC&#39;s list</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Alternate [&#39;</span> <span class="o">+</span> <span class="n">soc</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
                    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;num_alternates_allowed&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="c1"># Check the blocking pair constraint for this rated AFSC and cadet pair</span>
                    <span class="n">not_blocking_pair</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">soc</span> <span class="o">+</span> <span class="s1">&#39;_quota&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j_p</span><span class="p">]</span> <span class="k">for</span> <span class="n">j_p</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Preferred [&#39;</span> <span class="o">+</span> <span class="n">soc</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="n">i_p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i_p</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Preferred [&#39;</span> <span class="o">+</span> <span class="n">soc</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">not_blocking_pair</span><span class="p">:</span>
                        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;num_successful_alternates&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;alternate_list_metric&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;num_successful_alternates&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; / &quot;</span> <span class="o">+</span> \
                                            <span class="nb">str</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;num_alternates_allowed&#39;</span><span class="p">])</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;alternate_list_metric&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0 / 0&quot;</span>  <span class="c1"># Not applicable here</span>

    <span class="c1"># Verification that AFSCs are being assigned properly to work with J^Fixed and J^Reserved</span>
    <span class="n">num_fixed_needed</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Fixed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">num_reserved_needed</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Reserved&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadets_fixed_correctly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_fixed_needed</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; / &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_fixed_needed</span><span class="p">)</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadets_reserved_correctly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_reserved_correctly</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; / &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_reserved_needed</span><span class="p">)</span>

    <span class="c1"># Define overall metrics</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadets_overall_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s1">&#39;cadet_weight&#39;</span><span class="p">][</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^Match&#39;</span><span class="p">]],</span>
                                              <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_value&#39;</span><span class="p">][</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^Match&#39;</span><span class="p">]])</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afscs_overall_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s1">&#39;afsc_weight&#39;</span><span class="p">],</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_value&#39;</span><span class="p">])</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;cadets_overall_weight&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadets_overall_value&#39;</span><span class="p">]</span> <span class="o">+</span> \
                   <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;afscs_overall_weight&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afscs_overall_value&#39;</span><span class="p">]</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;num_ineligible&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;ineligible&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^Match&#39;</span><span class="p">])</span>

    <span class="c1"># Add additional metrics components (Non-VFT stuff)</span>
    <span class="n">solution</span> <span class="o">=</span> <span class="n">calculate_additional_useful_metrics</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">vp</span><span class="p">)</span>

    <span class="c1"># Add base/training components if applicable</span>
    <span class="k">if</span> <span class="s1">&#39;base_array&#39;</span> <span class="ow">in</span> <span class="n">solution</span><span class="p">:</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="n">calculate_base_training_metrics</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">vp</span><span class="p">)</span>

    <span class="c1"># Add Castle solution metrics</span>
    <span class="k">if</span> <span class="s1">&#39;castle_q&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="n">calculate_castle_solution_metrics</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;ots&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;SOCs&#39;</span><span class="p">]:</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="n">calculate_ots_specific_metrics</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

    <span class="c1"># Calculate blocking pairs</span>
    <span class="k">if</span> <span class="s1">&#39;a_pref_matrix&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;blocking_pairs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_blocking_pairs</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">solution</span><span class="p">)</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;num_blocking_pairs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;blocking_pairs&#39;</span><span class="p">])</span>

    <span class="c1"># Print statement</span>
    <span class="k">if</span> <span class="n">printing</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">approximate</span><span class="p">:</span>
            <span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;approximate&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;exact&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">solution</span><span class="p">:</span>
            <span class="n">print_str</span> <span class="o">=</span> <span class="s2">&quot;Solution Evaluated: &quot;</span> <span class="o">+</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">print_str</span> <span class="o">=</span> <span class="s2">&quot;New Solution Evaluated.&quot;</span>
        <span class="n">print_str</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Measured &quot;</span> <span class="o">+</span> <span class="n">model_type</span> <span class="o">+</span> <span class="s2">&quot; VFT objective value: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
        <span class="k">if</span> <span class="s1">&#39;z^gu&#39;</span> <span class="ow">in</span> <span class="n">solution</span><span class="p">:</span>
            <span class="n">print_str</span> <span class="o">+=</span> <span class="s2">&quot;.</span><span class="se">\n</span><span class="s2">Global Utility Score: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;z^gu&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">print_str</span> <span class="o">+=</span> <span class="s2">&quot;. &quot;</span> <span class="o">+</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadets_fixed_correctly&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; AFSCs fixed. &#39;</span> <span class="o">+</span> \
                     <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadets_reserved_correctly&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; AFSCs reserved&#39;</span>
        <span class="n">print_str</span> <span class="o">+=</span> <span class="s2">&quot;. &quot;</span> <span class="o">+</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;alternate_list_metric&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; alternate list scenarios respected&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;z^CASTLE&#39;</span> <span class="ow">in</span> <span class="n">solution</span><span class="p">:</span>
            <span class="n">print_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="se">\n</span><span class="s2">CASTLE GUO Score: </span><span class="si">{</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;z^CASTLE&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. &quot;</span> \
                         <span class="sa">f</span><span class="s2">&quot;Value Curve Score: </span><span class="si">{</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;z^CASTLE (Values)&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;num_blocking_pairs&#39;</span> <span class="ow">in</span> <span class="n">solution</span><span class="p">:</span>
            <span class="n">print_str</span> <span class="o">+=</span> <span class="s2">&quot;.</span><span class="se">\n</span><span class="s2">Blocking pairs: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;num_blocking_pairs&#39;</span><span class="p">])</span>
        <span class="n">print_str</span> <span class="o">+=</span> <span class="s2">&quot;. Unmatched cadets: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s2">&quot;num_unmatched&quot;</span><span class="p">])</span>
        <span class="n">print_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="se">\n</span><span class="s2">Matched cadets: </span><span class="si">{</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;Num Matched&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. N^Match: </span><span class="si">{</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N^Match&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">print_str</span> <span class="o">+=</span> <span class="s2">&quot;. Ineligible cadets: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;num_ineligible&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;matched_out_of_must_match&#39;</span> <span class="ow">in</span> <span class="n">solution</span><span class="p">:</span>
            <span class="n">print_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">solution</span><span class="p">[</span><span class="s2">&quot;matched_out_of_must_match&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> OTS &quot;must-matches&quot; accessed.</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;ots&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;SOCs&#39;</span><span class="p">]:</span>
            <span class="n">print_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;OTS Average Merit: </span><span class="si">{</span><span class="n">solution</span><span class="p">[</span><span class="s2">&quot;OTS Average Merit&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">. &#39;</span> \
                         <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">solution</span><span class="p">[</span><span class="s2">&quot;OTS Selected Pref Count&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> / </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s2">&quot;I^Match-OTS&quot;</span><span class="p">])</span><span class="si">}</span><span class="s1"> &#39;</span> \
                         <span class="sa">f</span><span class="s1">&#39;OTS candidates received AFSC they selected.&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">print_str</span><span class="p">)</span>

    <span class="c1"># Return the solution/metrics</span>
    <span class="k">return</span> <span class="n">solution</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="solutions.handling.fitness_function" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fitness_function</span><span class="p">(</span><span class="n">chromosome</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">mp</span><span class="p">,</span> <span class="n">con_fail_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#solutions.handling.fitness_function" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Evaluates a chromosome (solution vector) and returns its fitness score.</p>
<p>Parameters:
    chromosome (array-like): The chromosome representing the solution vector.
    p (dict): Parameters used in the calculations.
    vp (dict): Value parameters used in the calculations.
    mp (dict): Model parameters.
    con_fail_dict (dict, optional): Dictionary to store failed constraints for efficient evaluation.
                                    Defaults to None.</p>
<p>Returns:
    fitness_score (float): The fitness score of the chromosome.</p>
<p>Note:
    This function is relatively time-consuming and should be as efficient as possible.
    The fitness score is calculated based on the provided chromosome and parameters.</p>

            <details class="quote">
              <summary>Source code in <code>afccp/solutions/handling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fitness_function</span><span class="p">(</span><span class="n">chromosome</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">mp</span><span class="p">,</span> <span class="n">con_fail_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluates a chromosome (solution vector) and returns its fitness score.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        chromosome (array-like): The chromosome representing the solution vector.</span>
<span class="sd">        p (dict): Parameters used in the calculations.</span>
<span class="sd">        vp (dict): Value parameters used in the calculations.</span>
<span class="sd">        mp (dict): Model parameters.</span>
<span class="sd">        con_fail_dict (dict, optional): Dictionary to store failed constraints for efficient evaluation.</span>
<span class="sd">                                        Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        fitness_score (float): The fitness score of the chromosome.</span>

<span class="sd">    Note:</span>
<span class="sd">        This function is relatively time-consuming and should be as efficient as possible.</span>
<span class="sd">        The fitness score is calculated based on the provided chromosome and parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># 5% cap on total percentage of USAFA cadets allowed into certain AFSCs</span>
    <span class="k">if</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;J^USAFA&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

        <span class="c1"># This is a pretty arbitrary constraint and will only be used for real class years (but has since been removed)</span>
        <span class="n">cap</span> <span class="o">=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">mp</span><span class="p">[</span><span class="s2">&quot;real_usafa_n&quot;</span><span class="p">]</span>
        <span class="n">u_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;J^USAFA&quot;</span><span class="p">]:</span>
            <span class="n">cadets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">chromosome</span> <span class="o">==</span> <span class="n">j</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">usafa_cadets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^D&#39;</span><span class="p">][</span><span class="s1">&#39;USAFA Proportion&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">cadets</span><span class="p">)</span>
            <span class="n">u_count</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">usafa_cadets</span><span class="p">)</span>

        <span class="c1"># If we fail this constraint, we return an objective value of 0</span>
        <span class="k">if</span> <span class="n">u_count</span> <span class="o">&gt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="c1"># Calculate AFSC individual values</span>
    <span class="n">afsc_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]:</span>

        <span class="c1"># Initialize objective measures and values</span>
        <span class="n">measure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">])</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">])</span>

        <span class="c1"># Indices of cadets assigned to this AFSC</span>
        <span class="n">cadets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">chromosome</span> <span class="o">==</span> <span class="n">j</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Only calculate measures for AFSCs with at least one cadet</span>
        <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cadets</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="c1"># Loop through all AFSC objectives</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;K&quot;</span><span class="p">]:</span>

                <span class="c1"># If this AFSC is constraining this objective or only has it in the objective function</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;K^A&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>

                    <span class="c1"># Calculate AFSC objective measure</span>
                    <span class="n">measure</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_objective_measure_chromosome</span><span class="p">(</span><span class="n">cadets</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;objectives&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>

                    <span class="c1"># Assign AFSC objective value</span>
                    <span class="n">value</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_function</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;f^hat&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="n">measure</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

                    <span class="c1"># Check failed AFSC objective</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;K^C&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">check_failed_constraint_chromosome</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">measure</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">count</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">con_fail_dict</span><span class="p">):</span>
                            <span class="k">return</span> <span class="mi">0</span>

            <span class="c1"># Calculate AFSC value</span>
            <span class="n">afsc_value</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s1">&#39;objective_weight&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;J^C&#39;</span><span class="p">]:</span>

                <span class="c1"># If we fail this constraint, we return an objective value of 0</span>
                <span class="k">if</span> <span class="n">afsc_value</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;afsc_value_min&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="mi">0</span>

        <span class="c1"># No cadets assigned to the AFSC means it failed</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="c1"># Calculate Cadet Value</span>
    <span class="n">cadet_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">chromosome</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;I^C&#39;</span><span class="p">]:</span>

        <span class="c1"># If we fail this constraint, we return an objective value of 0</span>
        <span class="k">if</span> <span class="n">cadet_value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;cadet_value_min&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="c1"># Return fitness value</span>
    <span class="k">return</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;cadets_overall_weight&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s1">&#39;cadet_weight&#39;</span><span class="p">],</span> <span class="n">cadet_value</span><span class="p">)</span> <span class="o">+</span> \
           <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;afscs_overall_weight&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s1">&#39;afsc_weight&#39;</span><span class="p">],</span> <span class="n">afsc_value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="solutions.handling.calculate_blocking_pairs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_blocking_pairs</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">solution</span><span class="p">,</span> <span class="n">only_return_count</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#solutions.handling.calculate_blocking_pairs" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate blocking pairs in a given solution.</p>
<p>Parameters:
- parameters (dict): The parameters of the matching problem.
- solution (dict): The current matching solution.
- only_return_count (bool): If True, return the count of blocking pairs; if False,
  return the list of blocking pairs.</p>
<p>Returns:
- blocking_pairs (list or int): A list of blocking pairs (or count of blocking pairs).</p>
<p>Description:
This function calculates the blocking pairs in a given matching solution based on
the stable matching community's definition. A blocking pair consists of an unmatched
cadet and a more preferred AFSC that is also unmatched or assigned to a cadet with
lower preference.</p>
<p>Parameters Dictionary Structure:
- 'cadet_preferences': An array representing cadet preferences.
- 'a_pref_matrix': A matrix of AFSC preferences.
- 'J': The set of all AFSCs.
- 'M': A special symbol representing an unmatched cadet.</p>
<p>Solution Dictionary Structure:
- 'j_array': An array representing the assignment of AFSCs to cadets.</p>
<p>Dependencies:
- NumPy</p>
<p>Reference:
- Gale, D., &amp; Shapley, L. S. (1962). College Admissions and the Stability of
  Marriage. American Mathematical Monthly, 69(1), 9-15.</p>

            <details class="quote">
              <summary>Source code in <code>afccp/solutions/handling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_blocking_pairs</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">solution</span><span class="p">,</span> <span class="n">only_return_count</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate blocking pairs in a given solution.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - parameters (dict): The parameters of the matching problem.</span>
<span class="sd">    - solution (dict): The current matching solution.</span>
<span class="sd">    - only_return_count (bool): If True, return the count of blocking pairs; if False,</span>
<span class="sd">      return the list of blocking pairs.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - blocking_pairs (list or int): A list of blocking pairs (or count of blocking pairs).</span>

<span class="sd">    Description:</span>
<span class="sd">    This function calculates the blocking pairs in a given matching solution based on</span>
<span class="sd">    the stable matching community&#39;s definition. A blocking pair consists of an unmatched</span>
<span class="sd">    cadet and a more preferred AFSC that is also unmatched or assigned to a cadet with</span>
<span class="sd">    lower preference.</span>

<span class="sd">    Parameters Dictionary Structure:</span>
<span class="sd">    - &#39;cadet_preferences&#39;: An array representing cadet preferences.</span>
<span class="sd">    - &#39;a_pref_matrix&#39;: A matrix of AFSC preferences.</span>
<span class="sd">    - &#39;J&#39;: The set of all AFSCs.</span>
<span class="sd">    - &#39;M&#39;: A special symbol representing an unmatched cadet.</span>

<span class="sd">    Solution Dictionary Structure:</span>
<span class="sd">    - &#39;j_array&#39;: An array representing the assignment of AFSCs to cadets.</span>

<span class="sd">    Dependencies:</span>
<span class="sd">    - NumPy</span>

<span class="sd">    Reference:</span>
<span class="sd">    - Gale, D., &amp; Shapley, L. S. (1962). College Admissions and the Stability of</span>
<span class="sd">      Marriage. American Mathematical Monthly, 69(1), 9-15.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Shorthand</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">parameters</span>

    <span class="c1"># Dictionary of cadets matched to each AFSC in this solution</span>
    <span class="n">cadets_matched</span> <span class="o">=</span> <span class="p">{</span><span class="n">j</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;j_array&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]}</span>

    <span class="c1"># Loop through all cadets and their assigned AFSCs</span>
    <span class="n">blocking_pairs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">blocking_pair_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Loop through each cadet, AFSC pair</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;j_array&#39;</span><span class="p">]):</span>

        <span class="c1"># Unmatched cadets are blocking pairs by definition</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">only_return_count</span><span class="p">:</span>
                <span class="n">blocking_pair_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">blocking_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
                <span class="n">blocking_pair_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Matched cadets need to be calculated</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cadet_choice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Loop through more desirable AFSCs than current matched</span>
            <span class="k">for</span> <span class="n">j_compare</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="n">cadet_choice</span><span class="p">]:</span>

                <span class="c1"># Where is this cadet ranked in the AFSC list?</span>
                <span class="n">afsc_choice_of_this_cadet</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;a_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j_compare</span><span class="p">]</span>
                <span class="n">matched_cadet_ranks</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;a_pref_matrix&#39;</span><span class="p">][</span><span class="n">cadets_matched</span><span class="p">[</span><span class="n">j_compare</span><span class="p">],</span> <span class="n">j_compare</span><span class="p">]</span>

                <span class="c1"># No one has been assigned to this more desirable AFSC (another blocking pair situation)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matched_cadet_ranks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">only_return_count</span><span class="p">:</span>
                        <span class="n">blocking_pair_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">blocking_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j_compare</span><span class="p">))</span>
                        <span class="n">blocking_pair_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">break</span>

                <span class="c1"># The lowest rank of the assigned cadet</span>
                <span class="n">afsc_choice_of_worst_cadet</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">matched_cadet_ranks</span><span class="p">)</span>

                <span class="c1"># Check for blocking pairs</span>
                <span class="k">if</span> <span class="n">afsc_choice_of_this_cadet</span> <span class="o">&lt;</span> <span class="n">afsc_choice_of_worst_cadet</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">only_return_count</span><span class="p">:</span>
                        <span class="n">blocking_pair_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">blocking_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j_compare</span><span class="p">))</span>
                        <span class="n">blocking_pair_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">break</span>

    <span class="k">if</span> <span class="n">only_return_count</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">blocking_pair_count</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">blocking_pairs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="solutions.handling.value_function" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">value_function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">f_a</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span></code>

<a href="#solutions.handling.value_function" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculates the AFSC objective value based on the provided parameters.</p>
<p>Parameters:
    a (array-like): Measure at each breakpoint.
    f_a (array-like): Value at each breakpoint.
    r (int): Number of breakpoints.
    x (float): Actual AFSC objective measure.</p>
<p>Returns:
    value (float): AFSC objective value.</p>
<p>Note:
    This function finds the appropriate breakpoint based on the measure and calculates the objective value
    using linear interpolation.</p>

            <details class="quote">
              <summary>Source code in <code>afccp/solutions/handling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">value_function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">f_a</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the AFSC objective value based on the provided parameters.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        a (array-like): Measure at each breakpoint.</span>
<span class="sd">        f_a (array-like): Value at each breakpoint.</span>
<span class="sd">        r (int): Number of breakpoints.</span>
<span class="sd">        x (float): Actual AFSC objective measure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        value (float): AFSC objective value.</span>

<span class="sd">    Note:</span>
<span class="sd">        This function finds the appropriate breakpoint based on the measure and calculates the objective value</span>
<span class="sd">        using linear interpolation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find which breakpoint is immediately before this measure</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span> <span class="o">*</span> <span class="mi">1</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">indices</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Obtain value</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">r</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">f_a</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">f_a</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">((</span><span class="n">f_a</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">f_a</span><span class="p">[</span><span class="n">l</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">]))</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>

    <span class="c1"># Return value</span>
    <span class="k">return</span> <span class="n">val</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="solutions.handling.value_function_points" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">value_function_points</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">fhat</span><span class="p">)</span></code>

<a href="#solutions.handling.value_function_points" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Takes the linear function parameters and returns the approximately non-linear coordinates</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>a</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>function breakpoints</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fhat</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>function breakpoint values</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>x, y</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>afccp/solutions/handling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">value_function_points</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">fhat</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes the linear function parameters and returns the approximately non-linear coordinates</span>
<span class="sd">    :param a: function breakpoints</span>
<span class="sd">    :param fhat: function breakpoint values</span>
<span class="sd">    :return: x, y</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1001</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">value_function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">fhat</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="solutions.handling.calculate_afsc_norm_score" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_afsc_norm_score</span><span class="p">(</span><span class="n">cadets</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#solutions.handling.calculate_afsc_norm_score" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate the Normalized Score for an AFSC assignment.</p>
<p>Parameters:
- cadets (list or numpy.ndarray): A list of cadets assigned to the AFSC.
- j (int): The index of the AFSC for which the score is calculated.
- p (dict): The problem parameters including preferences and AFSC data.
- count (int, optional): The number of cadets assigned to the AFSC. If not provided,
  it is calculated from the length of the 'cadets' list.</p>
<p>Returns:
- norm_score (float): The normalized score for the AFSC assignment, ranging from 0 to 1.</p>
<p>Description:
This function calculates the normalized score for an assignment of cadets to an AFSC.
The score reflects how well the cadets are matched to their preferences for the given AFSC.
A higher score indicates a better match, while a lower score suggests a less favorable assignment.</p>
<p>The calculation involves comparing the achieved score (sum of cadet preferences) to the
best and worst possible scores for the AFSC assignment. The result is then normalized to
a range between 0 and 1, with 1 being the best possible score and 0 being the worst.</p>
<p>Parameters Dictionary Structure:
- 'a_pref_matrix': A matrix of AFSC preferences.
- 'num_eligible': A dictionary with the number of eligible cadets for each AFSC.</p>
<p>Dependencies:
- NumPy</p>
<p>Returns:
- norm_score (float): The normalized score for the AFSC assignment, ranging from 0 to 1.</p>

            <details class="quote">
              <summary>Source code in <code>afccp/solutions/handling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_afsc_norm_score</span><span class="p">(</span><span class="n">cadets</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the Normalized Score for an AFSC assignment.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - cadets (list or numpy.ndarray): A list of cadets assigned to the AFSC.</span>
<span class="sd">    - j (int): The index of the AFSC for which the score is calculated.</span>
<span class="sd">    - p (dict): The problem parameters including preferences and AFSC data.</span>
<span class="sd">    - count (int, optional): The number of cadets assigned to the AFSC. If not provided,</span>
<span class="sd">      it is calculated from the length of the &#39;cadets&#39; list.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - norm_score (float): The normalized score for the AFSC assignment, ranging from 0 to 1.</span>

<span class="sd">    Description:</span>
<span class="sd">    This function calculates the normalized score for an assignment of cadets to an AFSC.</span>
<span class="sd">    The score reflects how well the cadets are matched to their preferences for the given AFSC.</span>
<span class="sd">    A higher score indicates a better match, while a lower score suggests a less favorable assignment.</span>

<span class="sd">    The calculation involves comparing the achieved score (sum of cadet preferences) to the</span>
<span class="sd">    best and worst possible scores for the AFSC assignment. The result is then normalized to</span>
<span class="sd">    a range between 0 and 1, with 1 being the best possible score and 0 being the worst.</span>

<span class="sd">    Parameters Dictionary Structure:</span>
<span class="sd">    - &#39;a_pref_matrix&#39;: A matrix of AFSC preferences.</span>
<span class="sd">    - &#39;num_eligible&#39;: A dictionary with the number of eligible cadets for each AFSC.</span>

<span class="sd">    Dependencies:</span>
<span class="sd">    - NumPy</span>

<span class="sd">    Returns:</span>
<span class="sd">    - norm_score (float): The normalized score for the AFSC assignment, ranging from 0 to 1.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Re-calculate count if necessary</span>
    <span class="k">if</span> <span class="n">count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cadets</span><span class="p">)</span>

    <span class="c1"># Best score sum we could achieve</span>
    <span class="n">best_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>

    <span class="c1"># Worst score sum we could receive</span>
    <span class="n">worst_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;num_eligible&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">count</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;num_eligible&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
    <span class="n">worst_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">worst_range</span><span class="p">)</span>

    <span class="c1"># Score sum we did receive</span>
    <span class="n">achieved_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;a_pref_matrix&quot;</span><span class="p">][</span><span class="n">cadets</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>

    <span class="c1"># Normalize this score and return it</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">achieved_sum</span> <span class="o">-</span> <span class="n">best_sum</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">worst_sum</span> <span class="o">-</span> <span class="n">best_sum</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="solutions.handling.calculate_afsc_norm_score_general" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_afsc_norm_score_general</span><span class="p">(</span><span class="n">ranks</span><span class="p">,</span> <span class="n">achieved_ranks</span><span class="p">)</span></code>

<a href="#solutions.handling.calculate_afsc_norm_score_general" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate the Normalized Score for an AFSC assignment using custom ranks.</p>
<p>Parameters:
- ranks (numpy.ndarray): An array containing the preference ranks for eligible cadets
  for the specific AFSC.
- achieved_ranks (numpy.ndarray): An array of achieved ranks, indicating the ranks
  at which cadets were assigned to the AFSC.</p>
<p>Returns:
- norm_score (float): The normalized score for the AFSC assignment, ranging from 0 to 1.</p>
<p>Description:
This function calculates the normalized score for an assignment of cadets to an AFSC.
The score reflects how well the cadets are matched to their preferences for the given AFSC.
A higher score indicates a better match, while a lower score suggests a less favorable assignment.</p>
<p>The calculation involves comparing the achieved ranks of cadets to the best and worst possible ranks
for the AFSC assignment. The result is then normalized to a range between 0 and 1, with 1 being the
best possible score and 0 being the worst.</p>
<p>Dependencies:
- NumPy</p>
<p>Returns:
- norm_score (float): The normalized score for the AFSC assignment, ranging from 0 to 1.</p>

            <details class="quote">
              <summary>Source code in <code>afccp/solutions/handling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_afsc_norm_score_general</span><span class="p">(</span><span class="n">ranks</span><span class="p">,</span> <span class="n">achieved_ranks</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the Normalized Score for an AFSC assignment using custom ranks.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - ranks (numpy.ndarray): An array containing the preference ranks for eligible cadets</span>
<span class="sd">      for the specific AFSC.</span>
<span class="sd">    - achieved_ranks (numpy.ndarray): An array of achieved ranks, indicating the ranks</span>
<span class="sd">      at which cadets were assigned to the AFSC.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - norm_score (float): The normalized score for the AFSC assignment, ranging from 0 to 1.</span>

<span class="sd">    Description:</span>
<span class="sd">    This function calculates the normalized score for an assignment of cadets to an AFSC.</span>
<span class="sd">    The score reflects how well the cadets are matched to their preferences for the given AFSC.</span>
<span class="sd">    A higher score indicates a better match, while a lower score suggests a less favorable assignment.</span>

<span class="sd">    The calculation involves comparing the achieved ranks of cadets to the best and worst possible ranks</span>
<span class="sd">    for the AFSC assignment. The result is then normalized to a range between 0 and 1, with 1 being the</span>
<span class="sd">    best possible score and 0 being the worst.</span>

<span class="sd">    Dependencies:</span>
<span class="sd">    - NumPy</span>

<span class="sd">    Returns:</span>
<span class="sd">    - norm_score (float): The normalized score for the AFSC assignment, ranging from 0 to 1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Number of cadets assigned here</span>
    <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">achieved_ranks</span><span class="p">)</span>

    <span class="c1"># Only consider eligible cadets</span>
    <span class="n">eligible_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ranks</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">eligible_ranks</span> <span class="o">=</span> <span class="n">ranks</span><span class="p">[</span><span class="n">eligible_indices</span><span class="p">]</span>

    <span class="c1"># Determine the best and worst set of rankings in this list</span>
    <span class="n">worst_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">eligible_ranks</span><span class="p">)[</span><span class="o">-</span><span class="n">count</span><span class="p">:][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">worst_ranks</span> <span class="o">=</span> <span class="n">eligible_ranks</span><span class="p">[</span><span class="n">worst_indices</span><span class="p">]</span>
    <span class="n">best_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">eligible_ranks</span><span class="p">)[:</span><span class="n">count</span><span class="p">]</span>
    <span class="n">best_ranks</span> <span class="o">=</span> <span class="n">eligible_ranks</span><span class="p">[</span><span class="n">best_indices</span><span class="p">]</span>

    <span class="c1"># Calculate the sums</span>
    <span class="n">best_sum</span><span class="p">,</span> <span class="n">achieved_sum</span><span class="p">,</span> <span class="n">worst_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">best_ranks</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">achieved_ranks</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">worst_ranks</span><span class="p">)</span>

    <span class="c1"># Normalize this score and return it</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">achieved_sum</span> <span class="o">-</span> <span class="n">best_sum</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">worst_sum</span> <span class="o">-</span> <span class="n">best_sum</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="solutions.handling.calculate_additional_useful_metrics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_additional_useful_metrics</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">vp</span><span class="p">)</span></code>

<a href="#solutions.handling.calculate_additional_useful_metrics" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Add additional components to the "metrics" dictionary based on the parameters and value parameters.</p>
<p>Parameters:
    solution (dict): The dictionary containing the existing metrics.
    p (dict): The parameters dictionary.
    vp (dict): The value parameters dictionary.</p>
<p>Returns:
    solution (dict): The updated metrics dictionary.</p>
<p>Note:
    This function adds additional components to the "solution" dictionary based on the provided parameters
    and value parameters. The purpose is to enhance the information and analysis of the solution/metrics.</p>

            <details class="quote">
              <summary>Source code in <code>afccp/solutions/handling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_additional_useful_metrics</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">vp</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add additional components to the &quot;metrics&quot; dictionary based on the parameters and value parameters.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        solution (dict): The dictionary containing the existing metrics.</span>
<span class="sd">        p (dict): The parameters dictionary.</span>
<span class="sd">        vp (dict): The value parameters dictionary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        solution (dict): The updated metrics dictionary.</span>

<span class="sd">    Note:</span>
<span class="sd">        This function adds additional components to the &quot;solution&quot; dictionary based on the provided parameters</span>
<span class="sd">        and value parameters. The purpose is to enhance the information and analysis of the solution/metrics.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Only calculate these metrics if we have the right parameters</span>
    <span class="k">if</span> <span class="s1">&#39;c_pref_matrix&#39;</span> <span class="ow">in</span> <span class="n">p</span> <span class="ow">and</span> <span class="s1">&#39;a_pref_matrix&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>

        <span class="c1"># Calculate various metrics achieved</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_choice&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_choice&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_utility_achieved&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_utility_achieved&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;global_utility_achieved&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;j_array&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]:</span>
                <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_choice&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>  <span class="c1"># Assigned cadet choice</span>

                <span class="c1"># Cadet is not in the AFSC&#39;s preferences</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cadet&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;not in &#39;</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39;s preferences. This will cause an error.&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_choice&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Where is the cadet ranked</span>
                <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_utility_achieved&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_utility_achieved&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;global_utility_achieved&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;global_utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_choice&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Unassigned cadet choice</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;average_cadet_choice&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_choice&#39;</span><span class="p">][</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^Match&#39;</span><span class="p">]]),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Calculate average cadet choice for each AFSC individually</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_average_cadet_choice&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]:</span>
            <span class="n">cadets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;j_array&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_average_cadet_choice&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">][</span><span class="n">cadets</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>

        <span class="c1"># Calculate overall utility scores</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;z^gu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;global_utility_achieved&#39;</span><span class="p">][</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^Match&#39;</span><span class="p">]]),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_utility_overall&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_utility_achieved&#39;</span><span class="p">][</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^Match&#39;</span><span class="p">]]),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_utility_overall&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_utility_achieved&#39;</span><span class="p">][</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^Match&#39;</span><span class="p">]]),</span> <span class="mi">4</span><span class="p">)</span>

        <span class="c1"># Calculate cadet utility based on SOC</span>
        <span class="k">for</span> <span class="n">soc</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;SOCs&#39;</span><span class="p">]:</span>
            <span class="n">solution</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">soc</span><span class="si">}</span><span class="s1">_cadet_utility&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_utility_achieved&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">soc</span><span class="si">}</span><span class="s1">_cadets&#39;</span><span class="p">]]),</span> <span class="mi">4</span><span class="p">)</span>

    <span class="c1"># Cadet Choice Counts (For exporting solution file to excel)</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_choice_counts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">choice</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span>  <span class="c1"># Just looking at top 10</span>
        <span class="n">choice_cadets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_choice&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">choice</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_choice_counts&#39;</span><span class="p">][</span><span class="n">choice</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">choice_cadets</span><span class="p">,</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^Match&#39;</span><span class="p">]))</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_choice_counts&#39;</span><span class="p">][</span><span class="s1">&#39;All Others&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;Num Matched&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span>
        <span class="p">[</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_choice_counts&#39;</span><span class="p">][</span><span class="n">choice</span><span class="p">]</span> <span class="k">for</span> <span class="n">choice</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)]))</span>

    <span class="c1"># Save the counts for each AFSC separately from the objective_measure matrix</span>
    <span class="n">quota_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s1">&#39;objectives&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Combined Quota&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;objective_measure&#39;</span><span class="p">][:,</span> <span class="n">quota_k</span><span class="p">]</span>

    <span class="c1"># Assigned cadets</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadets_assigned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">j</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;j_array&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]}</span>

    <span class="c1"># Cadets assigned to each accession group</span>
    <span class="n">con_acc_grp_numerator</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">con_acc_grp_denominator</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">acc_grp</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_acc_grp&#39;</span><span class="p">]:</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">acc_grp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;j_array&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^&#39;</span> <span class="o">+</span> <span class="n">acc_grp</span><span class="p">]])</span>

        <span class="c1"># Determine if we constrained Accessions groups properly</span>
        <span class="k">if</span> <span class="s2">&quot;I^&quot;</span> <span class="o">+</span> <span class="n">acc_grp</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">acc_grp_constrained</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">acc_grp</span><span class="p">])</span>

            <span class="c1"># Calculate metrics if we actually constrained some people from this group</span>
            <span class="k">if</span> <span class="n">acc_grp_constrained</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">acc_grp_correct</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">acc_grp</span><span class="p">],</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">acc_grp</span><span class="p">]))</span>
                <span class="n">con_acc_grp_numerator</span> <span class="o">+=</span> <span class="n">acc_grp_correct</span>
                <span class="n">con_acc_grp_denominator</span> <span class="o">+=</span> <span class="n">acc_grp_constrained</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;constrained_acc_grp_target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">con_acc_grp_numerator</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; / &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">con_acc_grp_denominator</span><span class="p">)</span>

    <span class="c1"># Air Force Cadets</span>
    <span class="k">if</span> <span class="s1">&#39;USSF&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_acc_grp&#39;</span><span class="p">]:</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^USAF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^USSF&#39;</span><span class="p">]])</span>

    <span class="c1"># Calculate USSF Merit Distribution</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;ussf_om&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Just to have something to show</span>
    <span class="k">if</span> <span class="s1">&#39;USSF&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_acc_grp&#39;</span><span class="p">]:</span>

        <span class="c1"># Necessary variables to calculate</span>
        <span class="n">ussf_merit_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;merit&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^USSF&#39;</span><span class="p">])</span>
        <span class="n">ussf_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^USSF&#39;</span><span class="p">])</span>

        <span class="c1"># Calculate metric</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;ussf_om&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">ussf_merit_sum</span> <span class="o">/</span> <span class="n">ussf_sum</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="c1"># USSF/USAF cadet distinctions</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;ussf_cadets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;j_array&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^USSF&#39;</span><span class="p">]])</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;usaf_cadets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;j_array&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^USSF&#39;</span><span class="p">]])</span>

        <span class="c1"># Calculate cadet/AFSC utility relative to USSF/USAF cadets</span>
        <span class="k">for</span> <span class="n">service</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ussf&#39;</span><span class="p">,</span> <span class="s1">&#39;usaf&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cadet&#39;</span><span class="p">,</span> <span class="s1">&#39;afsc&#39;</span><span class="p">]:</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="n">service</span> <span class="o">+</span> <span class="s1">&#39;_cadets&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">solution</span><span class="p">[</span><span class="n">service</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">entity</span> <span class="o">+</span> <span class="s1">&#39;_utility&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="n">entity</span> <span class="o">+</span> <span class="s1">&#39;_utility_achieved&#39;</span><span class="p">][</span><span class="n">solution</span><span class="p">[</span><span class="n">service</span> <span class="o">+</span> <span class="s1">&#39;_cadets&#39;</span><span class="p">]]),</span> <span class="mi">4</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">solution</span><span class="p">[</span><span class="n">service</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">entity</span> <span class="o">+</span> <span class="s1">&#39;_utility&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># USSF SOC Breakout</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;ussf_usafa_cadets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;ussf_cadets&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;usafa_cadets&#39;</span><span class="p">])</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;ussf_rotc_cadets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;ussf_cadets&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rotc_cadets&#39;</span><span class="p">])</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;ussf_usafa_cadets_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;ussf_usafa_cadets&#39;</span><span class="p">])</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;ussf_rotc_cadets_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;ussf_rotc_cadets&#39;</span><span class="p">])</span>

        <span class="c1"># Metrics that will be printed to excel</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;ussf_usafa_pgl_target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;ussf_usafa_cadets_count&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; / &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;ussf_usafa_pgl&#39;</span><span class="p">])</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;ussf_rotc_pgl_target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;ussf_rotc_cadets_count&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; / &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;ussf_rotc_pgl&#39;</span><span class="p">])</span>

    <span class="c1"># Calculate weighted average AFSC choice (based on Norm Score)</span>
    <span class="k">if</span> <span class="s1">&#39;Norm Score&#39;</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;objectives&#39;</span><span class="p">]:</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s1">&#39;objectives&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Norm Score&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Individual norm scores for each AFSC</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_norm_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;objective_measure&#39;</span><span class="p">][:,</span> <span class="n">k</span><span class="p">]</span>

        <span class="c1"># Weighted average AFSC choice</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">])</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;weighted_average_afsc_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_norm_score&#39;</span><span class="p">])</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;weighted_average_nrl_afsc_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^NRL&#39;</span><span class="p">]]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^NRL&#39;</span><span class="p">]]),</span>
                                                             <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_norm_score&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^NRL&#39;</span><span class="p">]])</span>

        <span class="c1"># Space Force and Air Force differences</span>
        <span class="k">if</span> <span class="s1">&#39;USSF&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_acc_grp&#39;</span><span class="p">]:</span>

            <span class="c1"># Weighted average AFSC choice for USSF AFSCs (SFSCs)</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^USSF&#39;</span><span class="p">]]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^USSF&#39;</span><span class="p">]])</span>
            <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;weighted_average_ussf_afsc_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_norm_score&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^USSF&#39;</span><span class="p">]])</span>

            <span class="c1"># Weighted average AFSC choice for USAF AFSCs (AFSCs)</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^USAF&#39;</span><span class="p">]]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^USAF&#39;</span><span class="p">]])</span>
            <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;weighted_average_usaf_afsc_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_norm_score&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^USAF&#39;</span><span class="p">]])</span>

    <span class="c1"># Generate objective scores for each objective</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;K&#39;</span><span class="p">]:</span>
        <span class="n">new_weights</span> <span class="o">=</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;afsc_weight&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;objective_weight&#39;</span><span class="p">][:,</span> <span class="n">k</span><span class="p">]</span>
        <span class="n">new_weights</span> <span class="o">=</span> <span class="n">new_weights</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">new_weights</span><span class="p">)</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;objective_score&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">new_weights</span><span class="p">,</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;objective_value&#39;</span><span class="p">][:,</span> <span class="n">k</span><span class="p">])</span>

    <span class="c1"># SOC/Gender proportions across AFSCs</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;usafa_proportion_afscs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;usafa&#39;</span><span class="p">][</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadets_assigned&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]]),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]])</span>
    <span class="k">if</span> <span class="s1">&#39;male&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;male_proportion_afscs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;male&#39;</span><span class="p">][</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadets_assigned&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]]),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]])</span>

    <span class="c1"># SOC/Gender proportions across each Accession group</span>
    <span class="k">for</span> <span class="n">acc_grp</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_acc_grp&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">acc_grp</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;usafa_proportion_&#39;</span> <span class="o">+</span> <span class="n">acc_grp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;usafa&#39;</span><span class="p">][</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">acc_grp</span><span class="p">]]),</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;male&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;male_proportion_&#39;</span> <span class="o">+</span> <span class="n">acc_grp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;male&#39;</span><span class="p">][</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">acc_grp</span><span class="p">]]),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Simpson index</span>
    <span class="k">if</span> <span class="s1">&#39;race&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">races</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;race_categories&#39;</span><span class="p">]</span>  <span class="c1"># Shorthand (easier to type)</span>

        <span class="c1"># Calculate Simpson diversity index for each AFSC</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;simpson_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">])</span>  <span class="c1"># Initialize index array for all the AFSCs</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>  <span class="c1"># Just grabbing &quot;n&quot; as the number of cadets assigned to this AFSC</span>

            <span class="c1"># &quot;AFSC Cadets Race&quot; dictionary of the number of cadets that were assigned to this AFSC from each race</span>
            <span class="n">acr</span> <span class="o">=</span> <span class="p">{</span><span class="n">race</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">race</span><span class="p">],</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadets_assigned&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]))</span> <span class="k">for</span> <span class="n">race</span> <span class="ow">in</span> <span class="n">races</span><span class="p">}</span>

            <span class="c1"># Calculate simpson diversity index for this AFSC</span>
            <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;simpson_index&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([(</span><span class="n">acr</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">acr</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">races</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Calculate Simpson diversity index for each Accessions Group</span>
        <span class="k">for</span> <span class="n">acc_grp</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_acc_grp&#39;</span><span class="p">]:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">acc_grp</span><span class="p">])</span>  <span class="c1"># Just grabbing &quot;n&quot; as the number of cadets assigned to this acc group</span>

            <span class="c1"># &quot;Accessions Cadets Race&quot; dictionary of the number of cadets that were assigned to this grp from each race</span>
            <span class="n">acr</span> <span class="o">=</span> <span class="p">{</span><span class="n">race</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">race</span><span class="p">],</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">acc_grp</span><span class="p">]))</span> <span class="k">for</span> <span class="n">race</span> <span class="ow">in</span> <span class="n">races</span><span class="p">}</span>

            <span class="c1"># Calculate simpson diversity index for this accessions group</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;simpson_index_&#39;</span> <span class="o">+</span> <span class="n">acc_grp</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                    <span class="p">[(</span><span class="n">acr</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">acr</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">races</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;simpson_index_&#39;</span> <span class="o">+</span> <span class="n">acc_grp</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Simpson index (Ethnicity)</span>
    <span class="k">if</span> <span class="s1">&#39;ethnicity&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">eths</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;ethnicity_categories&#39;</span><span class="p">]</span>  <span class="c1"># Shorthand (easier to type)</span>

        <span class="c1"># Calculate Simpson diversity index for each AFSC</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;simpson_index_eth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">])</span>  <span class="c1"># Initialize index array for all the AFSCs</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>  <span class="c1"># Just grabbing &quot;n&quot; as the number of cadets assigned to this AFSC</span>

            <span class="c1"># &quot;AFSC Cadets Ethnicity&quot; dictionary of the number of cadets that were assigned to this AFSC from each eth</span>
            <span class="n">ace</span> <span class="o">=</span> <span class="p">{</span><span class="n">eth</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">eth</span><span class="p">],</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadets_assigned&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]))</span> <span class="k">for</span> <span class="n">eth</span> <span class="ow">in</span> <span class="n">eths</span><span class="p">}</span>

            <span class="c1"># Calculate simpson diversity index for this AFSC</span>
            <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;simpson_index_eth&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span>
                <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([(</span><span class="n">ace</span><span class="p">[</span><span class="n">eth</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">ace</span><span class="p">[</span><span class="n">eth</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">eth</span> <span class="ow">in</span> <span class="n">eths</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Calculate Simpson diversity index for each Accessions Group</span>
        <span class="k">for</span> <span class="n">acc_grp</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_acc_grp&#39;</span><span class="p">]:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">acc_grp</span><span class="p">])</span>  <span class="c1"># Just grabbing &quot;n&quot; as the number of cadets assigned to this acc group</span>

            <span class="c1"># &quot;Accessions Cadets Ethnicity&quot; dictionary of the number of cadets that were assigned to this grp/from eth</span>
            <span class="n">ace</span> <span class="o">=</span> <span class="p">{</span><span class="n">eth</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">eth</span><span class="p">],</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">acc_grp</span><span class="p">]))</span> <span class="k">for</span> <span class="n">eth</span> <span class="ow">in</span> <span class="n">eths</span><span class="p">}</span>

            <span class="c1"># Calculate simpson diversity index for this accessions group</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;simpson_index_eth_&#39;</span> <span class="o">+</span> <span class="n">acc_grp</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                    <span class="p">[(</span><span class="n">ace</span><span class="p">[</span><span class="n">eth</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">ace</span><span class="p">[</span><span class="n">eth</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">eth</span> <span class="ow">in</span> <span class="n">eths</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;simpson_index_eth_&#39;</span> <span class="o">+</span> <span class="n">acc_grp</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Calculate STEM proportions in each AFSC</span>
    <span class="k">if</span> <span class="s1">&#39;stem&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># Initialize dictionaries for cadet choice based on demographics</span>
    <span class="n">dd</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;usafa&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">soc</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">soc</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;SOCs&#39;</span><span class="p">]],</span> <span class="s2">&quot;male&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Male&quot;</span><span class="p">,</span> <span class="s2">&quot;Female&quot;</span><span class="p">]}</span>  <span class="c1"># Demographic Dictionary</span>
    <span class="n">demographic_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">cat</span><span class="p">:</span> <span class="p">[</span><span class="n">dd</span><span class="p">[</span><span class="n">cat</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dd</span><span class="p">[</span><span class="n">cat</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">dd</span> <span class="k">if</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">p</span><span class="p">}</span>  <span class="c1"># Demographic Dictionary (For this instance)</span>
    <span class="n">solution</span><span class="p">[</span><span class="s2">&quot;choice_counts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;TOTAL&quot;</span><span class="p">:</span> <span class="p">{}}</span>  <span class="c1"># Everyone</span>
    <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">demographic_dict</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">dem</span> <span class="ow">in</span> <span class="n">demographic_dict</span><span class="p">[</span><span class="n">cat</span><span class="p">]:</span>
            <span class="n">solution</span><span class="p">[</span><span class="s2">&quot;choice_counts&quot;</span><span class="p">][</span><span class="n">dem</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Top 3 Choices from USSF and USAF (and ROTC/USAFA)</span>
    <span class="k">if</span> <span class="s1">&#39;USSF&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs_acc_grp&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;USSF&#39;</span><span class="p">,</span> <span class="s1">&#39;USAF&#39;</span><span class="p">]:</span>

            <span class="c1"># Might not have anyone assigned from this group</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">cat</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;top_3_&#39;</span> <span class="o">+</span> <span class="n">cat</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">continue</span>

            <span class="c1"># Calculate actual top 3 count</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">cat</span><span class="p">]</span> <span class="k">if</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;j_array&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="mi">3</span><span class="p">]])</span>
            <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;top_3_&#39;</span> <span class="o">+</span> <span class="n">cat</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">cat</span><span class="p">]),</span> <span class="mi">4</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;usafa&#39;</span><span class="p">]:</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">cat</span><span class="p">]</span> <span class="k">if</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;j_array&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="mi">3</span><span class="p">]])</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;top_3_&#39;</span> <span class="o">+</span> <span class="n">cat</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^&#39;</span> <span class="o">+</span> <span class="n">cat</span><span class="p">]),</span> <span class="mi">4</span><span class="p">)</span>

    <span class="c1"># Initialize arrays within the choice dictionaries for the AFSCs</span>
    <span class="n">choice_categories</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Top 3&quot;</span><span class="p">,</span> <span class="s2">&quot;Next 3&quot;</span><span class="p">,</span> <span class="s2">&quot;All Others&quot;</span><span class="p">,</span> <span class="s2">&quot;Total&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">dem</span> <span class="ow">in</span> <span class="n">solution</span><span class="p">[</span><span class="s2">&quot;choice_counts&quot;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">c_cat</span> <span class="ow">in</span> <span class="n">choice_categories</span><span class="p">:</span>
            <span class="n">solution</span><span class="p">[</span><span class="s2">&quot;choice_counts&quot;</span><span class="p">][</span><span class="n">dem</span><span class="p">][</span><span class="n">c_cat</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;afscs&quot;</span><span class="p">]:</span>
            <span class="n">solution</span><span class="p">[</span><span class="s2">&quot;choice_counts&quot;</span><span class="p">][</span><span class="n">dem</span><span class="p">][</span><span class="n">afsc</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1"># AFSC choice</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_choice_counts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">cat_bound_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;90-100%&#39;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span> <span class="s1">&#39;80-89%&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s1">&#39;70-79%&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span> <span class="s1">&#39;60-69%&#39;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span> <span class="s1">&#39;50-59%&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
                      <span class="s1">&#39;40-49%&#39;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span> <span class="s1">&#39;30-39%&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s1">&#39;20-29%&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;10-19%&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;0-10%&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

    <span class="c1"># Loop through each AFSC</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;afscs&quot;</span><span class="p">][:</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]]):</span>  <span class="c1"># Skip unmatched AFSC</span>

        <span class="c1"># The cadets that were assigned to this AFSC</span>
        <span class="n">dem_cadets</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;TOTAL&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s2">&quot;afsc_array&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">afsc</span><span class="p">)[</span><span class="mi">0</span><span class="p">]}</span>

        <span class="c1"># The cadets with the demographic that were assigned to this AFSC</span>
        <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">demographic_dict</span><span class="p">:</span>
            <span class="n">dem_1</span><span class="p">,</span> <span class="n">dem_2</span> <span class="o">=</span> <span class="n">demographic_dict</span><span class="p">[</span><span class="n">cat</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">demographic_dict</span><span class="p">[</span><span class="n">cat</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">dem_cadets</span><span class="p">[</span><span class="n">dem_1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dem_cadets</span><span class="p">[</span><span class="s2">&quot;TOTAL&quot;</span><span class="p">])</span>
            <span class="n">dem_cadets</span><span class="p">[</span><span class="n">dem_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dem_cadets</span><span class="p">[</span><span class="s2">&quot;TOTAL&quot;</span><span class="p">])</span>

        <span class="n">afsc_utilities</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_utility&#39;</span><span class="p">][</span><span class="n">dem_cadets</span><span class="p">[</span><span class="s1">&#39;TOTAL&#39;</span><span class="p">],</span> <span class="n">j</span><span class="p">]</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_choice_counts&#39;</span><span class="p">][</span><span class="n">afsc</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">cat</span><span class="p">,</span> <span class="n">bound</span> <span class="ow">in</span> <span class="n">cat_bound_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="k">if</span> <span class="n">cat</span> <span class="o">==</span> <span class="s1">&#39;90-100%&#39;</span><span class="p">:</span>
                <span class="n">condition</span> <span class="o">=</span> <span class="p">(</span><span class="n">afsc_utilities</span> <span class="o">&gt;=</span> <span class="n">bound</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">afsc_utilities</span> <span class="o">&lt;=</span> <span class="n">bound</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">condition</span> <span class="o">=</span> <span class="p">(</span><span class="n">afsc_utilities</span> <span class="o">&gt;=</span> <span class="n">bound</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">afsc_utilities</span> <span class="o">&lt;</span> <span class="n">bound</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">)</span>
            <span class="n">cadets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">condition</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_choice_counts&#39;</span><span class="p">][</span><span class="n">afsc</span><span class="p">][</span><span class="n">cat</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cadets</span><span class="p">)</span>

        <span class="c1"># Loop through each choice and calculate the metric</span>
        <span class="k">for</span> <span class="n">choice</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">]):</span>

            <span class="c1"># The cadets that were assigned to this AFSC and placed it in their Pth choice</span>
            <span class="n">assigned_choice_cadets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;I^Choice&quot;</span><span class="p">][</span><span class="n">choice</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">dem_cadets</span><span class="p">[</span><span class="s2">&quot;TOTAL&quot;</span><span class="p">])</span>

            <span class="c1"># The cadets that were assigned to this AFSC, placed it in their Pth choice, and had the demographic</span>
            <span class="k">for</span> <span class="n">dem</span> <span class="ow">in</span> <span class="n">solution</span><span class="p">[</span><span class="s2">&quot;choice_counts&quot;</span><span class="p">]:</span>
                <span class="n">solution</span><span class="p">[</span><span class="s2">&quot;choice_counts&quot;</span><span class="p">][</span><span class="n">dem</span><span class="p">][</span><span class="n">afsc</span><span class="p">][</span><span class="n">choice</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">assigned_choice_cadets</span><span class="p">,</span> <span class="n">dem_cadets</span><span class="p">[</span><span class="n">dem</span><span class="p">]))</span>

        <span class="c1"># Loop through each demographic</span>
        <span class="k">for</span> <span class="n">dem</span> <span class="ow">in</span> <span class="n">solution</span><span class="p">[</span><span class="s2">&quot;choice_counts&quot;</span><span class="p">]:</span>
            <span class="n">solution</span><span class="p">[</span><span class="s2">&quot;choice_counts&quot;</span><span class="p">][</span><span class="n">dem</span><span class="p">][</span><span class="s2">&quot;Total&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dem_cadets</span><span class="p">[</span><span class="n">dem</span><span class="p">]))</span>
            <span class="n">solution</span><span class="p">[</span><span class="s2">&quot;choice_counts&quot;</span><span class="p">][</span><span class="n">dem</span><span class="p">][</span><span class="s2">&quot;Top 3&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s2">&quot;choice_counts&quot;</span><span class="p">][</span><span class="n">dem</span><span class="p">][</span><span class="n">afsc</span><span class="p">][:</span><span class="mi">3</span><span class="p">]))</span>
            <span class="n">solution</span><span class="p">[</span><span class="s2">&quot;choice_counts&quot;</span><span class="p">][</span><span class="n">dem</span><span class="p">][</span><span class="s2">&quot;Next 3&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s2">&quot;choice_counts&quot;</span><span class="p">][</span><span class="n">dem</span><span class="p">][</span><span class="n">afsc</span><span class="p">][</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]))</span>
            <span class="n">solution</span><span class="p">[</span><span class="s2">&quot;choice_counts&quot;</span><span class="p">][</span><span class="n">dem</span><span class="p">][</span><span class="s2">&quot;All Others&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span>
                <span class="n">dem_cadets</span><span class="p">[</span><span class="n">dem</span><span class="p">])</span> <span class="o">-</span> <span class="n">solution</span><span class="p">[</span><span class="s2">&quot;choice_counts&quot;</span><span class="p">][</span><span class="n">dem</span><span class="p">][</span><span class="s2">&quot;Top 3&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">solution</span><span class="p">[</span><span class="s2">&quot;choice_counts&quot;</span><span class="p">][</span><span class="n">dem</span><span class="p">][</span><span class="s2">&quot;Next 3&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>

    <span class="c1"># Top 3 Choice Percentage</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;top_3_choice_percent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_choice&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">3</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;I^Match&#39;</span><span class="p">]])</span> <span class="o">/</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;Num Matched&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">solution</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="solutions.handling.calculate_base_training_metrics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_base_training_metrics</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">vp</span><span class="p">)</span></code>

<a href="#solutions.handling.calculate_base_training_metrics" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Add additional base/training components to the "solution" dictionary based on the parameters and value parameters.</p>

            <details class="quote">
              <summary>Source code in <code>afccp/solutions/handling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_base_training_metrics</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">vp</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add additional base/training components to the &quot;solution&quot; dictionary based on the parameters and value parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Initialize arrays</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;base_choice&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;base_utility_achieved&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;course_utility_achieved&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_state_achieved&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_value_achieved&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span>

    <span class="c1"># Weights Implemented</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_weight_used&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;base_weight_used&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;course_weight_used&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;state_utility_used&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span>

    <span class="c1"># Loop through each cadet to load in their values to each of the above</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;j_array&#39;</span><span class="p">]):</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;b_array&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;c_array&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Determine what state this cadet achieved</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^State&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_state_achieved&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>

        <span class="c1"># Base-components depend on base outcome</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]:</span>
            <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;base_choice&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;b_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span>
            <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;base_utility_achieved&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;base_utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span>
            <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;base_weight_used&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^B&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;base_choice&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;base_utility_achieved&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;base_weight_used&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Load other components</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;course_utility_achieved&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;course_utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">c</span><span class="p">]</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_weight_used&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^A&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;course_weight_used&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^C&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;state_utility_used&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;u^S&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span>

        <span class="c1"># Calculate Cadet Value</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_value_achieved&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;u^S&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^A&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;u^S&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">])</span> <span class="o">+</span>
                <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;base_weight_used&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;base_utility_achieved&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span>
                <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^C&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">*</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;course_utility_achieved&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>

    <span class="c1"># Calculate adjusted Z value (VFT) and associated metrics</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_value_achieved&#39;</span><span class="p">]</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadets_overall_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s1">&#39;cadet_weight&#39;</span><span class="p">],</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadet_value&#39;</span><span class="p">])</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;cadets_overall_weight&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadets_overall_value&#39;</span><span class="p">]</span> <span class="o">+</span> \
                    <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;afscs_overall_weight&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afscs_overall_value&#39;</span><span class="p">]</span>

    <span class="c1"># Calculate adjusted Z value (GUO)</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;z^gu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;afscs_overall_weight&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;afsc_utility_achieved&#39;</span><span class="p">])</span> <span class="o">+</span> \
                       <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;cadets_overall_weight&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;cadets_overall_value&#39;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">solution</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="solutions.handling.calculate_castle_solution_metrics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_castle_solution_metrics</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span></code>

<a href="#solutions.handling.calculate_castle_solution_metrics" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Add CASTLE-specific solution metrics</p>

            <details class="quote">
              <summary>Source code in <code>afccp/solutions/handling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_castle_solution_metrics</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add CASTLE-specific solution metrics</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Shorthand</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;castle_q&#39;</span><span class="p">]</span>

    <span class="c1"># Loop through each CASTLE AFSC to calculate the numbers of people assigned</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;castle_counts&#39;</span><span class="p">],</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;castle_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
    <span class="n">afscs</span> <span class="o">=</span> <span class="p">[</span><span class="n">afsc</span> <span class="k">for</span> <span class="n">afsc</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^CASTLE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="k">for</span> <span class="n">afsc</span><span class="p">,</span> <span class="n">j_indices</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^CASTLE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

        <span class="c1"># Get the number of people assigned to each AFSC under this &quot;CASTLE&quot; AFSC umbrella</span>
        <span class="n">measure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">j_indices</span><span class="p">)</span>

        <span class="c1"># (+ ADD OTS if they&#39;re not being matched!!)</span>
        <span class="k">if</span> <span class="s1">&#39;ots&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;SOCs&#39;</span><span class="p">]:</span>
            <span class="n">measure</span> <span class="o">+=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;ots_counts&#39;</span><span class="p">][</span><span class="n">afsc</span><span class="p">]</span>

        <span class="c1"># Save the measure</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;castle_counts&#39;</span><span class="p">][</span><span class="n">afsc</span><span class="p">]</span> <span class="o">=</span> <span class="n">measure</span>

        <span class="c1"># Get the value from this AFSC&#39;s curve</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">value_function</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="n">afsc</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="s1">&#39;f^hat&#39;</span><span class="p">][</span><span class="n">afsc</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">afsc</span><span class="p">],</span> <span class="n">measure</span><span class="p">)</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;castle_v&#39;</span><span class="p">][</span><span class="n">afsc</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="c1"># Calculate &quot;z^CASTLE&quot;</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;z^CASTLE (Values)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;castle_v&#39;</span><span class="p">][</span><span class="n">afsc</span><span class="p">]</span> <span class="k">for</span> <span class="n">afsc</span> <span class="ow">in</span> <span class="n">afscs</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;z^CASTLE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^G&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;z^gu&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;w^G&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;z^CASTLE (Values)&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">solution</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="solutions.handling.calculate_objective_measure_chromosome" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_objective_measure_chromosome</span><span class="p">(</span><span class="n">cadets</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">objective</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span></code>

<a href="#solutions.handling.calculate_objective_measure_chromosome" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculates the AFSC objective measure based on the provided parameters.</p>
<p>Parameters:
    cadets (list): List of cadets.
    j (int): AFSC index.
    objective (str): Objective for which to calculate the measure.
    p (dict): Parameters used in the calculations.
    vp (dict): Value parameters used in the calculations.
    count (int): Number of cadets.</p>
<p>Returns:
    measure (float): The calculated AFSC objective measure.</p>
<p>Note:
    The function assumes an "exact" model since it's used in the fitness function.
    The measure is calculated based on the objective and the provided inputs.</p>

            <details class="quote">
              <summary>Source code in <code>afccp/solutions/handling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_objective_measure_chromosome</span><span class="p">(</span><span class="n">cadets</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">objective</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the AFSC objective measure based on the provided parameters.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        cadets (list): List of cadets.</span>
<span class="sd">        j (int): AFSC index.</span>
<span class="sd">        objective (str): Objective for which to calculate the measure.</span>
<span class="sd">        p (dict): Parameters used in the calculations.</span>
<span class="sd">        vp (dict): Value parameters used in the calculations.</span>
<span class="sd">        count (int): Number of cadets.</span>

<span class="sd">    Returns:</span>
<span class="sd">        measure (float): The calculated AFSC objective measure.</span>

<span class="sd">    Note:</span>
<span class="sd">        The function assumes an &quot;exact&quot; model since it&#39;s used in the fitness function.</span>
<span class="sd">        The measure is calculated based on the objective and the provided inputs.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Objective to balance some demographic of the cadets (binary indicator)</span>
    <span class="k">if</span> <span class="n">objective</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;K^D&#39;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^D&#39;</span><span class="p">][</span><span class="n">objective</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">cadets</span><span class="p">))</span> <span class="o">/</span> <span class="n">count</span>

    <span class="c1"># Balancing Merit</span>
    <span class="k">elif</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;Merit&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;merit&#39;</span><span class="p">][</span><span class="n">cadets</span><span class="p">])</span>

    <span class="c1"># &quot;Number of Cadets&quot; Objectives</span>
    <span class="k">elif</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;Combined Quota&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">count</span>
    <span class="k">elif</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;USAFA Quota&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;usafa_cadets&#39;</span><span class="p">],</span> <span class="n">cadets</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;ROTC Quota&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rotc_cadets&#39;</span><span class="p">],</span> <span class="n">cadets</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;OTS Quota&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;ots_cadets&#39;</span><span class="p">],</span> <span class="n">cadets</span><span class="p">))</span>

    <span class="c1"># Maximize cadet utility</span>
    <span class="k">elif</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;Utility&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_utility&#39;</span><span class="p">][</span><span class="n">cadets</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>

    <span class="c1"># New objective to evaluate CFM preference lists</span>
    <span class="k">elif</span> <span class="n">objective</span> <span class="o">==</span> <span class="s2">&quot;Norm Score&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">calculate_afsc_norm_score</span><span class="p">(</span><span class="n">cadets</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="solutions.handling.calculate_objective_measure_matrix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_objective_measure_matrix</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">objective</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">approximate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#solutions.handling.calculate_objective_measure_matrix" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculates the AFSC objective measure based on the provided parameters.</p>
<p>Parameters:
    x (ndarray): Matrix representing the assignment of cadets to AFSCs.
    j (int): AFSC index.
    objective (str): Objective for which to calculate the measure.
    p (dict): Parameters used in the calculations.
    vp (dict): Value parameters used in the calculations.
    approximate (bool, optional): Flag indicating whether to use an approximate measure (divide by estimated number
        of cadets, not the REAL number af cadets assigned to the AFSC. Defaults to True.</p>
<p>Returns:
    measure (float): The calculated AFSC objective measure.
    numerator (float or None): The numerator used in the calculation of the measure.
        It is None for certain objectives.</p>
<p>Raises:
    ValueError: If the provided objective does not have a means of calculation in the VFT model.</p>
<p>Note:
    The measure and numerator are calculated based on the objective and the provided inputs.
    The numerator is the value used in the calculation of the measure (sum of cadets with some feature over the
    "num_cadets" variable which is either the actual number of cadets assigned (count) or estimated (quota_e).</p>

            <details class="quote">
              <summary>Source code in <code>afccp/solutions/handling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_objective_measure_matrix</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">objective</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">approximate</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the AFSC objective measure based on the provided parameters.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        x (ndarray): Matrix representing the assignment of cadets to AFSCs.</span>
<span class="sd">        j (int): AFSC index.</span>
<span class="sd">        objective (str): Objective for which to calculate the measure.</span>
<span class="sd">        p (dict): Parameters used in the calculations.</span>
<span class="sd">        vp (dict): Value parameters used in the calculations.</span>
<span class="sd">        approximate (bool, optional): Flag indicating whether to use an approximate measure (divide by estimated number</span>
<span class="sd">            of cadets, not the REAL number af cadets assigned to the AFSC. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        measure (float): The calculated AFSC objective measure.</span>
<span class="sd">        numerator (float or None): The numerator used in the calculation of the measure.</span>
<span class="sd">            It is None for certain objectives.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the provided objective does not have a means of calculation in the VFT model.</span>

<span class="sd">    Note:</span>
<span class="sd">        The measure and numerator are calculated based on the objective and the provided inputs.</span>
<span class="sd">        The numerator is the value used in the calculation of the measure (sum of cadets with some feature over the</span>
<span class="sd">        &quot;num_cadets&quot; variable which is either the actual number of cadets assigned (count) or estimated (quota_e).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get count variables for this AFSC</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">approximate</span><span class="p">:</span>
        <span class="n">num_cadets</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;quota_e&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>  <span class="c1"># estimated number of cadets</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">num_cadets</span> <span class="o">=</span> <span class="n">count</span>  <span class="c1"># actual number of cadets</span>

    <span class="c1"># Objective to balance some demographic of the cadets (binary indicator)</span>
    <span class="k">if</span> <span class="n">objective</span> <span class="ow">in</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;K^D&#39;</span><span class="p">]:</span>
        <span class="n">numerator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^D&#39;</span><span class="p">][</span><span class="n">objective</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">num_cadets</span><span class="p">,</span> <span class="n">numerator</span> <span class="c1"># Measure, Numerator</span>

    <span class="c1"># Balancing Merit</span>
    <span class="k">elif</span> <span class="n">objective</span> <span class="o">==</span> <span class="s2">&quot;Merit&quot;</span><span class="p">:</span>
        <span class="n">numerator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;merit&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">num_cadets</span><span class="p">,</span> <span class="n">numerator</span> <span class="c1"># Measure, Numerator</span>

    <span class="c1"># &quot;Number of Cadets&quot; Objectives</span>
    <span class="k">elif</span> <span class="n">objective</span> <span class="o">==</span> <span class="s2">&quot;Combined Quota&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">count</span><span class="p">,</span> <span class="kc">None</span> <span class="c1"># Measure, Numerator</span>
    <span class="k">elif</span> <span class="n">objective</span> <span class="o">==</span> <span class="s2">&quot;USAFA Quota&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;usafa_cadets&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])),</span> <span class="kc">None</span> <span class="c1"># Measure, Numerator</span>
    <span class="k">elif</span> <span class="n">objective</span> <span class="o">==</span> <span class="s2">&quot;ROTC Quota&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rotc_cadets&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])),</span> <span class="kc">None</span>  <span class="c1"># Measure, Numerator</span>
    <span class="k">elif</span> <span class="n">objective</span> <span class="o">==</span> <span class="s2">&quot;OTS Quota&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;ots_cadets&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])),</span> <span class="kc">None</span>  <span class="c1"># Measure, Numerator</span>

    <span class="c1"># Maximize cadet utility</span>
    <span class="k">elif</span> <span class="n">objective</span> <span class="o">==</span> <span class="s2">&quot;Utility&quot;</span><span class="p">:</span>
        <span class="n">numerator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">num_cadets</span><span class="p">,</span> <span class="n">numerator</span>  <span class="c1"># Measure, Numerator</span>

    <span class="c1"># New objective to evaluate CFM preference lists</span>
    <span class="k">elif</span> <span class="n">objective</span> <span class="o">==</span> <span class="s2">&quot;Norm Score&quot;</span><span class="p">:</span>

        <span class="c1"># Proxy for constraint purposes</span>
        <span class="n">numerator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_utility&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>

        <span class="c1"># Temporary placeholder- need better methodology for calculating Norm Score in &quot;Exact Model&quot;!</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">num_cadets</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]:</span>
            <span class="n">num_cadets</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;quota_e&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>

        <span class="c1"># Actual objective measure</span>
        <span class="n">best_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cadets</span><span class="p">)</span>
        <span class="n">best_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">best_range</span><span class="p">)</span>
        <span class="n">worst_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;num_eligible&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">num_cadets</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;num_eligible&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
        <span class="n">worst_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">worst_range</span><span class="p">)</span>
        <span class="n">achieved_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;a_pref_matrix&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;I^E&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">achieved_sum</span> <span class="o">-</span> <span class="n">best_sum</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">worst_sum</span> <span class="o">-</span> <span class="n">best_sum</span><span class="p">),</span> <span class="n">numerator</span>  <span class="c1"># Measure, Numerator</span>

    <span class="c1"># Unrecognized objective</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error. Objective &#39;&quot;</span> <span class="o">+</span> <span class="n">objective</span> <span class="o">+</span> <span class="s2">&quot;&#39; does not have a means of calculation in the&quot;</span>
                                                            <span class="s2">&quot; VFT model. Please adjust.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="solutions.handling.calculate_failed_constraint_metrics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_failed_constraint_metrics</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">solution</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">vp</span><span class="p">)</span></code>

<a href="#solutions.handling.calculate_failed_constraint_metrics" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate failed constraint metrics for an AFSC objective and return the updated metrics dictionary.</p>
<p>Parameters:
    j (int): Index of the AFSC objective.
    k (int): Index of the objective measure.
    solution (dict): The solution/metrics dictionary.
    p (dict): The fixed cadet/AFSC model parameters.
    vp (dict): The weight/value parameters.</p>
<p>Returns:
    solution (dict): The updated solution/metrics dictionary.</p>
<p>Note:
    This function calculates the failed constraint metrics for an AFSC objective and updates the metrics dictionary
    with the newly calculated values.</p>

            <details class="quote">
              <summary>Source code in <code>afccp/solutions/handling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_failed_constraint_metrics</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">solution</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">vp</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate failed constraint metrics for an AFSC objective and return the updated metrics dictionary.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        j (int): Index of the AFSC objective.</span>
<span class="sd">        k (int): Index of the objective measure.</span>
<span class="sd">        solution (dict): The solution/metrics dictionary.</span>
<span class="sd">        p (dict): The fixed cadet/AFSC model parameters.</span>
<span class="sd">        vp (dict): The weight/value parameters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        solution (dict): The updated solution/metrics dictionary.</span>

<span class="sd">    Note:</span>
<span class="sd">        This function calculates the failed constraint metrics for an AFSC objective and updates the metrics dictionary</span>
<span class="sd">        with the newly calculated values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Constrained Approximate Measure (Only meant for degree tier constraints)</span>
    <span class="k">if</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;constraint_type&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Should be an &quot;at least constraint&quot;</span>

        <span class="c1"># Get count variable</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
        <span class="n">constrained_measure</span> <span class="o">=</span> <span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;objective_measure&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">count</span><span class="p">)</span> <span class="o">/</span> <span class="nb">min</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;quota_min&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;pgl&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>

    <span class="c1"># Constrained Exact Measure</span>
    <span class="k">elif</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;constraint_type&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># Should be either an &quot;at most constraint&quot; or simple valid range (0.2, 0.4)</span>
        <span class="n">constrained_measure</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;objective_measure&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># Measure is below the range</span>
    <span class="k">if</span> <span class="n">constrained_measure</span> <span class="o">&lt;</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;objective_min&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]:</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;objective_constraint_fail&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> \
            <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">constrained_measure</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; &lt; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s1">&#39;objective_min&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;. &#39;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">constrained_measure</span> <span class="o">/</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;objective_min&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;% Met.&#39;</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;total_failed_constraints&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">solution</span><span class="p">[</span><span class="s2">&quot;failed_constraints&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;objectives&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
        <span class="n">solution</span><span class="p">[</span><span class="s2">&quot;con_fail_dict&quot;</span><span class="p">][(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="s1">&#39;&gt; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">constrained_measure</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

    <span class="c1"># Measure is above the range</span>
    <span class="k">elif</span> <span class="n">constrained_measure</span> <span class="o">&gt;</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;objective_max&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]:</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;objective_constraint_fail&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> \
            <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">constrained_measure</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; &gt; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">vp</span><span class="p">[</span><span class="s1">&#39;objective_max&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;. &#39;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;objective_max&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">constrained_measure</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;% Met.&#39;</span>
        <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;total_failed_constraints&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">solution</span><span class="p">[</span><span class="s2">&quot;failed_constraints&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">vp</span><span class="p">[</span><span class="s1">&#39;objectives&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
        <span class="n">solution</span><span class="p">[</span><span class="s2">&quot;con_fail_dict&quot;</span><span class="p">][(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="s1">&#39;&lt; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">constrained_measure</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">solution</span>  <span class="c1"># Return *updated* solution/metrics</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="solutions.handling.check_failed_constraint_chromosome" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_failed_constraint_chromosome</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">measure</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">con_fail_dict</span><span class="p">)</span></code>

<a href="#solutions.handling.check_failed_constraint_chromosome" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>This function takes in the AFSC index, objective index, AFSC objective measure, number of cadets assigned (count),
parameters, value parameters, and the constraint fail dictionary and determines if we've failed the constraint or not.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>j</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the AFSC (Air Force Specialty Code).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>k</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the objective.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>measure</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Measure of the AFSC objective.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>count</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of cadets assigned.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>p</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of parameters. - 'quota_min': Array of minimum quotas for each AFSC. - 'pgl': Array of Program Guidance Letter (PGL) targets for each AFSC.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>vp</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of value parameters. - 'constraint_type': Array representing the constraint type for each AFSC and objective. - 1 represents Constrained Approximate Measure. - 2 represents Constrained Exact Measure. - 'objective_min': Array representing the minimum objective value for each AFSC and objective. - 'objective_max': Array representing the maximum objective value for each AFSC and objective.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>con_fail_dict</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing information about failed constraints (optional). - Keys are tuples (j, k) representing AFSC and objective indices. - Values are strings representing adjusted min/max values for the failed constraint. - If the string starts with '&gt;', it means the minimum value needed should be lowered. - Otherwise, it means the maximum value allowed should be raised.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A boolean indicating whether the constraint is failed or not. - True if the measure is outside the constrained range (constraint failed). - False if the measure is within the constrained range (constraint passed).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>afccp/solutions/handling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_failed_constraint_chromosome</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">measure</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">con_fail_dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function takes in the AFSC index, objective index, AFSC objective measure, number of cadets assigned (count),</span>
<span class="sd">    parameters, value parameters, and the constraint fail dictionary and determines if we&#39;ve failed the constraint or not.</span>

<span class="sd">    :param j: Index of the AFSC (Air Force Specialty Code).</span>
<span class="sd">    :param k: Index of the objective.</span>
<span class="sd">    :param measure: Measure of the AFSC objective.</span>
<span class="sd">    :param count: Number of cadets assigned.</span>
<span class="sd">    :param p: Dictionary of parameters.</span>
<span class="sd">        - &#39;quota_min&#39;: Array of minimum quotas for each AFSC.</span>
<span class="sd">        - &#39;pgl&#39;: Array of Program Guidance Letter (PGL) targets for each AFSC.</span>
<span class="sd">    :param vp: Dictionary of value parameters.</span>
<span class="sd">        - &#39;constraint_type&#39;: Array representing the constraint type for each AFSC and objective.</span>
<span class="sd">            - 1 represents Constrained Approximate Measure.</span>
<span class="sd">            - 2 represents Constrained Exact Measure.</span>
<span class="sd">        - &#39;objective_min&#39;: Array representing the minimum objective value for each AFSC and objective.</span>
<span class="sd">        - &#39;objective_max&#39;: Array representing the maximum objective value for each AFSC and objective.</span>
<span class="sd">    :param con_fail_dict: Dictionary containing information about failed constraints (optional).</span>
<span class="sd">        - Keys are tuples (j, k) representing AFSC and objective indices.</span>
<span class="sd">        - Values are strings representing adjusted min/max values for the failed constraint.</span>
<span class="sd">            - If the string starts with &#39;&gt;&#39;, it means the minimum value needed should be lowered.</span>
<span class="sd">            - Otherwise, it means the maximum value allowed should be raised.</span>

<span class="sd">    :return: A boolean indicating whether the constraint is failed or not.</span>
<span class="sd">        - True if the measure is outside the constrained range (constraint failed).</span>
<span class="sd">        - False if the measure is within the constrained range (constraint passed).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Constrained Approximate Measure (Only meant for degree tier constraints)</span>
    <span class="k">if</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;constraint_type&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Should be an &quot;at least constraint&quot;</span>
        <span class="n">constrained_measure</span> <span class="o">=</span> <span class="p">(</span><span class="n">measure</span> <span class="o">*</span> <span class="n">count</span><span class="p">)</span> <span class="o">/</span> <span class="nb">min</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;quota_min&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;pgl&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>

    <span class="c1"># Constrained Exact Measure</span>
    <span class="k">elif</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;constraint_type&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># Should be either an &quot;at most constraint&quot; or simple valid range (0.2, 0.4)</span>
        <span class="n">constrained_measure</span> <span class="o">=</span> <span class="n">measure</span>

    <span class="c1"># The constrained min and max values as specified by the value parameters</span>
    <span class="n">constrained_min</span><span class="p">,</span> <span class="n">constrained_max</span> <span class="o">=</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;objective_min&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="n">vp</span><span class="p">[</span><span class="s2">&quot;objective_max&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>

    <span class="c1"># We adjust the constrained min and max based on the pyomo solution since it could be a little off due to rounding</span>
    <span class="k">if</span> <span class="n">con_fail_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">in</span> <span class="n">con_fail_dict</span><span class="p">:</span>

            <span class="c1"># Split up the value in the dictionary to get the new min and max</span>
            <span class="n">split_list</span> <span class="o">=</span> <span class="n">con_fail_dict</span><span class="p">[(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">split_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>  <span class="c1"># We lower the minimum value needed</span>
                <span class="n">constrained_min</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">split_list</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># We raise the maximum value allowed</span>
                <span class="n">constrained_max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">split_list</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Round everything to stay consistent</span>
    <span class="n">constrained_min</span><span class="p">,</span> <span class="n">constrained_measure</span><span class="p">,</span> <span class="n">constrained_max</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">constrained_min</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">constrained_measure</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> \
                                                            <span class="nb">round</span><span class="p">(</span><span class="n">constrained_max</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    <span class="c1"># Check if we failed the constraint, and return a boolean</span>
    <span class="k">if</span> <span class="n">constrained_min</span> <span class="o">&lt;=</span> <span class="n">constrained_measure</span> <span class="o">&lt;=</span> <span class="n">constrained_max</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># Measure is in the range, we DID NOT fail the constraint (failed = False)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Measure is outside the range, we DID fail the constraint (failed = True)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="solutions.handling.compare_solutions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compare_solutions</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="n">compared</span><span class="p">,</span> <span class="n">printing</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#solutions.handling.compare_solutions" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Compare two solutions (in vector form) to the same problem and determine the similarity between them based on the
AFSCs assigned to cadets.</p>
<p>Parameters:
    baseline (numpy.ndarray): The first solution (baseline) to compare.
    compared (numpy.ndarray): The second solution to compare against the baseline.
    printing (bool, optional): Whether to print the similarity percentage. Defaults to False.</p>
<p>Returns:
    percent_similar (float): The percentage of the compared solution that is the same as the baseline solution.</p>
<p>Note:
    This function compares two solutions represented as vectors and calculates the percentage of similarity
    between them in terms of the AFSCs assigned to cadets. The solutions must be for the same set of cadets
    and AFSCs.</p>
<p>Example:
    baseline = np.array([0, 1, 2, 1, 0])
    compared = np.array([1, 0, 2, 1, 0])
    similarity = compare_solutions(baseline, compared, printing=True)
    # Output: The two solutions are 60.0% the same (3/5).</p>

            <details class="quote">
              <summary>Source code in <code>afccp/solutions/handling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compare_solutions</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="n">compared</span><span class="p">,</span> <span class="n">printing</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compare two solutions (in vector form) to the same problem and determine the similarity between them based on the</span>
<span class="sd">    AFSCs assigned to cadets.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        baseline (numpy.ndarray): The first solution (baseline) to compare.</span>
<span class="sd">        compared (numpy.ndarray): The second solution to compare against the baseline.</span>
<span class="sd">        printing (bool, optional): Whether to print the similarity percentage. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        percent_similar (float): The percentage of the compared solution that is the same as the baseline solution.</span>

<span class="sd">    Note:</span>
<span class="sd">        This function compares two solutions represented as vectors and calculates the percentage of similarity</span>
<span class="sd">        between them in terms of the AFSCs assigned to cadets. The solutions must be for the same set of cadets</span>
<span class="sd">        and AFSCs.</span>

<span class="sd">    Example:</span>
<span class="sd">        baseline = np.array([0, 1, 2, 1, 0])</span>
<span class="sd">        compared = np.array([1, 0, 2, 1, 0])</span>
<span class="sd">        similarity = compare_solutions(baseline, compared, printing=True)</span>
<span class="sd">        # Output: The two solutions are 60.0% the same (3/5).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">percent_similar</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">baseline</span> <span class="o">==</span> <span class="n">compared</span> <span class="o">*</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseline</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">printing</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The two solutions are &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">percent_similar</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;% the same.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">percent_similar</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="solutions.handling.similarity_coordinates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">similarity_coordinates</span><span class="p">(</span><span class="n">similarity_matrix</span><span class="p">)</span></code>

<a href="#solutions.handling.similarity_coordinates" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Perform Multidimensional Scaling (MDS) on a similarity matrix to obtain coordinates
representing the solutions' similarity relationships.</p>
<p>Parameters:
- similarity_matrix (numpy.ndarray): A square similarity matrix where each element
  (i, j) measures the similarity between solutions i and j.</p>
<p>Returns:
- coordinates (numpy.ndarray): An array of 2D coordinates representing the solutions
  in a space where the distance between solutions reflects their similarity.</p>
<p>Description:
This function takes in a similarity matrix and performs Multidimensional Scaling (MDS)
to obtain coordinates representing the solutions in a lower-dimensional space. The
purpose of MDS is to transform similarity data into distances. In the resulting 2D
space, solutions that are similar to each other will be closer together, while
dissimilar solutions will be farther apart.</p>
<p>MDS is particularly useful for visualizing the similarity relationships among solutions.
These coordinates can be used for plotting or further analysis to gain insights into
how solutions relate to each other based on their similarities.</p>
<p>Note: Ensure that you have the required libraries, such as NumPy and Scikit-learn, installed.</p>

            <details class="quote">
              <summary>Source code in <code>afccp/solutions/handling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">similarity_coordinates</span><span class="p">(</span><span class="n">similarity_matrix</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform Multidimensional Scaling (MDS) on a similarity matrix to obtain coordinates</span>
<span class="sd">    representing the solutions&#39; similarity relationships.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - similarity_matrix (numpy.ndarray): A square similarity matrix where each element</span>
<span class="sd">      (i, j) measures the similarity between solutions i and j.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - coordinates (numpy.ndarray): An array of 2D coordinates representing the solutions</span>
<span class="sd">      in a space where the distance between solutions reflects their similarity.</span>

<span class="sd">    Description:</span>
<span class="sd">    This function takes in a similarity matrix and performs Multidimensional Scaling (MDS)</span>
<span class="sd">    to obtain coordinates representing the solutions in a lower-dimensional space. The</span>
<span class="sd">    purpose of MDS is to transform similarity data into distances. In the resulting 2D</span>
<span class="sd">    space, solutions that are similar to each other will be closer together, while</span>
<span class="sd">    dissimilar solutions will be farther apart.</span>

<span class="sd">    MDS is particularly useful for visualizing the similarity relationships among solutions.</span>
<span class="sd">    These coordinates can be used for plotting or further analysis to gain insights into</span>
<span class="sd">    how solutions relate to each other based on their similarities.</span>

<span class="sd">    Note: Ensure that you have the required libraries, such as NumPy and Scikit-learn, installed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Change similarity matrix into distance matrix</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">similarity_matrix</span>

    <span class="c1"># Get coordinates</span>
    <span class="k">if</span> <span class="n">afccp</span><span class="o">.</span><span class="n">globals</span><span class="o">.</span><span class="n">use_manifold</span><span class="p">:</span>
        <span class="n">mds</span> <span class="o">=</span> <span class="n">manifold</span><span class="o">.</span><span class="n">MDS</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dissimilarity</span><span class="o">=</span><span class="s1">&#39;precomputed&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">mds</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">embedding_</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">distances</span><span class="p">),</span> <span class="mi">2</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sklearn manifold not available&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">coordinates</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="solutions.handling.incorporate_rated_results_in_parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">incorporate_rated_results_in_parameters</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">printing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#solutions.handling.incorporate_rated_results_in_parameters" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>This function extracts the results from the two Rated solutions (for both USAFA &amp; ROTC)
and incorporates them into the problem's parameters. It fixes cadets who were "matched" by the algorithm
to specific AFSCs and constrains individuals who had "reserved" slots.</p>
<p>Parameters:
- instance: An instance of the problem, containing parameters and algorithm results.
- printing (bool, optional): A flag to control whether to print information during execution.
  Set to True to enable printing, and False to suppress it. Default is True.</p>
<p>Returns:
- parameters (dict): The updated parameters dictionary reflecting the rated algorithm results.</p>
<p>Description:
This function is used to integrate the outcomes of the Rated SOC (Source of Commissioning) algorithm into
the problem's parameters. It processes the results for both USAFA (United States Air Force Academy)
and ROTC (Reserve Officers' Training Corps) categories.</p>
<ul>
<li>
<p>The "Matched" cadets are assigned to specific AFSCs based on the algorithm results. These assignments
  are recorded in the 'J^Fixed' array within the parameters.</p>
</li>
<li>
<p>The "Reserved" cadets have their AFSC selections constrained based on their reserved slots. The
  'J^Reserved' dictionary is updated to enforce these constraints.</p>
</li>
<li>
<p>Special treatment is provided for AFSCs with an "alternate list" concept. Cadets who did not receive
  one of their top preferences but are next in line for a particular AFSC are assigned to the "alternate list."
  Cadets on this list may be given preferences or reserved slots, depending on availability.</p>
</li>
</ul>
<p>This function aims to ensure that the problem's parameters align with the Rated SOC algorithm's results,
facilitating further decision-making and analysis.</p>
<p>Note: Detailed information on the Rated SOC algorithm results is assumed to be available within the 'instance.'</p>

            <details class="quote">
              <summary>Source code in <code>afccp/solutions/handling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">incorporate_rated_results_in_parameters</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">printing</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function extracts the results from the two Rated solutions (for both USAFA &amp; ROTC)</span>
<span class="sd">    and incorporates them into the problem&#39;s parameters. It fixes cadets who were &quot;matched&quot; by the algorithm</span>
<span class="sd">    to specific AFSCs and constrains individuals who had &quot;reserved&quot; slots.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - instance: An instance of the problem, containing parameters and algorithm results.</span>
<span class="sd">    - printing (bool, optional): A flag to control whether to print information during execution.</span>
<span class="sd">      Set to True to enable printing, and False to suppress it. Default is True.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - parameters (dict): The updated parameters dictionary reflecting the rated algorithm results.</span>

<span class="sd">    Description:</span>
<span class="sd">    This function is used to integrate the outcomes of the Rated SOC (Source of Commissioning) algorithm into</span>
<span class="sd">    the problem&#39;s parameters. It processes the results for both USAFA (United States Air Force Academy)</span>
<span class="sd">    and ROTC (Reserve Officers&#39; Training Corps) categories.</span>

<span class="sd">    - The &quot;Matched&quot; cadets are assigned to specific AFSCs based on the algorithm results. These assignments</span>
<span class="sd">      are recorded in the &#39;J^Fixed&#39; array within the parameters.</span>

<span class="sd">    - The &quot;Reserved&quot; cadets have their AFSC selections constrained based on their reserved slots. The</span>
<span class="sd">      &#39;J^Reserved&#39; dictionary is updated to enforce these constraints.</span>

<span class="sd">    - Special treatment is provided for AFSCs with an &quot;alternate list&quot; concept. Cadets who did not receive</span>
<span class="sd">      one of their top preferences but are next in line for a particular AFSC are assigned to the &quot;alternate list.&quot;</span>
<span class="sd">      Cadets on this list may be given preferences or reserved slots, depending on availability.</span>

<span class="sd">    This function aims to ensure that the problem&#39;s parameters align with the Rated SOC algorithm&#39;s results,</span>
<span class="sd">    facilitating further decision-making and analysis.</span>

<span class="sd">    Note: Detailed information on the Rated SOC algorithm results is assumed to be available within the &#39;instance.&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">printing</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Incorporating rated algorithm results...&quot;</span><span class="p">)</span>

    <span class="c1"># Shorthand</span>
    <span class="n">p</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">solutions</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">value_parameters</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">solutions</span>
    <span class="n">mdl_p</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">mdl_p</span>
    <span class="k">if</span> <span class="n">mdl_p</span><span class="p">[</span><span class="s1">&#39;socs_to_use&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">socs_to_use</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;SOCs&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">socs_to_use</span> <span class="o">=</span> <span class="n">mdl_p</span><span class="p">[</span><span class="s1">&#39;socs_to_use&#39;</span><span class="p">]</span>
    <span class="n">upper_socs</span> <span class="o">=</span> <span class="p">[</span><span class="n">soc</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">soc</span> <span class="ow">in</span> <span class="n">socs_to_use</span><span class="p">]</span>

    <span class="c1"># Make sure we have the solutions from both SOCs with matches and reserves</span>
    <span class="k">for</span> <span class="n">soc</span> <span class="ow">in</span> <span class="n">upper_socs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">kind</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Reserves&#39;</span><span class="p">,</span> <span class="s1">&#39;Matches&#39;</span><span class="p">]:</span>
            <span class="n">solution_name</span> <span class="o">=</span> <span class="s2">&quot;Rated &quot;</span> <span class="o">+</span> <span class="n">soc</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; HR (&quot;</span> <span class="o">+</span> <span class="n">kind</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
            <span class="k">if</span> <span class="n">solution_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">solutions</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">p</span>  <span class="c1"># We don&#39;t have the required solutions!</span>

    <span class="c1"># Matched cadets get fixed in the solution!</span>
    <span class="k">for</span> <span class="n">soc</span> <span class="ow">in</span> <span class="n">upper_socs</span><span class="p">:</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="n">solutions</span><span class="p">[</span><span class="s2">&quot;Rated &quot;</span> <span class="o">+</span> <span class="n">soc</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; HR (Matches)&quot;</span><span class="p">]</span>
        <span class="n">matched_cadets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;j_array&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">matched_cadets</span><span class="p">:</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Fixed&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;j_array&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

    <span class="c1"># Reserved cadets AFSC selection is constrained to be AT LEAST their reserved Rated slot</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Reserved&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">soc</span> <span class="ow">in</span> <span class="n">upper_socs</span><span class="p">:</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="n">solutions</span><span class="p">[</span><span class="s2">&quot;Rated &quot;</span> <span class="o">+</span> <span class="n">soc</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; HR (Reserves)&quot;</span><span class="p">]</span>
        <span class="n">reserved_cadets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="s1">&#39;j_array&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">reserved_cadets</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;j_array&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">choice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Reserved&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="n">choice</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Calculate additional rated algorithm result information for both SOCs</span>
    <span class="k">for</span> <span class="n">soc</span> <span class="ow">in</span> <span class="n">socs_to_use</span><span class="p">:</span>

        <span class="c1"># Do we want to potentially allow ROTC to fill USAFA pilot slots?</span>
        <span class="k">if</span> <span class="n">mdl_p</span><span class="p">[</span><span class="s1">&#39;usafa_soc_pilot_cross_in&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">soc</span> <span class="o">==</span> <span class="s1">&#39;rotc&#39;</span><span class="p">:</span>

            <span class="c1"># If we want to allow cross-flow, we need to add USAFA reserved pilot slots to be potentially filled</span>
            <span class="n">j_pilot_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;11XX_U&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># by ROTC (increase their alternate list)</span>

            <span class="c1"># First we calculate the number of reserved USAFA pilot slots there are</span>
            <span class="n">u_reserved_pilot</span> <span class="o">=</span> \
                <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Reserved&#39;</span><span class="p">]</span> <span class="k">if</span>
                 <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Reserved&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">j_pilot_u</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;usafa&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span>
            <span class="n">num_reserved_u_pilot</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">u_reserved_pilot</span><span class="p">)</span>

            <span class="c1"># We also need the number of hard alternates for USAFA pilot</span>
            <span class="n">u_hard_alternates_pilot</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Alternates (Hard)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">j_pilot_u</span><span class="p">]</span>
            <span class="n">num_hard_alternates_u_pilot</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">u_hard_alternates_pilot</span><span class="p">)</span>

            <span class="c1"># The number of potential additions for ROTC pilot is going to be the total number of resered USAFA slots</span>
            <span class="n">num_additions_rotc_pilot</span> <span class="o">=</span> <span class="n">num_reserved_u_pilot</span> <span class="o">-</span> <span class="n">num_hard_alternates_u_pilot</span>  <span class="c1"># minus hard alternates</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">num_additions_rotc_pilot</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">augment_rated_algorithm_results</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">soc</span><span class="o">=</span><span class="n">soc</span><span class="p">,</span> <span class="n">printing</span><span class="o">=</span><span class="n">instance</span><span class="o">.</span><span class="n">mdl_p</span><span class="p">[</span><span class="s1">&#39;alternate_list_iterations_printing&#39;</span><span class="p">],</span>
                                            <span class="n">num_additions_rotc_pilot</span><span class="o">=</span><span class="n">num_additions_rotc_pilot</span><span class="p">)</span>

    <span class="c1"># Print statement</span>
    <span class="k">if</span> <span class="n">printing</span><span class="p">:</span>

        <span class="c1"># Matched/Reserved Lists</span>
        <span class="n">print_str</span> <span class="o">=</span> <span class="s2">&quot;Rated SOC Algorithm Results:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">soc</span> <span class="ow">in</span> <span class="n">upper_socs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">kind</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Fixed&quot;</span><span class="p">,</span> <span class="s2">&quot;Reserved&quot;</span><span class="p">]:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="n">soc</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;_cadets&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^&#39;</span> <span class="o">+</span> <span class="n">kind</span><span class="p">]]))</span>
                <span class="n">print_str</span> <span class="o">+=</span> <span class="n">soc</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">kind</span> <span class="o">+</span> <span class="s1">&#39; Cadets: &#39;</span> <span class="o">+</span> <span class="n">count</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">print_str</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>

        <span class="c1"># Alternate Lists</span>
        <span class="n">count_u</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Alternate [usafa]&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]])))</span>
        <span class="n">count_r</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Alternate [rotc]&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]])))</span>
        <span class="n">print_str</span> <span class="o">=</span> <span class="s2">&quot;USAFA Rated Alternates: &quot;</span> <span class="o">+</span> <span class="n">count_u</span> <span class="o">+</span> <span class="s2">&quot;, ROTC Rated Alternates: &quot;</span> <span class="o">+</span> <span class="n">count_r</span>
        <span class="k">if</span> <span class="s1">&#39;ots&#39;</span> <span class="ow">in</span> <span class="n">socs_to_use</span><span class="p">:</span>
            <span class="n">count_o</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Alternate [ots]&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]])))</span>
            <span class="n">print_str</span> <span class="o">+=</span> <span class="s2">&quot;, OTS Rated Alternates: &quot;</span> <span class="o">+</span> <span class="n">count_o</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">print_str</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">p</span>  <span class="c1"># Return the parameters!</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="solutions.handling.augment_rated_algorithm_results" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">augment_rated_algorithm_results</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">soc</span><span class="o">=</span><span class="s1">&#39;rotc&#39;</span><span class="p">,</span> <span class="n">printing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_additions_rotc_pilot</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span></code>

<a href="#solutions.handling.augment_rated_algorithm_results" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Analyzes the results of the Rated SOC algorithm for a specific SOC (Source of Commissioning),
such as ROTC or USAFA, and augments the system's parameters. This analysis includes identifying
alternates and definitively matching additional individuals to AFSCs.</p>
<p>Parameters:
- p (dict): The problem's parameters containing relevant data.
- soc (str, optional): The SOC to analyze and augment results for. Default is 'rotc'.
- printing (bool, optional): A flag to control whether to print information during execution.
  Set to True to enable printing, and False to suppress it. Default is False.</p>
<p>Returns:
- parameters (dict): The updated parameters dictionary reflecting the rated algorithm results,
  including alternates and definitively matched individuals.</p>
<p>Description:
This function processes the results of the Rated SOC algorithm for a specific SOC category,
identifying alternates and definitively matching additional individuals to AFSCs. The primary goal
is to ensure the system's parameters accurately reflect the outcomes of the algorithm, which
aids in further analysis and decision-making.</p>
<ul>
<li>'Reserved' cadets have their AFSC selections constrained to match their reserved slots.</li>
<li>'Matched' cadets are assigned specific AFSCs based on the algorithm results.</li>
<li>'Alternates' are cadets who did not receive one of their top AFSC preferences but are next in line
  for specific AFSCs based on the algorithm's execution. Alternates may be given preferences or
  reserved slots, depending on availability.</li>
</ul>
<p>Note: Detailed information on the Rated SOC algorithm results is assumed to be available within the 'parameters.'</p>

            <details class="quote">
              <summary>Source code in <code>afccp/solutions/handling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">augment_rated_algorithm_results</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">soc</span><span class="o">=</span><span class="s1">&#39;rotc&#39;</span><span class="p">,</span> <span class="n">printing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_additions_rotc_pilot</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyzes the results of the Rated SOC algorithm for a specific SOC (Source of Commissioning),</span>
<span class="sd">    such as ROTC or USAFA, and augments the system&#39;s parameters. This analysis includes identifying</span>
<span class="sd">    alternates and definitively matching additional individuals to AFSCs.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - p (dict): The problem&#39;s parameters containing relevant data.</span>
<span class="sd">    - soc (str, optional): The SOC to analyze and augment results for. Default is &#39;rotc&#39;.</span>
<span class="sd">    - printing (bool, optional): A flag to control whether to print information during execution.</span>
<span class="sd">      Set to True to enable printing, and False to suppress it. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - parameters (dict): The updated parameters dictionary reflecting the rated algorithm results,</span>
<span class="sd">      including alternates and definitively matched individuals.</span>

<span class="sd">    Description:</span>
<span class="sd">    This function processes the results of the Rated SOC algorithm for a specific SOC category,</span>
<span class="sd">    identifying alternates and definitively matching additional individuals to AFSCs. The primary goal</span>
<span class="sd">    is to ensure the system&#39;s parameters accurately reflect the outcomes of the algorithm, which</span>
<span class="sd">    aids in further analysis and decision-making.</span>

<span class="sd">    - &#39;Reserved&#39; cadets have their AFSC selections constrained to match their reserved slots.</span>
<span class="sd">    - &#39;Matched&#39; cadets are assigned specific AFSCs based on the algorithm results.</span>
<span class="sd">    - &#39;Alternates&#39; are cadets who did not receive one of their top AFSC preferences but are next in line</span>
<span class="sd">      for specific AFSCs based on the algorithm&#39;s execution. Alternates may be given preferences or</span>
<span class="sd">      reserved slots, depending on availability.</span>

<span class="sd">    Note: Detailed information on the Rated SOC algorithm results is assumed to be available within the &#39;parameters.&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Start with a full list of cadets eligible for each AFSC from this SOC</span>
    <span class="n">possible_cadets</span> <span class="o">=</span> <span class="p">{</span><span class="n">j</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^E&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">soc</span> <span class="o">+</span> <span class="s1">&#39;_cadets&#39;</span><span class="p">]))</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]}</span>

    <span class="c1"># Used for stopping conditions</span>
    <span class="n">last_reserves</span><span class="p">,</span> <span class="n">last_matches</span><span class="p">,</span> <span class="n">last_alternates_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1000</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]]),</span> \
                                                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1000</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]]),</span> \
                                                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1000</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]])</span>

    <span class="k">if</span> <span class="n">printing</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">SOC:&quot;</span><span class="p">,</span> <span class="n">soc</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">()</span>

    <span class="c1"># Main algorithm</span>
    <span class="n">iteration</span><span class="p">,</span> <span class="n">iterating</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span>
    <span class="k">while</span> <span class="n">iterating</span><span class="p">:</span>

        <span class="c1"># Set of cadets reserved or matched to each AFSC</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Reserved&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">j</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Reserved&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Reserved&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="n">soc</span><span class="p">][</span><span class="n">i</span><span class="p">]])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]}</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Matched&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">j</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Fixed&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Fixed&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="n">soc</span><span class="p">][</span><span class="n">i</span><span class="p">]])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]}</span>

        <span class="c1"># Number of alternates (number of reserved slots)</span>
        <span class="n">num_reserved</span> <span class="o">=</span> <span class="p">{</span><span class="n">j</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Reserved&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]}</span>

        <span class="c1"># Need to determine who falls into each category of alternates</span>
        <span class="n">hard_alternates</span> <span class="o">=</span> <span class="p">{</span><span class="n">j</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]}</span>
        <span class="n">soft_r_alternates</span> <span class="o">=</span> <span class="p">{</span><span class="n">j</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]}</span>
        <span class="n">soft_n_alternates</span> <span class="o">=</span> <span class="p">{</span><span class="n">j</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]}</span>
        <span class="n">alternates</span> <span class="o">=</span> <span class="p">{</span><span class="n">j</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]}</span>  <span class="c1"># all the cadets ordered here</span>

        <span class="c1"># Loop through each rated AFSC to determine alternates</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]:</span>

            <span class="c1"># We may want to increase the length of ROTC pilot alternate list to account for USAFA</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="s1">&#39;11XX_R&#39;</span><span class="p">:</span>
                <span class="n">num_additions</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">num_additions_rotc_pilot</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">num_additions</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Loop through each cadet in order of the AFSC&#39;s preference from this SOC</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">[</span><span class="n">soc</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                    <span class="k">continue</span>

                <span class="c1"># Assume this cadet is &quot;next in line&quot; until proven otherwise</span>
                <span class="n">next_in_line</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># Is the cadet already fixed to something else?</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Fixed&#39;</span><span class="p">]:</span>
                    <span class="n">next_in_line</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">possible_cadets</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                        <span class="n">possible_cadets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                <span class="c1"># Is this cadet reserved for something?</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Reserved&#39;</span><span class="p">]:</span>

                    <span class="c1"># If they&#39;re already reserved for this AFSC or something better, they&#39;re not considered</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Reserved&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span>
                        <span class="n">next_in_line</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">possible_cadets</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                            <span class="n">possible_cadets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                <span class="c1"># If this cadet is next in line (and we still have alternates to assign)</span>
                <span class="k">if</span> <span class="n">next_in_line</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">hard_alternates</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">num_reserved</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">num_additions</span><span class="p">):</span>
                    <span class="n">alternates</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                    <span class="c1"># Loop through the cadet&#39;s preferences:</span>
                    <span class="k">for</span> <span class="n">j_c</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>

                        <span class="c1"># Determine what kind of alternate this cadet is</span>
                        <span class="k">if</span> <span class="n">j_c</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>  <span class="c1"># Hard Rated Alternate</span>
                            <span class="n">hard_alternates</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                            <span class="k">break</span>
                        <span class="k">elif</span> <span class="n">j_c</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">possible_cadets</span><span class="p">[</span><span class="n">j_c</span><span class="p">]:</span>  <span class="c1"># Soft Rated Alternate</span>
                                <span class="n">soft_r_alternates</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                                <span class="k">break</span>
                            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Can&#39;t be matched, go to next preference</span>
                                <span class="k">continue</span>
                        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Soft Non-Rated Alternate</span>
                            <span class="n">soft_n_alternates</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                            <span class="k">break</span>

                <span class="c1"># We&#39;ve run out of hard alternates to assign (thus, we&#39;re done assigning alternates)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">hard_alternates</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">num_reserved</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">num_additions</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">possible_cadets</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                        <span class="n">possible_cadets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="c1"># Loop through each rated AFSC to potentially turn &quot;reserved&quot; slots into &quot;matched&quot; slots</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]:</span>

            <span class="c1"># Loop through each cadet in order of the AFSC&#39;s preference from this SOC</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">[</span><span class="n">soc</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                    <span class="k">continue</span>

                <span class="c1"># Does this cadet have a reserved slot for something?</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Reserved&#39;</span><span class="p">]:</span>

                    <span class="c1"># Is this cadet reserved for this AFSC?</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Reserved&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;c_pref_matrix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span>

                        <span class="c1"># Determine if there&#39;s any possible way this cadet might not be matched to this AFSC</span>
                        <span class="n">inevitable_match</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">for</span> <span class="n">j_c</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Reserved&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">j_c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]:</span>
                                <span class="n">inevitable_match</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Rated</span>
                                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">alternates</span><span class="p">[</span><span class="n">j_c</span><span class="p">]:</span>
                                    <span class="n">inevitable_match</span> <span class="o">=</span> <span class="kc">False</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">possible_cadets</span><span class="p">[</span><span class="n">j_c</span><span class="p">]:</span>
                                        <span class="n">possible_cadets</span><span class="p">[</span><span class="n">j_c</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="c1"># Remove this cadet as a possibility!</span>

                        <span class="c1"># If still inevitable, change from reserved to fixed</span>
                        <span class="k">if</span> <span class="n">inevitable_match</span><span class="p">:</span>
                            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Fixed&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
                            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Reserved&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                <span class="c1"># This cadet cannot receive this AFSC</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">alternates</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">possible_cadets</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                    <span class="n">possible_cadets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="c1"># Print Statement</span>
        <span class="k">if</span> <span class="n">printing</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Iteration&quot;</span><span class="p">,</span> <span class="n">iteration</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Possible&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span> <span class="nb">len</span><span class="p">(</span><span class="n">possible_cadets</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]})</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Matched&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Matched&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]})</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reserved&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Reserved&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]})</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Alternates (Hard)&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span> <span class="nb">len</span><span class="p">(</span><span class="n">hard_alternates</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]})</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Alternates (Soft)&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afscs&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span> <span class="nb">len</span><span class="p">(</span><span class="n">soft_n_alternates</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span>
                                                       <span class="nb">len</span><span class="p">(</span><span class="n">soft_r_alternates</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]})</span>

        <span class="c1"># Once we stop changing from the algorithm, we&#39;re done!</span>
        <span class="n">current_matched</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Matched&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]])</span>
        <span class="n">current_reserved</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Reserved&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]])</span>
        <span class="n">current_alternates_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">hard_alternates</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]])</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">current_matched</span> <span class="o">-</span> <span class="n">last_matches</span> <span class="o">+</span> <span class="n">current_reserved</span> <span class="o">-</span>
                  <span class="n">last_reserves</span> <span class="o">+</span> <span class="n">current_alternates_h</span> <span class="o">-</span> <span class="n">last_alternates_h</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">iterating</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">last_matches</span><span class="p">,</span> <span class="n">last_reserves</span><span class="p">,</span> <span class="n">last_alternates_h</span> <span class="o">=</span> <span class="n">current_matched</span><span class="p">,</span> <span class="n">current_reserved</span><span class="p">,</span> <span class="n">current_alternates_h</span>

        <span class="c1"># Next iteration</span>
        <span class="n">iteration</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Incorporate alternate lists (broken down by Hard/Soft)</span>
    <span class="k">if</span> <span class="s1">&#39;J^Alternates (Hard)&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Alternates (Hard)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="s1">&#39;J^Alternates (Soft)&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Alternates (Soft)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Rated Cadets&#39;</span><span class="p">][</span><span class="n">soc</span><span class="p">]:</span>  <span class="c1"># Loop through all rated cadets</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Rated Choices&#39;</span><span class="p">][</span><span class="n">soc</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>  <span class="c1"># Loop through rated preferences in order</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">hard_alternates</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Alternates (Hard)&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">soft_r_alternates</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">or</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">soft_n_alternates</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Alternates (Soft)&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
                <span class="k">break</span> <span class="c1"># Next cadet</span>

    <span class="c1"># Alternate List Optimization Formulation Sets Needed</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Preferred [&#39;</span> <span class="o">+</span> <span class="n">soc</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Preferred [&#39;</span> <span class="o">+</span> <span class="n">soc</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Alternate [&#39;</span> <span class="o">+</span> <span class="n">soc</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Rated&#39;</span><span class="p">]:</span>

        <span class="c1"># Empty sets for each AFSC</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Alternate [&#39;</span> <span class="o">+</span> <span class="n">soc</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Preferred [&#39;</span> <span class="o">+</span> <span class="n">soc</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Preferred [&#39;</span> <span class="o">+</span> <span class="n">soc</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Loop through each cadet in order of the AFSC&#39;s preference</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>

            <span class="c1"># Where this cadet ranked this AFSC</span>
            <span class="n">cadet_rank_afsc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Set of more preferred AFSCs (including this AFSC too) for this cadet</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Preferred [&#39;</span> <span class="o">+</span> <span class="n">soc</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cadet_preferences&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="n">cadet_rank_afsc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Where this AFSC ranked this cadet</span>
            <span class="n">afsc_rank_cadet</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Set of more preferred cadets (including this cadet too) for this AFSC</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Preferred [&#39;</span> <span class="o">+</span> <span class="n">soc</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span>
                <span class="n">p</span><span class="p">[</span><span class="s1">&#39;afsc_preferences&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][:</span><span class="n">afsc_rank_cadet</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">soc</span> <span class="o">+</span> <span class="s1">&#39;_cadets&#39;</span><span class="p">])</span>

            <span class="c1"># Is this cadet an alternate from this SOC?</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="n">soc</span> <span class="o">+</span> <span class="s1">&#39;_cadets&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Alternates (Hard)&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Alternates (Soft)&#39;</span><span class="p">]):</span>

                <span class="c1"># This cadet needs to be an alternate specifically for this AFSC</span>
                <span class="n">alternate</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Alternates (Hard)&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Alternates (Hard)&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                        <span class="n">alternate</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Alternates (Soft)&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;J^Alternates (Soft)&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                        <span class="n">alternate</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">alternate</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># Add the cadet to the alternate list for this AFSC</span>
                <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Alternate [&#39;</span> <span class="o">+</span> <span class="n">soc</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="c1"># Convert to numpy array</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Alternate [&#39;</span> <span class="o">+</span> <span class="n">soc</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;I^Alternate [&#39;</span> <span class="o">+</span> <span class="n">soc</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>

    <span class="c1"># Return updated parameters (and alternate lists)</span>
    <span class="k">return</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://gitlab.com/path-to-your-repo" target="_blank" rel="noopener" title="gitlab.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/input/tex/extensions/bm.js"></script>
      
    
  </body>
</html>